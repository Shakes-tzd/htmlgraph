<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Auto-Filter .htmlgraph Metadata from Drift Scoring</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="chore-auto-filter-htmlgraph-metadata"
             data-type="chore"
             data-status="done"
             data-priority="high"
             data-created="2025-12-16T14:20:00+00:00"
             data-updated="2025-12-16T14:20:00+00:00" data-agent-assigned="claude">

        <header>
            <h1>Auto-Filter .htmlgraph Metadata from Drift Scoring</h1>
            <div class="metadata">
                <span class="badge status-done">Done</span>
                <span class="badge priority-high">High Priority</span>
            </div>
        </header>

        <nav data-graph-edges>
            <section data-edge-type="related">
                <h3>Related:</h3>
                <ul>
                    <li><a href="feature-self-tracking.html" data-relationship="related">Self-Tracking Feature</a></li>
                    <li><a href="feature-drift-auto-classification.html" data-relationship="related">Drift Auto-Classification Feature</a></li>
                    <li><a href="chore-drift-classification-consolidation.html" data-relationship="related">Consolidation Chore</a></li>
                </ul>
            </section>
            <section data-edge-type="blocks">
                <h3>Blocks:</h3>
                <ul>
                    <li><a href="feature-self-tracking.html" data-relationship="blocks">feature-self-tracking progression (prevents false positive drift signals)</a></li>
                </ul>
            </section>
            <section data-edge-type="implemented-in">
                <h3>Implemented-In:</h3>
                <ul>
                    <li><a href=".html" data-relationship="implemented-in">Current session activities</a></li>
                </ul>
            </section>
        </nav>
        <section data-properties>
            <h3>Properties</h3>
            <dl>
                <dt>Type</dt>
                <dd data-key="type" data-value="None">None</dd>
<dt>Detection-Method</dt>
                <dd data-key="detection-method" data-value="None">None</dd>
<dt>Root-Cause</dt>
                <dd data-key="root-cause" data-value="None">None</dd>
<dt>Impact</dt>
                <dd data-key="impact" data-value="None">None</dd>
<dt>Effort</dt>
                <dd data-key="effort" data-value="None" data-unit="hours">None hours</dd>
            </dl>
        </section>
        <section data-steps>
            <h3>Implementation Steps</h3>
            <ol>
                <li data-completed="false">⏳ Update drift scoring algorithm to exclude .htmlgraph/** file patterns</li>
                <li data-completed="false">⏳ Add configuration flag for metadata filtering in drift calculator</li>
                <li data-completed="false">⏳ Implement filtering for .htmlgraph/sessions, .htmlgraph/spikes, .htmlgraph/chores, .htmlgraph/features metadata reads</li>
                <li data-completed="false">⏳ Add unit tests for drift filtering logic (test inclusion/exclusion patterns)</li>
                <li data-completed="false">⏳ Verify feature-self-tracking session no longer triggers false drift warnings</li>
                <li data-completed="false">⏳ Update drift-queue.json purge strategy to remove self-referential entries</li>
            </ol>
        </section>
        <section data-content>
            <h3>Description</h3>
            The current drift classification system is detecting high-drift signals (0.71) when Claude Code agents read .htmlgraph metadata files. These system infrastructure reads should not count toward feature development drift scoring.
Root Issue Analysis:
Detected Pattern Read: drift-queue.json (appears 2-3 times in activity log) Read: spike-classify-high-drift-activities.html Read: chore-drift-classification-consolidation.html Skill: htmlgraph-tracker activation Why This Happens Drift detection runs on ALL file operations .htmlgraph/* files are part of the tracking infrastructure Multiple reads of tracking metadata = high drift score Creates false positive: "looks like the agent went off-topic" when really they're doing system work Impact Prevents feature-self-tracking from completing (blocked by drift noise) Reduces signal-to-noise ratio in drift detection Creates confusion: legitimate system work flagged as off-topic
Solution Approach:
Filter Algorithm: Exclude .htmlgraph/** patterns from drift calculation Pattern: /.htmlgraph\/(drift-queue\.json|sessions|spikes|chores|features|events)/ Rationale: These are system metadata, not feature code Configuration: Add flag to enable/disable metadata filtering Default: True (filter enabled) Allow override for specific use cases Testing: Comprehensive unit tests for filtering rules Test that .htmlgraph/* files are excluded Test that actual feature files are still included Test edge cases (nested paths, symlinks) Verification: Re-run feature-self-tracking session and confirm no false drift warnings
Acceptance Criteria:
✓ Drift scores no longer include .htmlgraph/** reads ✓ feature-self-tracking can progress without false drift triggers ✓ Unit tests validate filtering logic (≥95% coverage) ✓ Configuration option documented ✓ No regression in existing drift detection for actual off-topic activities ✓ drift-queue.json cleaned of self-referential metadata entries
Files to Modify:
src/python/htmlgraph/drift.py (drift calculation logic) src/python/htmlgraph/config.py (add metadata_filter_enabled flag) tests/python/test_drift_filtering.py (new test suite) .htmlgraph/drift-queue.json (purge obsolete entries)
Why This Is a CHORE:
Infrastructure/maintenance work (improving drift system) No new user-facing features added Fixes operational noise/false positives Enables other features (feature-self-tracking) to progress
        </section>
    </article>
</body>
</html>
