<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Chore: Exclude .htmlgraph/* from Drift Scoring</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="chore-drift-system-filtering"
             data-type="chore"
             data-status="pending"
             data-priority="high"
             data-created="2025-12-16T20:45:00Z"
             data-updated="2025-12-16T20:45:00Z"
             data-agent-assigned="claude">

        <header>
            <h1>Exclude .htmlgraph/* from Drift Scoring</h1>
            <div class="metadata">
                <span class="badge status-pending">Pending</span>
                <span class="badge priority-high">High Priority</span>
            </div>
        </header>

        <nav data-graph-edges>
            <section data-edge-type="related">
                <h3>Related:</h3>
                <ul>
                    <li><a href="../features/feature-self-tracking.html" data-relationship="related">Self-Tracking Feature</a></li>
                    <li><a href="chore-drift-classification-consolidation.html" data-relationship="related">Drift Classification Consolidation</a></li>
                    <li><a href="../spikes/spike-classify-high-drift-activities.html" data-relationship="related">Drift Activity Classification Research</a></li>
                </ul>
            </section>
            <section data-edge-type="blocks">
                <h3>Blocks:</h3>
                <ul>
                    <li><a href="../features/feature-self-tracking.html" data-relationship="blocks">Self-Tracking Feature Progress</a></li>
                </ul>
            </section>
        </nav>

        <section data-properties>
            <h3>Classification Summary</h3>
            <dl>
                <dt>Work Item Type</dt>
                <dd data-key="type">CHORE - Infrastructure/Maintenance</dd>

                <dt>Root Cause</dt>
                <dd data-key="cause">System metadata reads inflating drift scores (0.71)</dd>

                <dt>Impact</dt>
                <dd data-key="impact">False positive drift warnings prevent feature work from progressing</dd>

                <dt>Detected From</dt>
                <dd data-key="source">5 high-drift activities reading .htmlgraph/** files during feature-self-tracking</dd>
            </dl>
        </section>

        <section data-steps>
            <h3>Implementation Tasks</h3>
            <ol>
                <li data-completed="false">
                    ⏳ Update drift scoring algorithm to exclude .htmlgraph/** file reads
                </li>
                <li data-completed="false">
                    ⏳ Implement path filtering in drift_index.py (or equivalent module)
                </li>
                <li data-completed="false">
                    ⏳ Add unit tests for filtering logic (test excluded paths are skipped)
                </li>
                <li data-completed="false">
                    ⏳ Test on existing drift-queue.json - verify 0.71 activities filter out
                </li>
                <li data-completed="false">
                    ⏳ Document exclusion rules in CLAUDE.md under "Drift Classification"
                </li>
                <li data-completed="false">
                    ⏳ Verify feature-self-tracking can proceed without false drift warnings
                </li>
            </ol>
        </section>

        <section data-content>
            <h3>Description</h3>
            <p>During feature-self-tracking work, the drift classification system detected 5 high-drift activities (0.71 score) that are actually system maintenance operations reading .htmlgraph metadata files. These infrastructure reads should not count as "off-topic" drift.</p>

            <h4>Problem Statement:</h4>
            <ul>
                <li>Agent reads .htmlgraph/drift-queue.json to understand tracking system</li>
                <li>Agent reads .htmlgraph/spikes/spike-*.html to analyze classifications</li>
                <li>Agent reads .htmlgraph/features/feature-*.html to understand feature context</li>
                <li>Result: Drift score of 0.71 flags these as "off-topic" work</li>
                <li>Impact: Self-tracking feature can't progress due to false positive drift warnings</li>
            </ul>

            <h4>Root Cause Analysis:</h4>
            <p>The drift classification system lacks context awareness:</p>
            <ul>
                <li>It counts ALL file reads equally</li>
                <li>It doesn't distinguish between "operational" reads (.htmlgraph/*) and "feature" reads (src/*)</li>
                <li>System reads for understanding the tracking system itself count as drift</li>
                <li>This creates self-referential false positives when agents introspect their own tools</li>
            </ul>

            <h4>Solution Approach:</h4>
            <ol>
                <li><strong>Filter:</strong> Exclude .htmlgraph/** paths from drift calculation entirely</li>
                <li><strong>Rationale:</strong> System infrastructure reads are operational, not "off-topic"</li>
                <li><strong>Scope:</strong> Apply to drift_index.py, all active drift calculations</li>
                <li><strong>Testing:</strong> Verify with existing 0.71 drift activities - should become 0.0</li>
            </ol>

            <h4>Implementation Details:</h4>
            <pre data-language="python">
# In drift_index.py or equivalent module:
DRIFT_EXCLUDED_PATHS = [
    '.htmlgraph/',
    '.claude-plugin/',
]

def should_exclude_from_drift(file_path):
    """Check if file is part of system infrastructure."""
    for excluded_prefix in DRIFT_EXCLUDED_PATHS:
        if file_path.startswith(excluded_prefix):
            return True
    return False

def calculate_drift(activities):
    """Calculate drift excluding system infrastructure files."""
    filtered_activities = [
        a for a in activities
        if not should_exclude_from_drift(a.get('file_path', ''))
    ]
    return drift_score(filtered_activities)
            </pre>

            <h4>Acceptance Criteria:</h4>
            <ul>
                <li>✓ Drift scores no longer include .htmlgraph/** reads</li>
                <li>✓ Existing 0.71 drift activities now score 0.0 or near-zero</li>
                <li>✓ Unit tests verify filtering logic works correctly</li>
                <li>✓ Self-tracking feature can progress without false warnings</li>
                <li>✓ Documentation updated with exclusion rules</li>
                <li>✓ No regression in legitimate drift detection</li>
            </ul>
        </section>

        <section data-activity-log>
            <h3>Activity Log</h3>
            <ol reversed>
                <li data-timestamp="2025-12-16T20:45:00Z" data-agent="claude">
                    Created chore: Exclude .htmlgraph/* from drift scoring to fix false positive drift warnings
                </li>
            </ol>
        </section>
    </article>
</body>
</html>
