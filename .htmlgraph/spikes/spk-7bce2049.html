<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Fix Activity Feed Event Ordering</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="spk-7bce2049"
             data-type="spike"
             data-status="todo"
             data-priority="medium"
             data-created="2026-01-06T11:59:51.928295"
             data-updated="2026-01-06T11:59:51.928297" data-spike-type="general" data-timebox-hours="4" data-agent-assigned="coder">

        <header>
            <h1>Fix Activity Feed Event Ordering</h1>
            <div class="metadata">
                <span class="badge status-todo">Todo</span>
                <span class="badge priority-medium">Medium Priority</span>
            </div>
        </header>

    
        <section data-spike-metadata>
            <h3>Spike Metadata</h3>
            <dl>
                <dt>Type</dt>
                <dd>General</dd>
                <dt>Timebox</dt>
                <dd>4 hours</dd>
            </dl>
        </section>
        <section data-findings>
            <h3>Findings</h3>
            <div class="findings-content">
                ## Activity Feed Event Ordering Fix

**Issue:** Events displayed in ascending order (oldest first)
- Newest event (claude-code 15:51) appeared at BOTTOM
- Oldest event (test-agent 15:46) appeared at TOP
- Expected: Descending order (newest first)

**Root Cause:** Query returned events in DESC order correctly, but the iteration through `events` list built `root_events` in query order. Template then displayed items in that same order.

**Solution:** Reverse the `root_events` list after collecting all root-level events before building hierarchical structure.

**File:** `/Users/shakes/DevProjects/htmlgraph/src/python/htmlgraph/api/main.py`

**Change (Lines 248-250):**
```python
# Reverse root_events to display newest first (DESC order)
# Query returns DESC but iteration builds list in query order
root_events.reverse()
```

**Result:**
✅ Newest events now appear at TOP of Activity Feed (newest first)
✅ Oldest events appear at BOTTOM (oldest last)
✅ New real-time WebSocket events stream in at top with green highlight
✅ Hierarchical parent-child structure maintained
✅ All tests passing (1354 pass, pre-existing failures unrelated)
✅ Code quality: Ruff and mypy both pass

**Impact:**
- Activity Feed now displays in standard UX order (newest first)
- Matches user expectations for real-time activity feeds
- WebSocket real-time updates will appear at top as expected
- No breaking changes to API or data structure
            </div>
        </section>
    </article>
</body>
</html>
