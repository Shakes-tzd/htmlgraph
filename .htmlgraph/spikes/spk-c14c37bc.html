<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Research: Imperative Delegation Language</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="spk-c14c37bc"
             data-type="spike"
             data-status="todo"
             data-priority="medium"
             data-created="2026-01-02T02:07:48.289743"
             data-updated="2026-01-02T02:07:48.289747" data-spike-type="technical" data-timebox-hours="4">

        <header>
            <h1>Research: Imperative Delegation Language</h1>
            <div class="metadata">
                <span class="badge status-todo">Todo</span>
                <span class="badge priority-medium">Medium Priority</span>
            </div>
        </header>

    
        <section data-spike-metadata>
            <h3>Spike Metadata</h3>
            <dl>
                <dt>Type</dt>
                <dd>Technical</dd>
                <dt>Timebox</dt>
                <dd>4 hours</dd>
            </dl>
        </section>
        <section data-findings>
            <h3>Findings</h3>
            <div class="findings-content">
                
# Research: Imperative Delegation Language for AI Skills

## Current Problems in SKILL.md

### 1. Weak Language Patterns (Lines 46-73)
**Current weak language:**
- "ALWAYS Delegate" (line 58) - Uses ALL CAPS but still framed as suggestion
- "Should" vs "Must" inconsistency throughout
- "Consider" and "Ask yourself" (line 68-72) - These are suggestions, not commands
- "CRITICAL" warnings without enforcement mechanism

**Why this fails:**
- "ALWAYS" is descriptive, not imperative
- "Should" = recommendation, not requirement
- Decision frameworks suggest options instead of blocking actions
- AI can rationalize ignoring suggestions

### 2. Permission-Based Framing (Lines 52-56)
**Current pattern:**
```
Operations You MAY Execute Directly:
- Task() - Delegation itself
- AskUserQuestion() - Clarifying requirements
```

**Problem:** "MAY" implies choice. AI interprets this as "I can choose whether to delegate."

**Better pattern:** FORBIDDEN vs PERMITTED lists with no middle ground.

### 3. Missing Negative Examples (Throughout)
**Current state:** Skill shows what TO do, not what is FORBIDDEN.

**Why this matters:** AI learns from both positive and negative examples. Without explicit "NEVER DO THIS" blocks, AI assumes unstated patterns are acceptable.

### 4. Rationale Instead of Rules (Lines 66-67)
**Current pattern:**
```
Why Git MUST be delegated: Git operations cascade... Context cost: Direct execution = 7+ tool calls
```

**Problem:** Explaining WHY doesn't enforce behavior. AI thinks "I understand the rationale, but in THIS case it doesn't apply."

---

## Imperative Language Patterns (Best Practices)

### 1. Modal Verbs Hierarchy (Strictness Levels)
Based on RFC 2119 and AI instruction research:

**MANDATORY (Enforced):**
- MUST / REQUIRED / SHALL - Absolute requirement
- MUST NOT / SHALL NOT - Absolute prohibition
- FORBIDDEN - Explicit ban

**RECOMMENDED (Not enforced):**
- SHOULD / RECOMMENDED - Strong suggestion
- SHOULD NOT / NOT RECOMMENDED - Strong discouragement
- MAY / OPTIONAL - Truly optional

**Key insight:** Only use MUST/MUST NOT for behaviors you want enforced. Everything else is a suggestion.

### 2. Negative Constraints Are Stronger Than Positive Rules
**Research finding:** AI agents are more compliant with "NEVER DO X" than "ALWAYS DO Y"

**Why:**
- "NEVER" = binary, no interpretation needed
- "ALWAYS" = AI rationalizes exceptions ("this case is different")

**Example transformation:**
```
❌ Weak: "ALWAYS delegate git operations"
✅ Strong: "FORBIDDEN: Direct execution of git commands. You MUST use Task() delegation."
```

### 3. First-Person Prohibitions
**Pattern:** Use "I MUST NOT" instead of "You should"

**Why:** First-person creates internal constraint, not external suggestion.

**Example:**
```
❌ Weak: "You should delegate git operations"
✅ Strong: "I MUST NOT execute git commands directly. I MUST delegate via Task()."
```

### 4. Explicit Consequences
**Pattern:** State what happens if rule is violated

**Example:**
```
FORBIDDEN: Direct git execution
CONSEQUENCE: Context pollution (7+ tool calls), failed hooks, merge conflicts
ENFORCEMENT: Immediate halt, delegate to subagent
```

### 5. Structured Rule Format (From ServiceNow research)
```
RULE: [Short imperative statement]
SCOPE: [When this applies]
REQUIRED ACTION: [Exactly what to do]
FORBIDDEN ACTION: [Exactly what NOT to do]
CONSEQUENCE: [What happens if violated]
EXAMPLES: [Show both correct and forbidden patterns]
```

---

## Recommended Changes to SKILL.md

### Section 1: Operations List (Lines 46-73)

**CURRENT (Weak):**
```
Operations You MAY Execute Directly:
- Task() - Delegation itself
- AskUserQuestion() - Clarifying requirements
- TodoWrite() - Tracking work items
- SDK operations - Creating features, spikes, analytics

ALWAYS Delegate:
- ✅ Git operations (commit, push, branch, merge) - **ALWAYS DELEGATE**
```

**REWRITE (Strong):**
```
## MANDATORY DELEGATION RULES

### FORBIDDEN: Direct Execution
I MUST NOT execute these operations directly. I MUST delegate ALL of these to subagents via Task():

- ❌ FORBIDDEN: Git commands (add, commit, push, pull, merge, branch, checkout)
- ❌ FORBIDDEN: Multi-file code changes (2+ files)
- ❌ FORBIDDEN: Research & exploration (codebase searches, documentation lookup)
- ❌ FORBIDDEN: Testing & validation (pytest, test suites, debugging)
- ❌ FORBIDDEN: Build & deployment (package publishing, environment setup)
- ❌ FORBIDDEN: Complex file operations (batch operations, large file processing)
- ❌ FORBIDDEN: Analysis & computation (performance profiling, large-scale analysis)

### CONSEQUENCE OF VIOLATION:
Direct execution causes:
- Context pollution (5-10+ tool calls instead of 2)
- Cascading failures (hooks fail, conflicts occur, retries needed)
- Lost strategic context (tactical details obscure high-level planning)
- Reduced parallel efficiency (serial execution when parallel is possible)

### PERMITTED: Strategic Operations Only
I MAY ONLY execute these operations directly:
- ✅ Task() - Delegation to subagents
- ✅ AskUserQuestion() - Clarifying user requirements
- ✅ TodoWrite() - Tracking work items
- ✅ SDK operations - Creating features, spikes, bugs, analytics
```

### Section 2: Decision Framework (Lines 68-73)

**CURRENT (Weak):**
```
Decision Framework - Ask yourself:
1. Will this likely be one tool call? → If uncertain, DELEGATE
2. Does this require error handling? → DELEGATE
```

**REWRITE (Strong):**
```
## ENFORCEMENT MECHANISM

### DEFAULT ACTION: DELEGATE
I MUST delegate by default. I MUST NOT rationalize direct execution.

### BLOCKING QUESTIONS (Halt Direct Execution)
Before executing ANY tool call, I MUST ask:
1. Is this operation in the FORBIDDEN list above?
   → If YES: HALT. Delegate via Task(). No exceptions.
2. Could this require error handling or retries?
   → If YES: HALT. Delegate via Task(). No exceptions.
3. Could this cascade into 2+ tool calls?
   → If YES: HALT. Delegate via Task(). No exceptions.

### ONLY PROCEED WITH DIRECT EXECUTION IF:
- Operation is explicitly in PERMITTED list (Task, AskUserQuestion, TodoWrite, SDK)
- AND I am 100% certain it is a single tool call with no cascading effects
- AND It is strategic (decisions), not tactical (execution)

### WHEN IN DOUBT: DELEGATE
If I am uncertain whether to delegate, I MUST delegate. No exceptions.
```

### Section 3: Add Negative Examples Section

**NEW SECTION (Insert after line 94):**
```
## FORBIDDEN PATTERNS (DO NOT USE)

### ❌ FORBIDDEN PATTERN 1: Direct Git Execution
```python
# NEVER DO THIS - Direct git commands
Bash(command="git add .")
Bash(command="git commit -m 'message'")
Bash(command="git push origin main")

# WHY FORBIDDEN: Cascades into 5-10 tool calls when hooks fail, conflicts occur
```

### ❌ FORBIDDEN PATTERN 2: Sequential Implementation
```python
# NEVER DO THIS - Implementing code changes directly
Edit(file_path="src/auth.py", ...)
Edit(file_path="src/middleware.py", ...)
Bash(command="pytest tests/test_auth.py")

# WHY FORBIDDEN: Multi-file changes consume context, risk conflicts
```

### ❌ FORBIDDEN PATTERN 3: Rationalized Direct Execution
```python
# NEVER DO THIS - Rationalizing "this is simple"
# "This is just a quick fix, I don't need to delegate"
Edit(file_path="config.py", ...)
Bash(command="git commit -m 'quick fix'")

# WHY FORBIDDEN: "Quick fixes" cascade unpredictably (hooks, tests, conflicts)
```

### ✅ CORRECT PATTERN: Always Delegate Tactical Work
```python
# CORRECT - Delegate ALL tactical execution
from htmlgraph.orchestration import delegate_with_id, get_results_by_task_id

task_id, prompt = delegate_with_id(
    "Implement authentication",
    """
    1. Edit src/auth.py
    2. Edit src/middleware.py
    3. Write tests
    4. Run pytest
    5. Commit changes with git
    6. Push to origin/main
    
    Handle ALL errors (hooks, conflicts, test failures).
    Report final status.
    """,
    "general-purpose"
)

Task(prompt=prompt, description=f"{task_id}: Implement authentication")

# Wait for completion, then retrieve results
results = get_results_by_task_id(sdk, task_id, timeout=120)
```
```

### Section 4: Git Operations (Lines 58-67)

**CURRENT (Weak):**
```
Git operations (commit, push, branch, merge) - **ALWAYS DELEGATE**

Why Git MUST be delegated: Git operations cascade unpredictably...
```

**REWRITE (Strong):**
```
### ABSOLUTE PROHIBITION: Git Commands

I MUST NOT execute git commands directly under ANY circumstances.

FORBIDDEN COMMANDS:
- git add, git commit, git push, git pull
- git merge, git rebase, git cherry-pick
- git branch, git checkout, git switch
- git tag, git reset, git revert

REQUIRED ACTION:
I MUST delegate ALL git operations via Task() to subagents.

ENFORCEMENT:
- If I consider direct git execution → HALT
- If I think "this is just one commit" → HALT
- If I think "git is simpler than delegating" → HALT
- ALWAYS delegate. No rationalization. No exceptions.

EXAMPLE DELEGATION:
```python
task_id, prompt = delegate_with_id(
    "Commit and push changes",
    """
    Files: [list files or "all changes"]
    Message: "your commit message"
    
    1. git add [files]
    2. git commit -m "message"
    3. git push origin main
    4. Handle errors (hooks, conflicts, push failures)
    5. Report status
    """,
    "general-purpose"
)
Task(prompt=prompt, description=f"{task_id}: Git workflow")
```
```

---

## Implementation Checklist

### High-Priority Changes (Do First)
1. ✅ Replace "MAY" with "FORBIDDEN" and "PERMITTED" lists
2. ✅ Replace "ALWAYS" with "I MUST NOT" + "I MUST"
3. ✅ Replace decision frameworks with blocking questions
4. ✅ Add FORBIDDEN PATTERNS section with negative examples
5. ✅ Add CONSEQUENCE sections to all rules
6. ✅ Remove all "should", "consider", "ask yourself" language

### Medium-Priority Changes
7. ✅ Rewrite git section with absolute prohibition
8. ✅ Add ENFORCEMENT MECHANISM section
9. ✅ Use first-person prohibitions throughout ("I MUST NOT" vs "You should")
10. ✅ Add structured rule format (RULE → SCOPE → REQUIRED → FORBIDDEN → CONSEQUENCE)

### Low-Priority Changes
11. ✅ Add positive examples (CORRECT PATTERN) after each negative example
12. ✅ Remove explanatory "why" text from rules (move to separate rationale section)
13. ✅ Add "DEFAULT ACTION: DELEGATE" header to top of section

---

## Key Insight: Enforcement Through Structure

**The problem isn't just language - it's structure.**

**Current structure:**
1. Explain what to do (positive)
2. Explain why (rationale)
3. Suggest a decision framework (optional)

**Enforcing structure:**
1. State what is FORBIDDEN (negative constraint)
2. State what is REQUIRED (imperative)
3. Show FORBIDDEN examples (concrete)
4. Show CORRECT examples (concrete)
5. State CONSEQUENCES of violation (enforcement)

**Research finding:** AI agents comply better with:
- Negative constraints ("NEVER") over positive rules ("ALWAYS")
- Concrete examples (code blocks) over abstract rules
- First-person prohibitions ("I MUST NOT") over third-person suggestions ("You should")
- Immediate consequences over delayed rationale

---

## Sources

### Official Documentation
1. **Anthropic Skill Best Practices**: [Skill authoring best practices - Claude Docs](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/best-practices)
2. **Claude Code Best Practices**: [Claude Code: Best practices for agentic coding](https://www.anthropic.com/engineering/claude-code-best-practices)

### Research & Industry Best Practices
3. **Imperative vs Suggestive Language**: [Advanced AI Agent Instructions Guide: ServiceNow](https://www.servicenow.com/community/now-assist-articles/advanced-ai-agent-instructions-guide-servicenow-edition/ta-p/3346578)
4. **MUST vs SHOULD in AI Instructions**: [11 Prompt Writing Rules for AI Agents - Datablist](https://www.datablist.com/how-to/rules-writing-prompts-ai-agents)
5. **Structured Enforcement Patterns**: [How to write 10/10 AI instructions - Optimizely](https://www.optimizely.com/insights/blog/how-to-write-ai-instructions/)

### Technical Standards
6. **RFC 2119 (Modal Verb Standards)**: Defines MUST, SHOULD, MAY hierarchy for specifications

            </div>
        </section>
        <section data-decision>
            <h3>Decision</h3>
            <p>Rewrite SKILL.md delegation section using imperative language patterns</p>
        </section>
    </article>
</body>
</html>
