<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Research: Top 3 Recommended Features Analysis</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="spk-363c62f4"
             data-type="spike"
             data-status="todo"
             data-priority="medium"
             data-created="2026-02-12T20:13:27.454415"
             data-updated="2026-02-12T20:13:27.454417" data-spike-type="general" data-timebox-hours="4" data-agent-assigned="researcher">

        <header>
            <h1>Research: Top 3 Recommended Features Analysis</h1>
            <div class="metadata">
                <span class="badge status-todo">Todo</span>
                <span class="badge priority-medium">Medium Priority</span>
            </div>
        </header>

    
        <section data-spike-metadata>
            <h3>Spike Metadata</h3>
            <dl>
                <dt>Type</dt>
                <dd>General</dd>
                <dt>Timebox</dt>
                <dd>4 hours</dd>
            </dl>
        </section>
        <section data-findings>
            <h3>Findings</h3>
            <div class="findings-content">
                
## Research Objective
Analyze the top 3 recommended features from HtmlGraph analytics to understand scope, dependencies, and implementation requirements.

## Features Analyzed

### Feature 1: feat-0de33d85 - Pre-commit Hook: Detect Incomplete Systematic Changes
**Status**: Todo (Critical Priority)
**Created**: 2026-01-03
**Session**: sess-529faa2c

**Description**:
This is a DUPLICATE of feat-dcdeb2d8 (created 20 seconds earlier). Both features have identical:
- Title: "Pre-commit Hook: Detect Incomplete Systematic Changes"
- Implementation steps (6 steps each)
- Session reference (sess-529faa2c)
- Priority (critical)

**Difference**: feat-0de33d85 has slightly more detailed step 2: "Add keyword detection in commit messages (replace, rename, migrate)" vs just "Add keyword detection in commit messages"

**RECOMMENDATION**: Consolidate these duplicates into a single feature before implementation.

---

### Feature 2: feat-1598baf6 - Phase 1: Pydantic Integration - Type-Safe CLI Arguments
**Status**: Todo (Critical Priority)
**Created**: 2026-01-05
**Session**: sess-3d9ec350

**Description**:
Convert CLI argument parsing from argparse to Pydantic models for type safety and validation.

**Implementation Steps** (7 steps):
1. Plan: Create Pydantic model spec for top-priority commands
2. Implement: Convert 5-10 top commands to Pydantic models
3. Integrate: Replace argparse validation with Pydantic validators
4. Connect: Integrate with Rich error formatting (ValidationError)
5. Test: Add integration tests for model validation
6. Config: Extend to config management with Pydantic Settings
7. Run quality gates and mark Phase 1 complete

**Current State Analysis**:
- ✅ Pydantic already a dependency (pyproject.toml: "pydantic>=2.0.0")
- ✅ Pydantic models ALREADY exist in `src/python/htmlgraph/cli/models.py`:
  - Filter models: FeatureFilter, SessionFilter, TrackFilter
  - Config models: InitConfig, ServeConfig, ServeApiConfig, BootstrapConfig
  - Result models: InitResult, ValidationResult
  - Display models: SessionDisplay, FeatureDisplay, TrackDisplay
- ✅ Pydantic validators already implemented
- ⚠️ BUT: CLI still uses argparse in main.py (create_parser())
- ⚠️ Models exist but aren't integrated with argparse yet

**Files to Touch**:
- `src/python/htmlgraph/cli/main.py` - Parser integration
- `src/python/htmlgraph/cli/core.py` - Command implementations
- `src/python/htmlgraph/cli/work.py` - Work command implementations
- `src/python/htmlgraph/cli/analytics.py` - Analytics commands
- `src/python/htmlgraph/cli/models.py` - Extend existing models
- Tests for validation

**Estimated Complexity**: MEDIUM
- Models already exist (50% done)
- Need to bridge argparse → Pydantic
- Integration pattern needed for each command
- ~10-15 commands to convert

**Best Suited Agent**: sonnet-coder (needs architectural thinking + implementation)

---

### Feature 3: feat-dcdeb2d8 - Pre-commit Hook: Detect Incomplete Systematic Changes
**Status**: Todo (Critical Priority)
**Created**: 2026-01-03
**Session**: sess-529faa2c

**DUPLICATE OF feat-0de33d85** (see above)

**Description** (from content section):
Add pre-commit validation that detects when a commit claims to do a systematic change but hasn't completed it.

**Detection Heuristics**:
- Commit message contains keywords: "replace", "rename", "migrate", "refactor all"
- Changed files show pattern-based modifications
- Verify ALL instances in codebase match the change

**Implementation**:
- Git hook script that analyzes commit messages and diffs
- Pattern detection for common refactoring operations
- Automated grep/ripgrep verification
- Fail commit if incomplete, show remaining instances

**Current State Analysis**:
- ✅ Pre-commit hook ALREADY exists at `.git/hooks/pre-commit`
- ✅ Current hook runs: ruff check, ruff format --check, mypy
- ✅ Infrastructure for git hooks exists:
  - `src/python/htmlgraph/session_context.py` - GitHooksInstaller class
  - `src/python/htmlgraph/hooks/installer.py` - Hook installation logic
  - `packages/claude-plugin/hooks/scripts/session-start.py` - Installs hooks
- ⚠️ Current hook does NOT detect incomplete systematic changes
- ⚠️ Need to ADD detection logic to existing hook

**Implementation Steps** (6 steps):
1. Create .git/hooks/pre-commit script for systematic change detection
2. Add keyword detection in commit messages
3. Implement pattern extraction from git diff
4. Add verification grep for remaining instances
5. Test with mock incomplete changes
6. Document hook usage in CLAUDE.md

**Files to Touch**:
- `.git/hooks/pre-commit` - Add detection logic
- `scripts/hooks/pre-commit` (if exists) - Source template
- `CLAUDE.md` or `.claude/rules/` - Documentation
- Tests for hook behavior

**Estimated Complexity**: LOW-MEDIUM
- Hook infrastructure exists
- Need to add ~50-100 lines of bash/python
- Pattern matching logic (grep-based)
- Commit message parsing

**Best Suited Agent**: haiku-coder (straightforward scripting task)

---

## Dependency Analysis

### Cross-Feature Dependencies:
**NONE** - All three features are independent:
- Pre-commit hooks (feat-0de33d85/dcdeb2d8) → Git infrastructure
- Pydantic integration (feat-1598baf6) → CLI argument parsing

**Can be parallelized**: Yes, but only 2 unique features (after deduplication)

### Internal Dependencies:
- **Pre-commit hook**: Requires existing git repo (✅ already exists)
- **Pydantic integration**: Requires existing models (✅ already exist)

---

## Recommendations

### 1. Immediate Action: Deduplicate Features
**Problem**: feat-0de33d85 and feat-dcdeb2d8 are duplicates
**Solution**: Merge into single feature, close one as duplicate
**Command**:
```python
sdk = SDK(agent='researcher')
# Mark one as duplicate/blocked, update the other with consolidated info
```

### 2. Priority Ranking (After Deduplication):

**Priority 1: feat-1598baf6 - Pydantic Integration**
- **Impact**: HIGH - Improves entire CLI UX and type safety
- **Effort**: MEDIUM - Models exist, need integration
- **Risk**: MEDIUM - Touches many commands
- **Agent**: sonnet-coder
- **Rationale**: Foundation for better CLI, affects all commands

**Priority 2: feat-dcdeb2d8 - Pre-commit Hook Enhancement**
- **Impact**: MEDIUM - Prevents incomplete refactorings
- **Effort**: LOW-MEDIUM - Hook exists, add detection
- **Risk**: LOW - Isolated to git hooks
- **Agent**: haiku-coder
- **Rationale**: Quality gate, doesn't block other work

### 3. Parallelization Strategy:
**NOT RECOMMENDED** - Only 2 unique features, sequential is better:
1. Start Pydantic integration first (higher impact)
2. Then pre-commit hook (can be done by different agent)

### 4. Missing Context:
- No test files found for existing CLI models
- Need to verify if argparse → Pydantic bridge pattern exists elsewhere
- Should check if other projects have similar integration patterns

---

## Next Steps

1. **Deduplicate**: Resolve feat-0de33d85 vs feat-dcdeb2d8
2. **Research Pydantic + argparse integration**: Find best practice patterns
3. **Plan Pydantic migration**: Prioritize which commands to convert first
4. **Implement pre-commit enhancement**: Simpler task, good warmup


            </div>
        </section>
    </article>
</body>
</html>
