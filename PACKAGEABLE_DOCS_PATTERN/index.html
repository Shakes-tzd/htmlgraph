
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="HTML is All You Need - Graph database on web standards">
      
      
      
        <link rel="canonical" href="https://shakes-tzd.github.io/htmlgraph/PACKAGEABLE_DOCS_PATTERN/">
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Packageable Auto-Updating Documentation Pattern - HtmlGraph</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#packageable-auto-updating-documentation-pattern" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HtmlGraph" class="md-header__button md-logo" aria-label="HtmlGraph" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HtmlGraph
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Packageable Auto-Updating Documentation Pattern
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Shakes-tzd/htmlgraph" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Shakes-tzd/htmlgraph
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../guide/" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../cookbook/" class="md-tabs__link">
          
  
  
    
  
  Cookbook

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../philosophy/why-html/" class="md-tabs__link">
          
  
  
    
  
  Philosophy

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../contributing/" class="md-tabs__link">
          
  
  
    
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HtmlGraph" class="md-nav__button md-logo" aria-label="HtmlGraph" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    HtmlGraph
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Shakes-tzd/htmlgraph" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Shakes-tzd/htmlgraph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../guide/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/features-tracks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features & Tracks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/track-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TrackBuilder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/sqlite-index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQLite Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../api/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HtmlGraph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Planning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/track-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TrackBuilder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/ids/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ID Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../examples/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/tracks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Track Creation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../cookbook/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Cookbook
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cookbook
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cookbook/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cookbook/features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cookbook/tracks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracks & Planning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cookbook/analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analytics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Philosophy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Philosophy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../philosophy/why-html/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Why HTML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../philosophy/comparisons/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comparisons
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../philosophy/decisions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Decisions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../contributing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/publishing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Publishing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="packageable-auto-updating-documentation-pattern">Packageable Auto-Updating Documentation Pattern<a class="headerlink" href="#packageable-auto-updating-documentation-pattern" title="Anchor link to this section">&para;</a></h1>
<p><strong>A comprehensive guide for package developers implementing versioned, customizable, auto-updating agent documentation systems</strong></p>
<hr />
<h2 id="1-introduction">1. Introduction<a class="headerlink" href="#1-introduction" title="Anchor link to this section">&para;</a></h2>
<h3 id="what-is-packageable-auto-updating-documentation">What is Packageable Auto-Updating Documentation?<a class="headerlink" href="#what-is-packageable-auto-updating-documentation" title="Anchor link to this section">&para;</a></h3>
<p>Packageable auto-updating documentation is a pattern for distributing AI agent instructions that:</p>
<ol>
<li><strong>Ship with the package</strong> - Documentation lives in the package, not external docs sites</li>
<li><strong>Auto-update</strong> - Users get latest best practices when upgrading packages</li>
<li><strong>Preserve customizations</strong> - User modifications survive package updates</li>
<li><strong>Version intelligently</strong> - Track both package version and documentation schema version</li>
<li><strong>Migrate safely</strong> - Guide users through breaking documentation changes</li>
</ol>
<p>This pattern is particularly valuable for AI agent tools (Claude Code plugins, MCP servers, Gemini extensions) where the "documentation" is actually executable instructions that agents consume.</p>
<h3 id="why-this-pattern-matters">Why This Pattern Matters<a class="headerlink" href="#why-this-pattern-matters" title="Anchor link to this section">&para;</a></h3>
<p><strong>Traditional documentation problems:</strong>
- Users read docs once, never check for updates
- Breaking changes in APIs require manual doc updates
- No way to know if user's local instructions are stale
- Customizations get lost when copying new examples</p>
<p><strong>Agent documentation challenges:</strong>
- Instructions are consumed programmatically, not read by humans
- Stale instructions cause agent failures
- Context budget limits require careful documentation design
- Users need to customize for their workflows
- Package updates must not break user customizations</p>
<p><strong>This pattern solves:</strong>
- ✅ Automatic delivery of documentation improvements
- ✅ Safe preservation of user customizations
- ✅ Clear upgrade paths for breaking changes
- ✅ Version compatibility tracking
- ✅ Rollback safety for failed migrations</p>
<h3 id="use-cases-and-benefits">Use Cases and Benefits<a class="headerlink" href="#use-cases-and-benefits" title="Anchor link to this section">&para;</a></h3>
<p><strong>Ideal for:</strong>
1. <strong>AI Agent Plugins</strong> - Claude Code plugins, MCP servers, Gemini extensions
2. <strong>CLI Tools</strong> - Developer tools with complex configuration
3. <strong>SDK Libraries</strong> - Packages with agent integration
4. <strong>Framework Starters</strong> - Project templates that evolve</p>
<p><strong>Benefits:</strong>
- <strong>Users</strong> - Always have up-to-date best practices
- <strong>Maintainers</strong> - Deprecate old patterns safely
- <strong>Ecosystem</strong> - Shared improvements propagate automatically</p>
<h3 id="when-to-use-this-pattern">When to Use This Pattern<a class="headerlink" href="#when-to-use-this-pattern" title="Anchor link to this section">&para;</a></h3>
<p><strong>✅ Use this pattern when:</strong>
- Documentation is consumed by AI agents programmatically
- Package updates include documentation improvements
- Users need to customize documentation for their needs
- You need to track documentation schema evolution
- Context budget matters (token limits)</p>
<p><strong>❌ Simpler approaches work when:</strong>
- Documentation is only for human reading
- No user customization needed
- Package updates rarely affect documentation
- Documentation is stateless (no version tracking needed)</p>
<p><strong>Decision framework:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Does your package provide AI agent instructions? YES → Continue
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Do you expect to improve those instructions over time? YES → Continue
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Do users need to customize instructions? YES → Continue
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>Is there a context budget concern? YES → Use this pattern
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>Otherwise: Use simple static documentation
</span></code></pre></div></p>
<hr />
<h2 id="2-architecture-overview">2. Architecture Overview<a class="headerlink" href="#2-architecture-overview" title="Anchor link to this section">&para;</a></h2>
<h3 id="two-tier-system">Two-Tier System<a class="headerlink" href="#two-tier-system" title="Anchor link to this section">&para;</a></h3>
<p>The pattern uses a <strong>two-tier system</strong> where package-provided templates combine with user customizations:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>┌─────────────────────────────────────────────────────────┐
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>│                    USER PROJECT                          │
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>│  .claude/                                                │
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>│    ├── CLAUDE.md (generated, user can override blocks)  │
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>│    ├── .claude-docs-meta.json (version tracking)        │
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>│    └── templates/ (optional user overrides)             │
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>│        └── claude.md.jinja2 (custom blocks)             │
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>└─────────────────┬───────────────────────────────────────┘
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>                  │ extends (Jinja2 inheritance)
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>┌─────────────────┴───────────────────────────────────────┐
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>│                 PACKAGE DISTRIBUTION                     │
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>│  your_package/                                           │
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>│    ├── templates/                                        │
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>│    │   ├── base/                                         │
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>│    │   │   └── claude.md.jinja2 (base template)         │
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>│    │   └── platforms/                                    │
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>│    │       ├── gemini.md.jinja2                          │
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>│    │       └── codex.md.jinja2                           │
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>│    ├── migrations/                                       │
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>│    │   ├── 001_initial.py                               │
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>│    │   └── 002_add_orchestration.py                     │
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>│    └── cli.py (generate/upgrade commands)               │
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>└─────────────────────────────────────────────────────────┘
</span></code></pre></div>
<h3 id="template-inheritance-model">Template Inheritance Model<a class="headerlink" href="#template-inheritance-model" title="Anchor link to this section">&para;</a></h3>
<p><strong>Base Template</strong> (in package):
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>{# your_package/templates/base/claude.md.jinja2 #}
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a># {{ package_name }} - Claude Code Instructions
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>## Quick Start
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>{% block quickstart %}
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>Default quickstart content from package...
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>{% endblock %}
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>## Configuration
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>{% block configuration %}
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>Default configuration from package...
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>{% endblock %}
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>## Advanced Usage
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>{% block advanced %}
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>Default advanced usage from package...
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>{% endblock %}
</span></code></pre></div></p>
<p><strong>User Override</strong> (in project):
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>{# .claude/templates/claude.md.jinja2 #}
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>{% extends &quot;base/claude.md.jinja2&quot; %}
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>{# Override just the configuration block #}
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>{% block configuration %}
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>## My Custom Configuration
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>- Custom setting 1
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>- Custom setting 2
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>{{ super() }}  {# Include package defaults too #}
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>{% endblock %}
</span></code></pre></div></p>
<p><strong>Result</strong> - User gets:
- Package's quickstart (default)
- User's custom configuration + package defaults
- Package's advanced usage (default)</p>
<h3 id="version-tracking">Version Tracking<a class="headerlink" href="#version-tracking" title="Anchor link to this section">&para;</a></h3>
<p><strong>Dual versioning system:</strong></p>
<ol>
<li><strong>Package Version</strong> (<code>0.9.5</code>) - Tracks package releases</li>
<li><strong>Doc Schema Version</strong> (<code>2</code>) - Tracks documentation structure changes</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Stored in .claude/.claude-docs-meta.json</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>           <span class="c1"># Doc schema version</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  <span class="s2">&quot;package_version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.9.5&quot;</span><span class="p">,</span>  <span class="c1"># Package version when generated</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  <span class="s2">&quot;generated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-01-02T10:30:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>  <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;claude&quot;</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>  <span class="s2">&quot;has_customizations&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>  <span class="s2">&quot;customization_blocks&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">,</span> <span class="s2">&quot;advanced&quot;</span><span class="p">],</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>  <span class="s2">&quot;last_migration&quot;</span><span class="p">:</span> <span class="s2">&quot;002_add_orchestration&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Why dual versioning?</strong>
- Package version changes frequently (bug fixes, features)
- Doc schema version changes rarely (structure changes only)
- Allows N-1 compatibility (old docs work with new package)</p>
<h3 id="version-compatibility-matrix">Version Compatibility Matrix<a class="headerlink" href="#version-compatibility-matrix" title="Anchor link to this section">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">COMPATIBILITY_MATRIX</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Doc schema version 1</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="s2">&quot;min_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="s2">&quot;max_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.8.9&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Original single-file format&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="p">},</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Doc schema version 2</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="s2">&quot;min_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.9.0&quot;</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="s2">&quot;max_package&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Current</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Template-based with blocks&quot;</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="p">}</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="context-budget-management">Context Budget Management<a class="headerlink" href="#context-budget-management" title="Anchor link to this section">&para;</a></h3>
<p><strong>Challenge:</strong> AI agents have token limits (context budget).</p>
<p><strong>Strategy:</strong> Progressive disclosure with template blocks</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>{# Base template - always included (high priority) #}
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>## Core Concepts
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Essential information agents always need...
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>{# Optional blocks - user can exclude #}
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>{% block advanced_patterns %}
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>Advanced patterns for power users...
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>{% endblock %}
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>{% block troubleshooting %}
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>Detailed troubleshooting guide...
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>{% endblock %}
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>{% block examples %}
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>Comprehensive examples...
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>{% endblock %}
</span></code></pre></div>
<p><strong>User customization to reduce context:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>{% extends &quot;base/claude.md.jinja2&quot; %}
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>{# Exclude heavy blocks to save tokens #}
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>{% block examples %}{% endblock %}
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>{% block troubleshooting %}{% endblock %}
</span></code></pre></div></p>
<h3 id="visual-system-diagram">Visual System Diagram<a class="headerlink" href="#visual-system-diagram" title="Anchor link to this section">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>┌──────────────────────────────────────────────────────────┐
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>│                    Package Release                        │
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>│  1. Developer updates base templates                     │
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>│  2. Creates migration script if schema changes           │
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>│  3. Bumps doc_schema_version if needed                   │
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>└────────────────┬─────────────────────────────────────────┘
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>                 │
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>                 ▼
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>┌──────────────────────────────────────────────────────────┐
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>│              User Runs: pip install --upgrade             │
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>└────────────────┬─────────────────────────────────────────┘
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>                 │
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>                 ▼
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>┌──────────────────────────────────────────────────────────┐
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>│         CLI Command: your-package docs upgrade           │
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>│  1. Detect current doc version                           │
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>│  2. Compare with package doc version                     │
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>│  3. Detect user customizations                           │
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>│  4. Run migration scripts if needed                      │
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>│  5. Regenerate docs preserving customizations            │
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>│  6. Update metadata                                      │
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>└────────────────┬─────────────────────────────────────────┘
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>                 │
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>                 ▼
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>┌──────────────────────────────────────────────────────────┐
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>│                  User Gets Updated Docs                   │
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>│  - Latest package improvements                           │
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>│  - User customizations preserved                         │
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>│  - Version metadata updated                              │
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>│  - Rollback available if issues                          │
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>└──────────────────────────────────────────────────────────┘
</span></code></pre></div>
<hr />
<h2 id="3-implementation-guide">3. Implementation Guide<a class="headerlink" href="#3-implementation-guide" title="Anchor link to this section">&para;</a></h2>
<h3 id="31-template-system-setup">3.1 Template System Setup<a class="headerlink" href="#31-template-system-setup" title="Anchor link to this section">&para;</a></h3>
<h4 id="directory-structure">Directory Structure<a class="headerlink" href="#directory-structure" title="Anchor link to this section">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>your_package/
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>├── templates/
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>│   ├── base/
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>│   │   ├── claude.md.jinja2       # Base template for Claude
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>│   │   ├── gemini.md.jinja2       # Base template for Gemini
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>│   │   └── shared/
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>│   │       ├── quickstart.md.jinja2
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>│   │       └── api-reference.md.jinja2
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>│   └── platforms/                  # Platform-specific extensions
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>│       └── claude-advanced.md.jinja2
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>├── migrations/
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>│   ├── __init__.py
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>│   ├── base.py                     # MigrationScript base class
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>│   ├── 001_initial.py
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>│   └── 002_add_orchestration.py
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>├── models.py                       # DocsMetadata Pydantic model
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>├── template_engine.py              # DocTemplateEngine class
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>└── cli.py                          # CLI commands
</span></code></pre></div>
<h4 id="base-template-creation-with-jinja2">Base Template Creation with Jinja2<a class="headerlink" href="#base-template-creation-with-jinja2" title="Anchor link to this section">&para;</a></h4>
<p><strong>Example base template:</strong></p>
<p _="%" endblock="endblock"><div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>{# your_package/templates/base/claude.md.jinja2 #}
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>{#
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>  Base template for Claude Code documentation
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>  Users can override any {% block %} in their local templates
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>#}
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a># {{ package_name }} v{{ package_version }}
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>{% block header %}
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>**AI-Powered {{ package_name }} for Claude Code**
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>This documentation is auto-generated from package version {{ package_version }}.
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>Last updated: {{ generated_at }}
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>{% endblock %}
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>---
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>## Quick Start
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>{% block quickstart %}
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>```bash
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a># Install the package
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>pip install {{ package_name }}
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a># Initialize documentation
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>{{ package_name }} docs generate
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a># Verify setup
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>{{ package_name }} docs version
</span></code></pre></div></p>
<hr />
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Anchor link to this section">&para;</a></h2>
<p>{% block configuration %}</p>
<h3 id="basic-configuration">Basic Configuration<a class="headerlink" href="#basic-configuration" title="Anchor link to this section">&para;</a></h3>
<p>The package looks for configuration in:
1. <code>.{{ package_name }}/config.json</code>
2. Environment variables prefixed with <code>{{ package_name.upper() }}_</code></p>
<p _="%" endblock="endblock"><strong>Example config.json:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nt">&quot;agent_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nt">&quot;features_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;analytics&quot;</span><span class="p">],</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">&quot;auto_update_docs&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">}</span>
</span></code></pre></div></p>
<hr />
<h2 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Anchor link to this section">&para;</a></h2>
<p>{% block core_concepts %}</p>
<h3 id="how-package_name-works">How {{ package_name }} Works<a class="headerlink" href="#how-package_name-works" title="Anchor link to this section">&para;</a></h3>
<ol>
<li><strong>Concept A</strong> - Explanation...</li>
<li><strong>Concept B</strong> - Explanation...</li>
<li _="%" endblock="endblock"><strong>Concept C</strong> - Explanation...</li>
</ol>
<hr />
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Anchor link to this section">&para;</a></h2>
<p>{% block api_reference %}</p>
<h3 id="main-classes">Main Classes<a class="headerlink" href="#main-classes" title="Anchor link to this section">&para;</a></h3>
<h4 id="sdk-class"><code>SDK</code> Class<a class="headerlink" href="#sdk-class" title="Anchor link to this section">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="p">{{</span> <span class="n">package_name</span> <span class="p">}}</span> <span class="kn">import</span><span class="w"> </span><span class="nn">SDK</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">sdk</span> <span class="o">=</span> <span class="n">SDK</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p _="%" endblock="endblock"><strong>Methods:</strong>
- <code>create_feature()</code> - Create a new feature
- <code>create_spike()</code> - Create a research spike</p>
<hr />
<h2 id="advanced-usage">Advanced Usage<a class="headerlink" href="#advanced-usage" title="Anchor link to this section">&para;</a></h2>
<p>{% block advanced %}</p>
<h3 id="advanced-patterns">Advanced Patterns<a class="headerlink" href="#advanced-patterns" title="Anchor link to this section">&para;</a></h3>
<p>{% block orchestration %}</p>
<h4 id="orchestration-mode">Orchestration Mode<a class="headerlink" href="#orchestration-mode" title="Anchor link to this section">&para;</a></h4>
<p _="%" endblock="endblock">For complex multi-agent workflows...</p>
<p>{% block analytics %}</p>
<h4 id="strategic-analytics">Strategic Analytics<a class="headerlink" href="#strategic-analytics" title="Anchor link to this section">&para;</a></h4>
<p _="%" endblock="endblock">Analyze your workflow effectiveness...
{% endblock %}</p>
<hr />
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Anchor link to this section">&para;</a></h2>
<p>{% block troubleshooting %}</p>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Anchor link to this section">&para;</a></h3>
<p><strong>Issue 1: Docs out of date</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="o">{{</span><span class="w"> </span>package_name<span class="w"> </span><span class="o">}}</span><span class="w"> </span>docs<span class="w"> </span>upgrade
</span></code></pre></div></p>
<p _="%" endblock="endblock"><strong>Issue 2: Customizations lost</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">{{</span><span class="w"> </span>package_name<span class="w"> </span><span class="o">}}</span><span class="w"> </span>docs<span class="w"> </span>rollback
</span></code></pre></div></p>
<hr />
<h2 id="customization-guide">Customization Guide<a class="headerlink" href="#customization-guide" title="Anchor link to this section">&para;</a></h2>
<p>{% block customization_guide %}</p>
<h3 id="how-to-customize-this-documentation">How to Customize This Documentation<a class="headerlink" href="#how-to-customize-this-documentation" title="Anchor link to this section">&para;</a></h3>
<ol>
<li>Create <code>.claude/templates/claude.md.jinja2</code></li>
<li>Extend the base template:
   <div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>{%raw%}{% extends &quot;base/claude.md.jinja2&quot; %}{%endraw%}
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>{%raw%}{% block configuration %}{%endraw%}
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>## My Custom Configuration
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>...
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>{%raw%}{% endblock %}{%endraw%}
</span></code></pre></div></li>
<li _="%" endblock="endblock">Regenerate: <code>{{ package_name }} docs generate</code></li>
</ol>
<hr />
<p>{% block footer %}
<strong>Documentation Version:</strong> {{ doc_version }}
<strong>Package Version:</strong> {{ package_version }}
<strong>Generated:</strong> {{ generated_at }}
{% endblock %}
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>#### Block-Based Structure for User Overrides
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>**Design principles:**
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>1. **Granular blocks** - Each section should be independently overridable
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>2. **Nested blocks** - Allow partial overrides
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>3. **Semantic naming** - Block names should describe content, not structure
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>4. **Safe defaults** - Empty blocks should not break documentation
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>**Example nested blocks:**
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>```jinja2
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>{% block advanced %}
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>### Advanced Usage
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>{% block orchestration %}
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>#### Orchestration Mode
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>Default orchestration docs...
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>{% endblock %}
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>{% block analytics %}
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>#### Analytics
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>Default analytics docs...
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>{% endblock %}
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>{% block custom_workflows %}
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>{# Empty by default - users can add custom content #}
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>{% endblock %}
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>{% endblock %}
</span></code></pre></div></p>
<p><strong>User can override at any level:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>{# Override entire advanced section #}
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>{% block advanced %}
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>My completely custom advanced docs...
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>{% endblock %}
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>{# OR override just orchestration #}
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>{% block orchestration %}
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>My custom orchestration docs...
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>{% endblock %}
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>{# OR add custom workflows while keeping defaults #}
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>{% block custom_workflows %}
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>## My Custom Workflows
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>- Workflow 1
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>- Workflow 2
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>{% endblock %}
</span></code></pre></div></p>
<h4 id="choiceloader-priority-system">ChoiceLoader Priority System<a class="headerlink" href="#choiceloader-priority-system" title="Anchor link to this section">&para;</a></h4>
<p><strong>Implementation:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># your_package/template_engine.py</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">jinja2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span><span class="p">,</span> <span class="n">ChoiceLoader</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocTemplateEngine</span><span class="p">:</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">project_root</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        <span class="c1"># Package templates (bundled with distribution)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>        <span class="n">package_templates</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>        <span class="c1"># User templates (in project directory)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>        <span class="n">user_templates</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>        <span class="n">user_templates</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        <span class="c1"># Priority: User templates first, then package templates</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="n">loader</span> <span class="o">=</span> <span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_templates</span><span class="p">)),</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">package_templates</span><span class="p">))</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        <span class="p">])</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>            <span class="n">loader</span><span class="o">=</span><span class="n">loader</span><span class="p">,</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>            <span class="n">autoescape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># We&#39;re generating Markdown</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>            <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>            <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>        <span class="p">)</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Render template with user overrides taking priority&quot;&quot;&quot;</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_user_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if user has custom template&quot;&quot;&quot;</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>        <span class="n">user_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>            <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>            <span class="s2">&quot;templates&quot;</span> <span class="o">/</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>            <span class="n">template_name</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>        <span class="p">)</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>        <span class="k">return</span> <span class="n">user_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span></code></pre></div>
<p><strong>Usage:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="s2">&quot;htmlgraph&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="s2">&quot;htmlgraph&quot;</span><span class="p">,</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="s2">&quot;package_version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.9.5&quot;</span><span class="p">,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    <span class="s2">&quot;doc_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    <span class="s2">&quot;generated_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="p">}</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="c1"># Renders user template if exists, falls back to package template</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="n">output</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;base/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="32-version-tracking">3.2 Version Tracking<a class="headerlink" href="#32-version-tracking" title="Anchor link to this section">&para;</a></h3>
<h4 id="dual-versioning-model-design">Dual Versioning Model Design<a class="headerlink" href="#dual-versioning-model-design" title="Anchor link to this section">&para;</a></h4>
<p><strong>DocsMetadata Pydantic Model:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># your_package/models.py</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocsMetadata</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="sd">    Tracks documentation version and customization state.</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="sd">    Dual versioning:</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="sd">    - doc_version: Schema version (changes when structure changes)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="sd">    - package_version: Package version when docs were generated</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="sd">    This allows N-1 compatibility where old docs work with new packages</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="sd">    as long as doc_version is compatible.</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>    <span class="n">doc_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Documentation schema version (e.g., &#39;2&#39;)&quot;</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>    <span class="p">)</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>    <span class="n">package_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Package version when generated (e.g., &#39;0.9.5&#39;)&quot;</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>    <span class="p">)</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>    <span class="n">generated_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Timestamp of generation&quot;</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>    <span class="p">)</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>    <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">,</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Target platform (claude, gemini, codex, etc.)&quot;</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>    <span class="p">)</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>    <span class="n">has_customizations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether user has custom template overrides&quot;</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>    <span class="p">)</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>    <span class="n">customization_blocks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of template blocks user has customized&quot;</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>    <span class="p">)</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>    <span class="n">last_migration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of last migration applied (e.g., &#39;002_add_orchestration&#39;)&quot;</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a>    <span class="p">)</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>    <span class="n">backup_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Path to backup created before last update&quot;</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>    <span class="p">)</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>    <span class="nd">@classmethod</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;DocsMetadata&quot;</span><span class="p">]:</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load metadata from .claude-docs-meta.json&quot;&quot;&quot;</span>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a>            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Failed to load metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save metadata to .claude-docs-meta.json&quot;&quot;&quot;</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a>        <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a>                <span class="n">f</span><span class="p">,</span>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a>                <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a>                <span class="n">default</span><span class="o">=</span><span class="nb">str</span>  <span class="c1"># Handle datetime serialization</span>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a>            <span class="p">)</span>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_compatible_with_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if docs are compatible with given package version&quot;&quot;&quot;</span>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a>        <span class="c1"># Get compatibility matrix for this doc version</span>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a>        <span class="n">compat</span> <span class="o">=</span> <span class="n">VERSION_COMPATIBILITY</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_version</span><span class="p">)</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">compat</span><span class="p">:</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a>        <span class="n">pkg_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a>        <span class="n">min_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">compat</span><span class="p">[</span><span class="s2">&quot;min_package&quot;</span><span class="p">])</span>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a>        <span class="n">max_ver</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a>            <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">compat</span><span class="p">[</span><span class="s2">&quot;max_package&quot;</span><span class="p">])</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a>            <span class="k">if</span> <span class="n">compat</span><span class="p">[</span><span class="s2">&quot;max_package&quot;</span><span class="p">]</span>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a>            <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a>        <span class="p">)</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a>        <span class="k">if</span> <span class="n">pkg_ver</span> <span class="o">&lt;</span> <span class="n">min_ver</span><span class="p">:</span>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a>        <span class="k">if</span> <span class="n">max_ver</span> <span class="ow">and</span> <span class="n">pkg_ver</span> <span class="o">&gt;</span> <span class="n">max_ver</span><span class="p">:</span>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">needs_upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_doc_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if docs need upgrading to current version&quot;&quot;&quot;</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a>        <span class="k">return</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">current_doc_version</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="version-compatibility-matrix_1">Version Compatibility Matrix<a class="headerlink" href="#version-compatibility-matrix_1" title="Anchor link to this section">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># your_package/models.py</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">VERSION_COMPATIBILITY</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>        <span class="s2">&quot;min_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="s2">&quot;max_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.8.9&quot;</span><span class="p">,</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Original single-file CLAUDE.md format&quot;</span><span class="p">,</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>        <span class="s2">&quot;breaking_changes&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>            <span class="s2">&quot;No template system&quot;</span><span class="p">,</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>            <span class="s2">&quot;No customization support&quot;</span><span class="p">,</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>            <span class="s2">&quot;Manual updates only&quot;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="p">]</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>    <span class="p">},</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="s2">&quot;min_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.9.0&quot;</span><span class="p">,</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>        <span class="s2">&quot;max_package&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Current version</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Template-based with Jinja2 blocks&quot;</span><span class="p">,</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>            <span class="s2">&quot;User customization via template inheritance&quot;</span><span class="p">,</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>            <span class="s2">&quot;Auto-update with migration support&quot;</span><span class="p">,</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>            <span class="s2">&quot;Version tracking and rollback&quot;</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>        <span class="p">],</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>        <span class="s2">&quot;breaking_changes&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>            <span class="s2">&quot;File location changed to .claude/CLAUDE.md&quot;</span><span class="p">,</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>            <span class="s2">&quot;Metadata file required (.claude-docs-meta.json)&quot;</span><span class="p">,</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>            <span class="s2">&quot;Custom blocks must use Jinja2 syntax&quot;</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>        <span class="p">]</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>    <span class="p">}</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="p">}</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="n">CURRENT_DOC_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span><span class="n">doc_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get compatibility info for a doc version&quot;&quot;&quot;</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>    <span class="k">return</span> <span class="n">VERSION_COMPATIBILITY</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc_version</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_migration_path</span><span class="p">(</span><span class="n">from_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="sd">    Get list of migration scripts needed to upgrade.</span>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="sd">    Example: from_version=&quot;1&quot;, to_version=&quot;2&quot;</span>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="sd">    Returns: [&quot;001_to_002&quot;]</span>
</span><span id="__span-21-43"><a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-21-44"><a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-21-45"><a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a>
</span><span id="__span-21-46"><a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>    <span class="n">from_ver</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">from_version</span><span class="p">)</span>
</span><span id="__span-21-47"><a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a>    <span class="n">to_ver</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">to_version</span><span class="p">)</span>
</span><span id="__span-21-48"><a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a>
</span><span id="__span-21-49"><a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a>    <span class="k">if</span> <span class="n">from_ver</span> <span class="o">&gt;=</span> <span class="n">to_ver</span><span class="p">:</span>
</span><span id="__span-21-50"><a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="__span-21-51"><a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a>
</span><span id="__span-21-52"><a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a>    <span class="c1"># Return migration scripts in order</span>
</span><span id="__span-21-53"><a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a>    <span class="n">migrations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-21-54"><a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a>    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">from_ver</span><span class="p">,</span> <span class="n">to_ver</span><span class="p">):</span>
</span><span id="__span-21-55"><a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a>        <span class="n">migration_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">_to_</span><span class="si">{</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-21-56"><a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a>        <span class="n">migrations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">migration_id</span><span class="p">)</span>
</span><span id="__span-21-57"><a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>
</span><span id="__span-21-58"><a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a>    <span class="k">return</span> <span class="n">migrations</span>
</span></code></pre></div>
<h4 id="migration-script-architecture">Migration Script Architecture<a class="headerlink" href="#migration-script-architecture" title="Anchor link to this section">&para;</a></h4>
<p><strong>Base Migration Class:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># your_package/migrations/base.py</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">MigrationScript</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="sd">    Base class for documentation migration scripts.</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="sd">    Each migration handles upgrading from one doc version to the next,</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="sd">    while preserving user customizations.</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>    <span class="c1"># Subclasses must define these</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>    <span class="n">from_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    <span class="n">to_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">project_root</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>    <span class="nd">@abstractmethod</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_customizations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="sd">        Detect what customizations user has made.</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="sd">        Returns dict with structure like:</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="sd">        {</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="sd">            &quot;has_customizations&quot;: bool,</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="sd">            &quot;customized_blocks&quot;: List[str],</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="sd">            &quot;custom_sections&quot;: dict,</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="sd">            &quot;custom_config&quot;: dict</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="sd">        }</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>        <span class="k">pass</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>    <span class="nd">@abstractmethod</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customizations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-22-44"><a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a><span class="sd">        Perform the migration, preserving customizations.</span>
</span><span id="__span-22-45"><a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>
</span><span id="__span-22-46"><a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="sd">        Returns True if successful, False otherwise.</span>
</span><span id="__span-22-47"><a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-22-48"><a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>        <span class="k">pass</span>
</span><span id="__span-22-49"><a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a>
</span><span id="__span-22-50"><a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="__span-22-51"><a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create backup before migration&quot;&quot;&quot;</span>
</span><span id="__span-22-52"><a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="__span-22-53"><a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a>        <span class="n">backup_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;backups&quot;</span> <span class="o">/</span> <span class="n">timestamp</span>
</span><span id="__span-22-54"><a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a>        <span class="n">backup_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-22-55"><a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a>
</span><span id="__span-22-56"><a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a>        <span class="c1"># Backup all files in docs directory</span>
</span><span id="__span-22-57"><a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
</span><span id="__span-22-58"><a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-22-59"><a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">backup_dir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-22-60"><a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a>
</span><span id="__span-22-61"><a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Backup created: </span><span class="si">{</span><span class="n">backup_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-62"><a id="__codelineno-22-62" name="__codelineno-22-62" href="#__codelineno-22-62"></a>        <span class="k">return</span> <span class="n">backup_dir</span>
</span><span id="__span-22-63"><a id="__codelineno-22-63" name="__codelineno-22-63" href="#__codelineno-22-63"></a>
</span><span id="__span-22-64"><a id="__codelineno-22-64" name="__codelineno-22-64" href="#__codelineno-22-64"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-22-65"><a id="__codelineno-22-65" name="__codelineno-22-65" href="#__codelineno-22-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore from backup&quot;&quot;&quot;</span>
</span><span id="__span-22-66"><a id="__codelineno-22-66" name="__codelineno-22-66" href="#__codelineno-22-66"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-22-67"><a id="__codelineno-22-67" name="__codelineno-22-67" href="#__codelineno-22-67"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Backup not found: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-68"><a id="__codelineno-22-68" name="__codelineno-22-68" href="#__codelineno-22-68"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-22-69"><a id="__codelineno-22-69" name="__codelineno-22-69" href="#__codelineno-22-69"></a>
</span><span id="__span-22-70"><a id="__codelineno-22-70" name="__codelineno-22-70" href="#__codelineno-22-70"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-22-71"><a id="__codelineno-22-71" name="__codelineno-22-71" href="#__codelineno-22-71"></a>            <span class="c1"># Restore all files from backup</span>
</span><span id="__span-22-72"><a id="__codelineno-22-72" name="__codelineno-22-72" href="#__codelineno-22-72"></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
</span><span id="__span-22-73"><a id="__codelineno-22-73" name="__codelineno-22-73" href="#__codelineno-22-73"></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-22-74"><a id="__codelineno-22-74" name="__codelineno-22-74" href="#__codelineno-22-74"></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-22-75"><a id="__codelineno-22-75" name="__codelineno-22-75" href="#__codelineno-22-75"></a>
</span><span id="__span-22-76"><a id="__codelineno-22-76" name="__codelineno-22-76" href="#__codelineno-22-76"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Restored from backup: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-77"><a id="__codelineno-22-77" name="__codelineno-22-77" href="#__codelineno-22-77"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-22-78"><a id="__codelineno-22-78" name="__codelineno-22-78" href="#__codelineno-22-78"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-22-79"><a id="__codelineno-22-79" name="__codelineno-22-79" href="#__codelineno-22-79"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Rollback failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-80"><a id="__codelineno-22-80" name="__codelineno-22-80" href="#__codelineno-22-80"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-22-81"><a id="__codelineno-22-81" name="__codelineno-22-81" href="#__codelineno-22-81"></a>
</span><span id="__span-22-82"><a id="__codelineno-22-82" name="__codelineno-22-82" href="#__codelineno-22-82"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-22-83"><a id="__codelineno-22-83" name="__codelineno-22-83" href="#__codelineno-22-83"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute migration with backup and error handling&quot;&quot;&quot;</span>
</span><span id="__span-22-84"><a id="__codelineno-22-84" name="__codelineno-22-84" href="#__codelineno-22-84"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔄 Migration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-85"><a id="__codelineno-22-85" name="__codelineno-22-85" href="#__codelineno-22-85"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   From version </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_version</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-86"><a id="__codelineno-22-86" name="__codelineno-22-86" href="#__codelineno-22-86"></a>
</span><span id="__span-22-87"><a id="__codelineno-22-87" name="__codelineno-22-87" href="#__codelineno-22-87"></a>        <span class="c1"># Create backup</span>
</span><span id="__span-22-88"><a id="__codelineno-22-88" name="__codelineno-22-88" href="#__codelineno-22-88"></a>        <span class="n">backup_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">()</span>
</span><span id="__span-22-89"><a id="__codelineno-22-89" name="__codelineno-22-89" href="#__codelineno-22-89"></a>
</span><span id="__span-22-90"><a id="__codelineno-22-90" name="__codelineno-22-90" href="#__codelineno-22-90"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-22-91"><a id="__codelineno-22-91" name="__codelineno-22-91" href="#__codelineno-22-91"></a>            <span class="c1"># Detect customizations</span>
</span><span id="__span-22-92"><a id="__codelineno-22-92" name="__codelineno-22-92" href="#__codelineno-22-92"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Detecting customizations...&quot;</span><span class="p">)</span>
</span><span id="__span-22-93"><a id="__codelineno-22-93" name="__codelineno-22-93" href="#__codelineno-22-93"></a>            <span class="n">customizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_customizations</span><span class="p">()</span>
</span><span id="__span-22-94"><a id="__codelineno-22-94" name="__codelineno-22-94" href="#__codelineno-22-94"></a>
</span><span id="__span-22-95"><a id="__codelineno-22-95" name="__codelineno-22-95" href="#__codelineno-22-95"></a>            <span class="k">if</span> <span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">):</span>
</span><span id="__span-22-96"><a id="__codelineno-22-96" name="__codelineno-22-96" href="#__codelineno-22-96"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Found customizations: </span><span class="si">{</span><span class="n">customizations</span><span class="p">[</span><span class="s1">&#39;customized_blocks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-97"><a id="__codelineno-22-97" name="__codelineno-22-97" href="#__codelineno-22-97"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-22-98"><a id="__codelineno-22-98" name="__codelineno-22-98" href="#__codelineno-22-98"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No customizations detected&quot;</span><span class="p">)</span>
</span><span id="__span-22-99"><a id="__codelineno-22-99" name="__codelineno-22-99" href="#__codelineno-22-99"></a>
</span><span id="__span-22-100"><a id="__codelineno-22-100" name="__codelineno-22-100" href="#__codelineno-22-100"></a>            <span class="c1"># Perform migration</span>
</span><span id="__span-22-101"><a id="__codelineno-22-101" name="__codelineno-22-101" href="#__codelineno-22-101"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Migrating documentation...&quot;</span><span class="p">)</span>
</span><span id="__span-22-102"><a id="__codelineno-22-102" name="__codelineno-22-102" href="#__codelineno-22-102"></a>            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">migrate</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-22-103"><a id="__codelineno-22-103" name="__codelineno-22-103" href="#__codelineno-22-103"></a>
</span><span id="__span-22-104"><a id="__codelineno-22-104" name="__codelineno-22-104" href="#__codelineno-22-104"></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="__span-22-105"><a id="__codelineno-22-105" name="__codelineno-22-105" href="#__codelineno-22-105"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Migration completed successfully&quot;</span><span class="p">)</span>
</span><span id="__span-22-106"><a id="__codelineno-22-106" name="__codelineno-22-106" href="#__codelineno-22-106"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-22-107"><a id="__codelineno-22-107" name="__codelineno-22-107" href="#__codelineno-22-107"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-22-108"><a id="__codelineno-22-108" name="__codelineno-22-108" href="#__codelineno-22-108"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Migration failed, rolling back...&quot;</span><span class="p">)</span>
</span><span id="__span-22-109"><a id="__codelineno-22-109" name="__codelineno-22-109" href="#__codelineno-22-109"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
</span><span id="__span-22-110"><a id="__codelineno-22-110" name="__codelineno-22-110" href="#__codelineno-22-110"></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-22-111"><a id="__codelineno-22-111" name="__codelineno-22-111" href="#__codelineno-22-111"></a>
</span><span id="__span-22-112"><a id="__codelineno-22-112" name="__codelineno-22-112" href="#__codelineno-22-112"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-22-113"><a id="__codelineno-22-113" name="__codelineno-22-113" href="#__codelineno-22-113"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Migration error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-114"><a id="__codelineno-22-114" name="__codelineno-22-114" href="#__codelineno-22-114"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Rolling back...&quot;</span><span class="p">)</span>
</span><span id="__span-22-115"><a id="__codelineno-22-115" name="__codelineno-22-115" href="#__codelineno-22-115"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
</span><span id="__span-22-116"><a id="__codelineno-22-116" name="__codelineno-22-116" href="#__codelineno-22-116"></a>            <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div>
<h4 id="example-migration-implementation">Example Migration Implementation<a class="headerlink" href="#example-migration-implementation" title="Anchor link to this section">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># your_package/migrations/002_add_orchestration.py</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">MigrationScript</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Migration002AddOrchestration</span><span class="p">(</span><span class="n">MigrationScript</span><span class="p">):</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="sd">    Migration from doc version 1 to 2.</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="sd">    Changes:</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="sd">    - Add orchestration section to documentation</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="sd">    - Convert single-file to template-based system</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="sd">    - Preserve user&#39;s custom configuration blocks</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>    <span class="n">from_version</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    <span class="n">to_version</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Add orchestration patterns and convert to template system&quot;</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_customizations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect customizations in version 1 docs&quot;&quot;&quot;</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>        <span class="n">old_doc_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">old_doc_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">old_doc_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>        <span class="c1"># Look for custom sections (marked with specific headers)</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        <span class="n">custom_sections</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>        <span class="c1"># Detect custom configuration</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>        <span class="n">config_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>            <span class="sa">r</span><span class="s2">&quot;## My Configuration\n(.*?)(?=\n##|\Z)&quot;</span><span class="p">,</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>            <span class="n">content</span><span class="p">,</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>            <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>        <span class="p">)</span>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>        <span class="k">if</span> <span class="n">config_match</span><span class="p">:</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>            <span class="n">custom_sections</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>        <span class="c1"># Detect custom workflows</span>
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>        <span class="n">workflow_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>            <span class="sa">r</span><span class="s2">&quot;## My Workflows\n(.*?)(?=\n##|\Z)&quot;</span><span class="p">,</span>
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>            <span class="n">content</span><span class="p">,</span>
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>            <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>        <span class="p">)</span>
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>        <span class="k">if</span> <span class="n">workflow_match</span><span class="p">:</span>
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>            <span class="n">custom_sections</span><span class="p">[</span><span class="s2">&quot;workflows&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workflow_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a>
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a>            <span class="s2">&quot;has_customizations&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">custom_sections</span><span class="p">),</span>
</span><span id="__span-23-52"><a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a>            <span class="s2">&quot;customized_blocks&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">custom_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
</span><span id="__span-23-53"><a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>            <span class="s2">&quot;custom_sections&quot;</span><span class="p">:</span> <span class="n">custom_sections</span>
</span><span id="__span-23-54"><a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a>        <span class="p">}</span>
</span><span id="__span-23-55"><a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a>
</span><span id="__span-23-56"><a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customizations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-23-57"><a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-23-58"><a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a><span class="sd">        Migrate to template-based system with customizations.</span>
</span><span id="__span-23-59"><a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-23-60"><a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..template_engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocTemplateEngine</span>
</span><span id="__span-23-61"><a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..models</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocsMetadata</span><span class="p">,</span> <span class="n">CURRENT_DOC_VERSION</span>
</span><span id="__span-23-62"><a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-23-63"><a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a>
</span><span id="__span-23-64"><a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a>        <span class="c1"># Initialize template engine</span>
</span><span id="__span-23-65"><a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a>        <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
</span><span id="__span-23-66"><a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a>
</span><span id="__span-23-67"><a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a>        <span class="c1"># If user has customizations, create custom template</span>
</span><span id="__span-23-68"><a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a>        <span class="k">if</span> <span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">):</span>
</span><span id="__span-23-69"><a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_custom_template</span><span class="p">(</span><span class="n">customizations</span><span class="p">[</span><span class="s2">&quot;custom_sections&quot;</span><span class="p">])</span>
</span><span id="__span-23-70"><a id="__codelineno-23-70" name="__codelineno-23-70" href="#__codelineno-23-70"></a>
</span><span id="__span-23-71"><a id="__codelineno-23-71" name="__codelineno-23-71" href="#__codelineno-23-71"></a>        <span class="c1"># Generate new documentation</span>
</span><span id="__span-23-72"><a id="__codelineno-23-72" name="__codelineno-23-72" href="#__codelineno-23-72"></a>        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-23-73"><a id="__codelineno-23-73" name="__codelineno-23-73" href="#__codelineno-23-73"></a>            <span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span>
</span><span id="__span-23-74"><a id="__codelineno-23-74" name="__codelineno-23-74" href="#__codelineno-23-74"></a>            <span class="s2">&quot;package_version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">),</span>
</span><span id="__span-23-75"><a id="__codelineno-23-75" name="__codelineno-23-75" href="#__codelineno-23-75"></a>            <span class="s2">&quot;doc_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_version</span><span class="p">,</span>
</span><span id="__span-23-76"><a id="__codelineno-23-76" name="__codelineno-23-76" href="#__codelineno-23-76"></a>            <span class="s2">&quot;generated_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="__span-23-77"><a id="__codelineno-23-77" name="__codelineno-23-77" href="#__codelineno-23-77"></a>        <span class="p">}</span>
</span><span id="__span-23-78"><a id="__codelineno-23-78" name="__codelineno-23-78" href="#__codelineno-23-78"></a>
</span><span id="__span-23-79"><a id="__codelineno-23-79" name="__codelineno-23-79" href="#__codelineno-23-79"></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;base/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-23-80"><a id="__codelineno-23-80" name="__codelineno-23-80" href="#__codelineno-23-80"></a>
</span><span id="__span-23-81"><a id="__codelineno-23-81" name="__codelineno-23-81" href="#__codelineno-23-81"></a>        <span class="c1"># Write new documentation</span>
</span><span id="__span-23-82"><a id="__codelineno-23-82" name="__codelineno-23-82" href="#__codelineno-23-82"></a>        <span class="n">new_doc_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-23-83"><a id="__codelineno-23-83" name="__codelineno-23-83" href="#__codelineno-23-83"></a>        <span class="n">new_doc_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="__span-23-84"><a id="__codelineno-23-84" name="__codelineno-23-84" href="#__codelineno-23-84"></a>
</span><span id="__span-23-85"><a id="__codelineno-23-85" name="__codelineno-23-85" href="#__codelineno-23-85"></a>        <span class="c1"># Update metadata</span>
</span><span id="__span-23-86"><a id="__codelineno-23-86" name="__codelineno-23-86" href="#__codelineno-23-86"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">DocsMetadata</span><span class="p">(</span>
</span><span id="__span-23-87"><a id="__codelineno-23-87" name="__codelineno-23-87" href="#__codelineno-23-87"></a>            <span class="n">doc_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_version</span><span class="p">,</span>
</span><span id="__span-23-88"><a id="__codelineno-23-88" name="__codelineno-23-88" href="#__codelineno-23-88"></a>            <span class="n">package_version</span><span class="o">=</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;package_version&quot;</span><span class="p">],</span>
</span><span id="__span-23-89"><a id="__codelineno-23-89" name="__codelineno-23-89" href="#__codelineno-23-89"></a>            <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">,</span>
</span><span id="__span-23-90"><a id="__codelineno-23-90" name="__codelineno-23-90" href="#__codelineno-23-90"></a>            <span class="n">has_customizations</span><span class="o">=</span><span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="__span-23-91"><a id="__codelineno-23-91" name="__codelineno-23-91" href="#__codelineno-23-91"></a>            <span class="n">customization_blocks</span><span class="o">=</span><span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customized_blocks&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="__span-23-92"><a id="__codelineno-23-92" name="__codelineno-23-92" href="#__codelineno-23-92"></a>            <span class="n">last_migration</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_version</span><span class="si">}</span><span class="s2">_to_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_version</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-23-93"><a id="__codelineno-23-93" name="__codelineno-23-93" href="#__codelineno-23-93"></a>        <span class="p">)</span>
</span><span id="__span-23-94"><a id="__codelineno-23-94" name="__codelineno-23-94" href="#__codelineno-23-94"></a>        <span class="n">metadata</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;.claude-docs-meta.json&quot;</span><span class="p">)</span>
</span><span id="__span-23-95"><a id="__codelineno-23-95" name="__codelineno-23-95" href="#__codelineno-23-95"></a>
</span><span id="__span-23-96"><a id="__codelineno-23-96" name="__codelineno-23-96" href="#__codelineno-23-96"></a>        <span class="c1"># Archive old documentation</span>
</span><span id="__span-23-97"><a id="__codelineno-23-97" name="__codelineno-23-97" href="#__codelineno-23-97"></a>        <span class="n">old_doc_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md.v1&quot;</span>
</span><span id="__span-23-98"><a id="__codelineno-23-98" name="__codelineno-23-98" href="#__codelineno-23-98"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-23-99"><a id="__codelineno-23-99" name="__codelineno-23-99" href="#__codelineno-23-99"></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="__span-23-100"><a id="__codelineno-23-100" name="__codelineno-23-100" href="#__codelineno-23-100"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span><span class="p">,</span>
</span><span id="__span-23-101"><a id="__codelineno-23-101" name="__codelineno-23-101" href="#__codelineno-23-101"></a>                <span class="n">old_doc_path</span>
</span><span id="__span-23-102"><a id="__codelineno-23-102" name="__codelineno-23-102" href="#__codelineno-23-102"></a>            <span class="p">)</span>
</span><span id="__span-23-103"><a id="__codelineno-23-103" name="__codelineno-23-103" href="#__codelineno-23-103"></a>
</span><span id="__span-23-104"><a id="__codelineno-23-104" name="__codelineno-23-104" href="#__codelineno-23-104"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-23-105"><a id="__codelineno-23-105" name="__codelineno-23-105" href="#__codelineno-23-105"></a>
</span><span id="__span-23-106"><a id="__codelineno-23-106" name="__codelineno-23-106" href="#__codelineno-23-106"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_custom_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_sections</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-23-107"><a id="__codelineno-23-107" name="__codelineno-23-107" href="#__codelineno-23-107"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create user template with customizations&quot;&quot;&quot;</span>
</span><span id="__span-23-108"><a id="__codelineno-23-108" name="__codelineno-23-108" href="#__codelineno-23-108"></a>        <span class="n">templates_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-23-109"><a id="__codelineno-23-109" name="__codelineno-23-109" href="#__codelineno-23-109"></a>        <span class="n">templates_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-23-110"><a id="__codelineno-23-110" name="__codelineno-23-110" href="#__codelineno-23-110"></a>
</span><span id="__span-23-111"><a id="__codelineno-23-111" name="__codelineno-23-111" href="#__codelineno-23-111"></a>        <span class="n">template_content</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="si">% e</span><span class="s2">xtends &#39;base/claude.md.jinja2&#39; %}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="__span-23-112"><a id="__codelineno-23-112" name="__codelineno-23-112" href="#__codelineno-23-112"></a>
</span><span id="__span-23-113"><a id="__codelineno-23-113" name="__codelineno-23-113" href="#__codelineno-23-113"></a>        <span class="c1"># Add custom blocks</span>
</span><span id="__span-23-114"><a id="__codelineno-23-114" name="__codelineno-23-114" href="#__codelineno-23-114"></a>        <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">custom_sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-23-115"><a id="__codelineno-23-115" name="__codelineno-23-115" href="#__codelineno-23-115"></a>            <span class="n">template_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">% block </span><span class="si">{</span><span class="n">block_name</span><span class="si">}</span><span class="s2"> %</span><span class="se">}}\n</span><span class="s2">&quot;</span>
</span><span id="__span-23-116"><a id="__codelineno-23-116" name="__codelineno-23-116" href="#__codelineno-23-116"></a>            <span class="n">template_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-23-117"><a id="__codelineno-23-117" name="__codelineno-23-117" href="#__codelineno-23-117"></a>            <span class="n">template_content</span> <span class="o">+=</span> <span class="s2">&quot;{</span><span class="si">% e</span><span class="s2">ndblock %}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="__span-23-118"><a id="__codelineno-23-118" name="__codelineno-23-118" href="#__codelineno-23-118"></a>
</span><span id="__span-23-119"><a id="__codelineno-23-119" name="__codelineno-23-119" href="#__codelineno-23-119"></a>        <span class="n">template_path</span> <span class="o">=</span> <span class="n">templates_dir</span> <span class="o">/</span> <span class="s2">&quot;claude.md.jinja2&quot;</span>
</span><span id="__span-23-120"><a id="__codelineno-23-120" name="__codelineno-23-120" href="#__codelineno-23-120"></a>        <span class="n">template_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">template_content</span><span class="p">)</span>
</span><span id="__span-23-121"><a id="__codelineno-23-121" name="__codelineno-23-121" href="#__codelineno-23-121"></a>
</span><span id="__span-23-122"><a id="__codelineno-23-122" name="__codelineno-23-122" href="#__codelineno-23-122"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Created custom template: </span><span class="si">{</span><span class="n">template_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="33-cli-integration">3.3 CLI Integration<a class="headerlink" href="#33-cli-integration" title="Anchor link to this section">&para;</a></h3>
<h4 id="command-structure">Command Structure<a class="headerlink" href="#command-structure" title="Anchor link to this section">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># your_package/cli.py</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.template_engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocTemplateEngine</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocsMetadata</span><span class="p">,</span> <span class="n">CURRENT_DOC_VERSION</span><span class="p">,</span> <span class="n">get_migration_path</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.migrations</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_migration</span><span class="p">,</span> <span class="n">list_migrations</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">docs</span><span class="p">():</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Documentation management commands&quot;&quot;&quot;</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="k">pass</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="nd">@docs</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>    <span class="s2">&quot;--platform&quot;</span><span class="p">,</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">,</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;claude&quot;</span><span class="p">,</span> <span class="s2">&quot;gemini&quot;</span><span class="p">,</span> <span class="s2">&quot;codex&quot;</span><span class="p">]),</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Target platform&quot;</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="p">)</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>    <span class="s2">&quot;--force&quot;</span><span class="p">,</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Overwrite existing documentation&quot;</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="p">)</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="sd">    Generate agent documentation from package templates.</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="sd">    Example:</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="sd">        your-package docs generate</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="sd">        your-package docs generate --platform gemini</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="sd">        your-package docs generate --force</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>    <span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>    <span class="n">package_name</span> <span class="o">=</span> <span class="s2">&quot;your_package&quot;</span>  <span class="c1"># Replace with your package name</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>    <span class="c1"># Check if docs already exist</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a>    <span class="n">doc_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">.md&quot;</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>    <span class="n">meta_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;.claude-docs-meta.json&quot;</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>    <span class="k">if</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Documentation already exists: </span><span class="si">{</span><span class="n">doc_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Use --force to overwrite or &#39;docs upgrade&#39; to update&quot;</span><span class="p">)</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>        <span class="k">return</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a>    <span class="c1"># Initialize template engine</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">project_root</span><span class="p">)</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a>    <span class="c1"># Prepare context</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a>    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a>        <span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="n">package_name</span><span class="p">,</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a>        <span class="s2">&quot;package_version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">(</span><span class="n">package_name</span><span class="p">),</span>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a>        <span class="s2">&quot;doc_version&quot;</span><span class="p">:</span> <span class="n">CURRENT_DOC_VERSION</span><span class="p">,</span>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a>        <span class="s2">&quot;generated_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a>        <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">platform</span>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a>    <span class="p">}</span>
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a>    <span class="c1"># Render template</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📝 Generating </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2"> documentation...&quot;</span><span class="p">)</span>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;base/</span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2">.md.jinja2&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a>    <span class="c1"># Write documentation</span>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a>    <span class="n">docs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a>    <span class="n">doc_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a>    <span class="c1"># Save metadata</span>
</span><span id="__span-24-69"><a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">DocsMetadata</span><span class="p">(</span>
</span><span id="__span-24-70"><a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a>        <span class="n">doc_version</span><span class="o">=</span><span class="n">CURRENT_DOC_VERSION</span><span class="p">,</span>
</span><span id="__span-24-71"><a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a>        <span class="n">package_version</span><span class="o">=</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;package_version&quot;</span><span class="p">],</span>
</span><span id="__span-24-72"><a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a>        <span class="n">platform</span><span class="o">=</span><span class="n">platform</span><span class="p">,</span>
</span><span id="__span-24-73"><a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a>        <span class="n">has_customizations</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-24-74"><a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a>    <span class="p">)</span>
</span><span id="__span-24-75"><a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a>    <span class="n">metadata</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">meta_path</span><span class="p">)</span>
</span><span id="__span-24-76"><a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a>
</span><span id="__span-24-77"><a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Documentation generated: </span><span class="si">{</span><span class="n">doc_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-78"><a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📋 Metadata saved: </span><span class="si">{</span><span class="n">meta_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-79"><a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a>
</span><span id="__span-24-80"><a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a><span class="nd">@docs</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span id="__span-24-81"><a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a><span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">():</span>
</span><span id="__span-24-82"><a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-83"><a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a><span class="sd">    Show current documentation version and status.</span>
</span><span id="__span-24-84"><a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a>
</span><span id="__span-24-85"><a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a><span class="sd">    Example:</span>
</span><span id="__span-24-86"><a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a><span class="sd">        your-package docs version</span>
</span><span id="__span-24-87"><a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-24-88"><a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a>    <span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
</span><span id="__span-24-89"><a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a>    <span class="n">package_name</span> <span class="o">=</span> <span class="s2">&quot;your_package&quot;</span>
</span><span id="__span-24-90"><a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-91"><a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a>    <span class="n">meta_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;.claude-docs-meta.json&quot;</span>
</span><span id="__span-24-92"><a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a>
</span><span id="__span-24-93"><a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a>    <span class="c1"># Load metadata</span>
</span><span id="__span-24-94"><a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">DocsMetadata</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">meta_path</span><span class="p">)</span>
</span><span id="__span-24-95"><a id="__codelineno-24-95" name="__codelineno-24-95" href="#__codelineno-24-95"></a>
</span><span id="__span-24-96"><a id="__codelineno-24-96" name="__codelineno-24-96" href="#__codelineno-24-96"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>
</span><span id="__span-24-97"><a id="__codelineno-24-97" name="__codelineno-24-97" href="#__codelineno-24-97"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ No documentation found. Run &#39;docs generate&#39; first.&quot;</span><span class="p">)</span>
</span><span id="__span-24-98"><a id="__codelineno-24-98" name="__codelineno-24-98" href="#__codelineno-24-98"></a>        <span class="k">return</span>
</span><span id="__span-24-99"><a id="__codelineno-24-99" name="__codelineno-24-99" href="#__codelineno-24-99"></a>
</span><span id="__span-24-100"><a id="__codelineno-24-100" name="__codelineno-24-100" href="#__codelineno-24-100"></a>    <span class="c1"># Show version info</span>
</span><span id="__span-24-101"><a id="__codelineno-24-101" name="__codelineno-24-101" href="#__codelineno-24-101"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Documentation Status</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-102"><a id="__codelineno-24-102" name="__codelineno-24-102" href="#__codelineno-24-102"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Platform:          </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">platform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-103"><a id="__codelineno-24-103" name="__codelineno-24-103" href="#__codelineno-24-103"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Doc Version:       </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-104"><a id="__codelineno-24-104" name="__codelineno-24-104" href="#__codelineno-24-104"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package Version:   </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">package_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-105"><a id="__codelineno-24-105" name="__codelineno-24-105" href="#__codelineno-24-105"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated:         </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">generated_at</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-106"><a id="__codelineno-24-106" name="__codelineno-24-106" href="#__codelineno-24-106"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Customizations:    </span><span class="si">{</span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">metadata</span><span class="o">.</span><span class="n">has_customizations</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;No&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-107"><a id="__codelineno-24-107" name="__codelineno-24-107" href="#__codelineno-24-107"></a>
</span><span id="__span-24-108"><a id="__codelineno-24-108" name="__codelineno-24-108" href="#__codelineno-24-108"></a>    <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">has_customizations</span><span class="p">:</span>
</span><span id="__span-24-109"><a id="__codelineno-24-109" name="__codelineno-24-109" href="#__codelineno-24-109"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Custom Blocks:     </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">customization_blocks</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-110"><a id="__codelineno-24-110" name="__codelineno-24-110" href="#__codelineno-24-110"></a>
</span><span id="__span-24-111"><a id="__codelineno-24-111" name="__codelineno-24-111" href="#__codelineno-24-111"></a>    <span class="c1"># Check if upgrade needed</span>
</span><span id="__span-24-112"><a id="__codelineno-24-112" name="__codelineno-24-112" href="#__codelineno-24-112"></a>    <span class="n">current_pkg_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
</span><span id="__span-24-113"><a id="__codelineno-24-113" name="__codelineno-24-113" href="#__codelineno-24-113"></a>    <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">package_version</span> <span class="o">!=</span> <span class="n">current_pkg_version</span><span class="p">:</span>
</span><span id="__span-24-114"><a id="__codelineno-24-114" name="__codelineno-24-114" href="#__codelineno-24-114"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️  Package upgraded: </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">package_version</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">current_pkg_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-115"><a id="__codelineno-24-115" name="__codelineno-24-115" href="#__codelineno-24-115"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Run &#39;docs upgrade&#39; to get latest documentation&quot;</span><span class="p">)</span>
</span><span id="__span-24-116"><a id="__codelineno-24-116" name="__codelineno-24-116" href="#__codelineno-24-116"></a>
</span><span id="__span-24-117"><a id="__codelineno-24-117" name="__codelineno-24-117" href="#__codelineno-24-117"></a>    <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">needs_upgrade</span><span class="p">(</span><span class="n">CURRENT_DOC_VERSION</span><span class="p">):</span>
</span><span id="__span-24-118"><a id="__codelineno-24-118" name="__codelineno-24-118" href="#__codelineno-24-118"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️  Documentation schema outdated: </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">CURRENT_DOC_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-119"><a id="__codelineno-24-119" name="__codelineno-24-119" href="#__codelineno-24-119"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Run &#39;docs upgrade&#39; to migrate&quot;</span><span class="p">)</span>
</span><span id="__span-24-120"><a id="__codelineno-24-120" name="__codelineno-24-120" href="#__codelineno-24-120"></a>
</span><span id="__span-24-121"><a id="__codelineno-24-121" name="__codelineno-24-121" href="#__codelineno-24-121"></a><span class="nd">@docs</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span id="__span-24-122"><a id="__codelineno-24-122" name="__codelineno-24-122" href="#__codelineno-24-122"></a><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-24-123"><a id="__codelineno-24-123" name="__codelineno-24-123" href="#__codelineno-24-123"></a>    <span class="s2">&quot;--auto-confirm&quot;</span><span class="p">,</span>
</span><span id="__span-24-124"><a id="__codelineno-24-124" name="__codelineno-24-124" href="#__codelineno-24-124"></a>    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-24-125"><a id="__codelineno-24-125" name="__codelineno-24-125" href="#__codelineno-24-125"></a>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip confirmation prompts&quot;</span>
</span><span id="__span-24-126"><a id="__codelineno-24-126" name="__codelineno-24-126" href="#__codelineno-24-126"></a><span class="p">)</span>
</span><span id="__span-24-127"><a id="__codelineno-24-127" name="__codelineno-24-127" href="#__codelineno-24-127"></a><span class="k">def</span><span class="w"> </span><span class="nf">upgrade</span><span class="p">(</span><span class="n">auto_confirm</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="__span-24-128"><a id="__codelineno-24-128" name="__codelineno-24-128" href="#__codelineno-24-128"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-129"><a id="__codelineno-24-129" name="__codelineno-24-129" href="#__codelineno-24-129"></a><span class="sd">    Upgrade documentation to latest version, preserving customizations.</span>
</span><span id="__span-24-130"><a id="__codelineno-24-130" name="__codelineno-24-130" href="#__codelineno-24-130"></a>
</span><span id="__span-24-131"><a id="__codelineno-24-131" name="__codelineno-24-131" href="#__codelineno-24-131"></a><span class="sd">    Example:</span>
</span><span id="__span-24-132"><a id="__codelineno-24-132" name="__codelineno-24-132" href="#__codelineno-24-132"></a><span class="sd">        your-package docs upgrade</span>
</span><span id="__span-24-133"><a id="__codelineno-24-133" name="__codelineno-24-133" href="#__codelineno-24-133"></a><span class="sd">        your-package docs upgrade --auto-confirm</span>
</span><span id="__span-24-134"><a id="__codelineno-24-134" name="__codelineno-24-134" href="#__codelineno-24-134"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-24-135"><a id="__codelineno-24-135" name="__codelineno-24-135" href="#__codelineno-24-135"></a>    <span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
</span><span id="__span-24-136"><a id="__codelineno-24-136" name="__codelineno-24-136" href="#__codelineno-24-136"></a>    <span class="n">package_name</span> <span class="o">=</span> <span class="s2">&quot;your_package&quot;</span>
</span><span id="__span-24-137"><a id="__codelineno-24-137" name="__codelineno-24-137" href="#__codelineno-24-137"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-138"><a id="__codelineno-24-138" name="__codelineno-24-138" href="#__codelineno-24-138"></a>    <span class="n">meta_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;.claude-docs-meta.json&quot;</span>
</span><span id="__span-24-139"><a id="__codelineno-24-139" name="__codelineno-24-139" href="#__codelineno-24-139"></a>
</span><span id="__span-24-140"><a id="__codelineno-24-140" name="__codelineno-24-140" href="#__codelineno-24-140"></a>    <span class="c1"># Load current metadata</span>
</span><span id="__span-24-141"><a id="__codelineno-24-141" name="__codelineno-24-141" href="#__codelineno-24-141"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">DocsMetadata</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">meta_path</span><span class="p">)</span>
</span><span id="__span-24-142"><a id="__codelineno-24-142" name="__codelineno-24-142" href="#__codelineno-24-142"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>
</span><span id="__span-24-143"><a id="__codelineno-24-143" name="__codelineno-24-143" href="#__codelineno-24-143"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ No documentation found. Run &#39;docs generate&#39; first.&quot;</span><span class="p">)</span>
</span><span id="__span-24-144"><a id="__codelineno-24-144" name="__codelineno-24-144" href="#__codelineno-24-144"></a>        <span class="k">return</span>
</span><span id="__span-24-145"><a id="__codelineno-24-145" name="__codelineno-24-145" href="#__codelineno-24-145"></a>
</span><span id="__span-24-146"><a id="__codelineno-24-146" name="__codelineno-24-146" href="#__codelineno-24-146"></a>    <span class="c1"># Check if upgrade needed</span>
</span><span id="__span-24-147"><a id="__codelineno-24-147" name="__codelineno-24-147" href="#__codelineno-24-147"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="o">.</span><span class="n">needs_upgrade</span><span class="p">(</span><span class="n">CURRENT_DOC_VERSION</span><span class="p">):</span>
</span><span id="__span-24-148"><a id="__codelineno-24-148" name="__codelineno-24-148" href="#__codelineno-24-148"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;✅ Documentation is already up to date!&quot;</span><span class="p">)</span>
</span><span id="__span-24-149"><a id="__codelineno-24-149" name="__codelineno-24-149" href="#__codelineno-24-149"></a>        <span class="k">return</span>
</span><span id="__span-24-150"><a id="__codelineno-24-150" name="__codelineno-24-150" href="#__codelineno-24-150"></a>
</span><span id="__span-24-151"><a id="__codelineno-24-151" name="__codelineno-24-151" href="#__codelineno-24-151"></a>    <span class="c1"># Get migration path</span>
</span><span id="__span-24-152"><a id="__codelineno-24-152" name="__codelineno-24-152" href="#__codelineno-24-152"></a>    <span class="n">migrations</span> <span class="o">=</span> <span class="n">get_migration_path</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span><span class="p">,</span> <span class="n">CURRENT_DOC_VERSION</span><span class="p">)</span>
</span><span id="__span-24-153"><a id="__codelineno-24-153" name="__codelineno-24-153" href="#__codelineno-24-153"></a>
</span><span id="__span-24-154"><a id="__codelineno-24-154" name="__codelineno-24-154" href="#__codelineno-24-154"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">migrations</span><span class="p">:</span>
</span><span id="__span-24-155"><a id="__codelineno-24-155" name="__codelineno-24-155" href="#__codelineno-24-155"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ No migration path available&quot;</span><span class="p">)</span>
</span><span id="__span-24-156"><a id="__codelineno-24-156" name="__codelineno-24-156" href="#__codelineno-24-156"></a>        <span class="k">return</span>
</span><span id="__span-24-157"><a id="__codelineno-24-157" name="__codelineno-24-157" href="#__codelineno-24-157"></a>
</span><span id="__span-24-158"><a id="__codelineno-24-158" name="__codelineno-24-158" href="#__codelineno-24-158"></a>    <span class="c1"># Show upgrade plan</span>
</span><span id="__span-24-159"><a id="__codelineno-24-159" name="__codelineno-24-159" href="#__codelineno-24-159"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📋 Upgrade Plan</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-160"><a id="__codelineno-24-160" name="__codelineno-24-160" href="#__codelineno-24-160"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current version:  </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-161"><a id="__codelineno-24-161" name="__codelineno-24-161" href="#__codelineno-24-161"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target version:   </span><span class="si">{</span><span class="n">CURRENT_DOC_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-162"><a id="__codelineno-24-162" name="__codelineno-24-162" href="#__codelineno-24-162"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Migrations:       </span><span class="si">{</span><span class="s1">&#39; → &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">migrations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-163"><a id="__codelineno-24-163" name="__codelineno-24-163" href="#__codelineno-24-163"></a>
</span><span id="__span-24-164"><a id="__codelineno-24-164" name="__codelineno-24-164" href="#__codelineno-24-164"></a>    <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">has_customizations</span><span class="p">:</span>
</span><span id="__span-24-165"><a id="__codelineno-24-165" name="__codelineno-24-165" href="#__codelineno-24-165"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️  You have customizations that will be preserved:&quot;</span><span class="p">)</span>
</span><span id="__span-24-166"><a id="__codelineno-24-166" name="__codelineno-24-166" href="#__codelineno-24-166"></a>        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">customization_blocks</span><span class="p">:</span>
</span><span id="__span-24-167"><a id="__codelineno-24-167" name="__codelineno-24-167" href="#__codelineno-24-167"></a>            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - </span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-168"><a id="__codelineno-24-168" name="__codelineno-24-168" href="#__codelineno-24-168"></a>
</span><span id="__span-24-169"><a id="__codelineno-24-169" name="__codelineno-24-169" href="#__codelineno-24-169"></a>    <span class="c1"># Confirm</span>
</span><span id="__span-24-170"><a id="__codelineno-24-170" name="__codelineno-24-170" href="#__codelineno-24-170"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">auto_confirm</span><span class="p">:</span>
</span><span id="__span-24-171"><a id="__codelineno-24-171" name="__codelineno-24-171" href="#__codelineno-24-171"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceed with upgrade?&quot;</span><span class="p">):</span>
</span><span id="__span-24-172"><a id="__codelineno-24-172" name="__codelineno-24-172" href="#__codelineno-24-172"></a>            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ Upgrade cancelled&quot;</span><span class="p">)</span>
</span><span id="__span-24-173"><a id="__codelineno-24-173" name="__codelineno-24-173" href="#__codelineno-24-173"></a>            <span class="k">return</span>
</span><span id="__span-24-174"><a id="__codelineno-24-174" name="__codelineno-24-174" href="#__codelineno-24-174"></a>
</span><span id="__span-24-175"><a id="__codelineno-24-175" name="__codelineno-24-175" href="#__codelineno-24-175"></a>    <span class="c1"># Run migrations</span>
</span><span id="__span-24-176"><a id="__codelineno-24-176" name="__codelineno-24-176" href="#__codelineno-24-176"></a>    <span class="k">for</span> <span class="n">migration_id</span> <span class="ow">in</span> <span class="n">migrations</span><span class="p">:</span>
</span><span id="__span-24-177"><a id="__codelineno-24-177" name="__codelineno-24-177" href="#__codelineno-24-177"></a>        <span class="n">migration_class</span> <span class="o">=</span> <span class="n">get_migration</span><span class="p">(</span><span class="n">migration_id</span><span class="p">)</span>
</span><span id="__span-24-178"><a id="__codelineno-24-178" name="__codelineno-24-178" href="#__codelineno-24-178"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">migration_class</span><span class="p">:</span>
</span><span id="__span-24-179"><a id="__codelineno-24-179" name="__codelineno-24-179" href="#__codelineno-24-179"></a>            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Migration not found: </span><span class="si">{</span><span class="n">migration_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-180"><a id="__codelineno-24-180" name="__codelineno-24-180" href="#__codelineno-24-180"></a>            <span class="k">return</span>
</span><span id="__span-24-181"><a id="__codelineno-24-181" name="__codelineno-24-181" href="#__codelineno-24-181"></a>
</span><span id="__span-24-182"><a id="__codelineno-24-182" name="__codelineno-24-182" href="#__codelineno-24-182"></a>        <span class="n">migration</span> <span class="o">=</span> <span class="n">migration_class</span><span class="p">(</span><span class="n">project_root</span><span class="p">,</span> <span class="n">package_name</span><span class="p">)</span>
</span><span id="__span-24-183"><a id="__codelineno-24-183" name="__codelineno-24-183" href="#__codelineno-24-183"></a>        <span class="n">success</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-24-184"><a id="__codelineno-24-184" name="__codelineno-24-184" href="#__codelineno-24-184"></a>
</span><span id="__span-24-185"><a id="__codelineno-24-185" name="__codelineno-24-185" href="#__codelineno-24-185"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
</span><span id="__span-24-186"><a id="__codelineno-24-186" name="__codelineno-24-186" href="#__codelineno-24-186"></a>            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Migration failed: </span><span class="si">{</span><span class="n">migration_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-187"><a id="__codelineno-24-187" name="__codelineno-24-187" href="#__codelineno-24-187"></a>            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Documentation restored from backup&quot;</span><span class="p">)</span>
</span><span id="__span-24-188"><a id="__codelineno-24-188" name="__codelineno-24-188" href="#__codelineno-24-188"></a>            <span class="k">return</span>
</span><span id="__span-24-189"><a id="__codelineno-24-189" name="__codelineno-24-189" href="#__codelineno-24-189"></a>
</span><span id="__span-24-190"><a id="__codelineno-24-190" name="__codelineno-24-190" href="#__codelineno-24-190"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ Documentation upgraded successfully!&quot;</span><span class="p">)</span>
</span><span id="__span-24-191"><a id="__codelineno-24-191" name="__codelineno-24-191" href="#__codelineno-24-191"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   New version: </span><span class="si">{</span><span class="n">CURRENT_DOC_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-192"><a id="__codelineno-24-192" name="__codelineno-24-192" href="#__codelineno-24-192"></a>
</span><span id="__span-24-193"><a id="__codelineno-24-193" name="__codelineno-24-193" href="#__codelineno-24-193"></a><span class="nd">@docs</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span id="__span-24-194"><a id="__codelineno-24-194" name="__codelineno-24-194" href="#__codelineno-24-194"></a><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-24-195"><a id="__codelineno-24-195" name="__codelineno-24-195" href="#__codelineno-24-195"></a>    <span class="s2">&quot;--backup-id&quot;</span><span class="p">,</span>
</span><span id="__span-24-196"><a id="__codelineno-24-196" name="__codelineno-24-196" href="#__codelineno-24-196"></a>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specific backup to rollback to (YYYYMMDD_HHMMSS)&quot;</span>
</span><span id="__span-24-197"><a id="__codelineno-24-197" name="__codelineno-24-197" href="#__codelineno-24-197"></a><span class="p">)</span>
</span><span id="__span-24-198"><a id="__codelineno-24-198" name="__codelineno-24-198" href="#__codelineno-24-198"></a><span class="k">def</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="n">backup_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-24-199"><a id="__codelineno-24-199" name="__codelineno-24-199" href="#__codelineno-24-199"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-200"><a id="__codelineno-24-200" name="__codelineno-24-200" href="#__codelineno-24-200"></a><span class="sd">    Rollback documentation to a previous backup.</span>
</span><span id="__span-24-201"><a id="__codelineno-24-201" name="__codelineno-24-201" href="#__codelineno-24-201"></a>
</span><span id="__span-24-202"><a id="__codelineno-24-202" name="__codelineno-24-202" href="#__codelineno-24-202"></a><span class="sd">    Example:</span>
</span><span id="__span-24-203"><a id="__codelineno-24-203" name="__codelineno-24-203" href="#__codelineno-24-203"></a><span class="sd">        your-package docs rollback --backup-id 20250102_103000</span>
</span><span id="__span-24-204"><a id="__codelineno-24-204" name="__codelineno-24-204" href="#__codelineno-24-204"></a><span class="sd">        your-package docs rollback  # Shows available backups</span>
</span><span id="__span-24-205"><a id="__codelineno-24-205" name="__codelineno-24-205" href="#__codelineno-24-205"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-24-206"><a id="__codelineno-24-206" name="__codelineno-24-206" href="#__codelineno-24-206"></a>    <span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
</span><span id="__span-24-207"><a id="__codelineno-24-207" name="__codelineno-24-207" href="#__codelineno-24-207"></a>    <span class="n">package_name</span> <span class="o">=</span> <span class="s2">&quot;your_package&quot;</span>
</span><span id="__span-24-208"><a id="__codelineno-24-208" name="__codelineno-24-208" href="#__codelineno-24-208"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-209"><a id="__codelineno-24-209" name="__codelineno-24-209" href="#__codelineno-24-209"></a>    <span class="n">backups_dir</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;backups&quot;</span>
</span><span id="__span-24-210"><a id="__codelineno-24-210" name="__codelineno-24-210" href="#__codelineno-24-210"></a>
</span><span id="__span-24-211"><a id="__codelineno-24-211" name="__codelineno-24-211" href="#__codelineno-24-211"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">backups_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-24-212"><a id="__codelineno-24-212" name="__codelineno-24-212" href="#__codelineno-24-212"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ No backups found&quot;</span><span class="p">)</span>
</span><span id="__span-24-213"><a id="__codelineno-24-213" name="__codelineno-24-213" href="#__codelineno-24-213"></a>        <span class="k">return</span>
</span><span id="__span-24-214"><a id="__codelineno-24-214" name="__codelineno-24-214" href="#__codelineno-24-214"></a>
</span><span id="__span-24-215"><a id="__codelineno-24-215" name="__codelineno-24-215" href="#__codelineno-24-215"></a>    <span class="c1"># List available backups</span>
</span><span id="__span-24-216"><a id="__codelineno-24-216" name="__codelineno-24-216" href="#__codelineno-24-216"></a>    <span class="n">backups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">backups_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-24-217"><a id="__codelineno-24-217" name="__codelineno-24-217" href="#__codelineno-24-217"></a>
</span><span id="__span-24-218"><a id="__codelineno-24-218" name="__codelineno-24-218" href="#__codelineno-24-218"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_id</span><span class="p">:</span>
</span><span id="__span-24-219"><a id="__codelineno-24-219" name="__codelineno-24-219" href="#__codelineno-24-219"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📦 Available Backups:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-220"><a id="__codelineno-24-220" name="__codelineno-24-220" href="#__codelineno-24-220"></a>        <span class="k">for</span> <span class="n">backup</span> <span class="ow">in</span> <span class="n">backups</span><span class="p">:</span>
</span><span id="__span-24-221"><a id="__codelineno-24-221" name="__codelineno-24-221" href="#__codelineno-24-221"></a>            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">backup</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-222"><a id="__codelineno-24-222" name="__codelineno-24-222" href="#__codelineno-24-222"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Use: docs rollback --backup-id &lt;id&gt;&quot;</span><span class="p">)</span>
</span><span id="__span-24-223"><a id="__codelineno-24-223" name="__codelineno-24-223" href="#__codelineno-24-223"></a>        <span class="k">return</span>
</span><span id="__span-24-224"><a id="__codelineno-24-224" name="__codelineno-24-224" href="#__codelineno-24-224"></a>
</span><span id="__span-24-225"><a id="__codelineno-24-225" name="__codelineno-24-225" href="#__codelineno-24-225"></a>    <span class="c1"># Rollback to specific backup</span>
</span><span id="__span-24-226"><a id="__codelineno-24-226" name="__codelineno-24-226" href="#__codelineno-24-226"></a>    <span class="n">backup_path</span> <span class="o">=</span> <span class="n">backups_dir</span> <span class="o">/</span> <span class="n">backup_id</span>
</span><span id="__span-24-227"><a id="__codelineno-24-227" name="__codelineno-24-227" href="#__codelineno-24-227"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-24-228"><a id="__codelineno-24-228" name="__codelineno-24-228" href="#__codelineno-24-228"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Backup not found: </span><span class="si">{</span><span class="n">backup_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-229"><a id="__codelineno-24-229" name="__codelineno-24-229" href="#__codelineno-24-229"></a>        <span class="k">return</span>
</span><span id="__span-24-230"><a id="__codelineno-24-230" name="__codelineno-24-230" href="#__codelineno-24-230"></a>
</span><span id="__span-24-231"><a id="__codelineno-24-231" name="__codelineno-24-231" href="#__codelineno-24-231"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔄 Rolling back to: </span><span class="si">{</span><span class="n">backup_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-24-232"><a id="__codelineno-24-232" name="__codelineno-24-232" href="#__codelineno-24-232"></a>
</span><span id="__span-24-233"><a id="__codelineno-24-233" name="__codelineno-24-233" href="#__codelineno-24-233"></a>    <span class="c1"># Restore files</span>
</span><span id="__span-24-234"><a id="__codelineno-24-234" name="__codelineno-24-234" href="#__codelineno-24-234"></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
</span><span id="__span-24-235"><a id="__codelineno-24-235" name="__codelineno-24-235" href="#__codelineno-24-235"></a>        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-24-236"><a id="__codelineno-24-236" name="__codelineno-24-236" href="#__codelineno-24-236"></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-24-237"><a id="__codelineno-24-237" name="__codelineno-24-237" href="#__codelineno-24-237"></a>
</span><span id="__span-24-238"><a id="__codelineno-24-238" name="__codelineno-24-238" href="#__codelineno-24-238"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Documentation restored from backup&quot;</span><span class="p">)</span>
</span><span id="__span-24-239"><a id="__codelineno-24-239" name="__codelineno-24-239" href="#__codelineno-24-239"></a>
</span><span id="__span-24-240"><a id="__codelineno-24-240" name="__codelineno-24-240" href="#__codelineno-24-240"></a><span class="nd">@docs</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span id="__span-24-241"><a id="__codelineno-24-241" name="__codelineno-24-241" href="#__codelineno-24-241"></a><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-24-242"><a id="__codelineno-24-242" name="__codelineno-24-242" href="#__codelineno-24-242"></a>    <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
</span><span id="__span-24-243"><a id="__codelineno-24-243" name="__codelineno-24-243" href="#__codelineno-24-243"></a>    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-24-244"><a id="__codelineno-24-244" name="__codelineno-24-244" href="#__codelineno-24-244"></a>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show detailed diff&quot;</span>
</span><span id="__span-24-245"><a id="__codelineno-24-245" name="__codelineno-24-245" href="#__codelineno-24-245"></a><span class="p">)</span>
</span><span id="__span-24-246"><a id="__codelineno-24-246" name="__codelineno-24-246" href="#__codelineno-24-246"></a><span class="k">def</span><span class="w"> </span><span class="nf">diff</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="__span-24-247"><a id="__codelineno-24-247" name="__codelineno-24-247" href="#__codelineno-24-247"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-248"><a id="__codelineno-24-248" name="__codelineno-24-248" href="#__codelineno-24-248"></a><span class="sd">    Show differences between current docs and package template.</span>
</span><span id="__span-24-249"><a id="__codelineno-24-249" name="__codelineno-24-249" href="#__codelineno-24-249"></a>
</span><span id="__span-24-250"><a id="__codelineno-24-250" name="__codelineno-24-250" href="#__codelineno-24-250"></a><span class="sd">    Example:</span>
</span><span id="__span-24-251"><a id="__codelineno-24-251" name="__codelineno-24-251" href="#__codelineno-24-251"></a><span class="sd">        your-package docs diff</span>
</span><span id="__span-24-252"><a id="__codelineno-24-252" name="__codelineno-24-252" href="#__codelineno-24-252"></a><span class="sd">        your-package docs diff --verbose</span>
</span><span id="__span-24-253"><a id="__codelineno-24-253" name="__codelineno-24-253" href="#__codelineno-24-253"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-24-254"><a id="__codelineno-24-254" name="__codelineno-24-254" href="#__codelineno-24-254"></a>    <span class="c1"># Implementation similar to HtmlGraph&#39;s diff_memory_files</span>
</span><span id="__span-24-255"><a id="__codelineno-24-255" name="__codelineno-24-255" href="#__codelineno-24-255"></a>    <span class="c1"># Compare user&#39;s generated docs with fresh template render</span>
</span><span id="__span-24-256"><a id="__codelineno-24-256" name="__codelineno-24-256" href="#__codelineno-24-256"></a>    <span class="c1"># Highlight customizations</span>
</span><span id="__span-24-257"><a id="__codelineno-24-257" name="__codelineno-24-257" href="#__codelineno-24-257"></a>    <span class="k">pass</span>
</span></code></pre></div>
<hr />
<h3 id="34-hook-integration-optional">3.4 Hook Integration (Optional)<a class="headerlink" href="#34-hook-integration-optional" title="Anchor link to this section">&para;</a></h3>
<h4 id="hook-selection">Hook Selection<a class="headerlink" href="#hook-selection" title="Anchor link to this section">&para;</a></h4>
<p><strong>Best hooks for documentation injection:</strong></p>
<ol>
<li><strong>SessionStart</strong> - Inject docs once at session start</li>
<li><strong>Pros:</strong> Minimal context pollution, always available</li>
<li>
<p><strong>Cons:</strong> Users may forget docs exist, no refresh on updates</p>
</li>
<li>
<p><strong>PreToolUse</strong> - Inject docs before specific tools</p>
</li>
<li><strong>Pros:</strong> Context-aware, docs when needed</li>
<li>
<p><strong>Cons:</strong> Repetitive injection, context budget issues</p>
</li>
<li>
<p><strong>UserPromptSubmit</strong> - Inject on keywords</p>
</li>
<li><strong>Pros:</strong> On-demand, minimal overhead</li>
<li><strong>Cons:</strong> Requires user to remember keywords</li>
</ol>
<p><strong>Recommended:</strong> <code>SessionStart</code> with progressive disclosure</p>
<h4 id="context-injection-strategy">Context Injection Strategy<a class="headerlink" href="#context-injection-strategy" title="Anchor link to this section">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># .claude-plugin/hooks/session-start.py</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="c1"># Load hook input</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    <span class="n">hook_input</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="c1"># Find project root</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">hook_input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cwd&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()))</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">cwd</span> <span class="o">/</span> <span class="s2">&quot;.your-package&quot;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="n">doc_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="n">meta_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;.claude-docs-meta.json&quot;</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>    <span class="c1"># Check if docs exist</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>        <span class="c1"># No docs, no injection</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}))</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>        <span class="k">return</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="c1"># Load metadata for context budget management</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>    <span class="k">if</span> <span class="n">meta_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>    <span class="c1"># Read documentation</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>    <span class="n">doc_content</span> <span class="o">=</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>    <span class="c1"># Progressive disclosure: Inject summary + link to full docs</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>    <span class="n">summary</span> <span class="o">=</span> <span class="n">extract_summary</span><span class="p">(</span><span class="n">doc_content</span><span class="p">)</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="s2"># 📚 YourPackage Documentation Available</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a><span class="si">{</span><span class="n">summary</span><span class="si">}</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="s2">**Full documentation:** `.your-package/CLAUDE.md`</span>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="s2">**Quick commands:**</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="s2">- `your-package docs version` - Check doc status</span>
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="s2">- `your-package docs upgrade` - Get latest docs</span>
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="s2">- `your-package --help` - Show CLI help</span>
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="s2">💡 Use the full documentation for detailed API reference and examples.</span>
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>    <span class="c1"># Add version warning if outdated</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="n">needs_upgrade</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>        <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a><span class="s2">⚠️  **Documentation may be outdated!**</span>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="s2">Current: v</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;doc_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (package v</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;package_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a><span class="s2">Run: `your-package docs upgrade`</span>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>    <span class="c1"># Return injected prompt</span>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}))</span>
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_summary</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract Quick Start section as summary&quot;&quot;&quot;</span>
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a>    <span class="c1"># Parse Markdown and extract ## Quick Start section</span>
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>    <span class="c1"># Return condensed version</span>
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a>    <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a>    <span class="n">in_quickstart</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a>    <span class="n">summary_lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a>
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a>        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;## Quick Start&quot;</span><span class="p">):</span>
</span><span id="__span-25-70"><a id="__codelineno-25-70" name="__codelineno-25-70" href="#__codelineno-25-70"></a>            <span class="n">in_quickstart</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-25-71"><a id="__codelineno-25-71" name="__codelineno-25-71" href="#__codelineno-25-71"></a>            <span class="k">continue</span>
</span><span id="__span-25-72"><a id="__codelineno-25-72" name="__codelineno-25-72" href="#__codelineno-25-72"></a>        <span class="k">if</span> <span class="n">in_quickstart</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;##&quot;</span><span class="p">):</span>
</span><span id="__span-25-73"><a id="__codelineno-25-73" name="__codelineno-25-73" href="#__codelineno-25-73"></a>            <span class="k">break</span>
</span><span id="__span-25-74"><a id="__codelineno-25-74" name="__codelineno-25-74" href="#__codelineno-25-74"></a>        <span class="k">if</span> <span class="n">in_quickstart</span><span class="p">:</span>
</span><span id="__span-25-75"><a id="__codelineno-25-75" name="__codelineno-25-75" href="#__codelineno-25-75"></a>            <span class="n">summary_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-25-76"><a id="__codelineno-25-76" name="__codelineno-25-76" href="#__codelineno-25-76"></a>
</span><span id="__span-25-77"><a id="__codelineno-25-77" name="__codelineno-25-77" href="#__codelineno-25-77"></a>    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_lines</span><span class="p">[:</span><span class="mi">15</span><span class="p">])</span>  <span class="c1"># First 15 lines only</span>
</span><span id="__span-25-78"><a id="__codelineno-25-78" name="__codelineno-25-78" href="#__codelineno-25-78"></a>
</span><span id="__span-25-79"><a id="__codelineno-25-79" name="__codelineno-25-79" href="#__codelineno-25-79"></a><span class="k">def</span><span class="w"> </span><span class="nf">needs_upgrade</span><span class="p">(</span><span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-25-80"><a id="__codelineno-25-80" name="__codelineno-25-80" href="#__codelineno-25-80"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if docs need upgrade&quot;&quot;&quot;</span>
</span><span id="__span-25-81"><a id="__codelineno-25-81" name="__codelineno-25-81" href="#__codelineno-25-81"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-25-82"><a id="__codelineno-25-82" name="__codelineno-25-82" href="#__codelineno-25-82"></a>    <span class="n">CURRENT_DOC_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>  <span class="c1"># Replace with actual</span>
</span><span id="__span-25-83"><a id="__codelineno-25-83" name="__codelineno-25-83" href="#__codelineno-25-83"></a>
</span><span id="__span-25-84"><a id="__codelineno-25-84" name="__codelineno-25-84" href="#__codelineno-25-84"></a>    <span class="n">doc_ver</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;doc_version&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
</span><span id="__span-25-85"><a id="__codelineno-25-85" name="__codelineno-25-85" href="#__codelineno-25-85"></a>    <span class="k">return</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">doc_ver</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">CURRENT_DOC_VERSION</span><span class="p">)</span>
</span><span id="__span-25-86"><a id="__codelineno-25-86" name="__codelineno-25-86" href="#__codelineno-25-86"></a>
</span><span id="__span-25-87"><a id="__codelineno-25-87" name="__codelineno-25-87" href="#__codelineno-25-87"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-25-88"><a id="__codelineno-25-88" name="__codelineno-25-88" href="#__codelineno-25-88"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="token-budget-management">Token Budget Management<a class="headerlink" href="#token-budget-management" title="Anchor link to this section">&para;</a></h4>
<p><strong>Strategy:</strong> Progressive disclosure with sections</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="gh"># Documentation (Condensed for Context Budget)</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="gu">## Quick Reference</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>[Essential API calls, always shown]
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="gu">## Common Patterns</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>&lt;details&gt;
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>&lt;summary&gt;Click to expand&lt;/summary&gt;
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>[Frequently used patterns]
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>&lt;/details&gt;
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="gu">## Advanced Usage</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>&lt;details&gt;
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>&lt;summary&gt;Click to expand&lt;/summary&gt;
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>[Advanced topics]
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>&lt;/details&gt;
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="gu">## Full Documentation</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>See <span class="sb">`.your-package/CLAUDE.md`</span> for complete reference.
</span></code></pre></div>
<p><strong>Or use template blocks:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>{# Condensed version for hook injection #}
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>{% block hook_summary %}
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>## Quick Reference
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>- Command 1: Description
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>- Command 2: Description
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>- Command 3: Description
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>Full docs: `.your-package/CLAUDE.md`
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>{% endblock %}
</span></code></pre></div>
<hr />
<h2 id="4-best-practices">4. Best Practices<a class="headerlink" href="#4-best-practices" title="Anchor link to this section">&para;</a></h2>
<h3 id="template-design">Template Design<a class="headerlink" href="#template-design" title="Anchor link to this section">&para;</a></h3>
<h4 id="block-naming-conventions">Block Naming Conventions<a class="headerlink" href="#block-naming-conventions" title="Anchor link to this section">&para;</a></h4>
<p><strong>Use semantic names, not structural:</strong></p>
<p>✅ <strong>Good:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>{% block quickstart %}
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>{% block configuration %}
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>{% block api_reference %}
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>{% block troubleshooting %}
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>{% block orchestration_patterns %}
</span></code></pre></div></p>
<p>❌ <strong>Bad:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>{% block section_1 %}
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>{% block part_a %}
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>{% block content %}
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>{% block div_2 %}
</span></code></pre></div></p>
<p><strong>Naming guidelines:</strong>
- Use snake_case for consistency
- Be specific (not generic)
- Indicate content type (e.g., <code>_examples</code>, <code>_reference</code>)
- Group related blocks (e.g., <code>advanced_orchestration</code>, <code>advanced_analytics</code>)</p>
<h4 id="section-organization">Section Organization<a class="headerlink" href="#section-organization" title="Anchor link to this section">&para;</a></h4>
<p><strong>Recommended structure:</strong></p>
<ol>
<li><strong>Header</strong> - Package name, version, generated timestamp</li>
<li><strong>Quick Start</strong> - Get users productive fast</li>
<li><strong>Configuration</strong> - Setup and customization</li>
<li><strong>Core Concepts</strong> - Fundamental understanding</li>
<li><strong>API Reference</strong> - Detailed reference</li>
<li><strong>Advanced Usage</strong> - Power user features</li>
<li><strong>Troubleshooting</strong> - Common issues</li>
<li><strong>Customization Guide</strong> - How to override blocks</li>
<li><strong>Footer</strong> - Version info, links</li>
</ol>
<p><strong>Template organization:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>{# Header - Always visible #}
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>{% block header %}{% endblock %}
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>{# Critical path - Always visible #}
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>{% block quickstart %}{% endblock %}
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>{% block configuration %}{% endblock %}
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>{# Core content - Collapsible or always visible #}
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>{% block core_concepts %}{% endblock %}
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>{% block api_reference %}{% endblock %}
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>{# Advanced - User can exclude to save tokens #}
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>{% block advanced %}
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>  {% block orchestration %}{% endblock %}
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>  {% block analytics %}{% endblock %}
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>{% endblock %}
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>{# Support - User can exclude #}
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>{% block troubleshooting %}{% endblock %}
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>{% block examples %}{% endblock %}
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>{# Footer - Always visible #}
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>{% block footer %}{% endblock %}
</span></code></pre></div></p>
<h4 id="reusable-template-patterns">Reusable Template Patterns<a class="headerlink" href="#reusable-template-patterns" title="Anchor link to this section">&para;</a></h4>
<p><strong>Include pattern for shared content:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>{# templates/shared/api-common.md.jinja2 #}
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>## Common API Patterns
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>### Error Handling
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>All API methods follow this pattern:
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>```python
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>try:
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>    result = sdk.method()
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>except PackageError as e:
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    print(f&quot;Error: {e}&quot;)
</span></code></pre></div></p>
<p _="%" endmacro="endmacro">{# Use in multiple templates #}
{% include "shared/api-common.md.jinja2" %}
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>**Macro pattern for repeated structures:**
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>```jinja2
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>{# Define macro #}
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>{% macro code_example(title, code, language=&quot;python&quot;) %}
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>### {{ title }}
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>```{{ language }}
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>{{ code }}
</span></code></pre></div></p>
<p>{# Use macro #}
{{ code_example("Create Feature", "sdk.features.create('title')") }}
{{ code_example("Run Analytics", "sdk.analytics.recommend_next_work()") }}
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>---
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>### Version Management
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>#### When to Bump Doc Schema Version
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>**Bump doc_version when:**
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>- ✅ Template structure changes (blocks added/removed/renamed)
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>- ✅ Required context changes (new required sections)
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>- ✅ Breaking changes in customization API
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>- ✅ File location changes
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>- ✅ Metadata format changes
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>**Don&#39;t bump doc_version when:**
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>- ❌ Content updates (typo fixes, clarifications)
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>- ❌ New examples added
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>- ❌ Package version bumps (use package_version for that)
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>- ❌ Documentation improvements (same structure)
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>**Example decision tree:**
</span></code></pre></div>
Did template block structure change? YES → Bump doc_version
Did metadata schema change? YES → Bump doc_version
Did file paths change? YES → Bump doc_version
Did you just improve docs content? NO → Don't bump
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>#### N-1 Compatibility Strategy
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>**Goal:** Old docs work with new package versions
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>```python
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a># Version 1 docs can work with package 0.9.0 - 0.9.9
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a># Version 2 docs work with package 0.10.0+
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a># User on doc v1 installs package 0.9.5 → Works fine
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a># User on doc v1 installs package 0.10.0 → Warning + upgrade prompt
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a># User on doc v2 installs package 0.9.0 → Error (unsupported)
</span></code></pre></div></p>
<p><strong>Implementation:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_compatibility</span><span class="p">(</span><span class="n">metadata</span><span class="p">:</span> <span class="n">DocsMetadata</span><span class="p">,</span> <span class="n">package_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if docs are compatible with package&quot;&quot;&quot;</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    <span class="n">compat</span> <span class="o">=</span> <span class="n">VERSION_COMPATIBILITY</span><span class="p">[</span><span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span><span class="p">]</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">compat</span><span class="p">:</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Unknown doc version&quot;</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>    <span class="n">pkg_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>    <span class="n">min_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">compat</span><span class="p">[</span><span class="s2">&quot;min_package&quot;</span><span class="p">])</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>    <span class="n">max_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">compat</span><span class="p">[</span><span class="s2">&quot;max_package&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">compat</span><span class="p">[</span><span class="s2">&quot;max_package&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>    <span class="k">if</span> <span class="n">pkg_ver</span> <span class="o">&lt;</span> <span class="n">min_ver</span><span class="p">:</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Package too old (need &gt;= </span><span class="si">{</span><span class="n">min_ver</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>    <span class="k">if</span> <span class="n">max_ver</span> <span class="ow">and</span> <span class="n">pkg_ver</span> <span class="o">&gt;</span> <span class="n">max_ver</span><span class="p">:</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Docs outdated (upgrade for &gt;= </span><span class="si">{</span><span class="n">max_ver</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Compatible&quot;</span>
</span></code></pre></div></p>
<h4 id="breaking-change-communication">Breaking Change Communication<a class="headerlink" href="#breaking-change-communication" title="Anchor link to this section">&para;</a></h4>
<p><strong>When introducing breaking changes:</strong></p>
<ol>
<li>
<p><strong>Announce in CHANGELOG:</strong>
   <div class="language-markdown highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="gu">## [0.10.0] - 2025-01-15</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="gu">### BREAKING CHANGES</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="k">-</span><span class="w"> </span>Documentation schema upgraded to v2
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="k">-</span><span class="w"> </span>File moved: <span class="sb">`CLAUDE.md`</span> → <span class="sb">`.your-package/CLAUDE.md`</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="k">-</span><span class="w"> </span>Custom configurations now use Jinja2 blocks
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="gs">**Migration:**</span> Run <span class="sb">`your-package docs upgrade`</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Add upgrade prompt in CLI:</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span> <span class="o">&lt;</span> <span class="n">CURRENT_DOC_VERSION</span><span class="p">:</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️  BREAKING CHANGE&quot;</span><span class="p">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Documentation schema updated: v</span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">doc_version</span><span class="si">}</span><span class="s2"> → v</span><span class="si">{</span><span class="n">CURRENT_DOC_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;   Your customizations will be preserved during upgrade.&quot;</span><span class="p">)</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Run: your-package docs upgrade&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Provide clear migration path:</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Migration script with clear messaging</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Migration001To002</span><span class="p">(</span><span class="n">MigrationScript</span><span class="p">):</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="s2">    Migrate to template-based documentation system.</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="s2">    What changes:</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="s2">    - File moves to .your-package/CLAUDE.md</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="s2">    - Custom sections become Jinja2 blocks</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="s2">    - Version tracking with .claude-docs-meta.json</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="s2">    What&#39;s preserved:</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="s2">    - All your custom content</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="s2">    - Custom configuration</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="s2">    - Custom workflows</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="s2">    &quot;&quot;&quot;</span>
</span></code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="user-experience">User Experience<a class="headerlink" href="#user-experience" title="Anchor link to this section">&para;</a></h3>
<h4 id="clear-upgrade-prompts">Clear Upgrade Prompts<a class="headerlink" href="#clear-upgrade-prompts" title="Anchor link to this section">&para;</a></h4>
<p><strong>Example upgrade flow:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>$<span class="w"> </span>your-package<span class="w"> </span>docs<span class="w"> </span>version
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>📊<span class="w"> </span>Documentation<span class="w"> </span>Status
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>Platform:<span class="w">          </span>claude
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>Doc<span class="w"> </span>Version:<span class="w">       </span><span class="m">1</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>Package<span class="w"> </span>Version:<span class="w">   </span><span class="m">0</span>.9.0
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>Generated:<span class="w">         </span><span class="m">2024</span>-12-15T10:30:00Z
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>⚠️<span class="w">  </span>Package<span class="w"> </span>upgraded:<span class="w"> </span><span class="m">0</span>.9.0<span class="w"> </span>→<span class="w"> </span><span class="m">0</span>.10.2
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">   </span>Run<span class="w"> </span><span class="s1">&#39;docs upgrade&#39;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>latest<span class="w"> </span>documentation
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>⚠️<span class="w">  </span>Documentation<span class="w"> </span>schema<span class="w"> </span>outdated:<span class="w"> </span><span class="m">1</span><span class="w"> </span>→<span class="w"> </span><span class="m">2</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">   </span>Run<span class="w"> </span><span class="s1">&#39;docs upgrade&#39;</span><span class="w"> </span>to<span class="w"> </span>migrate
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>$<span class="w"> </span>your-package<span class="w"> </span>docs<span class="w"> </span>upgrade
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>📋<span class="w"> </span>Upgrade<span class="w"> </span>Plan
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>Current<span class="w"> </span>version:<span class="w">  </span><span class="m">1</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>Target<span class="w"> </span>version:<span class="w">   </span><span class="m">2</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a>Migrations:<span class="w">       </span>001_to_002
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a>⚠️<span class="w">  </span>You<span class="w"> </span>have<span class="w"> </span>customizations<span class="w"> </span>that<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>preserved:
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">   </span>-<span class="w"> </span>configuration
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">   </span>-<span class="w"> </span>workflows
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a>Proceed<span class="w"> </span>with<span class="w"> </span>upgrade?<span class="w"> </span><span class="o">[</span>y/N<span class="o">]</span>:<span class="w"> </span>y
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a>🔄<span class="w"> </span>Migration:<span class="w"> </span>Migrate<span class="w"> </span>to<span class="w"> </span>template-based<span class="w"> </span>system
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="w">   </span>From<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span>→<span class="w"> </span><span class="m">2</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="w">   </span>Detecting<span class="w"> </span>customizations...
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">   </span>Found<span class="w"> </span>customizations:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;configuration&#39;</span>,<span class="w"> </span><span class="s1">&#39;workflows&#39;</span><span class="o">]</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">   </span>Migrating<span class="w"> </span>documentation...
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a>✅<span class="w"> </span>Migration<span class="w"> </span>completed<span class="w"> </span>successfully
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a>✅<span class="w"> </span>Documentation<span class="w"> </span>upgraded<span class="w"> </span>successfully!
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">   </span>New<span class="w"> </span>version:<span class="w"> </span><span class="m">2</span>
</span></code></pre></div>
<h4 id="informative-error-messages">Informative Error Messages<a class="headerlink" href="#informative-error-messages" title="Anchor link to this section">&para;</a></h4>
<p><strong>Good error messages:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># ❌ Bad</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Migration failed&quot;</span><span class="p">)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="c1"># ✅ Good</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="k">raise</span> <span class="n">MigrationError</span><span class="p">(</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    <span class="sa">f</span><span class="s2">&quot;Migration </span><span class="si">{</span><span class="n">migration_id</span><span class="si">}</span><span class="s2"> failed during customization detection.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>    <span class="sa">f</span><span class="s2">&quot;Possible causes:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="sa">f</span><span class="s2">&quot;1. Documentation file corrupted</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    <span class="sa">f</span><span class="s2">&quot;2. Custom template syntax error</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>    <span class="sa">f</span><span class="s2">&quot;3. Incompatible customization format</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>    <span class="sa">f</span><span class="s2">&quot;Your documentation has been restored from backup:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>    <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>    <span class="sa">f</span><span class="s2">&quot;For help, see: https://docs.example.com/migration-troubleshooting&quot;</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="p">)</span>
</span></code></pre></div>
<p><strong>Actionable errors:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ Documentation not found&quot;</span><span class="p">)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;   Expected: .your-package/CLAUDE.md&quot;</span><span class="p">)</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;   Run: your-package docs generate&quot;</span><span class="p">)</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>    <span class="k">return</span>
</span></code></pre></div></p>
<h4 id="safe-defaults">Safe Defaults<a class="headerlink" href="#safe-defaults" title="Anchor link to this section">&para;</a></h4>
<p><strong>Principle:</strong> Prefer safety over convenience</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># ✅ Safe: Require explicit confirmation for destructive operations</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--force&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Overwrite existing docs&quot;</span><span class="p">)</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>    <span class="k">if</span> <span class="n">doc_exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Docs exist. Use --force to overwrite&quot;</span><span class="p">)</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>        <span class="k">return</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="c1"># ✅ Safe: Create backups automatically</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">():</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>    <span class="n">backup_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">()</span>  <span class="c1"># Always backup before migration</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">perform_migration</span><span class="p">()</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>  <span class="c1"># Auto-rollback on failure</span>
</span></code></pre></div>
<h4 id="rollback-confidence">Rollback Confidence<a class="headerlink" href="#rollback-confidence" title="Anchor link to this section">&para;</a></h4>
<p><strong>Make rollback trustworthy:</strong></p>
<ol>
<li>
<p><strong>Automatic backups:</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create timestamped backup automatically&quot;&quot;&quot;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="n">backup_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;backups&quot;</span> <span class="o">/</span> <span class="n">timestamp</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="c1"># ... copy files ...</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    <span class="k">return</span> <span class="n">backup_dir</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>List available backups:</strong>
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>$<span class="w"> </span>your-package<span class="w"> </span>docs<span class="w"> </span>rollback
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>📦<span class="w"> </span>Available<span class="w"> </span>Backups:
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">   </span>20250102_103000
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">   </span>20250101_150000
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">   </span>20241230_093000
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>Use:<span class="w"> </span>docs<span class="w"> </span>rollback<span class="w"> </span>--backup-id<span class="w"> </span>&lt;id&gt;
</span></code></pre></div></p>
</li>
<li>
<p><strong>Verify rollback:</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>    <span class="c1"># Restore files</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_from_backup</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    <span class="c1"># Verify restoration</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_docs</span><span class="p">():</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;✅ Documentation restored successfully&quot;</span><span class="p">)</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;❌ Rollback verification failed&quot;</span><span class="p">)</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>        <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="testing-strategy">Testing Strategy<a class="headerlink" href="#testing-strategy" title="Anchor link to this section">&para;</a></h3>
<h4 id="integration-test-coverage">Integration Test Coverage<a class="headerlink" href="#integration-test-coverage" title="Anchor link to this section">&para;</a></h4>
<p><strong>Essential test scenarios:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># tests/test_docs_system.py</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">your_package.template_engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocTemplateEngine</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">your_package.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocsMetadata</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">your_package.migrations</span><span class="w"> </span><span class="kn">import</span> <span class="n">Migration001To002</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">project_dir</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create temporary project directory&quot;&quot;&quot;</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>    <span class="k">return</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;test_project&quot;</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_generate_fresh_docs</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test generating docs in empty project&quot;&quot;&quot;</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="s2">&quot;test_package&quot;</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">)</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>        <span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_package&quot;</span><span class="p">,</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>        <span class="s2">&quot;package_version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>        <span class="s2">&quot;doc_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a>    <span class="p">}</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;base/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a>    <span class="k">assert</span> <span class="s2">&quot;# test_package&quot;</span> <span class="ow">in</span> <span class="n">output</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>    <span class="k">assert</span> <span class="s2">&quot;0.1.0&quot;</span> <span class="ow">in</span> <span class="n">output</span>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_user_customization_preserved</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that user customizations survive regeneration&quot;&quot;&quot;</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a>    <span class="c1"># Setup: Create custom template</span>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a>    <span class="n">templates_dir</span> <span class="o">=</span> <span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;.test-package&quot;</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a>    <span class="n">templates_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a>    <span class="n">custom_template</span> <span class="o">=</span> <span class="n">templates_dir</span> <span class="o">/</span> <span class="s2">&quot;claude.md.jinja2&quot;</span>
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a>    <span class="n">custom_template</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-46-36"><a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="s2">{</span><span class="si">% e</span><span class="s2">xtends &quot;base/claude.md.jinja2&quot; %}</span>
</span><span id="__span-46-37"><a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a>
</span><span id="__span-46-38"><a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a><span class="s2">{% block configuration %}</span>
</span><span id="__span-46-39"><a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="s2">## My Custom Configuration</span>
</span><span id="__span-46-40"><a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="s2">Custom content here</span>
</span><span id="__span-46-41"><a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a><span class="s2">{</span><span class="si">% e</span><span class="s2">ndblock %}</span>
</span><span id="__span-46-42"><a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-46-43"><a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a>
</span><span id="__span-46-44"><a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a>    <span class="c1"># Generate docs with customization</span>
</span><span id="__span-46-45"><a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="s2">&quot;test_package&quot;</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">)</span>
</span><span id="__span-46-46"><a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;base/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-46-47"><a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a>
</span><span id="__span-46-48"><a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a>    <span class="k">assert</span> <span class="s2">&quot;My Custom Configuration&quot;</span> <span class="ow">in</span> <span class="n">output</span>
</span><span id="__span-46-49"><a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a>
</span><span id="__span-46-50"><a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_migration_preserves_customizations</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-46-51"><a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test migration preserves user content&quot;&quot;&quot;</span>
</span><span id="__span-46-52"><a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a>    <span class="c1"># Setup: Create v1 docs with custom content</span>
</span><span id="__span-46-53"><a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;.test-package&quot;</span>
</span><span id="__span-46-54"><a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a>    <span class="n">docs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-55"><a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a>
</span><span id="__span-46-56"><a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a>    <span class="n">v1_doc</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-46-57"><a id="__codelineno-46-57" name="__codelineno-46-57" href="#__codelineno-46-57"></a>    <span class="n">v1_doc</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-46-58"><a id="__codelineno-46-58" name="__codelineno-46-58" href="#__codelineno-46-58"></a><span class="s2"># Test Package</span>
</span><span id="__span-46-59"><a id="__codelineno-46-59" name="__codelineno-46-59" href="#__codelineno-46-59"></a>
</span><span id="__span-46-60"><a id="__codelineno-46-60" name="__codelineno-46-60" href="#__codelineno-46-60"></a><span class="s2">## My Configuration</span>
</span><span id="__span-46-61"><a id="__codelineno-46-61" name="__codelineno-46-61" href="#__codelineno-46-61"></a><span class="s2">Custom config here</span>
</span><span id="__span-46-62"><a id="__codelineno-46-62" name="__codelineno-46-62" href="#__codelineno-46-62"></a>
</span><span id="__span-46-63"><a id="__codelineno-46-63" name="__codelineno-46-63" href="#__codelineno-46-63"></a><span class="s2">## My Workflows</span>
</span><span id="__span-46-64"><a id="__codelineno-46-64" name="__codelineno-46-64" href="#__codelineno-46-64"></a><span class="s2">Custom workflows here</span>
</span><span id="__span-46-65"><a id="__codelineno-46-65" name="__codelineno-46-65" href="#__codelineno-46-65"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-46-66"><a id="__codelineno-46-66" name="__codelineno-46-66" href="#__codelineno-46-66"></a>
</span><span id="__span-46-67"><a id="__codelineno-46-67" name="__codelineno-46-67" href="#__codelineno-46-67"></a>    <span class="c1"># Run migration</span>
</span><span id="__span-46-68"><a id="__codelineno-46-68" name="__codelineno-46-68" href="#__codelineno-46-68"></a>    <span class="n">migration</span> <span class="o">=</span> <span class="n">Migration001To002</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="s2">&quot;test_package&quot;</span><span class="p">)</span>
</span><span id="__span-46-69"><a id="__codelineno-46-69" name="__codelineno-46-69" href="#__codelineno-46-69"></a>    <span class="n">customizations</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">detect_customizations</span><span class="p">()</span>
</span><span id="__span-46-70"><a id="__codelineno-46-70" name="__codelineno-46-70" href="#__codelineno-46-70"></a>
</span><span id="__span-46-71"><a id="__codelineno-46-71" name="__codelineno-46-71" href="#__codelineno-46-71"></a>    <span class="k">assert</span> <span class="n">customizations</span><span class="p">[</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-46-72"><a id="__codelineno-46-72" name="__codelineno-46-72" href="#__codelineno-46-72"></a>    <span class="k">assert</span> <span class="s2">&quot;configuration&quot;</span> <span class="ow">in</span> <span class="n">customizations</span><span class="p">[</span><span class="s2">&quot;customized_blocks&quot;</span><span class="p">]</span>
</span><span id="__span-46-73"><a id="__codelineno-46-73" name="__codelineno-46-73" href="#__codelineno-46-73"></a>
</span><span id="__span-46-74"><a id="__codelineno-46-74" name="__codelineno-46-74" href="#__codelineno-46-74"></a>    <span class="c1"># Perform migration</span>
</span><span id="__span-46-75"><a id="__codelineno-46-75" name="__codelineno-46-75" href="#__codelineno-46-75"></a>    <span class="n">success</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">migrate</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-46-76"><a id="__codelineno-46-76" name="__codelineno-46-76" href="#__codelineno-46-76"></a>    <span class="k">assert</span> <span class="n">success</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-46-77"><a id="__codelineno-46-77" name="__codelineno-46-77" href="#__codelineno-46-77"></a>
</span><span id="__span-46-78"><a id="__codelineno-46-78" name="__codelineno-46-78" href="#__codelineno-46-78"></a>    <span class="c1"># Verify custom content preserved</span>
</span><span id="__span-46-79"><a id="__codelineno-46-79" name="__codelineno-46-79" href="#__codelineno-46-79"></a>    <span class="n">v2_template</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;claude.md.jinja2&quot;</span>
</span><span id="__span-46-80"><a id="__codelineno-46-80" name="__codelineno-46-80" href="#__codelineno-46-80"></a>    <span class="k">assert</span> <span class="n">v2_template</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span><span id="__span-46-81"><a id="__codelineno-46-81" name="__codelineno-46-81" href="#__codelineno-46-81"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">v2_template</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-46-82"><a id="__codelineno-46-82" name="__codelineno-46-82" href="#__codelineno-46-82"></a>    <span class="k">assert</span> <span class="s2">&quot;Custom config here&quot;</span> <span class="ow">in</span> <span class="n">content</span>
</span><span id="__span-46-83"><a id="__codelineno-46-83" name="__codelineno-46-83" href="#__codelineno-46-83"></a>
</span><span id="__span-46-84"><a id="__codelineno-46-84" name="__codelineno-46-84" href="#__codelineno-46-84"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_version_compatibility_check</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-46-85"><a id="__codelineno-46-85" name="__codelineno-46-85" href="#__codelineno-46-85"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test version compatibility detection&quot;&quot;&quot;</span>
</span><span id="__span-46-86"><a id="__codelineno-46-86" name="__codelineno-46-86" href="#__codelineno-46-86"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">DocsMetadata</span><span class="p">(</span>
</span><span id="__span-46-87"><a id="__codelineno-46-87" name="__codelineno-46-87" href="#__codelineno-46-87"></a>        <span class="n">doc_version</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="__span-46-88"><a id="__codelineno-46-88" name="__codelineno-46-88" href="#__codelineno-46-88"></a>        <span class="n">package_version</span><span class="o">=</span><span class="s2">&quot;0.9.0&quot;</span><span class="p">,</span>
</span><span id="__span-46-89"><a id="__codelineno-46-89" name="__codelineno-46-89" href="#__codelineno-46-89"></a>        <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span>
</span><span id="__span-46-90"><a id="__codelineno-46-90" name="__codelineno-46-90" href="#__codelineno-46-90"></a>    <span class="p">)</span>
</span><span id="__span-46-91"><a id="__codelineno-46-91" name="__codelineno-46-91" href="#__codelineno-46-91"></a>
</span><span id="__span-46-92"><a id="__codelineno-46-92" name="__codelineno-46-92" href="#__codelineno-46-92"></a>    <span class="c1"># Compatible package version</span>
</span><span id="__span-46-93"><a id="__codelineno-46-93" name="__codelineno-46-93" href="#__codelineno-46-93"></a>    <span class="k">assert</span> <span class="n">metadata</span><span class="o">.</span><span class="n">is_compatible_with_package</span><span class="p">(</span><span class="s2">&quot;0.9.5&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-46-94"><a id="__codelineno-46-94" name="__codelineno-46-94" href="#__codelineno-46-94"></a>
</span><span id="__span-46-95"><a id="__codelineno-46-95" name="__codelineno-46-95" href="#__codelineno-46-95"></a>    <span class="c1"># Incompatible (too new)</span>
</span><span id="__span-46-96"><a id="__codelineno-46-96" name="__codelineno-46-96" href="#__codelineno-46-96"></a>    <span class="k">assert</span> <span class="n">metadata</span><span class="o">.</span><span class="n">is_compatible_with_package</span><span class="p">(</span><span class="s2">&quot;0.11.0&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="__span-46-97"><a id="__codelineno-46-97" name="__codelineno-46-97" href="#__codelineno-46-97"></a>
</span><span id="__span-46-98"><a id="__codelineno-46-98" name="__codelineno-46-98" href="#__codelineno-46-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_backup_and_rollback</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-46-99"><a id="__codelineno-46-99" name="__codelineno-46-99" href="#__codelineno-46-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test backup creation and rollback&quot;&quot;&quot;</span>
</span><span id="__span-46-100"><a id="__codelineno-46-100" name="__codelineno-46-100" href="#__codelineno-46-100"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;.test-package&quot;</span>
</span><span id="__span-46-101"><a id="__codelineno-46-101" name="__codelineno-46-101" href="#__codelineno-46-101"></a>    <span class="n">docs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-102"><a id="__codelineno-46-102" name="__codelineno-46-102" href="#__codelineno-46-102"></a>
</span><span id="__span-46-103"><a id="__codelineno-46-103" name="__codelineno-46-103" href="#__codelineno-46-103"></a>    <span class="c1"># Create original doc</span>
</span><span id="__span-46-104"><a id="__codelineno-46-104" name="__codelineno-46-104" href="#__codelineno-46-104"></a>    <span class="n">doc_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-46-105"><a id="__codelineno-46-105" name="__codelineno-46-105" href="#__codelineno-46-105"></a>    <span class="n">doc_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;Original content&quot;</span><span class="p">)</span>
</span><span id="__span-46-106"><a id="__codelineno-46-106" name="__codelineno-46-106" href="#__codelineno-46-106"></a>
</span><span id="__span-46-107"><a id="__codelineno-46-107" name="__codelineno-46-107" href="#__codelineno-46-107"></a>    <span class="c1"># Create migration and backup</span>
</span><span id="__span-46-108"><a id="__codelineno-46-108" name="__codelineno-46-108" href="#__codelineno-46-108"></a>    <span class="n">migration</span> <span class="o">=</span> <span class="n">Migration001To002</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="s2">&quot;test_package&quot;</span><span class="p">)</span>
</span><span id="__span-46-109"><a id="__codelineno-46-109" name="__codelineno-46-109" href="#__codelineno-46-109"></a>    <span class="n">backup_path</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">backup</span><span class="p">()</span>
</span><span id="__span-46-110"><a id="__codelineno-46-110" name="__codelineno-46-110" href="#__codelineno-46-110"></a>
</span><span id="__span-46-111"><a id="__codelineno-46-111" name="__codelineno-46-111" href="#__codelineno-46-111"></a>    <span class="k">assert</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span><span id="__span-46-112"><a id="__codelineno-46-112" name="__codelineno-46-112" href="#__codelineno-46-112"></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">backup_path</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span><span id="__span-46-113"><a id="__codelineno-46-113" name="__codelineno-46-113" href="#__codelineno-46-113"></a>
</span><span id="__span-46-114"><a id="__codelineno-46-114" name="__codelineno-46-114" href="#__codelineno-46-114"></a>    <span class="c1"># Modify original</span>
</span><span id="__span-46-115"><a id="__codelineno-46-115" name="__codelineno-46-115" href="#__codelineno-46-115"></a>    <span class="n">doc_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;Modified content&quot;</span><span class="p">)</span>
</span><span id="__span-46-116"><a id="__codelineno-46-116" name="__codelineno-46-116" href="#__codelineno-46-116"></a>
</span><span id="__span-46-117"><a id="__codelineno-46-117" name="__codelineno-46-117" href="#__codelineno-46-117"></a>    <span class="c1"># Rollback</span>
</span><span id="__span-46-118"><a id="__codelineno-46-118" name="__codelineno-46-118" href="#__codelineno-46-118"></a>    <span class="n">success</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
</span><span id="__span-46-119"><a id="__codelineno-46-119" name="__codelineno-46-119" href="#__codelineno-46-119"></a>    <span class="k">assert</span> <span class="n">success</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-46-120"><a id="__codelineno-46-120" name="__codelineno-46-120" href="#__codelineno-46-120"></a>    <span class="k">assert</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Original content&quot;</span>
</span></code></pre></div>
<h4 id="customization-preservation-tests">Customization Preservation Tests<a class="headerlink" href="#customization-preservation-tests" title="Anchor link to this section">&para;</a></h4>
<p><strong>Test matrix:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;customization_type,expected_preserved&quot;</span><span class="p">,</span> <span class="p">[</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>    <span class="p">(</span><span class="s2">&quot;configuration&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>    <span class="p">(</span><span class="s2">&quot;workflows&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>    <span class="p">(</span><span class="s2">&quot;quickstart&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>    <span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>    <span class="p">(</span><span class="s2">&quot;unknown_block&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># Should preserve even unknown blocks</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="p">])</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_preserve_customization_types</span><span class="p">(</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>    <span class="n">project_dir</span><span class="p">,</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>    <span class="n">customization_type</span><span class="p">,</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>    <span class="n">expected_preserved</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="p">):</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test different customization types are preserved&quot;&quot;&quot;</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>    <span class="c1"># Setup custom block</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a>    <span class="c1"># Run migration</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a>    <span class="c1"># Verify preservation</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a>    <span class="k">pass</span>
</span></code></pre></div>
<h4 id="edge-case-handling">Edge Case Handling<a class="headerlink" href="#edge-case-handling" title="Anchor link to this section">&para;</a></h4>
<p><strong>Critical edge cases:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_migration_with_corrupted_docs</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test migration handles corrupted documentation&quot;&quot;&quot;</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;.test-package&quot;</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>    <span class="n">docs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>    <span class="c1"># Create corrupted doc (invalid UTF-8, etc.)</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>    <span class="n">doc_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>    <span class="n">doc_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x80\x81\x82</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Invalid UTF-8</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>    <span class="n">migration</span> <span class="o">=</span> <span class="n">Migration001To002</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="s2">&quot;test_package&quot;</span><span class="p">)</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>    <span class="c1"># Should handle gracefully</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">MigrationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>        <span class="n">migration</span><span class="o">.</span><span class="n">detect_customizations</span><span class="p">()</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>    <span class="k">assert</span> <span class="s2">&quot;corrupted&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_migration_with_missing_metadata</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test migration when metadata is missing&quot;&quot;&quot;</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>    <span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;.test-package&quot;</span>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a>    <span class="n">docs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>    <span class="c1"># Doc exists but no metadata</span>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a>    <span class="n">doc_path</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a>    <span class="n">doc_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;# Documentation&quot;</span><span class="p">)</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>    <span class="c1"># Should create default metadata</span>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">DocsMetadata</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;.claude-docs-meta.json&quot;</span><span class="p">)</span>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a>    <span class="k">assert</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="c1"># Missing</span>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a>    <span class="c1"># Migration should handle this</span>
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a>    <span class="n">migration</span> <span class="o">=</span> <span class="n">Migration001To002</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="s2">&quot;test_package&quot;</span><span class="p">)</span>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a>    <span class="n">success</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a>    <span class="k">assert</span> <span class="n">success</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_concurrent_upgrade_attempts</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test multiple upgrade processes don&#39;t conflict&quot;&quot;&quot;</span>
</span><span id="__span-48-38"><a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a>    <span class="c1"># Use file locking or similar to prevent concurrent upgrades</span>
</span><span id="__span-48-39"><a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a>    <span class="c1"># This is advanced - may need process-level locks</span>
</span><span id="__span-48-40"><a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a>    <span class="k">pass</span>
</span><span id="__span-48-41"><a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a>
</span><span id="__span-48-42"><a id="__codelineno-48-42" name="__codelineno-48-42" href="#__codelineno-48-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_upgrade_with_partial_customizations</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
</span><span id="__span-48-43"><a id="__codelineno-48-43" name="__codelineno-48-43" href="#__codelineno-48-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test upgrade when user only customized some blocks&quot;&quot;&quot;</span>
</span><span id="__span-48-44"><a id="__codelineno-48-44" name="__codelineno-48-44" href="#__codelineno-48-44"></a>    <span class="c1"># User customized 2 of 5 blocks</span>
</span><span id="__span-48-45"><a id="__codelineno-48-45" name="__codelineno-48-45" href="#__codelineno-48-45"></a>    <span class="c1"># Verify:</span>
</span><span id="__span-48-46"><a id="__codelineno-48-46" name="__codelineno-48-46" href="#__codelineno-48-46"></a>    <span class="c1"># - Customized blocks preserved</span>
</span><span id="__span-48-47"><a id="__codelineno-48-47" name="__codelineno-48-47" href="#__codelineno-48-47"></a>    <span class="c1"># - Non-customized blocks updated</span>
</span><span id="__span-48-48"><a id="__codelineno-48-48" name="__codelineno-48-48" href="#__codelineno-48-48"></a>    <span class="k">pass</span>
</span></code></pre></div>
<hr />
<h2 id="5-reference-implementation">5. Reference Implementation<a class="headerlink" href="#5-reference-implementation" title="Anchor link to this section">&para;</a></h2>
<h3 id="doctemplateengine-simplified">DocTemplateEngine (Simplified)<a class="headerlink" href="#doctemplateengine-simplified" title="Anchor link to this section">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># your_package/template_engine.py</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">jinja2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span><span class="p">,</span> <span class="n">ChoiceLoader</span><span class="p">,</span> <span class="n">TemplateNotFound</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocTemplateEngine</span><span class="p">:</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="sd">    Template engine for packageable auto-updating documentation.</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="sd">    Manages Jinja2 templates with user override support via ChoiceLoader.</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="sd">    User templates (in project) take priority over package templates.</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">project_root</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>        <span class="c1"># Package templates (bundled with distribution)</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>        <span class="n">package_templates</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>        <span class="c1"># User templates (in project .package-name/templates/)</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>        <span class="n">user_templates</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>        <span class="n">user_templates</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a>        <span class="c1"># ChoiceLoader: User templates first, then package templates</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a>        <span class="n">loader</span> <span class="o">=</span> <span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_templates</span><span class="p">)),</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">package_templates</span><span class="p">))</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a>        <span class="p">])</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a>            <span class="n">loader</span><span class="o">=</span><span class="n">loader</span><span class="p">,</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a>            <span class="n">autoescape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Markdown doesn&#39;t need HTML escaping</span>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a>            <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a>            <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a>            <span class="n">keep_trailing_newline</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a>        <span class="p">)</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a>        <span class="c1"># Add custom filters</span>
</span><span id="__span-49-41"><a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;snake_to_title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span id="__span-49-42"><a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a>
</span><span id="__span-49-43"><a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-49-44"><a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-49-45"><a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a><span class="sd">        Render template with context.</span>
</span><span id="__span-49-46"><a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a>
</span><span id="__span-49-47"><a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a><span class="sd">        User template takes priority if it exists.</span>
</span><span id="__span-49-48"><a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a><span class="sd">        Falls back to package template.</span>
</span><span id="__span-49-49"><a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-49-50"><a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-49-51"><a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a>            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="__span-49-52"><a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a>            <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-49-53"><a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a>        <span class="k">except</span> <span class="n">TemplateNotFound</span><span class="p">:</span>
</span><span id="__span-49-54"><a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a>            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span>
</span><span id="__span-49-55"><a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a>                <span class="sa">f</span><span class="s2">&quot;Template not found: </span><span class="si">{</span><span class="n">template_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-49-56"><a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a>                <span class="sa">f</span><span class="s2">&quot;Searched in:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-49-57"><a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a>                <span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;templates&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-49-58"><a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a>                <span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;templates&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-49-59"><a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a>            <span class="p">)</span>
</span><span id="__span-49-60"><a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a>
</span><span id="__span-49-61"><a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_user_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-49-62"><a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if user has custom template&quot;&quot;&quot;</span>
</span><span id="__span-49-63"><a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a>        <span class="n">user_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-49-64"><a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span>
</span><span id="__span-49-65"><a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a>            <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span>
</span><span id="__span-49-66"><a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a>            <span class="s2">&quot;templates&quot;</span> <span class="o">/</span>
</span><span id="__span-49-67"><a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a>            <span class="n">template_name</span>
</span><span id="__span-49-68"><a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a>        <span class="p">)</span>
</span><span id="__span-49-69"><a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a>        <span class="k">return</span> <span class="n">user_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span><span id="__span-49-70"><a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a>
</span><span id="__span-49-71"><a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_customized_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-49-72"><a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-49-73"><a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a><span class="sd">        Detect which template blocks user has customized.</span>
</span><span id="__span-49-74"><a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a>
</span><span id="__span-49-75"><a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a><span class="sd">        Returns list of block names found in user template.</span>
</span><span id="__span-49-76"><a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-49-77"><a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_user_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">):</span>
</span><span id="__span-49-78"><a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="__span-49-79"><a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a>
</span><span id="__span-49-80"><a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a>        <span class="n">user_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-49-81"><a id="__codelineno-49-81" name="__codelineno-49-81" href="#__codelineno-49-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span>
</span><span id="__span-49-82"><a id="__codelineno-49-82" name="__codelineno-49-82" href="#__codelineno-49-82"></a>            <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span>
</span><span id="__span-49-83"><a id="__codelineno-49-83" name="__codelineno-49-83" href="#__codelineno-49-83"></a>            <span class="s2">&quot;templates&quot;</span> <span class="o">/</span>
</span><span id="__span-49-84"><a id="__codelineno-49-84" name="__codelineno-49-84" href="#__codelineno-49-84"></a>            <span class="n">template_name</span>
</span><span id="__span-49-85"><a id="__codelineno-49-85" name="__codelineno-49-85" href="#__codelineno-49-85"></a>        <span class="p">)</span>
</span><span id="__span-49-86"><a id="__codelineno-49-86" name="__codelineno-49-86" href="#__codelineno-49-86"></a>
</span><span id="__span-49-87"><a id="__codelineno-49-87" name="__codelineno-49-87" href="#__codelineno-49-87"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">user_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-49-88"><a id="__codelineno-49-88" name="__codelineno-49-88" href="#__codelineno-49-88"></a>
</span><span id="__span-49-89"><a id="__codelineno-49-89" name="__codelineno-49-89" href="#__codelineno-49-89"></a>        <span class="c1"># Parse Jinja2 blocks using regex</span>
</span><span id="__span-49-90"><a id="__codelineno-49-90" name="__codelineno-49-90" href="#__codelineno-49-90"></a>        <span class="n">block_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;{%\s*block\s+(\w+)\s*%}&#39;</span>
</span><span id="__span-49-91"><a id="__codelineno-49-91" name="__codelineno-49-91" href="#__codelineno-49-91"></a>        <span class="n">blocks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">block_pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span id="__span-49-92"><a id="__codelineno-49-92" name="__codelineno-49-92" href="#__codelineno-49-92"></a>
</span><span id="__span-49-93"><a id="__codelineno-49-93" name="__codelineno-49-93" href="#__codelineno-49-93"></a>        <span class="k">return</span> <span class="n">blocks</span>
</span><span id="__span-49-94"><a id="__codelineno-49-94" name="__codelineno-49-94" href="#__codelineno-49-94"></a>
</span><span id="__span-49-95"><a id="__codelineno-49-95" name="__codelineno-49-95" href="#__codelineno-49-95"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_available_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-49-96"><a id="__codelineno-49-96" name="__codelineno-49-96" href="#__codelineno-49-96"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-49-97"><a id="__codelineno-49-97" name="__codelineno-49-97" href="#__codelineno-49-97"></a><span class="sd">        List all available templates.</span>
</span><span id="__span-49-98"><a id="__codelineno-49-98" name="__codelineno-49-98" href="#__codelineno-49-98"></a>
</span><span id="__span-49-99"><a id="__codelineno-49-99" name="__codelineno-49-99" href="#__codelineno-49-99"></a><span class="sd">        Returns dict with:</span>
</span><span id="__span-49-100"><a id="__codelineno-49-100" name="__codelineno-49-100" href="#__codelineno-49-100"></a><span class="sd">        {</span>
</span><span id="__span-49-101"><a id="__codelineno-49-101" name="__codelineno-49-101" href="#__codelineno-49-101"></a><span class="sd">            &quot;package&quot;: [&quot;base/claude.md.jinja2&quot;, ...],</span>
</span><span id="__span-49-102"><a id="__codelineno-49-102" name="__codelineno-49-102" href="#__codelineno-49-102"></a><span class="sd">            &quot;user&quot;: [&quot;claude.md.jinja2&quot;, ...]</span>
</span><span id="__span-49-103"><a id="__codelineno-49-103" name="__codelineno-49-103" href="#__codelineno-49-103"></a><span class="sd">        }</span>
</span><span id="__span-49-104"><a id="__codelineno-49-104" name="__codelineno-49-104" href="#__codelineno-49-104"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-49-105"><a id="__codelineno-49-105" name="__codelineno-49-105" href="#__codelineno-49-105"></a>        <span class="n">package_templates_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-49-106"><a id="__codelineno-49-106" name="__codelineno-49-106" href="#__codelineno-49-106"></a>        <span class="n">user_templates_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
</span><span id="__span-49-107"><a id="__codelineno-49-107" name="__codelineno-49-107" href="#__codelineno-49-107"></a>
</span><span id="__span-49-108"><a id="__codelineno-49-108" name="__codelineno-49-108" href="#__codelineno-49-108"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">list_templates</span><span class="p">(</span><span class="n">base_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-49-109"><a id="__codelineno-49-109" name="__codelineno-49-109" href="#__codelineno-49-109"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-49-110"><a id="__codelineno-49-110" name="__codelineno-49-110" href="#__codelineno-49-110"></a>                <span class="k">return</span> <span class="p">[]</span>
</span><span id="__span-49-111"><a id="__codelineno-49-111" name="__codelineno-49-111" href="#__codelineno-49-111"></a>
</span><span id="__span-49-112"><a id="__codelineno-49-112" name="__codelineno-49-112" href="#__codelineno-49-112"></a>            <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-49-113"><a id="__codelineno-49-113" name="__codelineno-49-113" href="#__codelineno-49-113"></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.jinja2&quot;</span><span class="p">):</span>
</span><span id="__span-49-114"><a id="__codelineno-49-114" name="__codelineno-49-114" href="#__codelineno-49-114"></a>                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
</span><span id="__span-49-115"><a id="__codelineno-49-115" name="__codelineno-49-115" href="#__codelineno-49-115"></a>                <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">))</span>
</span><span id="__span-49-116"><a id="__codelineno-49-116" name="__codelineno-49-116" href="#__codelineno-49-116"></a>            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>
</span><span id="__span-49-117"><a id="__codelineno-49-117" name="__codelineno-49-117" href="#__codelineno-49-117"></a>
</span><span id="__span-49-118"><a id="__codelineno-49-118" name="__codelineno-49-118" href="#__codelineno-49-118"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-49-119"><a id="__codelineno-49-119" name="__codelineno-49-119" href="#__codelineno-49-119"></a>            <span class="s2">&quot;package&quot;</span><span class="p">:</span> <span class="n">list_templates</span><span class="p">(</span><span class="n">package_templates_dir</span><span class="p">),</span>
</span><span id="__span-49-120"><a id="__codelineno-49-120" name="__codelineno-49-120" href="#__codelineno-49-120"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">list_templates</span><span class="p">(</span><span class="n">user_templates_dir</span><span class="p">)</span>
</span><span id="__span-49-121"><a id="__codelineno-49-121" name="__codelineno-49-121" href="#__codelineno-49-121"></a>        <span class="p">}</span>
</span></code></pre></div>
<h3 id="docsmetadata-model-complete">DocsMetadata Model (Complete)<a class="headerlink" href="#docsmetadata-model-complete" title="Anchor link to this section">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># your_package/models.py</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">field_validator</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocsMetadata</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="sd">    Metadata for packageable auto-updating documentation.</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="sd">    Tracks version, customizations, and migration state.</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="sd">    Stored in .package-name/.claude-docs-meta.json</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a>    <span class="n">doc_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Documentation schema version (e.g., &#39;2&#39;)&quot;</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a>    <span class="p">)</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>    <span class="n">package_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Package version when generated (e.g., &#39;0.9.5&#39;)&quot;</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a>    <span class="p">)</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a>    <span class="n">generated_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Timestamp of generation&quot;</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a>    <span class="p">)</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a>    <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">,</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Target platform (claude, gemini, codex, etc.)&quot;</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a>    <span class="p">)</span>
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a>    <span class="n">has_customizations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a>        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether user has custom template overrides&quot;</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a>    <span class="p">)</span>
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a>
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a>    <span class="n">customization_blocks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a>        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of template blocks user has customized&quot;</span>
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a>    <span class="p">)</span>
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a>
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a>    <span class="n">last_migration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of last migration applied&quot;</span>
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a>    <span class="p">)</span>
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a>
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a>    <span class="n">backup_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Path to backup created before last update&quot;</span>
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a>    <span class="p">)</span>
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a>
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;doc_version&quot;</span><span class="p">,</span> <span class="s2">&quot;package_version&quot;</span><span class="p">)</span>
</span><span id="__span-50-56"><a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_version_format</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="__span-50-57"><a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure versions are valid semver or integer strings&quot;&quot;&quot;</span>
</span><span id="__span-50-58"><a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-50-59"><a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a>            <span class="c1"># Try parsing as semver</span>
</span><span id="__span-50-60"><a id="__codelineno-50-60" name="__codelineno-50-60" href="#__codelineno-50-60"></a>            <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="__span-50-61"><a id="__codelineno-50-61" name="__codelineno-50-61" href="#__codelineno-50-61"></a>            <span class="k">return</span> <span class="n">v</span>
</span><span id="__span-50-62"><a id="__codelineno-50-62" name="__codelineno-50-62" href="#__codelineno-50-62"></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="__span-50-63"><a id="__codelineno-50-63" name="__codelineno-50-63" href="#__codelineno-50-63"></a>            <span class="c1"># Try parsing as integer</span>
</span><span id="__span-50-64"><a id="__codelineno-50-64" name="__codelineno-50-64" href="#__codelineno-50-64"></a>            <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="__span-50-65"><a id="__codelineno-50-65" name="__codelineno-50-65" href="#__codelineno-50-65"></a>            <span class="k">return</span> <span class="n">v</span>
</span><span id="__span-50-66"><a id="__codelineno-50-66" name="__codelineno-50-66" href="#__codelineno-50-66"></a>
</span><span id="__span-50-67"><a id="__codelineno-50-67" name="__codelineno-50-67" href="#__codelineno-50-67"></a>    <span class="nd">@classmethod</span>
</span><span id="__span-50-68"><a id="__codelineno-50-68" name="__codelineno-50-68" href="#__codelineno-50-68"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;DocsMetadata&quot;</span><span class="p">]:</span>
</span><span id="__span-50-69"><a id="__codelineno-50-69" name="__codelineno-50-69" href="#__codelineno-50-69"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load metadata from .claude-docs-meta.json&quot;&quot;&quot;</span>
</span><span id="__span-50-70"><a id="__codelineno-50-70" name="__codelineno-50-70" href="#__codelineno-50-70"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-50-71"><a id="__codelineno-50-71" name="__codelineno-50-71" href="#__codelineno-50-71"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-50-72"><a id="__codelineno-50-72" name="__codelineno-50-72" href="#__codelineno-50-72"></a>
</span><span id="__span-50-73"><a id="__codelineno-50-73" name="__codelineno-50-73" href="#__codelineno-50-73"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-50-74"><a id="__codelineno-50-74" name="__codelineno-50-74" href="#__codelineno-50-74"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-50-75"><a id="__codelineno-50-75" name="__codelineno-50-75" href="#__codelineno-50-75"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-50-76"><a id="__codelineno-50-76" name="__codelineno-50-76" href="#__codelineno-50-76"></a>            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-50-77"><a id="__codelineno-50-77" name="__codelineno-50-77" href="#__codelineno-50-77"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-50-78"><a id="__codelineno-50-78" name="__codelineno-50-78" href="#__codelineno-50-78"></a>            <span class="k">raise</span> <span class="n">MetadataError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load metadata from </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-50-79"><a id="__codelineno-50-79" name="__codelineno-50-79" href="#__codelineno-50-79"></a>
</span><span id="__span-50-80"><a id="__codelineno-50-80" name="__codelineno-50-80" href="#__codelineno-50-80"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-50-81"><a id="__codelineno-50-81" name="__codelineno-50-81" href="#__codelineno-50-81"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save metadata to .claude-docs-meta.json&quot;&quot;&quot;</span>
</span><span id="__span-50-82"><a id="__codelineno-50-82" name="__codelineno-50-82" href="#__codelineno-50-82"></a>        <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-50-83"><a id="__codelineno-50-83" name="__codelineno-50-83" href="#__codelineno-50-83"></a>
</span><span id="__span-50-84"><a id="__codelineno-50-84" name="__codelineno-50-84" href="#__codelineno-50-84"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-50-85"><a id="__codelineno-50-85" name="__codelineno-50-85" href="#__codelineno-50-85"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
</span><span id="__span-50-86"><a id="__codelineno-50-86" name="__codelineno-50-86" href="#__codelineno-50-86"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="__span-50-87"><a id="__codelineno-50-87" name="__codelineno-50-87" href="#__codelineno-50-87"></a>                <span class="n">f</span><span class="p">,</span>
</span><span id="__span-50-88"><a id="__codelineno-50-88" name="__codelineno-50-88" href="#__codelineno-50-88"></a>                <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-50-89"><a id="__codelineno-50-89" name="__codelineno-50-89" href="#__codelineno-50-89"></a>                <span class="n">default</span><span class="o">=</span><span class="nb">str</span>  <span class="c1"># Handle datetime serialization</span>
</span><span id="__span-50-90"><a id="__codelineno-50-90" name="__codelineno-50-90" href="#__codelineno-50-90"></a>            <span class="p">)</span>
</span><span id="__span-50-91"><a id="__codelineno-50-91" name="__codelineno-50-91" href="#__codelineno-50-91"></a>
</span><span id="__span-50-92"><a id="__codelineno-50-92" name="__codelineno-50-92" href="#__codelineno-50-92"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_compatible_with_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-50-93"><a id="__codelineno-50-93" name="__codelineno-50-93" href="#__codelineno-50-93"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if docs are compatible with given package version&quot;&quot;&quot;</span>
</span><span id="__span-50-94"><a id="__codelineno-50-94" name="__codelineno-50-94" href="#__codelineno-50-94"></a>        <span class="n">compat</span> <span class="o">=</span> <span class="n">VERSION_COMPATIBILITY</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_version</span><span class="p">)</span>
</span><span id="__span-50-95"><a id="__codelineno-50-95" name="__codelineno-50-95" href="#__codelineno-50-95"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">compat</span><span class="p">:</span>
</span><span id="__span-50-96"><a id="__codelineno-50-96" name="__codelineno-50-96" href="#__codelineno-50-96"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-50-97"><a id="__codelineno-50-97" name="__codelineno-50-97" href="#__codelineno-50-97"></a>
</span><span id="__span-50-98"><a id="__codelineno-50-98" name="__codelineno-50-98" href="#__codelineno-50-98"></a>        <span class="n">pkg_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
</span><span id="__span-50-99"><a id="__codelineno-50-99" name="__codelineno-50-99" href="#__codelineno-50-99"></a>        <span class="n">min_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">compat</span><span class="p">[</span><span class="s2">&quot;min_package&quot;</span><span class="p">])</span>
</span><span id="__span-50-100"><a id="__codelineno-50-100" name="__codelineno-50-100" href="#__codelineno-50-100"></a>        <span class="n">max_ver</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-50-101"><a id="__codelineno-50-101" name="__codelineno-50-101" href="#__codelineno-50-101"></a>            <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">compat</span><span class="p">[</span><span class="s2">&quot;max_package&quot;</span><span class="p">])</span>
</span><span id="__span-50-102"><a id="__codelineno-50-102" name="__codelineno-50-102" href="#__codelineno-50-102"></a>            <span class="k">if</span> <span class="n">compat</span><span class="p">[</span><span class="s2">&quot;max_package&quot;</span><span class="p">]</span>
</span><span id="__span-50-103"><a id="__codelineno-50-103" name="__codelineno-50-103" href="#__codelineno-50-103"></a>            <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-50-104"><a id="__codelineno-50-104" name="__codelineno-50-104" href="#__codelineno-50-104"></a>        <span class="p">)</span>
</span><span id="__span-50-105"><a id="__codelineno-50-105" name="__codelineno-50-105" href="#__codelineno-50-105"></a>
</span><span id="__span-50-106"><a id="__codelineno-50-106" name="__codelineno-50-106" href="#__codelineno-50-106"></a>        <span class="k">if</span> <span class="n">pkg_ver</span> <span class="o">&lt;</span> <span class="n">min_ver</span><span class="p">:</span>
</span><span id="__span-50-107"><a id="__codelineno-50-107" name="__codelineno-50-107" href="#__codelineno-50-107"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-50-108"><a id="__codelineno-50-108" name="__codelineno-50-108" href="#__codelineno-50-108"></a>        <span class="k">if</span> <span class="n">max_ver</span> <span class="ow">and</span> <span class="n">pkg_ver</span> <span class="o">&gt;</span> <span class="n">max_ver</span><span class="p">:</span>
</span><span id="__span-50-109"><a id="__codelineno-50-109" name="__codelineno-50-109" href="#__codelineno-50-109"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-50-110"><a id="__codelineno-50-110" name="__codelineno-50-110" href="#__codelineno-50-110"></a>
</span><span id="__span-50-111"><a id="__codelineno-50-111" name="__codelineno-50-111" href="#__codelineno-50-111"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-50-112"><a id="__codelineno-50-112" name="__codelineno-50-112" href="#__codelineno-50-112"></a>
</span><span id="__span-50-113"><a id="__codelineno-50-113" name="__codelineno-50-113" href="#__codelineno-50-113"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">needs_upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_doc_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-50-114"><a id="__codelineno-50-114" name="__codelineno-50-114" href="#__codelineno-50-114"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if docs need upgrading to current version&quot;&quot;&quot;</span>
</span><span id="__span-50-115"><a id="__codelineno-50-115" name="__codelineno-50-115" href="#__codelineno-50-115"></a>        <span class="k">return</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">current_doc_version</span><span class="p">)</span>
</span><span id="__span-50-116"><a id="__codelineno-50-116" name="__codelineno-50-116" href="#__codelineno-50-116"></a>
</span><span id="__span-50-117"><a id="__codelineno-50-117" name="__codelineno-50-117" href="#__codelineno-50-117"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetadataError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="__span-50-118"><a id="__codelineno-50-118" name="__codelineno-50-118" href="#__codelineno-50-118"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when metadata operations fail&quot;&quot;&quot;</span>
</span><span id="__span-50-119"><a id="__codelineno-50-119" name="__codelineno-50-119" href="#__codelineno-50-119"></a>    <span class="k">pass</span>
</span><span id="__span-50-120"><a id="__codelineno-50-120" name="__codelineno-50-120" href="#__codelineno-50-120"></a>
</span><span id="__span-50-121"><a id="__codelineno-50-121" name="__codelineno-50-121" href="#__codelineno-50-121"></a><span class="c1"># Version compatibility matrix</span>
</span><span id="__span-50-122"><a id="__codelineno-50-122" name="__codelineno-50-122" href="#__codelineno-50-122"></a><span class="n">VERSION_COMPATIBILITY</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-50-123"><a id="__codelineno-50-123" name="__codelineno-50-123" href="#__codelineno-50-123"></a>    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-50-124"><a id="__codelineno-50-124" name="__codelineno-50-124" href="#__codelineno-50-124"></a>        <span class="s2">&quot;min_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-50-125"><a id="__codelineno-50-125" name="__codelineno-50-125" href="#__codelineno-50-125"></a>        <span class="s2">&quot;max_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.8.9&quot;</span><span class="p">,</span>
</span><span id="__span-50-126"><a id="__codelineno-50-126" name="__codelineno-50-126" href="#__codelineno-50-126"></a>        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Original single-file format&quot;</span>
</span><span id="__span-50-127"><a id="__codelineno-50-127" name="__codelineno-50-127" href="#__codelineno-50-127"></a>    <span class="p">},</span>
</span><span id="__span-50-128"><a id="__codelineno-50-128" name="__codelineno-50-128" href="#__codelineno-50-128"></a>    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-50-129"><a id="__codelineno-50-129" name="__codelineno-50-129" href="#__codelineno-50-129"></a>        <span class="s2">&quot;min_package&quot;</span><span class="p">:</span> <span class="s2">&quot;0.9.0&quot;</span><span class="p">,</span>
</span><span id="__span-50-130"><a id="__codelineno-50-130" name="__codelineno-50-130" href="#__codelineno-50-130"></a>        <span class="s2">&quot;max_package&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-50-131"><a id="__codelineno-50-131" name="__codelineno-50-131" href="#__codelineno-50-131"></a>        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Template-based with blocks&quot;</span>
</span><span id="__span-50-132"><a id="__codelineno-50-132" name="__codelineno-50-132" href="#__codelineno-50-132"></a>    <span class="p">}</span>
</span><span id="__span-50-133"><a id="__codelineno-50-133" name="__codelineno-50-133" href="#__codelineno-50-133"></a><span class="p">}</span>
</span><span id="__span-50-134"><a id="__codelineno-50-134" name="__codelineno-50-134" href="#__codelineno-50-134"></a>
</span><span id="__span-50-135"><a id="__codelineno-50-135" name="__codelineno-50-135" href="#__codelineno-50-135"></a><span class="n">CURRENT_DOC_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span></code></pre></div>
<h3 id="migrationscript-base-class-complete">MigrationScript Base Class (Complete)<a class="headerlink" href="#migrationscript-base-class-complete" title="Anchor link to this section">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># your_package/migrations/base.py</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">MigrationScript</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="sd">    Base class for documentation migration scripts.</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="sd">    Subclasses implement:</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="sd">    - detect_customizations(): Find user customizations</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="sd">    - migrate(): Perform migration preserving customizations</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>    <span class="c1"># Subclasses MUST define these</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>    <span class="n">from_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>    <span class="n">to_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a>    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">project_root</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a>    <span class="nd">@abstractmethod</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_customizations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="sd">        Detect user customizations.</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a><span class="sd">        Returns:</span>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="sd">            {</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="sd">                &quot;has_customizations&quot;: bool,</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="sd">                &quot;customized_blocks&quot;: List[str],</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="sd">                &quot;custom_content&quot;: Dict[str, str]</span>
</span><span id="__span-51-37"><a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="sd">            }</span>
</span><span id="__span-51-38"><a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-51-39"><a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a>        <span class="k">pass</span>
</span><span id="__span-51-40"><a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a>
</span><span id="__span-51-41"><a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a>    <span class="nd">@abstractmethod</span>
</span><span id="__span-51-42"><a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customizations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-51-43"><a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-51-44"><a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a><span class="sd">        Perform migration, preserving customizations.</span>
</span><span id="__span-51-45"><a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a>
</span><span id="__span-51-46"><a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a><span class="sd">        Returns:</span>
</span><span id="__span-51-47"><a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a><span class="sd">            True if successful, False otherwise</span>
</span><span id="__span-51-48"><a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-51-49"><a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a>        <span class="k">pass</span>
</span><span id="__span-51-50"><a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a>
</span><span id="__span-51-51"><a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="__span-51-52"><a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create timestamped backup before migration&quot;&quot;&quot;</span>
</span><span id="__span-51-53"><a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="__span-51-54"><a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a>        <span class="n">backup_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;backups&quot;</span> <span class="o">/</span> <span class="n">timestamp</span>
</span><span id="__span-51-55"><a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a>        <span class="n">backup_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-51-56"><a id="__codelineno-51-56" name="__codelineno-51-56" href="#__codelineno-51-56"></a>
</span><span id="__span-51-57"><a id="__codelineno-51-57" name="__codelineno-51-57" href="#__codelineno-51-57"></a>        <span class="c1"># Backup all files</span>
</span><span id="__span-51-58"><a id="__codelineno-51-58" name="__codelineno-51-58" href="#__codelineno-51-58"></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
</span><span id="__span-51-59"><a id="__codelineno-51-59" name="__codelineno-51-59" href="#__codelineno-51-59"></a>            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-51-60"><a id="__codelineno-51-60" name="__codelineno-51-60" href="#__codelineno-51-60"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">backup_dir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-51-61"><a id="__codelineno-51-61" name="__codelineno-51-61" href="#__codelineno-51-61"></a>
</span><span id="__span-51-62"><a id="__codelineno-51-62" name="__codelineno-51-62" href="#__codelineno-51-62"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Backup created: </span><span class="si">{</span><span class="n">backup_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-63"><a id="__codelineno-51-63" name="__codelineno-51-63" href="#__codelineno-51-63"></a>        <span class="k">return</span> <span class="n">backup_dir</span>
</span><span id="__span-51-64"><a id="__codelineno-51-64" name="__codelineno-51-64" href="#__codelineno-51-64"></a>
</span><span id="__span-51-65"><a id="__codelineno-51-65" name="__codelineno-51-65" href="#__codelineno-51-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-51-66"><a id="__codelineno-51-66" name="__codelineno-51-66" href="#__codelineno-51-66"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore from backup&quot;&quot;&quot;</span>
</span><span id="__span-51-67"><a id="__codelineno-51-67" name="__codelineno-51-67" href="#__codelineno-51-67"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-51-68"><a id="__codelineno-51-68" name="__codelineno-51-68" href="#__codelineno-51-68"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Backup not found: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-69"><a id="__codelineno-51-69" name="__codelineno-51-69" href="#__codelineno-51-69"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-51-70"><a id="__codelineno-51-70" name="__codelineno-51-70" href="#__codelineno-51-70"></a>
</span><span id="__span-51-71"><a id="__codelineno-51-71" name="__codelineno-51-71" href="#__codelineno-51-71"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-51-72"><a id="__codelineno-51-72" name="__codelineno-51-72" href="#__codelineno-51-72"></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">backup_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
</span><span id="__span-51-73"><a id="__codelineno-51-73" name="__codelineno-51-73" href="#__codelineno-51-73"></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-51-74"><a id="__codelineno-51-74" name="__codelineno-51-74" href="#__codelineno-51-74"></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-51-75"><a id="__codelineno-51-75" name="__codelineno-51-75" href="#__codelineno-51-75"></a>
</span><span id="__span-51-76"><a id="__codelineno-51-76" name="__codelineno-51-76" href="#__codelineno-51-76"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Restored from backup: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-77"><a id="__codelineno-51-77" name="__codelineno-51-77" href="#__codelineno-51-77"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-51-78"><a id="__codelineno-51-78" name="__codelineno-51-78" href="#__codelineno-51-78"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-51-79"><a id="__codelineno-51-79" name="__codelineno-51-79" href="#__codelineno-51-79"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Rollback failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-80"><a id="__codelineno-51-80" name="__codelineno-51-80" href="#__codelineno-51-80"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-51-81"><a id="__codelineno-51-81" name="__codelineno-51-81" href="#__codelineno-51-81"></a>
</span><span id="__span-51-82"><a id="__codelineno-51-82" name="__codelineno-51-82" href="#__codelineno-51-82"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-51-83"><a id="__codelineno-51-83" name="__codelineno-51-83" href="#__codelineno-51-83"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute migration with backup and error handling&quot;&quot;&quot;</span>
</span><span id="__span-51-84"><a id="__codelineno-51-84" name="__codelineno-51-84" href="#__codelineno-51-84"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔄 Migration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-85"><a id="__codelineno-51-85" name="__codelineno-51-85" href="#__codelineno-51-85"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_version</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-86"><a id="__codelineno-51-86" name="__codelineno-51-86" href="#__codelineno-51-86"></a>
</span><span id="__span-51-87"><a id="__codelineno-51-87" name="__codelineno-51-87" href="#__codelineno-51-87"></a>        <span class="n">backup_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">()</span>
</span><span id="__span-51-88"><a id="__codelineno-51-88" name="__codelineno-51-88" href="#__codelineno-51-88"></a>
</span><span id="__span-51-89"><a id="__codelineno-51-89" name="__codelineno-51-89" href="#__codelineno-51-89"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-51-90"><a id="__codelineno-51-90" name="__codelineno-51-90" href="#__codelineno-51-90"></a>            <span class="n">customizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_customizations</span><span class="p">()</span>
</span><span id="__span-51-91"><a id="__codelineno-51-91" name="__codelineno-51-91" href="#__codelineno-51-91"></a>
</span><span id="__span-51-92"><a id="__codelineno-51-92" name="__codelineno-51-92" href="#__codelineno-51-92"></a>            <span class="k">if</span> <span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">):</span>
</span><span id="__span-51-93"><a id="__codelineno-51-93" name="__codelineno-51-93" href="#__codelineno-51-93"></a>                <span class="n">blocks</span> <span class="o">=</span> <span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customized_blocks&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-51-94"><a id="__codelineno-51-94" name="__codelineno-51-94" href="#__codelineno-51-94"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Found customizations: </span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-95"><a id="__codelineno-51-95" name="__codelineno-51-95" href="#__codelineno-51-95"></a>
</span><span id="__span-51-96"><a id="__codelineno-51-96" name="__codelineno-51-96" href="#__codelineno-51-96"></a>            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">migrate</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-51-97"><a id="__codelineno-51-97" name="__codelineno-51-97" href="#__codelineno-51-97"></a>
</span><span id="__span-51-98"><a id="__codelineno-51-98" name="__codelineno-51-98" href="#__codelineno-51-98"></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
</span><span id="__span-51-99"><a id="__codelineno-51-99" name="__codelineno-51-99" href="#__codelineno-51-99"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Migration successful&quot;</span><span class="p">)</span>
</span><span id="__span-51-100"><a id="__codelineno-51-100" name="__codelineno-51-100" href="#__codelineno-51-100"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-51-101"><a id="__codelineno-51-101" name="__codelineno-51-101" href="#__codelineno-51-101"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-51-102"><a id="__codelineno-51-102" name="__codelineno-51-102" href="#__codelineno-51-102"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Migration failed&quot;</span><span class="p">)</span>
</span><span id="__span-51-103"><a id="__codelineno-51-103" name="__codelineno-51-103" href="#__codelineno-51-103"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
</span><span id="__span-51-104"><a id="__codelineno-51-104" name="__codelineno-51-104" href="#__codelineno-51-104"></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-51-105"><a id="__codelineno-51-105" name="__codelineno-51-105" href="#__codelineno-51-105"></a>
</span><span id="__span-51-106"><a id="__codelineno-51-106" name="__codelineno-51-106" href="#__codelineno-51-106"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-51-107"><a id="__codelineno-51-107" name="__codelineno-51-107" href="#__codelineno-51-107"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Migration error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-51-108"><a id="__codelineno-51-108" name="__codelineno-51-108" href="#__codelineno-51-108"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
</span><span id="__span-51-109"><a id="__codelineno-51-109" name="__codelineno-51-109" href="#__codelineno-51-109"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-51-110"><a id="__codelineno-51-110" name="__codelineno-51-110" href="#__codelineno-51-110"></a>
</span><span id="__span-51-111"><a id="__codelineno-51-111" name="__codelineno-51-111" href="#__codelineno-51-111"></a><span class="k">class</span><span class="w"> </span><span class="nc">MigrationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="__span-51-112"><a id="__codelineno-51-112" name="__codelineno-51-112" href="#__codelineno-51-112"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when migration fails&quot;&quot;&quot;</span>
</span><span id="__span-51-113"><a id="__codelineno-51-113" name="__codelineno-51-113" href="#__codelineno-51-113"></a>    <span class="k">pass</span>
</span></code></pre></div>
<hr />
<h2 id="6-common-pitfalls-and-solutions">6. Common Pitfalls and Solutions<a class="headerlink" href="#6-common-pitfalls-and-solutions" title="Anchor link to this section">&para;</a></h2>
<h3 id="user-templates-not-loading">User Templates Not Loading<a class="headerlink" href="#user-templates-not-loading" title="Anchor link to this section">&para;</a></h3>
<p><strong>Problem:</strong> User customizations not appearing in generated docs</p>
<p><strong>Cause:</strong> ChoiceLoader order incorrect</p>
<p><strong>Solution:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># ❌ Wrong order</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">loader</span> <span class="o">=</span> <span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>    <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">package_templates</span><span class="p">),</span>  <span class="c1"># Package first</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>    <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">user_templates</span><span class="p">)</span>       <span class="c1"># User second</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="p">])</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="c1"># ✅ Correct order</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="n">loader</span> <span class="o">=</span> <span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>    <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">user_templates</span><span class="p">),</span>      <span class="c1"># User first</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>    <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">package_templates</span><span class="p">)</span>    <span class="c1"># Package second</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="p">])</span>
</span></code></pre></div></p>
<h3 id="customizations-lost-during-migration">Customizations Lost During Migration<a class="headerlink" href="#customizations-lost-during-migration" title="Anchor link to this section">&para;</a></h3>
<p><strong>Problem:</strong> User content disappears after upgrade</p>
<p><strong>Cause:</strong> Migration didn't detect customizations properly</p>
<p><strong>Solution:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_customizations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Robust customization detection&quot;&quot;&quot;</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>    <span class="c1"># 1. Check for custom template file</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>    <span class="n">custom_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;claude.md.jinja2&quot;</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>    <span class="k">if</span> <span class="n">custom_template</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>        <span class="c1"># Parse blocks from template</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_custom_blocks</span><span class="p">(</span><span class="n">custom_template</span><span class="p">)</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>    <span class="c1"># 2. Check for custom markers in generated doc</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>    <span class="n">doc_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>    <span class="k">if</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>        <span class="c1"># Look for custom section markers</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>        <span class="k">if</span> <span class="s2">&quot;## My Configuration&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_custom_sections</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>    <span class="c1"># 3. Compare with base template (diff approach)</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diff_with_base_template</span><span class="p">(</span><span class="n">doc_path</span><span class="p">)</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="k">def</span><span class="w"> </span><span class="nf">_diff_with_base_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare user doc with base template to find customizations&quot;&quot;&quot;</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">difflib</span><span class="w"> </span><span class="kn">import</span> <span class="n">unified_diff</span>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a>
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a>    <span class="c1"># Render base template</span>
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a>    <span class="n">base_content</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;base/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a>
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a>    <span class="c1"># Compare</span>
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a>    <span class="n">user_content</span> <span class="o">=</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-53-32"><a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a>    <span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span>
</span><span id="__span-53-33"><a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a>        <span class="n">base_content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span>
</span><span id="__span-53-34"><a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a>        <span class="n">user_content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span><span id="__span-53-35"><a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a>    <span class="p">))</span>
</span><span id="__span-53-36"><a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a>
</span><span id="__span-53-37"><a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a>    <span class="c1"># Analyze diff to find customized sections</span>
</span><span id="__span-53-38"><a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a>    <span class="c1"># ...</span>
</span></code></pre></div></p>
<h3 id="metadata-corruption">Metadata Corruption<a class="headerlink" href="#metadata-corruption" title="Anchor link to this section">&para;</a></h3>
<p><strong>Problem:</strong> <code>.claude-docs-meta.json</code> becomes invalid</p>
<p><strong>Cause:</strong> Concurrent writes, interrupted migrations, manual edits</p>
<p><strong>Solution:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nd">@classmethod</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;DocsMetadata&quot;</span><span class="p">]:</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load with corruption recovery&quot;&quot;&quot;</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>        <span class="c1"># Corrupted JSON - try to recover</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Metadata corrupted, attempting recovery...&quot;</span><span class="p">)</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a>        <span class="n">backup</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_find_latest_backup</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a>        <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Restoring from backup: </span><span class="si">{</span><span class="n">backup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">backup</span> <span class="o">/</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a>            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No backup found, creating default metadata&quot;</span><span class="p">)</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_default</span><span class="p">()</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a>        <span class="k">raise</span> <span class="n">MetadataError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a><span class="nd">@staticmethod</span>
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">_find_latest_backup</span><span class="p">(</span><span class="n">docs_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find most recent backup directory&quot;&quot;&quot;</span>
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a>    <span class="n">backups_dir</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;backups&quot;</span>
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">backups_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a>
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a>    <span class="n">backups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">backups_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a>    <span class="k">return</span> <span class="n">backups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">backups</span> <span class="k">else</span> <span class="kc">None</span>
</span></code></pre></div></p>
<h3 id="template-syntax-errors">Template Syntax Errors<a class="headerlink" href="#template-syntax-errors" title="Anchor link to this section">&para;</a></h3>
<p><strong>Problem:</strong> User creates invalid Jinja2 template</p>
<p><strong>Cause:</strong> Typos in block syntax, missing <code>{% endblock %}</code></p>
<p><strong>Solution:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_user_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="sd">    Validate user template syntax before using it.</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="sd">    Returns: (is_valid, error_message)</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>    <span class="n">user_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="n">template_name</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># No user template</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>        <span class="c1"># Try parsing template</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a>
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="c1"># Use in CLI</span>
</span><span id="__span-55-21"><a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-55-22"><a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="s2">&quot;package&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span>
</span><span id="__span-55-23"><a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a>
</span><span id="__span-55-24"><a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>    <span class="c1"># Validate before rendering</span>
</span><span id="__span-55-25"><a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a>    <span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">validate_user_template</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2">.md.jinja2&quot;</span><span class="p">)</span>
</span><span id="__span-55-26"><a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="__span-55-27"><a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Template syntax error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-55-28"><a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a>        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Fix your template in: .package/templates/</span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2">.md.jinja2&quot;</span><span class="p">)</span>
</span><span id="__span-55-29"><a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a>        <span class="k">return</span>
</span><span id="__span-55-30"><a id="__codelineno-55-30" name="__codelineno-55-30" href="#__codelineno-55-30"></a>
</span><span id="__span-55-31"><a id="__codelineno-55-31" name="__codelineno-55-31" href="#__codelineno-55-31"></a>    <span class="c1"># Proceed with generation</span>
</span><span id="__span-55-32"><a id="__codelineno-55-32" name="__codelineno-55-32" href="#__codelineno-55-32"></a>    <span class="o">...</span>
</span></code></pre></div></p>
<h3 id="version-compatibility-confusion">Version Compatibility Confusion<a class="headerlink" href="#version-compatibility-confusion" title="Anchor link to this section">&para;</a></h3>
<p><strong>Problem:</strong> Users don't understand doc_version vs package_version</p>
<p><strong>Cause:</strong> Unclear messaging</p>
<p><strong>Solution:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># Clear explanations in CLI output</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">():</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="s2">📊 Documentation Status</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="s2">Doc Schema Version:    2</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="s2">├─ Controls template structure</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="s2">├─ Changes rarely (only with breaking changes)</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="s2">└─ Current latest: 2</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="s2">Package Version:       0.10.5</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="s2">├─ Controls features and APIs</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="s2">├─ Changes frequently (with releases)</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="s2">└─ Current latest: 0.10.5</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="s2">💡 Explanation:</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="s2">- Doc schema version changes when template structure changes</span>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="s2">- Package version changes with every release</span>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="s2">- Old doc schemas may work with new packages (compatibility)</span>
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a><span class="s2">- Run &#39;docs upgrade&#39; when prompted</span>
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h2 id="7-extension-points">7. Extension Points<a class="headerlink" href="#7-extension-points" title="Anchor link to this section">&para;</a></h2>
<h3 id="multi-platform-documentation">Multi-Platform Documentation<a class="headerlink" href="#multi-platform-documentation" title="Anchor link to this section">&para;</a></h3>
<p><strong>Pattern:</strong> Single base template, platform-specific extensions</p>
<p _="%" endblock="endblock"><div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1"># Structure</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">templates</span><span class="o">/</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>  <span class="err">├──</span> <span class="n">shared</span><span class="o">/</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>  <span class="err">│</span>   <span class="err">├──</span> <span class="n">quickstart</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>  <span class="err">│</span>   <span class="err">└──</span> <span class="n">api</span><span class="o">-</span><span class="n">reference</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>  <span class="err">└──</span> <span class="n">platforms</span><span class="o">/</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>      <span class="err">├──</span> <span class="n">claude</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>      <span class="err">├──</span> <span class="n">gemini</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>      <span class="err">└──</span> <span class="n">codex</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="c1"># Base template (shared sections)</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="c1"># templates/shared/quickstart.md.jinja2</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="c1">## Quick Start</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">install</span> <span class="o">%</span><span class="p">}</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="err">```</span><span class="n">bash</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="n">pip</span> <span class="n">install</span> <span class="p">{{</span> <span class="n">package_name</span> <span class="p">}}</span>
</span></code></pre></div></p>
<h1 id="platform-specific-template">Platform-specific template<a class="headerlink" href="#platform-specific-template" title="Anchor link to this section">&para;</a></h1>
<h1 id="templatesplatformsclaudemdjinja2">templates/platforms/claude.md.jinja2<a class="headerlink" href="#templatesplatformsclaudemdjinja2" title="Anchor link to this section">&para;</a></h1>
<p>{% include "shared/quickstart.md.jinja2" %}</p>
<h2 id="claude-specific-features">Claude-Specific Features<a class="headerlink" href="#claude-specific-features" title="Anchor link to this section">&para;</a></h2>
<p>{% block claude_orchestration %}
Use orchestration mode for multi-agent workflows...
{% endblock %}
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>**CLI support:**
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>```bash
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>your-package docs generate --platform claude
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>your-package docs generate --platform gemini
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>your-package docs generate --all-platforms
</span></code></pre></div></p>
<h3 id="internationalization-i18n">Internationalization (i18n)<a class="headerlink" href="#internationalization-i18n" title="Anchor link to this section">&para;</a></h3>
<p><strong>Pattern:</strong> Template selection by locale</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># Structure</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="n">templates</span><span class="o">/</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>  <span class="err">├──</span> <span class="n">en</span><span class="o">/</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>  <span class="err">│</span>   <span class="err">└──</span> <span class="n">claude</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>  <span class="err">├──</span> <span class="n">ja</span><span class="o">/</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>  <span class="err">│</span>   <span class="err">└──</span> <span class="n">claude</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>  <span class="err">└──</span> <span class="n">es</span><span class="o">/</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>      <span class="err">└──</span> <span class="n">claude</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">jinja2</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="c1"># Context with locale</span>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>    <span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="s2">&quot;htmlgraph&quot;</span><span class="p">,</span>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>    <span class="s2">&quot;locale&quot;</span><span class="p">:</span> <span class="s2">&quot;ja&quot;</span><span class="p">,</span>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>    <span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="n">translation_function</span>  <span class="c1"># gettext or similar</span>
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="p">}</span>
</span><span id="__span-59-16"><a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a>
</span><span id="__span-59-17"><a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="c1"># Render with locale-specific template</span>
</span><span id="__span-59-18"><a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a><span class="n">output</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;locale&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="dynamic-content-injection">Dynamic Content Injection<a class="headerlink" href="#dynamic-content-injection" title="Anchor link to this section">&para;</a></h3>
<p><strong>Pattern:</strong> Hook-based content providers</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># Allow plugins to inject content into templates</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">ContentProvider</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>    <span class="nd">@abstractmethod</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>        <span class="k">pass</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="c1"># Register providers</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="n">engine</span><span class="o">.</span><span class="n">register_provider</span><span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="n">ExamplesProvider</span><span class="p">())</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="n">engine</span><span class="o">.</span><span class="n">register_provider</span><span class="p">(</span><span class="s2">&quot;changelog&quot;</span><span class="p">,</span> <span class="n">ChangelogProvider</span><span class="p">())</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="c1"># In template</span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">examples</span> <span class="o">%</span><span class="p">}</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="p">{{</span> <span class="n">providers</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">get_content</span><span class="p">(</span><span class="s2">&quot;quickstart&quot;</span><span class="p">)</span> <span class="p">}}</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="custom-template-filters">Custom Template Filters<a class="headerlink" href="#custom-template-filters" title="Anchor link to this section">&para;</a></h3>
<p><strong>Pattern:</strong> Domain-specific Jinja2 filters</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_filters</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n">Environment</span><span class="p">):</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add custom Jinja2 filters&quot;&quot;&quot;</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>    <span class="c1"># Convert snake_case to Title Case</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>    <span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;titleize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>    <span class="c1"># Format code blocks</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>    <span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">code</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;```</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\n</span><span class="s2">```&quot;</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>    <span class="c1"># Format timestamps</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>    <span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>    <span class="c1"># Markdown table formatter</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>    <span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_markdown_table</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="c1"># Usage in templates</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="p">{{</span> <span class="n">package_name</span> <span class="o">|</span> <span class="n">titleize</span> <span class="p">}}</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="p">{{</span> <span class="n">code_sample</span> <span class="o">|</span> <span class="n">code</span><span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span> <span class="p">}}</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="p">{{</span> <span class="n">generated_at</span> <span class="o">|</span> <span class="n">datetime</span> <span class="p">}}</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="p">{{</span> <span class="n">api_methods</span> <span class="o">|</span> <span class="n">table</span> <span class="p">}}</span>
</span></code></pre></div>
<hr />
<h2 id="8-faq">8. FAQ<a class="headerlink" href="#8-faq" title="Anchor link to this section">&para;</a></h2>
<h3 id="q-why-jinja2-instead-of-simpler-string-templates">Q: Why Jinja2 instead of simpler string templates?<a class="headerlink" href="#q-why-jinja2-instead-of-simpler-string-templates" title="Anchor link to this section">&para;</a></h3>
<p><strong>A:</strong> Jinja2 provides critical features for this pattern:</p>
<ol>
<li><strong>Template Inheritance</strong> - Users can extend base templates</li>
<li><strong>Block System</strong> - Granular override control</li>
<li><strong>Include/Import</strong> - Reusable components</li>
<li><strong>Filters</strong> - Custom formatting logic</li>
<li><strong>Conditionals</strong> - Platform-specific content</li>
<li><strong>Widely Used</strong> - Developers already know it</li>
</ol>
<p>Simple string templates (<code>str.format</code>, f-strings) don't support inheritance or blocks, making customization preservation impossible.</p>
<h3 id="q-how-do-i-know-when-to-create-a-migration">Q: How do I know when to create a migration?<a class="headerlink" href="#q-how-do-i-know-when-to-create-a-migration" title="Anchor link to this section">&para;</a></h3>
<p><strong>A:</strong> Create a migration when:</p>
<p>✅ <strong>Template structure changes</strong>
- Adding/removing/renaming blocks
- Changing file locations
- Modifying metadata schema</p>
<p>❌ <strong>Don't create migration for:</strong>
- Content improvements
- Typo fixes
- Adding examples (within existing blocks)</p>
<p><strong>Decision tree:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>Will user&#39;s custom template break? YES → Migration needed
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>Did file paths change? YES → Migration needed
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>Did metadata schema change? YES → Migration needed
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>Just improving docs content? NO → No migration needed
</span></code></pre></div></p>
<h3 id="q-can-users-completely-replace-base-documentation">Q: Can users completely replace base documentation?<a class="headerlink" href="#q-can-users-completely-replace-base-documentation" title="Anchor link to this section">&para;</a></h3>
<p><strong>A:</strong> Yes, with caveats:</p>
<p><strong>Option 1: Override all blocks</strong> (recommended)
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>{% extends &quot;base/claude.md.jinja2&quot; %}
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>{% block quickstart %}Custom quickstart{% endblock %}
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>{% block configuration %}Custom config{% endblock %}
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>{# Override every block #}
</span></code></pre></div></p>
<p><strong>Option 2: Completely custom template</strong> (advanced)
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>{# Don&#39;t extend base template #}
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a># My Completely Custom Documentation
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>...
</span></code></pre></div></p>
<p><strong>Caveat:</strong> Option 2 means:
- No automatic updates from package
- Must manually track changes
- Version compatibility may break</p>
<h3 id="q-what-if-user-customizations-conflict-with-package-updates">Q: What if user customizations conflict with package updates?<a class="headerlink" href="#q-what-if-user-customizations-conflict-with-package-updates" title="Anchor link to this section">&para;</a></h3>
<p><strong>A:</strong> Handle with migration strategy:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customizations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle conflicting customizations&quot;&quot;&quot;</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>    <span class="c1"># Detect conflicts</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>    <span class="n">conflicts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_conflicts</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>    <span class="k">if</span> <span class="n">conflicts</span><span class="p">:</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Customization conflicts detected:&quot;</span><span class="p">)</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>        <span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - </span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;block&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>        <span class="c1"># Offer resolution strategies</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resolution options:&quot;</span><span class="p">)</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Keep your customization (may lose new features)&quot;</span><span class="p">)</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Accept package update (will overwrite your customization)&quot;</span><span class="p">)</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Merge both (manual editing required)&quot;</span><span class="p">)</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>        <span class="n">choice</span> <span class="o">=</span> <span class="n">click</span><span class="o">.</span><span class="n">prompt</span><span class="p">(</span><span class="s2">&quot;Choose&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>        <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>            <span class="c1"># Keep user customization</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_migrate_keep_user</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>        <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a>            <span class="c1"># Accept package update</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_migrate_accept_package</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a>            <span class="c1"># Create merged template for manual editing</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_migrate_create_merge_template</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="q-how-much-documentation-should-be-in-package-vs-project">Q: How much documentation should be in package vs project?<a class="headerlink" href="#q-how-much-documentation-should-be-in-package-vs-project" title="Anchor link to this section">&para;</a></h3>
<p><strong>A:</strong> Follow this guideline:</p>
<p><strong>Package documentation (base templates):</strong>
- ✅ Core concepts
- ✅ API reference
- ✅ Quick start
- ✅ Common patterns
- ✅ Troubleshooting</p>
<p><strong>Project documentation (user overrides):</strong>
- ✅ Project-specific configuration
- ✅ Custom workflows
- ✅ Team conventions
- ✅ Additional examples
- ✅ Integration notes</p>
<p><strong>Principle:</strong> Package provides comprehensive default, user customizes for their needs.</p>
<hr />
<h2 id="9-examples">9. Examples<a class="headerlink" href="#9-examples" title="Anchor link to this section">&para;</a></h2>
<h3 id="example-1-simple-package-basic-override">Example 1: Simple Package - Basic Override<a class="headerlink" href="#example-1-simple-package-basic-override" title="Anchor link to this section">&para;</a></h3>
<p><strong>Scenario:</strong> CLI tool with minimal customization needs</p>
<p><strong>Package structure:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>simple_tool/
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>├── templates/
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>│   └── base/
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>│       └── README.md.jinja2
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>└── cli.py
</span></code></pre></div></p>
<p _="%" endblock="endblock"><strong>Base template:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a># {{ package_name }}
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>{% block description %}
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>A simple CLI tool for X, Y, Z.
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>{% endblock %}
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>## Installation
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>{% block installation %}
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>```bash
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>pip install {{ package_name }}
</span></code></pre></div></p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Anchor link to this section">&para;</a></h2>
<p>{% block usage %}
<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="o">{{</span><span class="w"> </span>package_name<span class="w"> </span><span class="o">}}</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="o">[</span>options<span class="o">]</span>
</span></code></pre></div>
{% endblock %}
<div class="language-text highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>**User customization:**
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>```jinja2
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>{# .simple-tool/templates/README.md.jinja2 #}
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>{% extends &quot;base/README.md.jinja2&quot; %}
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>{% block description %}
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>{{ super() }}
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>**Our team uses this for:** Internal automation workflows
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>{% endblock %}
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a>{% block usage %}
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a>{{ super() }}
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a>### Our Common Commands
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a>```bash
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a>simple-tool deploy --env production
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a>simple-tool backup --daily
</span></code></pre></div>
{% endblock %}
<div class="language-text highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>**CLI:**
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>```bash
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>simple-tool docs generate
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a># Generates README.md with user customizations
</span></code></pre></div></p>
<h3 id="example-2-medium-complexity-multiple-platforms-one-migration">Example 2: Medium Complexity - Multiple Platforms, One Migration<a class="headerlink" href="#example-2-medium-complexity-multiple-platforms-one-migration" title="Anchor link to this section">&para;</a></h3>
<p><strong>Scenario:</strong> AI agent SDK with Claude and Gemini support</p>
<p><strong>Package structure:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>ai_sdk/
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>├── templates/
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>│   ├── base/
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>│   │   ├── claude.md.jinja2
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>│   │   └── gemini.md.jinja2
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>│   └── shared/
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>│       └── api-common.md.jinja2
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>├── migrations/
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>│   └── 001_add_analytics.py
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>└── cli.py
</span></code></pre></div></p>
<p><strong>Migration (001_add_analytics.py):</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Migration001AddAnalytics</span><span class="p">(</span><span class="n">MigrationScript</span><span class="p">):</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>    <span class="n">from_version</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>    <span class="n">to_version</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Add analytics section to documentation&quot;</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_customizations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>        <span class="c1"># Check for custom workflows section</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>        <span class="n">doc_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;CLAUDE.md&quot;</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">doc_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>        <span class="n">custom_workflows</span> <span class="o">=</span> <span class="s2">&quot;## My Workflows&quot;</span> <span class="ow">in</span> <span class="n">content</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>            <span class="s2">&quot;has_customizations&quot;</span><span class="p">:</span> <span class="n">custom_workflows</span><span class="p">,</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>            <span class="s2">&quot;customized_blocks&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;workflows&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">custom_workflows</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a>        <span class="p">}</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customizations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a>        <span class="c1"># Regenerate with new analytics section</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a>        <span class="n">engine</span> <span class="o">=</span> <span class="n">DocTemplateEngine</span><span class="p">(</span><span class="s2">&quot;ai_sdk&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a>        <span class="c1"># Preserve custom workflows if exists</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a>        <span class="k">if</span> <span class="n">customizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_customizations&quot;</span><span class="p">):</span>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a>            <span class="c1"># Create user template with custom workflows block</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a>            <span class="k">pass</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a>        <span class="c1"># Generate updated documentation</span>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;base/claude.md.jinja2&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a>        <span class="n">doc_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a>
</span><span id="__span-72-31"><a id="__codelineno-72-31" name="__codelineno-72-31" href="#__codelineno-72-31"></a>        <span class="k">return</span> <span class="kc">True</span>
</span></code></pre></div></p>
<p><strong>Usage:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1"># User has v1 docs with custom workflows</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>ai-sdk<span class="w"> </span>docs<span class="w"> </span>version
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="c1"># → Doc version: 1 (outdated)</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="c1"># Upgrade to v2 (adds analytics)</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>ai-sdk<span class="w"> </span>docs<span class="w"> </span>upgrade
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="c1"># → Detects custom workflows</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="c1"># → Preserves them in migration</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="c1"># → Adds new analytics section</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="c1"># Result: v2 docs with analytics + custom workflows preserved</span>
</span></code></pre></div></p>
<h3 id="example-3-advanced-multi-version-migrations-complex-customizations">Example 3: Advanced - Multi-Version Migrations, Complex Customizations<a class="headerlink" href="#example-3-advanced-multi-version-migrations-complex-customizations" title="Anchor link to this section">&para;</a></h3>
<p><strong>Scenario:</strong> Full-featured framework with extensive documentation</p>
<p><strong>Package structure:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>advanced_framework/
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>├── templates/
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>│   ├── base/
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>│   │   ├── claude.md.jinja2
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>│   │   ├── gemini.md.jinja2
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>│   │   └── getting-started.md.jinja2
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>│   ├── shared/
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>│   │   ├── api-reference.md.jinja2
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>│   │   ├── examples.md.jinja2
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>│   │   └── troubleshooting.md.jinja2
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>│   └── advanced/
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>│       ├── architecture.md.jinja2
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>│       └── performance.md.jinja2
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>├── migrations/
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>│   ├── 001_to_002.py
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>│   ├── 002_to_003.py
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>│   └── 003_to_004.py
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>└── cli.py
</span></code></pre></div></p>
<p><strong>Complex customization example:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>{# User template: .framework/templates/claude.md.jinja2 #}
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>{% extends &quot;base/claude.md.jinja2&quot; %}
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>{# Override configuration with team-specific setup #}
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>{% block configuration %}
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>## Our Production Configuration
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>```yaml
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>environment: production
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a>features:
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a>  - advanced_caching
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a>  - distributed_tracing
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a>  - auto_scaling
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a>integrations:
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a>  - datadog
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a>  - sentry
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a>  - pagerduty
</span></code></pre></div></p>
<p _="%" endblock="endblock">{{ super() }}  {# Include package defaults too #}</p>
<p _="%" block="block" deployment="deployment">{# Add custom deployment section #}</p>
<h2 id="deployment-workflow">Deployment Workflow<a class="headerlink" href="#deployment-workflow" title="Anchor link to this section">&para;</a></h2>
<h3 id="our-cicd-pipeline">Our CI/CD Pipeline<a class="headerlink" href="#our-cicd-pipeline" title="Anchor link to this section">&para;</a></h3>
<ol>
<li>Run tests in Docker</li>
<li>Build production images</li>
<li>Deploy to staging</li>
<li>Run smoke tests</li>
<li>Deploy to production</li>
<li>Monitor metrics</li>
</ol>
<h3 id="rollback-procedure">Rollback Procedure<a class="headerlink" href="#rollback-procedure" title="Anchor link to this section">&para;</a></h3>
<p _="%" endblock="endblock"><div class="language-bash highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>framework<span class="w"> </span>rollback<span class="w"> </span>--version<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>.last-stable<span class="k">)</span>
</span></code></pre></div></p>
<p>{# Override troubleshooting with team incidents #}
{% block troubleshooting %}
{{ super() }}</p>
<h3 id="team-incident-history">Team Incident History<a class="headerlink" href="#team-incident-history" title="Anchor link to this section">&para;</a></h3>
<ul>
<li><strong>2025-01-15</strong>: Database connection pool exhausted</li>
<li>Solution: Increased pool size to 50</li>
<li><strong>2025-01-10</strong>: Cache invalidation race condition</li>
<li>Solution: Added distributed locks
{% endblock %}
<div class="language-text highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>**Multi-version migration path:**
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>```python
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a># User on version 1, package at version 4
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a># Migration path: 1 → 2 → 3 → 4
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>migrations = [
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>    Migration001To002,  # Add analytics
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>    Migration002To003,  # Restructure API reference
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a>    Migration003To004,  # Add deployment section
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>]
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>for migration_class in migrations:
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a>    migration = migration_class(project_root, &quot;advanced_framework&quot;)
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a>    success = migration.run()
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a>    if not success:
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a>        print(&quot;Migration failed, rolling back&quot;)
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a>        break
</span></code></pre></div></li>
</ul>
<p><strong>Conflict resolution:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># Version 3 → 4 migration adds deployment section</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="c1"># User already has custom deployment section</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="c1"># Detect conflict and offer resolution</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customizations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>    <span class="k">if</span> <span class="s2">&quot;deployment&quot;</span> <span class="ow">in</span> <span class="n">customizations</span><span class="p">[</span><span class="s2">&quot;customized_blocks&quot;</span><span class="p">]:</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Conflict: You have a custom deployment section&quot;</span><span class="p">)</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Package v4 adds official deployment documentation&quot;</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Options:&quot;</span><span class="p">)</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Keep your custom deployment docs&quot;</span><span class="p">)</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Switch to package deployment docs&quot;</span><span class="p">)</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Merge both (you&#39;ll need to edit)&quot;</span><span class="p">)</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>        <span class="n">choice</span> <span class="o">=</span> <span class="n">click</span><span class="o">.</span><span class="n">prompt</span><span class="p">(</span><span class="s2">&quot;Choose&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a>        <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a>            <span class="c1"># Create merged template</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_merge_template</span><span class="p">(</span><span class="n">customizations</span><span class="p">)</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Created merged template for manual editing&quot;</span><span class="p">)</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Edit: .framework/templates/claude.md.jinja2&quot;</span><span class="p">)</span>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a>
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a>    <span class="c1"># Proceed with migration</span>
</span><span id="__span-78-24"><a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a>    <span class="o">...</span>
</span></code></pre></div></p>
<hr />
<h2 id="10-resources">10. Resources<a class="headerlink" href="#10-resources" title="Anchor link to this section">&para;</a></h2>
<h3 id="htmlgraph-source-code">HtmlGraph Source Code<a class="headerlink" href="#htmlgraph-source-code" title="Anchor link to this section">&para;</a></h3>
<p><strong>Reference implementation:</strong>
- <strong>Template Engine</strong>: <code>src/python/htmlgraph/template_engine.py</code>
- <strong>Models</strong>: <code>src/python/htmlgraph/models.py</code>
- <strong>Migrations</strong>: <code>src/python/htmlgraph/migrations/</code>
- <strong>CLI</strong>: <code>src/python/htmlgraph/cli.py</code> (docs subcommands)
- <strong>Tests</strong>: <code>tests/test_docs_system.py</code></p>
<p><strong>GitHub:</strong>
- Repository: https://github.com/shakes-tzd/htmlgraph
- Templates: <code>/src/python/htmlgraph/templates/</code>
- Migration examples: <code>/src/python/htmlgraph/migrations/</code></p>
<h3 id="external-documentation">External Documentation<a class="headerlink" href="#external-documentation" title="Anchor link to this section">&para;</a></h3>
<p><strong>Jinja2:</strong>
- Official Docs: https://jinja.palletsprojects.com/
- Template Designer Docs: https://jinja.palletsprojects.com/en/3.1.x/templates/
- API Reference: https://jinja.palletsprojects.com/en/3.1.x/api/</p>
<p><strong>Pydantic v2:</strong>
- Documentation: https://docs.pydantic.dev/latest/
- Migration Guide (v1→v2): https://docs.pydantic.dev/latest/migration/
- Validators: https://docs.pydantic.dev/latest/concepts/validators/</p>
<p><strong>Packaging:</strong>
- Semantic Versioning: https://semver.org/
- Python Packaging Guide: https://packaging.python.org/
- Version Specifiers: https://peps.python.org/pep-0440/</p>
<h3 id="related-patterns">Related Patterns<a class="headerlink" href="#related-patterns" title="Anchor link to this section">&para;</a></h3>
<p><strong>Configuration Management:</strong>
- Dynaconf: https://www.dynaconf.com/ (layered config)
- Hydra: https://hydra.cc/ (config composition)</p>
<p><strong>Template Systems:</strong>
- Cookiecutter: https://cookiecutter.readthedocs.io/ (project templates)
- Copier: https://copier.readthedocs.io/ (template updates)</p>
<p><strong>Migration Systems:</strong>
- Alembic: https://alembic.sqlalchemy.org/ (database migrations)
- Django Migrations: https://docs.djangoproject.com/en/stable/topics/migrations/</p>
<h3 id="community-examples">Community Examples<a class="headerlink" href="#community-examples" title="Anchor link to this section">&para;</a></h3>
<p><strong>Tools using similar patterns:</strong>
- <strong>Cookiecutter</strong> - Project templates with updates
- <strong>Copier</strong> - Template-based project generation with updates
- <strong>Homebrew</strong> - Formula templates with user customization
- <strong>Oh My Zsh</strong> - Plugin system with custom overrides</p>
<hr />
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Anchor link to this section">&para;</a></h2>
<p>The packageable auto-updating documentation pattern solves the challenge of keeping AI agent instructions current while preserving user customizations. By combining:</p>
<ol>
<li><strong>Jinja2 template inheritance</strong> for flexible customization</li>
<li><strong>Dual versioning</strong> for compatibility tracking</li>
<li><strong>Migration scripts</strong> for safe upgrades</li>
<li><strong>Metadata tracking</strong> for state management</li>
</ol>
<p>...developers can build documentation systems that:
- ✅ Auto-update with package releases
- ✅ Preserve user customizations
- ✅ Support safe rollback
- ✅ Work across multiple platforms
- ✅ Scale to complex use cases</p>
<p><strong>Next Steps:</strong>
1. Review HtmlGraph's implementation for working examples
2. Adapt the pattern to your package's needs
3. Start with simple template inheritance
4. Add migrations as your documentation evolves
5. Share your learnings with the community</p>
<p><strong>Remember:</strong> Start simple, add complexity only when needed. A basic template system is better than no system at all.</p>
<hr />
<p><em>This guide was created based on HtmlGraph's proven implementation. For questions or contributions, see: https://github.com/shakes-tzd/htmlgraph</em></p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 TZDLabs
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Shakes-tzd/htmlgraph" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/htmlgraph/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/shakestzd" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "navigation.footer", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>