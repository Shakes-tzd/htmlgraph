{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"HTML is All You Need","text":"A lightweight graph database framework built entirely on web standards    ## Install HtmlGraph  <pre><code>pip install htmlgraph\n</code></pre>  ## Create Your First Graph  <pre><code>from htmlgraph import SDK\n\n# Initialize SDK (auto-discovers .htmlgraph directory)\nsdk = SDK(agent=\"claude\")\n\n# Create a feature with fluent API\nfeature = sdk.features.create(\"User Authentication\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create login endpoint\",\n        \"Add JWT middleware\",\n        \"Write tests\"\n    ]) \\\n    .save()\n\n# Query with filters\nhigh_priority = sdk.features.where(status=\"todo\", priority=\"high\")\n\n# Create tracks with specs and plans\ntrack = sdk.tracks.builder() \\\n    .title(\"OAuth Integration\") \\\n    .with_spec(overview=\"Add OAuth 2.0 support\") \\\n    .with_plan_phases([\n        (\"Phase 1\", [\"Setup OAuth (2h)\", \"Add JWT (3h)\"])\n    ]) \\\n    .create()\n</code></pre> &lt;/&gt; Pure Web Standards  HTML files as nodes, hyperlinks as edges, CSS selectors as queries. No Docker, no JVM, no external databases.  \ud83d\udc41 Human Readable  Open any node in a browser. View relationships visually. Git diffs work perfectly. Inspect and debug with DevTools.  \u26a1 Minimal Infrastructure  No Docker, JVM, or external database servers. HTML files work in any browser. SDK uses pydantic, justhtml, SQLite. Offline-first.  \ud83d\udce2 AI Agent First  Fluent SDK for Claude, Codex, Gemini. Automatic session tracking. TrackBuilder for deterministic workflows.  \ud83d\udcc8 Git Native  Text-based storage means perfect version control. Diffs show what changed. Merge conflicts are human-readable.  \ud83d\ude80 Production Ready  Pydantic validation. SQLite index for scale. Built-in dashboard. Session management. Event tracking. Type safe."},{"location":"#why-htmlgraph","title":"Why HtmlGraph?","text":"<p>Modern AI agent systems are drowning in complexity:</p> <ul> <li>\u274c Neo4j/Memgraph: Docker, JVM, learn Cypher</li> <li>\u274c Redis: Caching and state management overhead</li> <li>\u274c PostgreSQL: Heavy relational database setup</li> <li>\u274c Custom Protocols: Proprietary agent coordination</li> <li>\u274c Separate UIs: Additional observability tools</li> </ul> <p>HtmlGraph eliminates all of this. The web is already a graph database. Use it.</p>"},{"location":"#core-philosophy","title":"Core Philosophy","text":"<p>The Web is the Graph</p> <p>Every webpage is a node. Every hyperlink is an edge. Every browser is a graph viewer. Every CSS selector is a query. Version control works. Humans can read it. Agents can navigate it. HTML is all you need.</p>"},{"location":"#quick-comparisons","title":"Quick Comparisons","text":""},{"location":"#vs-neo4j","title":"vs Neo4j","text":"Feature Neo4j HtmlGraph Setup Docker, JVM, learn Cypher <code>pip install htmlgraph</code> Human readable \u274c Browser required \u2705 Any web browser Version control \u274c Binary dumps \u2705 Git diff works Query language Cypher (learn it) CSS selectors (know it) Cost $$$ Enterprise Free, MIT license"},{"location":"#vs-jsonyaml","title":"vs JSON/YAML","text":"Feature JSON HtmlGraph Human readable \ud83d\udfe1 Text editor \u2705 Browser with styling Graph structure \u274c Manual references \u2705 Native hyperlinks Query \u274c jq or custom \u2705 CSS selectors Presentation \u274c Needs UI \u2705 Built-in rendering"},{"location":"#next-steps","title":"Next Steps","text":"\ud83d\udcda Get Started Installation guide, first graph, and core concepts \u2192 \ud83d\udd0c SDK Reference Complete SDK documentation with examples \u2192 \ud83d\udcd6 User Guide Learn tracks, features, and session management \u2192 \u26a1 Examples Real-world use cases and code samples \u2192 <p>Built with web standards. Designed for AI agents. Loved by developers.</p> <p>HTML is All You Need</p>"},{"location":"AGENT_STRATEGIC_PLANNING/","title":"Agent Strategic Planning Guide","text":"<p>This guide shows AI agents how to use HtmlGraph's strategic planning and dependency analytics features to make smart decisions about what to work on.</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#quick-start","title":"Quick Start","text":"<pre><code>from htmlgraph import SDK\n\n# Initialize with your agent ID\nsdk = SDK(agent=\"claude\")\n\n# Get smart recommendations\nrecs = sdk.recommend_next_work(agent_count=1)\nif recs:\n    best = recs[0]\n    print(f\"Work on: {best['title']}\")\n    print(f\"Why: {', '.join(best['reasons'])}\")\n</code></pre>"},{"location":"AGENT_STRATEGIC_PLANNING/#available-features","title":"Available Features","text":""},{"location":"AGENT_STRATEGIC_PLANNING/#1-find-bottlenecks","title":"1. Find Bottlenecks \ud83d\udea7","text":"<p>What it does: Identifies tasks blocking the most downstream work</p> <p>When to use: - At the start of a work session - When planning sprints - When coordinating multiple agents</p> <p>Example: <pre><code>bottlenecks = sdk.find_bottlenecks(top_n=5)\n\nfor bn in bottlenecks:\n    print(f\"{bn['title']} blocks {bn['blocks_count']} tasks\")\n    print(f\"Impact score: {bn['impact_score']}\")\n    print(f\"Priority: {bn['priority']}\")\n</code></pre></p> <p>Returns: List of dicts with: - <code>id</code>: Task ID - <code>title</code>: Task title - <code>status</code>: Current status - <code>priority</code>: Priority level - <code>blocks_count</code>: Number of tasks blocked - <code>impact_score</code>: Weighted impact metric - <code>blocked_tasks</code>: List of task IDs being blocked</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#2-get-parallel-work","title":"2. Get Parallel Work \u26a1","text":"<p>What it does: Finds tasks that can be worked on simultaneously by multiple agents</p> <p>When to use: - When coordinating multiple agents - When planning team assignments - When looking for independent work streams</p> <p>Example: <pre><code>parallel = sdk.get_parallel_work(max_agents=5)\n\nprint(f\"Can work on {parallel['max_parallelism']} tasks at once\")\nprint(f\"Ready now: {parallel['ready_now']}\")\n</code></pre></p> <p>Returns: Dict with: - <code>max_parallelism</code>: Maximum tasks that can run in parallel - <code>ready_now</code>: List of task IDs ready to start immediately - <code>total_ready</code>: Count of ready tasks - <code>level_count</code>: Number of dependency levels - <code>next_level</code>: Tasks in the next dependency level</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#3-recommend-next-work","title":"3. Recommend Next Work \ud83d\udca1","text":"<p>What it does: Provides smart recommendations on what to work on next, considering priority, dependencies, and impact</p> <p>When to use: - When deciding what task to pick up - When you need to prioritize between multiple options - When coordinating work across agents</p> <p>Example: <pre><code>recs = sdk.recommend_next_work(agent_count=3)\n\nfor rec in recs:\n    print(f\"{rec['title']} (score: {rec['score']})\")\n    print(f\"Priority: {rec['priority']}\")\n    print(f\"Reasons: {rec['reasons']}\")\n    print(f\"Unlocks: {rec['unlocks_count']} tasks\")\n</code></pre></p> <p>Returns: List of dicts with: - <code>id</code>: Task ID - <code>title</code>: Task title - <code>priority</code>: Priority level - <code>score</code>: Recommendation score (higher = better) - <code>reasons</code>: List of reasons why this task is recommended - <code>estimated_hours</code>: Estimated effort (if available) - <code>unlocks_count</code>: Number of tasks this will unblock - <code>unlocks</code>: List of task IDs that will be unblocked</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#4-assess-risks","title":"4. Assess Risks \u26a0\ufe0f","text":"<p>What it does: Identifies dependency-related risks like single points of failure, circular dependencies, and orphaned tasks</p> <p>When to use: - During project health checks - Before starting a sprint - When dependencies feel complex</p> <p>Example: <pre><code>risks = sdk.assess_risks()\n\nif risks['high_risk_count'] &gt; 0:\n    print(f\"Warning: {risks['high_risk_count']} high-risk tasks\")\n    for task in risks['high_risk_tasks']:\n        print(f\"  {task['title']}: {task['risk_factors']}\")\n\nif risks['circular_dependencies']:\n    print(\"Circular dependencies detected!\")\n</code></pre></p> <p>Returns: Dict with: - <code>high_risk_count</code>: Number of high-risk tasks - <code>high_risk_tasks</code>: List of dicts with:   - <code>id</code>: Task ID   - <code>title</code>: Task title   - <code>risk_score</code>: Risk metric   - <code>risk_factors</code>: List of risk descriptions - <code>circular_dependencies</code>: List of dependency cycles - <code>orphaned_count</code>: Number of orphaned tasks - <code>orphaned_tasks</code>: List of orphaned task IDs - <code>recommendations</code>: List of actionable recommendations</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#5-analyze-impact","title":"5. Analyze Impact \ud83d\udcca","text":"<p>What it does: Shows what downstream work will be unblocked by completing a specific task</p> <p>When to use: - Before committing to a large task - When deciding between tasks with similar priority - When communicating value of work</p> <p>Example: <pre><code>impact = sdk.analyze_impact(\"feature-001\")\n\nprint(f\"Direct dependents: {impact['direct_dependents']}\")\nprint(f\"Total impact: {impact['total_impact']} tasks\")\nprint(f\"Unlocks {impact['completion_impact']:.1f}% of remaining work\")\n</code></pre></p> <p>Returns: Dict with: - <code>node_id</code>: Task ID analyzed - <code>direct_dependents</code>: Number of tasks directly depending on this - <code>total_impact</code>: Total downstream tasks affected - <code>completion_impact</code>: Percentage of total work this unlocks - <code>unlocks_count</code>: Count of affected tasks - <code>affected_tasks</code>: List of affected task IDs</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#decision-flow-for-ai-agents","title":"Decision Flow for AI Agents","text":"<p>Here's a recommended decision flow for AI agents:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# 1. Check for bottlenecks\nbottlenecks = sdk.find_bottlenecks(top_n=3)\nif bottlenecks:\n    print(f\"\u26a0\ufe0f  {len(bottlenecks)} bottlenecks found\")\n    print(\"Consider: Focus on unblocking high-impact work\")\n\n# 2. Get smart recommendations\nrecs = sdk.recommend_next_work(agent_count=1)\nif recs:\n    top = recs[0]\n    print(f\"\\n\ud83d\udca1 RECOMMENDED: {top['title']}\")\n    print(f\"   Score: {top['score']:.1f}\")\n    print(f\"   Reasons: {', '.join(top['reasons'][:2])}\")\n\n    # 3. Analyze impact of recommended task\n    impact = sdk.analyze_impact(top['id'])\n    print(f\"   Impact: Unlocks {impact['unlocks_count']} tasks\")\n\n    # Decision: Work on this task\n    print(f\"\\n\u2705 DECISION: Starting work on {top['id']}\")\n\n# 4. Check for parallel work (if coordinating with other agents)\nparallel = sdk.get_parallel_work(max_agents=3)\nif parallel['total_ready'] &gt; 1:\n    print(f\"\\n\u26a1 {parallel['total_ready']} tasks can be done in parallel\")\n    print(f\"   Other agents can work on: {parallel['ready_now'][1:]}\")\n\n# 5. Assess risks (periodic health check)\nrisks = sdk.assess_risks()\nif risks['high_risk_count'] &gt; 0:\n    print(f\"\\n\u26a0\ufe0f  Health check: {risks['high_risk_count']} high-risk items\")\n</code></pre>"},{"location":"AGENT_STRATEGIC_PLANNING/#integration-with-agentinterface","title":"Integration with AgentInterface","text":"<p>All these methods are also available through <code>AgentInterface</code> for lower-level control:</p> <pre><code>from htmlgraph.agents import AgentInterface\n\nagent = AgentInterface(\"features/\", agent_id=\"claude\")\n\n# Same methods available\nbottlenecks = agent.find_bottlenecks(top_n=5)\nparallel = agent.get_parallel_work(max_agents=3)\nrecs = agent.recommend_next_work(agent_count=1)\nrisks = agent.assess_risks()\nimpact = agent.analyze_impact(\"feature-001\")\n</code></pre>"},{"location":"AGENT_STRATEGIC_PLANNING/#advanced-direct-access-to-analytics-engine","title":"Advanced: Direct Access to Analytics Engine","text":"<p>For advanced use cases, you can access the underlying analytics engine:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Access the full DependencyAnalytics class\nanalytics = sdk.dep_analytics\n\n# All methods return Pydantic models (more detail, less convenience)\nbottlenecks = analytics.find_bottlenecks(top_n=5, min_impact=1.0)\nparallel = analytics.find_parallelizable_work(status=\"todo\")\nrecs = analytics.recommend_next_tasks(agent_count=3, lookahead=5)\nrisk = analytics.assess_dependency_risk(spof_threshold=2)\nimpact = analytics.impact_analysis(\"feature-001\")\n\n# Pydantic models have all fields, not just agent-friendly subset\nfor bn in bottlenecks:\n    print(bn.id, bn.title, bn.transitive_blocking, bn.weighted_impact)\n    print(bn.blocked_nodes)  # Full list, not limited to 5\n</code></pre>"},{"location":"AGENT_STRATEGIC_PLANNING/#best-practices","title":"Best Practices","text":"<ol> <li>Start with recommendations: Use <code>recommend_next_work()</code> as your starting point</li> <li>Check bottlenecks regularly: At least once per session or sprint</li> <li>Assess risks periodically: Before major milestones</li> <li>Analyze impact for big decisions: When choosing between high-effort tasks</li> <li>Use parallel work for coordination: When multiple agents are available</li> </ol>"},{"location":"AGENT_STRATEGIC_PLANNING/#performance-notes","title":"Performance Notes","text":"<ul> <li>All analytics queries are O(N) or O(N log N) where N = number of nodes</li> <li>Results are computed on-demand (no caching)</li> <li>For large graphs (1000+ nodes), consider:</li> <li>Limiting <code>top_n</code> parameters</li> <li>Filtering by status before analysis</li> <li>Using the lower-level API for fine-grained control</li> </ul>"},{"location":"AGENT_STRATEGIC_PLANNING/#examples","title":"Examples","text":"<p>See <code>demo_agent_planning.py</code> for a complete working example.</p>"},{"location":"AGENT_STRATEGIC_PLANNING/#see-also","title":"See Also","text":"<ul> <li>SDK Documentation</li> <li>Agent Interface</li> <li>Dependency Analytics API</li> </ul>"},{"location":"API_REFERENCE/","title":"HtmlGraph SDK API Reference","text":"<p>Complete reference for the HtmlGraph Python SDK.</p>"},{"location":"API_REFERENCE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>SDK Initialization</li> <li>Collections API</li> <li>Collection Methods</li> <li>Builder API</li> <li>Analytics API</li> <li>Session Management</li> <li>Query Methods</li> <li>Error Handling</li> <li>Common Mistakes</li> </ol>"},{"location":"API_REFERENCE/#sdk-initialization","title":"SDK Initialization","text":""},{"location":"API_REFERENCE/#basic-usage","title":"Basic Usage","text":"<pre><code>from htmlgraph import SDK\n\n# Auto-discovers .htmlgraph directory\nsdk = SDK(agent='my-agent')\n\n# Explicit directory\nsdk = SDK(directory='/path/to/.htmlgraph', agent='my-agent')\n\n# Auto-detect agent name (Claude, Gemini, etc.)\nsdk = SDK()  # Detects agent automatically\n</code></pre>"},{"location":"API_REFERENCE/#constructor-parameters","title":"Constructor Parameters","text":"<p>Signature: <code>SDK(directory=None, agent=None)</code></p> <p>Parameters: - <code>directory</code> (optional): Path to .htmlgraph directory. Auto-discovers if not provided. - <code>agent</code> (optional): Agent identifier. Auto-detects if not provided.</p> <p>Auto-Discovery: - Searches current directory and parents for <code>.htmlgraph/</code> - Defaults to current directory if not found</p>"},{"location":"API_REFERENCE/#collections-api","title":"Collections API","text":""},{"location":"API_REFERENCE/#available-collections","title":"Available Collections","text":"<p>The SDK provides collections for different node types:</p> <pre><code>sdk.features      # FeatureCollection - Feature work items\nsdk.bugs          # BugCollection - Bug reports\nsdk.chores        # ChoreCollection - Maintenance tasks\nsdk.spikes        # SpikeCollection - Investigation spikes\nsdk.epics         # EpicCollection - Large initiatives\nsdk.phases        # PhaseCollection - Project phases\nsdk.tracks        # TrackCollection - Work tracks (with builder)\nsdk.sessions      # BaseCollection - Agent sessions\nsdk.agents        # BaseCollection - Agent information\nsdk.todos         # TodoCollection - Persistent tasks\nsdk.patterns      # PatternCollection - Workflow patterns\nsdk.insights      # InsightCollection - Session health insights\nsdk.metrics       # MetricCollection - Time-series metrics\n</code></pre>"},{"location":"API_REFERENCE/#collection-characteristics","title":"Collection Characteristics","text":"<p>With Builder Support (fluent API): - <code>sdk.features</code> - FeatureBuilder - <code>sdk.bugs</code> - BugBuilder - <code>sdk.chores</code> - ChoreBuilder - <code>sdk.spikes</code> - SpikeBuilder - <code>sdk.epics</code> - EpicBuilder - <code>sdk.phases</code> - PhaseBuilder - <code>sdk.tracks</code> - TrackBuilder - <code>sdk.patterns</code> - PatternBuilder - <code>sdk.insights</code> - InsightBuilder - <code>sdk.metrics</code> - MetricBuilder</p> <p>Without Builder (simple creation): - <code>sdk.sessions</code> - <code>sdk.agents</code> - <code>sdk.todos</code></p>"},{"location":"API_REFERENCE/#collection-methods","title":"Collection Methods","text":"<p>All collections inherit from <code>BaseCollection</code> and provide these methods:</p>"},{"location":"API_REFERENCE/#retrieval-methods","title":"Retrieval Methods","text":""},{"location":"API_REFERENCE/#all","title":"all()","text":"<p>Get all nodes in the collection.</p> <p>Signature: <code>all() -&gt; list[Node]</code></p> <p>Returns: List of all nodes of this type</p> <p>Example: <pre><code>features = sdk.features.all()\nbugs = sdk.bugs.all()\n</code></pre></p>"},{"location":"API_REFERENCE/#get","title":"get()","text":"<p>Get a single node by ID.</p> <p>Signature: <code>get(node_id: str) -&gt; Node | None</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to retrieve</p> <p>Returns: Node if found, None otherwise</p> <p>Example: <pre><code>feature = sdk.features.get('feat-abc123')\nif feature:\n    print(feature.title)\nelse:\n    print(\"Not found\")\n</code></pre></p>"},{"location":"API_REFERENCE/#where","title":"where()","text":"<p>Query nodes with filters.</p> <p>Signature: <code>where(status=None, priority=None, track=None, assigned_to=None, **extra_filters) -&gt; list[Node]</code></p> <p>Parameters: - <code>status</code> (optional): Filter by status (\"todo\", \"in-progress\", \"blocked\", \"done\") - <code>priority</code> (optional): Filter by priority (\"low\", \"medium\", \"high\", \"critical\") - <code>track</code> (optional): Filter by track_id - <code>assigned_to</code> (optional): Filter by agent_assigned - <code>**extra_filters</code>: Additional attribute filters</p> <p>Returns: List of matching nodes (empty list if none match)</p> <p>Example: <pre><code># High priority todos\nhigh_priority = sdk.features.where(priority='high', status='todo')\n\n# Assigned to specific agent\nmy_work = sdk.features.where(assigned_to='claude')\n\n# Multiple filters\nurgent = sdk.bugs.where(priority='critical', status='todo', assigned_to='claude')\n\n# Custom attribute filters\nauth_features = sdk.features.where(track='auth', status='in-progress')\n</code></pre></p>"},{"location":"API_REFERENCE/#filter","title":"filter()","text":"<p>Filter nodes using a custom predicate function.</p> <p>Signature: <code>filter(predicate: Callable[[Node], bool]) -&gt; list[Node]</code></p> <p>Parameters: - <code>predicate</code> (required): Function that takes a Node and returns True if it matches</p> <p>Returns: List of matching nodes</p> <p>Example: <pre><code># Find features with \"High\" in title\nhigh_priority = sdk.features.filter(lambda f: \"High\" in f.title)\n\n# Find features created in the last week\nfrom datetime import datetime, timedelta\nrecent = sdk.features.filter(\n    lambda f: f.created &gt; datetime.now() - timedelta(days=7)\n)\n\n# Complex multi-condition filter\nurgent = sdk.features.filter(\n    lambda f: f.priority == \"high\" and f.status == \"todo\" and len(f.steps) &gt; 5\n)\n</code></pre></p>"},{"location":"API_REFERENCE/#creation-methods","title":"Creation Methods","text":""},{"location":"API_REFERENCE/#create","title":"create()","text":"<p>Create a new node in this collection.</p> <p>Signature: <code>create(title: str, priority='medium', status='todo', **kwargs) -&gt; Builder | Node</code></p> <p>Parameters: - <code>title</code> (required): Node title - <code>priority</code> (optional): Priority level (\"low\", \"medium\", \"high\", \"critical\") - <code>status</code> (optional): Status (\"todo\", \"in-progress\", \"blocked\", \"done\") - <code>**kwargs</code>: Additional node properties</p> <p>Returns: - Builder instance if collection has builder support (e.g., FeatureBuilder) - Node instance if collection doesn't have builder support</p> <p>Example: <pre><code># With builder (requires .save())\nfeature = sdk.features.create(\"User Authentication\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Create login endpoint\", \"Add JWT middleware\"]) \\\n    .save()\n\n# Without builder (auto-saved)\nsession = sdk.sessions.create(\"Session 1\", status='active')\n</code></pre></p>"},{"location":"API_REFERENCE/#editing-methods","title":"Editing Methods","text":""},{"location":"API_REFERENCE/#edit","title":"edit()","text":"<p>Context manager for editing a node. Auto-saves on exit.</p> <p>Signature: <code>edit(node_id: str) -&gt; Iterator[Node]</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to edit</p> <p>Returns: Context manager yielding the node</p> <p>Raises: <code>NodeNotFoundError</code> if node not found</p> <p>Example: <pre><code># Edit a single node\nwith sdk.features.edit('feat-abc123') as feature:\n    feature.status = 'in-progress'\n    feature.priority = 'high'\n    feature.steps.append(Step(description='New step'))\n# Auto-saved on exit\n\n# Handle missing nodes\nfrom htmlgraph.exceptions import NodeNotFoundError\ntry:\n    with sdk.features.edit('nonexistent') as feature:\n        feature.status = 'done'\nexcept NodeNotFoundError:\n    print(\"Feature not found\")\n</code></pre></p>"},{"location":"API_REFERENCE/#update","title":"update()","text":"<p>Update a node directly.</p> <p>Signature: <code>update(node: Node) -&gt; Node</code></p> <p>Parameters: - <code>node</code> (required): Node to update</p> <p>Returns: Updated node</p> <p>Raises: <code>NodeNotFoundError</code> if node doesn't exist</p> <p>Example: <pre><code>feature = sdk.features.get('feat-abc123')\nfeature.status = 'done'\nfeature.priority = 'high'\nsdk.features.update(feature)\n</code></pre></p>"},{"location":"API_REFERENCE/#batch_update","title":"batch_update()","text":"<p>Batch update multiple nodes with the same changes.</p> <p>Signature: <code>batch_update(node_ids: list[str], updates: dict[str, Any]) -&gt; int</code></p> <p>Parameters: - <code>node_ids</code> (required): List of node IDs to update - <code>updates</code> (required): Dictionary of attribute: value pairs</p> <p>Returns: Number of nodes successfully updated</p> <p>Example: <pre><code># Update multiple nodes at once\ncount = sdk.features.batch_update(\n    ['feat-1', 'feat-2', 'feat-3'],\n    {'status': 'done', 'agent_assigned': 'claude'}\n)\nprint(f\"Updated {count} features\")\n</code></pre></p>"},{"location":"API_REFERENCE/#work-management-methods","title":"Work Management Methods","text":""},{"location":"API_REFERENCE/#start","title":"start()","text":"<p>Start working on a node.</p> <p>Signature: <code>start(node_id: str, agent=None) -&gt; Node | None</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to start - <code>agent</code> (optional): Agent ID (defaults to SDK agent)</p> <p>Returns: Updated node, or None if not found</p> <p>Behavior: - Sets status to \"in-progress\" - Auto-claims for agent - Links to active session (if SessionManager available) - Logs 'FeatureStart' event - Checks WIP limits</p> <p>Raises: <code>NodeNotFoundError</code> if node not found</p> <p>Example: <pre><code>feature = sdk.features.start('feat-abc123')\n# Or with explicit agent\nfeature = sdk.features.start('feat-abc123', agent='claude')\n</code></pre></p>"},{"location":"API_REFERENCE/#complete","title":"complete()","text":"<p>Mark a node as complete.</p> <p>Signature: <code>complete(node_id: str, agent=None, transcript_id=None) -&gt; Node | None</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to complete - <code>agent</code> (optional): Agent ID (defaults to SDK agent) - <code>transcript_id</code> (optional): Transcript ID for parallel agent tracking</p> <p>Returns: Updated node, or None if not found</p> <p>Behavior: - Sets status to \"done\" - Logs 'FeatureComplete' event - Optionally releases claim - Links transcript if provided</p> <p>Raises: <code>NodeNotFoundError</code> if node not found</p> <p>Example: <pre><code># Complete a feature\nsdk.features.complete('feat-abc123')\n\n# With explicit agent\nsdk.features.complete('feat-abc123', agent='claude')\n\n# With transcript tracking\nsdk.features.complete('feat-abc123', transcript_id='sess-xyz')\n</code></pre></p>"},{"location":"API_REFERENCE/#claim","title":"claim()","text":"<p>Claim a node for an agent.</p> <p>Signature: <code>claim(node_id: str, agent=None) -&gt; Node | None</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to claim - <code>agent</code> (optional): Agent ID (defaults to SDK agent)</p> <p>Returns: Claimed node, or None if not found</p> <p>Raises: - <code>ValueError</code> if agent not provided and SDK has no agent - <code>NodeNotFoundError</code> if node not found - <code>ClaimConflictError</code> if already claimed by different agent</p> <p>Example: <pre><code># Claim a feature\nfeature = sdk.features.claim('feat-abc123')\n\n# Handle conflicts\nfrom htmlgraph.exceptions import ClaimConflictError\ntry:\n    feature = sdk.features.claim('feat-abc123')\nexcept ClaimConflictError as e:\n    print(f\"Already claimed by {e.claimed_by}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#release","title":"release()","text":"<p>Release a claimed node.</p> <p>Signature: <code>release(node_id: str, agent=None) -&gt; Node | None</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to release - <code>agent</code> (optional): Agent ID (defaults to SDK agent)</p> <p>Returns: Released node, or None if not found</p> <p>Behavior: - Clears agent_assigned - Clears claimed_at and claimed_by_session - Sets status back to \"todo\" - Logs 'FeatureRelease' event</p> <p>Raises: <code>NodeNotFoundError</code> if node not found</p> <p>Example: <pre><code>sdk.features.release('feat-abc123')\n</code></pre></p>"},{"location":"API_REFERENCE/#batch-operations","title":"Batch Operations","text":""},{"location":"API_REFERENCE/#mark_done","title":"mark_done()","text":"<p>Batch mark nodes as done.</p> <p>Signature: <code>mark_done(node_ids: list[str]) -&gt; dict[str, Any]</code></p> <p>Parameters: - <code>node_ids</code> (required): List of node IDs to mark as done</p> <p>Returns: Dict with: - <code>success_count</code>: Number of nodes successfully completed - <code>failed_ids</code>: List of node IDs that failed - <code>warnings</code>: List of warning messages</p> <p>Example: <pre><code>result = sdk.features.mark_done(['feat-001', 'feat-002', 'feat-003'])\nprint(f\"Completed {result['success_count']} of 3\")\n\nif result['failed_ids']:\n    print(f\"Failed: {result['failed_ids']}\")\n    print(f\"Reasons: {result['warnings']}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#assign","title":"assign()","text":"<p>Batch assign nodes to an agent.</p> <p>Signature: <code>assign(node_ids: list[str], agent: str) -&gt; int</code></p> <p>Parameters: - <code>node_ids</code> (required): List of node IDs to assign - <code>agent</code> (required): Agent ID to assign to</p> <p>Returns: Number of nodes assigned</p> <p>Example: <pre><code>count = sdk.features.assign(['feat-001', 'feat-002'], 'claude')\nprint(f\"Assigned {count} features to claude\")\n</code></pre></p>"},{"location":"API_REFERENCE/#deletion-methods","title":"Deletion Methods","text":""},{"location":"API_REFERENCE/#delete","title":"delete()","text":"<p>Delete a single node.</p> <p>Signature: <code>delete(node_id: str) -&gt; bool</code></p> <p>Parameters: - <code>node_id</code> (required): Node ID to delete</p> <p>Returns: True if deleted, False if not found</p> <p>Example: <pre><code>success = sdk.features.delete('feat-abc123')\nif success:\n    print(\"Deleted\")\nelse:\n    print(\"Not found\")\n</code></pre></p>"},{"location":"API_REFERENCE/#batch_delete","title":"batch_delete()","text":"<p>Delete multiple nodes in batch.</p> <p>Signature: <code>batch_delete(node_ids: list[str]) -&gt; int</code></p> <p>Parameters: - <code>node_ids</code> (required): List of node IDs to delete</p> <p>Returns: Number of nodes successfully deleted</p> <p>Example: <pre><code>count = sdk.features.batch_delete(['feat-001', 'feat-002', 'feat-003'])\nprint(f\"Deleted {count} features\")\n</code></pre></p>"},{"location":"API_REFERENCE/#builder-api","title":"Builder API","text":"<p>Collections with builder support return builder instances from <code>create()</code>.</p>"},{"location":"API_REFERENCE/#fluent-methods","title":"Fluent Methods","text":"<p>All builders provide method chaining:</p> <pre><code>feature = sdk.features.create(\"User Auth\") \\\n    .set_priority(\"high\") \\\n    .set_status(\"in-progress\") \\\n    .add_steps([\"Login\", \"Logout\", \"JWT middleware\"]) \\\n    .add_edge(\"blocks\", \"feat-other\", \"Needs auth\") \\\n    .save()\n</code></pre>"},{"location":"API_REFERENCE/#common-builder-methods","title":"Common Builder Methods","text":""},{"location":"API_REFERENCE/#set_priority","title":"set_priority()","text":"<p>Signature: <code>set_priority(priority: str) -&gt; Self</code></p> <p>Parameters: Priority level (\"low\", \"medium\", \"high\", \"critical\")</p> <p>Returns: Builder instance (for chaining)</p>"},{"location":"API_REFERENCE/#set_status","title":"set_status()","text":"<p>Signature: <code>set_status(status: str) -&gt; Self</code></p> <p>Parameters: Status (\"todo\", \"in-progress\", \"blocked\", \"done\")</p> <p>Returns: Builder instance (for chaining)</p>"},{"location":"API_REFERENCE/#add_steps","title":"add_steps()","text":"<p>Signature: <code>add_steps(steps: list[str]) -&gt; Self</code></p> <p>Parameters: List of step descriptions</p> <p>Returns: Builder instance (for chaining)</p>"},{"location":"API_REFERENCE/#add_edge","title":"add_edge()","text":"<p>Signature: <code>add_edge(relationship: str, target_id: str, title: str = None) -&gt; Self</code></p> <p>Parameters: - <code>relationship</code>: Relationship type (\"blocks\", \"depends-on\", \"related\", etc.) - <code>target_id</code>: Target node ID - <code>title</code> (optional): Link title</p> <p>Returns: Builder instance (for chaining)</p>"},{"location":"API_REFERENCE/#save","title":"save()","text":"<p>Signature: <code>save() -&gt; Node</code></p> <p>Returns: Created/updated node</p> <p>Note: MUST be called to persist the node.</p>"},{"location":"API_REFERENCE/#builder-specific-methods","title":"Builder-Specific Methods","text":"<p>Different builders provide specialized methods:</p>"},{"location":"API_REFERENCE/#featurebuilder","title":"FeatureBuilder","text":"<pre><code>feature = sdk.features.create(\"User Auth\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Login endpoint\", \"JWT middleware\"]) \\\n    .add_acceptance_criteria(\"Must support OAuth\") \\\n    .save()\n</code></pre>"},{"location":"API_REFERENCE/#bugbuilder","title":"BugBuilder","text":"<pre><code>bug = sdk.bugs.create(\"Login failure\") \\\n    .set_priority(\"critical\") \\\n    .set_severity(\"high\") \\\n    .add_reproduction_steps([\"Navigate to /login\", \"Enter credentials\", \"Click submit\"]) \\\n    .save()\n</code></pre>"},{"location":"API_REFERENCE/#spikebuilder","title":"SpikeBuilder","text":"<pre><code>spike = sdk.spikes.create(\"Investigate auth libraries\") \\\n    .set_spike_type(\"technical\") \\\n    .add_questions([\"Which library is best?\", \"Performance comparison?\"]) \\\n    .save()\n</code></pre>"},{"location":"API_REFERENCE/#trackbuilder","title":"TrackBuilder","text":"<pre><code>track = sdk.tracks.create(\"Authentication Track\") \\\n    .set_priority(\"high\") \\\n    .add_features([\"feat-001\", \"feat-002\"]) \\\n    .save()\n</code></pre>"},{"location":"API_REFERENCE/#analytics-api","title":"Analytics API","text":""},{"location":"API_REFERENCE/#dependency-analytics","title":"Dependency Analytics","text":"<p>Access via <code>sdk.dep_analytics</code>:</p>"},{"location":"API_REFERENCE/#find_bottlenecks","title":"find_bottlenecks()","text":"<p>Find tasks blocking the most work.</p> <p>Signature: <code>find_bottlenecks(top_n=5) -&gt; list[BottleneckDict]</code></p> <p>Example: <pre><code>bottlenecks = sdk.dep_analytics.find_bottlenecks(top_n=3)\nfor task in bottlenecks:\n    print(f\"{task['node_id']}: blocks {task['blocks_count']} tasks\")\n</code></pre></p>"},{"location":"API_REFERENCE/#get_parallel_work","title":"get_parallel_work()","text":"<p>Find tasks that can be worked on in parallel.</p> <p>Signature: <code>get_parallel_work(max_agents=5) -&gt; list[ParallelWorkInfo]</code></p> <p>Example: <pre><code>parallel = sdk.dep_analytics.get_parallel_work(max_agents=3)\nfor work in parallel:\n    print(f\"{work['node_id']}: {work['title']}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#recommend_next_tasks","title":"recommend_next_tasks()","text":"<p>Smart task recommendations based on dependencies.</p> <p>Signature: <code>recommend_next_tasks(agent_count=1) -&gt; list[WorkRecommendation]</code></p> <p>Example: <pre><code>recommendations = sdk.dep_analytics.recommend_next_tasks(agent_count=2)\nfor rec in recommendations:\n    print(f\"{rec['node_id']}: {rec['reason']}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#work-analytics","title":"Work Analytics","text":"<p>Access via <code>sdk.analytics</code>:</p>"},{"location":"API_REFERENCE/#get_work_type_distribution","title":"get_work_type_distribution()","text":"<p>Breakdown of work by type.</p> <p>Signature: <code>get_work_type_distribution() -&gt; dict[str, int]</code></p> <p>Example: <pre><code>distribution = sdk.analytics.get_work_type_distribution()\n# {'feature': 10, 'bug': 5, 'spike': 3, 'chore': 2}\n</code></pre></p>"},{"location":"API_REFERENCE/#get_spike_to_feature_ratio","title":"get_spike_to_feature_ratio()","text":"<p>Ratio of investigation to implementation work.</p> <p>Signature: <code>get_spike_to_feature_ratio() -&gt; float</code></p> <p>Example: <pre><code>ratio = sdk.analytics.get_spike_to_feature_ratio()\nprint(f\"Investigation ratio: {ratio:.2f}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#context-analytics","title":"Context Analytics","text":"<p>Access via <code>sdk.context</code>:</p>"},{"location":"API_REFERENCE/#get_context_usage","title":"get_context_usage()","text":"<p>Get context usage metrics for a session or feature.</p> <p>Signature: <code>get_context_usage(session_id=None, feature_id=None) -&gt; ContextUsage | None</code></p> <p>Example: <pre><code>usage = sdk.context.get_context_usage(session_id='sess-abc')\nif usage:\n    print(f\"Tokens used: {usage.tokens_used}\")\n    print(f\"Cost: ${usage.cost_usd:.4f}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#get_context_efficiency","title":"get_context_efficiency()","text":"<p>Calculate context efficiency score.</p> <p>Signature: <code>get_context_efficiency() -&gt; float</code></p> <p>Example: <pre><code>efficiency = sdk.context.get_context_efficiency()\nprint(f\"Efficiency: {efficiency:.2%}\")\n</code></pre></p>"},{"location":"API_REFERENCE/#session-management","title":"Session Management","text":""},{"location":"API_REFERENCE/#start_session","title":"start_session()","text":"<p>Start a new session.</p> <p>Signature: <code>start_session(session_id=None, title=None, agent=None) -&gt; Session</code></p> <p>Example: <pre><code>session = sdk.start_session(title=\"Authentication work\")\n</code></pre></p>"},{"location":"API_REFERENCE/#end_session","title":"end_session()","text":"<p>End a session.</p> <p>Signature: <code>end_session(session_id: str, handoff_notes=None, recommended_next=None, blockers=None) -&gt; Session</code></p> <p>Example: <pre><code>sdk.end_session(\n    session_id='sess-abc',\n    handoff_notes=\"Completed login, logout remaining\",\n    recommended_next=\"Implement logout endpoint\",\n    blockers=[\"Need JWT library decision\"]\n)\n</code></pre></p>"},{"location":"API_REFERENCE/#set_session_handoff","title":"set_session_handoff()","text":"<p>Set handoff context on active session.</p> <p>Signature: <code>set_session_handoff(handoff_notes=None, recommended_next=None, blockers=None, session_id=None) -&gt; Session | None</code></p> <p>Example: <pre><code>sdk.set_session_handoff(\n    handoff_notes=\"Auth partially done\",\n    recommended_next=\"Complete JWT middleware\"\n)\n</code></pre></p>"},{"location":"API_REFERENCE/#query-methods","title":"Query Methods","text":""},{"location":"API_REFERENCE/#advanced-querying","title":"Advanced Querying","text":"<p>Use <code>QueryBuilder</code> for complex queries:</p> <pre><code>from htmlgraph import QueryBuilder\n\n# Build complex query\nquery = QueryBuilder() \\\n    .where(\"status\", \"=\", \"todo\") \\\n    .where(\"priority\", \"in\", [\"high\", \"critical\"]) \\\n    .where(\"created\", \"&gt;\", datetime.now() - timedelta(days=7)) \\\n    .build()\n\n# Execute\nresults = sdk.features._ensure_graph().query(query)\n</code></pre>"},{"location":"API_REFERENCE/#error-handling","title":"Error Handling","text":""},{"location":"API_REFERENCE/#error-handling-patterns","title":"Error Handling Patterns","text":"<p>SDK methods follow consistent error handling by operation type:</p> Operation Type Error Behavior Example Methods Lookup Return None <code>get(id)</code> Query Return [] <code>where()</code>, <code>all()</code>, <code>filter()</code> Edit Raise Exception <code>edit(id)</code> Create Raise on Invalid <code>create(title)</code> Batch Return Results Dict <code>mark_done([ids])</code> Delete Return Bool <code>delete(id)</code>"},{"location":"API_REFERENCE/#available-exceptions","title":"Available Exceptions","text":"<pre><code>from htmlgraph.exceptions import (\n    NodeNotFoundError,      # Node with ID not found\n    ValidationError,        # Invalid input parameters\n    ClaimConflictError,     # Node already claimed by another agent\n)\n</code></pre>"},{"location":"API_REFERENCE/#error-handling-examples","title":"Error Handling Examples","text":""},{"location":"API_REFERENCE/#lookup-operations-return-none","title":"Lookup Operations (Return None)","text":"<pre><code>feature = sdk.features.get(\"nonexistent\")\nif feature:\n    print(feature.title)\nelse:\n    print(\"Not found\")\n</code></pre>"},{"location":"API_REFERENCE/#query-operations-return-empty-list","title":"Query Operations (Return Empty List)","text":"<pre><code>results = sdk.features.where(status=\"impossible\")\nfor r in results:  # Empty iteration is safe\n    print(r.title)\n</code></pre>"},{"location":"API_REFERENCE/#edit-operations-raise-exception","title":"Edit Operations (Raise Exception)","text":"<pre><code>from htmlgraph.exceptions import NodeNotFoundError\ntry:\n    with sdk.features.edit(\"nonexistent\") as f:\n        f.status = \"done\"\nexcept NodeNotFoundError:\n    print(\"Feature not found\")\n</code></pre>"},{"location":"API_REFERENCE/#create-operations-raise-on-validation","title":"Create Operations (Raise on Validation)","text":"<pre><code>from htmlgraph.exceptions import ValidationError\ntry:\n    sdk.features.create(\"\")  # Empty title\nexcept ValidationError:\n    print(\"Title required\")\n</code></pre>"},{"location":"API_REFERENCE/#batch-operations-return-results-dict","title":"Batch Operations (Return Results Dict)","text":"<pre><code>result = sdk.features.mark_done([\"feat-1\", \"missing\", \"feat-2\"])\nprint(f\"Completed {result['success_count']} of 3\")\nif result['failed_ids']:\n    print(f\"Failed: {result['failed_ids']}\")\n    print(f\"Reasons: {result['warnings']}\")\n</code></pre>"},{"location":"API_REFERENCE/#common-mistakes","title":"Common Mistakes","text":""},{"location":"API_REFERENCE/#using-list-instead-of-all","title":"Using .list() instead of .all()","text":"<pre><code># WRONG\nfeatures = sdk.features.list()  # AttributeError\n\n# CORRECT\nfeatures = sdk.features.all()\n</code></pre>"},{"location":"API_REFERENCE/#calling-complete-on-node-instance","title":"Calling complete() on Node instance","text":"<pre><code># WRONG\nfeature = sdk.features.get('feat-123')\nfeature.complete()  # AttributeError\n\n# CORRECT - Call on collection\nsdk.features.complete('feat-123')\n</code></pre>"},{"location":"API_REFERENCE/#forgetting-save-on-builder","title":"Forgetting .save() on Builder","text":"<pre><code># WRONG - Node not persisted\nfeature = sdk.features.create(\"User Auth\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Login\", \"Logout\"])\n# Feature not saved!\n\n# CORRECT - Must call .save()\nfeature = sdk.features.create(\"User Auth\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Login\", \"Logout\"]) \\\n    .save()\n</code></pre>"},{"location":"API_REFERENCE/#using-to_dict-on-older-versions","title":"Using to_dict() on older versions","text":"<pre><code># WRONG (before v0.24)\ndata = node.to_dict()  # AttributeError\n\n# CORRECT (all versions)\ndata = node.model_dump()\n\n# CORRECT (v0.24+)\ndata = node.to_dict()  # Now available as alias\n</code></pre>"},{"location":"API_REFERENCE/#not-checking-return-values","title":"Not checking return values","text":"<pre><code># RISKY - node could be None\nnode = sdk.features.get('feat-123')\nprint(node.title)  # AttributeError if not found\n\n# SAFE - Check first\nnode = sdk.features.get('feat-123')\nif node:\n    print(node.title)\nelse:\n    print(\"Not found\")\n</code></pre>"},{"location":"API_REFERENCE/#assuming-batch-operations-succeed","title":"Assuming batch operations succeed","text":"<pre><code># RISKY - Some IDs might fail\nsdk.features.mark_done(['feat-1', 'feat-2', 'feat-3'])\n\n# SAFE - Check results\nresult = sdk.features.mark_done(['feat-1', 'feat-2', 'feat-3'])\nif result['failed_ids']:\n    print(f\"Failed: {result['failed_ids']}\")\n    for warning in result['warnings']:\n        print(f\"  {warning}\")\n</code></pre>"},{"location":"API_REFERENCE/#quick-reference-card","title":"Quick Reference Card","text":"<pre><code># Initialize\nsdk = SDK(agent='my-agent')\n\n# Create with builder\nfeature = sdk.features.create(\"Title\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Step 1\", \"Step 2\"]) \\\n    .save()\n\n# Query\ntodos = sdk.features.where(status='todo', priority='high')\nall_bugs = sdk.bugs.all()\nrecent = sdk.features.filter(lambda f: f.created &gt; cutoff)\n\n# Edit\nwith sdk.features.edit('feat-123') as f:\n    f.status = 'done'\n\n# Work management\nsdk.features.start('feat-123')\nsdk.features.complete('feat-123')\nsdk.features.claim('feat-123')\nsdk.features.release('feat-123')\n\n# Batch operations\nresult = sdk.features.mark_done(['feat-1', 'feat-2'])\ncount = sdk.features.assign(['feat-1', 'feat-2'], 'claude')\n\n# Analytics\nbottlenecks = sdk.dep_analytics.find_bottlenecks()\nparallel = sdk.dep_analytics.get_parallel_work()\nrecommendations = sdk.dep_analytics.recommend_next_tasks()\n\n# Error handling\nfrom htmlgraph.exceptions import NodeNotFoundError, ClaimConflictError\ntry:\n    with sdk.features.edit('feat-123') as f:\n        f.status = 'done'\nexcept NodeNotFoundError:\n    print(\"Not found\")\n</code></pre>"},{"location":"API_REFERENCE/#see-also","title":"See Also","text":"<ul> <li>AGENTS.md - Complete SDK documentation with examples</li> <li>README.md - Project overview</li> <li>examples/ - Code examples</li> </ul>"},{"location":"ARCHITECTURE/","title":"HtmlGraph SDK Architecture","text":"<p>Design philosophy and architectural decisions behind the HtmlGraph SDK.</p>"},{"location":"ARCHITECTURE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Design Philosophy</li> <li>Component Architecture</li> <li>Design Patterns</li> <li>Common Mistakes Explained</li> <li>Event-Driven State Management</li> <li>Multi-Agent Coordination</li> </ol>"},{"location":"ARCHITECTURE/#design-philosophy","title":"Design Philosophy","text":""},{"location":"ARCHITECTURE/#core-principles","title":"Core Principles","text":"<p>HtmlGraph's SDK is built on four foundational principles:</p> <ol> <li>Immutability by Design - Nodes are data models, not state machines</li> <li>Centralized State Management - Collections manage state transitions</li> <li>Event-Driven Architecture - All changes generate auditable events</li> <li>Separation of Concerns - Clear boundaries between components</li> </ol> <p>These principles emerged from real-world usage patterns with AI agents, where: - Parallel execution is common (multiple agents working simultaneously) - Observability is critical (what changed, who changed it, when) - State consistency matters (no hidden mutations) - Developer experience needs to be intuitive (familiar patterns from Django/Rails)</p>"},{"location":"ARCHITECTURE/#component-architecture","title":"Component Architecture","text":""},{"location":"ARCHITECTURE/#node-pure-data-model","title":"Node - Pure Data Model","text":"<p>Nodes (Feature, Spike, Bug, Session, etc.) are immutable data containers based on Pydantic BaseModel.</p>"},{"location":"ARCHITECTURE/#responsibilities","title":"Responsibilities","text":"<ul> <li>Store node data (title, status, priority, steps, edges)</li> <li>Serialize to HTML and context formats</li> <li>Provide read-only properties (<code>completion_percentage</code>, <code>next_step</code>)</li> <li>NO state mutations</li> </ul>"},{"location":"ARCHITECTURE/#why-immutable","title":"Why Immutable?","text":"<p>Problem: What if Node instances could mutate themselves?</p> <pre><code># \u274c ANTI-PATTERN - If nodes were mutable\nfeature = sdk.features.get('feat-123')\nfeature.status = \"done\"  # Silent change, no events, no audit trail\nfeature.save()           # When does this happen? Who knows?\n</code></pre> <p>Issues with mutable nodes: - \ud83d\udd34 Hidden state changes - No visibility into what changed - \ud83d\udd34 No audit trails - Can't track who made changes or when - \ud83d\udd34 Thread-unsafe - Race conditions with parallel agents - \ud83d\udd34 Debugging nightmares - \"It changed but I don't know where\"</p> <p>Solution: Immutable nodes with centralized state management</p> <pre><code># \u2705 CORRECT - Immutable nodes, state changes through Collections\nfeature = sdk.features.get('feat-123')\n\n# Node is read-only - properties are transparent\nprint(feature.status)              # \"in-progress\"\nprint(feature.completion_percentage)  # 0.33\n\n# State changes go through Collection (logged, auditable, atomic)\nsdk.features.complete('feat-123')\n# \u2192 Generates FeatureComplete event\n# \u2192 Updates status, timestamp, completion\n# \u2192 Logs who, when, which session\n# \u2192 Thread-safe atomic operation\n</code></pre> <p>Benefits: - \u2705 Predictable behavior - Nodes never change unexpectedly - \u2705 Thread-safe - Safe for parallel agent access - \u2705 Audit trails - All mutations logged through Collections - \u2705 Prevents bugs - Can't accidentally modify without tracking - \u2705 Clean separation - Data model vs state machine</p>"},{"location":"ARCHITECTURE/#example-usage","title":"Example Usage","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# Nodes are read-only data containers\nfeature = sdk.features.get('feat-123')\nprint(feature.id)        # feat-123\nprint(feature.status)    # in-progress\nprint(feature.priority)  # high\n\n# \u274c WRONG - No instance methods for state changes\nfeature.complete()  # AttributeError: 'Node' has no attribute 'complete'\nfeature.start()     # AttributeError\nfeature.status = \"done\"  # Pydantic field is immutable\n\n# \u2705 CORRECT - Use Collection methods\nsdk.features.start('feat-123')\nsdk.features.complete('feat-123')\nsdk.features.update('feat-123', priority='critical')\n</code></pre>"},{"location":"ARCHITECTURE/#collection-state-management","title":"Collection - State Management","text":"<p>Collections (FeatureCollection, SpikeCollection, etc.) manage state transitions and operations.</p>"},{"location":"ARCHITECTURE/#responsibilities_1","title":"Responsibilities","text":"<ul> <li>CRUD operations - create, get, update, delete</li> <li>State transitions - start, complete, claim, release</li> <li>Event logging - via SessionManager integration</li> <li>Ownership tracking - claims, assignments, WIP limits</li> <li>Batch operations - mark_done, assign, batch_update</li> </ul>"},{"location":"ARCHITECTURE/#why-centralized","title":"Why Centralized?","text":"<p>Problem: What if state changes were decentralized?</p> <pre><code># \u274c ANTI-PATTERN - If state changes were scattered\nfeature.complete()          # Where's the event log?\nfeature.assign('agent-2')   # Where's the claiming logic?\nfeature.steps[0].complete() # Where's the validation?\n</code></pre> <p>Issues with decentralized state: - \ud83d\udd34 No single source of truth - Scattered state management - \ud83d\udd34 Inconsistent events - Some mutations logged, others not - \ud83d\udd34 No validation - Can't enforce WIP limits or claims - \ud83d\udd34 Audit gaps - Missing who/when/why information</p> <p>Solution: Centralized state management through Collections</p> <pre><code># \u2705 CORRECT - All state changes through Collection\nsdk.features.complete('feat-123')\n# Collection handles:\n# 1. Load current node\n# 2. Validate state transition (can it be completed?)\n# 3. Update status + timestamp\n# 4. Generate event (FeatureComplete)\n# 5. Log to session (who, when, which session)\n# 6. Save to HTML (atomic write)\n# 7. Update SQLite index (searchable)\n</code></pre> <p>Benefits: - \u2705 Single source of truth - All state changes in one place - \u2705 Consistent event logging - Every mutation generates events - \u2705 Validation and authorization - Enforce rules (WIP limits, claims) - \u2705 Audit trails - Full traceability (who, when, why) - \u2705 Parallel agent coordination - Claims prevent conflicts</p>"},{"location":"ARCHITECTURE/#example-usage_1","title":"Example Usage","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# State transitions\nsdk.features.start('feat-123')        # todo \u2192 in-progress\nsdk.features.complete('feat-123')     # in-progress \u2192 done\nsdk.features.claim('feat-123')        # Claim ownership\nsdk.features.release('feat-123')      # Release ownership\n\n# Batch operations\nsdk.features.mark_done(['feat-001', 'feat-002', 'feat-003'])\nsdk.features.assign(['feat-004'], agent='agent-2')\n\n# Query operations (lazy-loaded, efficient)\nhigh_priority = sdk.features.where(status='todo', priority='high')\nall_features = sdk.features.all()\nin_progress = sdk.features.filter(lambda f: f.status == 'in-progress')\n</code></pre>"},{"location":"ARCHITECTURE/#builder-fluent-creation-interface","title":"Builder - Fluent Creation Interface","text":"<p>Builders (FeatureBuilder, SpikeBuilder, etc.) provide fluent APIs for creating nodes.</p>"},{"location":"ARCHITECTURE/#responsibilities_2","title":"Responsibilities","text":"<ul> <li>Fluent method chaining - <code>.set_priority().add_steps()</code></li> <li>Validation during construction - Catch errors before save</li> <li>Return immutable Node - <code>.save()</code> returns read-only Node</li> </ul>"},{"location":"ARCHITECTURE/#why-builders","title":"Why Builders?","text":"<p>Problem: What if creation used constructors directly?</p> <pre><code># \u274c ANTI-PATTERN - Without builders\nfrom htmlgraph.models import Node\n\nfeature = Node(\n    id='feat-123',\n    title='User Auth',\n    type='feature',\n    status='todo',\n    priority='high',\n    steps=[\n        Step(description='Create endpoint', completed=False),\n        Step(description='Add tests', completed=False),\n    ],\n    edges={'blocks': [Edge(target_id='feat-456', relationship='blocks')]},\n    properties={},\n    created=datetime.now(),\n    updated=datetime.now(),\n)\n# Issues:\n# - Verbose (15+ lines for simple feature)\n# - Error-prone (manual ID generation)\n# - No validation until save\n# - No integration with SessionManager\n</code></pre> <p>Solution: Fluent Builder pattern</p> <pre><code># \u2705 CORRECT - Fluent builder\nfeature = sdk.features.create(\"User Authentication\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create login endpoint\",\n        \"Add JWT middleware\",\n        \"Write integration tests\"\n    ]) \\\n    .blocks(\"feat-456\") \\\n    .save()\n\n# Benefits:\n# - Concise (6 lines vs 20+)\n# - Readable (clear intent)\n# - Auto-generates ID\n# - Validates before save\n# - Integrates with SessionManager\n# - Returns immutable Node\n</code></pre> <p>Benefits: - \u2705 Method chaining - Fluent, readable code - \u2705 Validation during construction - Fail fast - \u2705 Clear separation - Builder vs data model - \u2705 Integration - Auto-connects to SessionManager events</p>"},{"location":"ARCHITECTURE/#example-usage_2","title":"Example Usage","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# Create with builder\nfeature = sdk.features.create(\"User Authentication\") \\\n    .set_priority(\"high\") \\\n    .set_description(\"Implement OAuth 2.0 login\") \\\n    .add_steps([\n        \"Create login endpoint\",\n        \"Add JWT middleware\",\n        \"Write integration tests\"\n    ]) \\\n    .blocks(\"feat-456\") \\\n    .blocked_by(\"spike-789\") \\\n    .save()  # Returns immutable Node\n\nprint(feature.id)        # feat-abc123 (auto-generated)\nprint(feature.status)    # todo\nprint(feature.priority)  # high\n\n# Builder validates before save\ntry:\n    bad_feature = sdk.features.create(\"\") \\\n        .set_priority(\"invalid\") \\\n        .save()\nexcept Exception as e:\n    print(f\"Validation failed: {e}\")\n</code></pre>"},{"location":"ARCHITECTURE/#design-patterns","title":"Design Patterns","text":""},{"location":"ARCHITECTURE/#django-orm-influence","title":"Django ORM Influence","text":"<p>HtmlGraph's Collections follow Django ORM naming conventions for familiarity.</p>"},{"location":"ARCHITECTURE/#why-all-not-list","title":"Why <code>.all()</code> not <code>.list()</code>?","text":"<p>Common confusion:</p> <pre><code># Many developers expect:\nfeatures = sdk.features.list()  # \u274c AttributeError\n\n# But the API is:\nfeatures = sdk.features.all()   # \u2705 Correct\n</code></pre> <p>Why <code>.all()</code> instead of <code>.list()</code>?</p> <ol> <li>Semantic clarity - \"Get ALL items\" vs type-based \"list\"</li> <li><code>.all()</code> = \"give me all features\" (intent)</li> <li> <p><code>.list()</code> = \"return a list type\" (implementation detail)</p> </li> <li> <p>Django/Rails familiarity - Developers recognize pattern    <pre><code># Django QuerySet API\nfeatures = Feature.objects.all()\nhigh_priority = Feature.objects.filter(priority='high')\n\n# HtmlGraph Collection API (same pattern!)\nfeatures = sdk.features.all()\nhigh_priority = sdk.features.where(priority='high')\n</code></pre></p> </li> <li> <p>Pairs naturally - Works with <code>.where()</code> and <code>.filter()</code> <pre><code>sdk.features.all()                      # All features\nsdk.features.where(status='todo')       # Filtered subset\nsdk.features.filter(lambda f: ...)      # Custom filter\n</code></pre></p> </li> <li> <p>Lazy evaluation future - <code>.all()</code> can be lazy (Django-style)    <pre><code># Future: Could return lazy QuerySet-like object\nfeatures = sdk.features.all()  # Doesn't load yet\ncount = features.count()        # Loads only count\nfor f in features:              # Iterates without loading all\n    print(f.title)\n</code></pre></p> </li> </ol>"},{"location":"ARCHITECTURE/#pattern-comparison","title":"Pattern Comparison","text":"<pre><code># Django ORM\nfrom django.db import models\n\nclass Feature(models.Model):\n    title = models.CharField(max_length=200)\n    status = models.CharField(max_length=50)\n\n# Query\nfeatures = Feature.objects.all()\ntodos = Feature.objects.filter(status='todo')\nhigh_priority = Feature.objects.filter(priority='high')\n\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n# HtmlGraph SDK (same pattern!)\nfrom htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# Query (same API!)\nfeatures = sdk.features.all()\ntodos = sdk.features.where(status='todo')\nhigh_priority = sdk.features.where(priority='high')\n</code></pre>"},{"location":"ARCHITECTURE/#event-driven-state-management","title":"Event-Driven State Management","text":"<p>All state changes generate events for observability and coordination.</p>"},{"location":"ARCHITECTURE/#event-flow","title":"Event Flow","text":"<pre><code>User Code                 Collection              SessionManager         Storage\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500              \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500         \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nsdk.features.complete()\n    \u2502\n    \u251c\u2500\u2192 Load node         (from HTML + SQLite)\n    \u2502\n    \u251c\u2500\u2192 Validate          (can it be completed?)\n    \u2502\n    \u251c\u2500\u2192 Update state      status = \"done\"\n    \u2502                     timestamp = now()\n    \u2502\n    \u251c\u2500\u2192 Generate event \u2500\u2500\u2500\u2192 FeatureComplete\n    \u2502                          \u2502\n    \u2502                          \u251c\u2500\u2192 Log event\n    \u2502                          \u2502   (who, when, session)\n    \u2502                          \u2502\n    \u2502                          \u2514\u2500\u2192 Update session\n    \u2502                              (track completion)\n    \u2502\n    \u2514\u2500\u2192 Save to disk \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 HTML file\n                                                 SQLite index\n</code></pre>"},{"location":"ARCHITECTURE/#event-types","title":"Event Types","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# FeatureCreate event\nfeature = sdk.features.create(\"User Auth\").save()\n# Event: {\"type\": \"FeatureCreate\", \"agent\": \"claude\", \"feature_id\": \"feat-123\"}\n\n# FeatureStart event\nsdk.features.start('feat-123')\n# Event: {\"type\": \"FeatureStart\", \"agent\": \"claude\", \"feature_id\": \"feat-123\"}\n\n# FeatureComplete event\nsdk.features.complete('feat-123')\n# Event: {\"type\": \"FeatureComplete\", \"agent\": \"claude\", \"feature_id\": \"feat-123\"}\n\n# All events include:\n# - timestamp (when)\n# - agent (who)\n# - session_id (which session)\n# - transcript_id (which conversation)\n</code></pre>"},{"location":"ARCHITECTURE/#benefits","title":"Benefits","text":"<ul> <li>\u2705 Full audit trail - Who did what, when, and why</li> <li>\u2705 Multi-agent coordination - Agents can see each other's work</li> <li>\u2705 Observability dashboards - Visualize progress, bottlenecks</li> <li>\u2705 Debugging - Replay events to understand state changes</li> <li>\u2705 Analytics - Time-series data, velocity metrics</li> </ul>"},{"location":"ARCHITECTURE/#common-mistakes-explained","title":"Common Mistakes Explained","text":""},{"location":"ARCHITECTURE/#mistake-1-why-doesnt-nodecomplete-exist","title":"Mistake 1: Why doesn't <code>Node.complete()</code> exist?","text":"<p>The Error:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\nfeature = sdk.features.get('feat-123')\n\n# \u274c This fails\nfeature.complete()\n# AttributeError: 'Node' object has no attribute 'complete'\n</code></pre> <p>Why this design?</p> <p>Architecture Decision: State mutations through Collections enforce:</p> <ol> <li>Event logging - For audit trails</li> <li>Ownership validation - Respect claims</li> <li>Parallel agent coordination - Prevent conflicts</li> <li>SessionManager integration - Track activity</li> </ol> <p>Correct pattern:</p> <pre><code># \u2705 CORRECT - State changes through Collection\nsdk.features.complete('feat-123')\n\n# Collection handles:\n# - Validates node exists\n# - Checks if claimed by another agent\n# - Updates status + timestamp\n# - Generates FeatureComplete event\n# - Logs to active session\n# - Saves atomically\n</code></pre> <p>Reference: See bug-3a2bf73c - Node objects have no <code>.complete()</code> instance method</p>"},{"location":"ARCHITECTURE/#mistake-2-why-all-instead-of-list","title":"Mistake 2: Why <code>.all()</code> instead of <code>.list()</code>?","text":"<p>The Error:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# \u274c This fails\nfeatures = sdk.features.list()\n# AttributeError: 'FeatureCollection' object has no attribute 'list'\n</code></pre> <p>Why this design?</p> <p>Design Choice: Django ORM naming for:</p> <ol> <li>Semantic clarity - \"Get all\" vs \"return list type\"</li> <li>Developer familiarity - Recognized pattern</li> <li>Consistency - Pairs with <code>.where()</code> / <code>.filter()</code></li> <li>Future lazy evaluation - Can optimize without breaking API</li> </ol> <p>Correct pattern:</p> <pre><code># \u2705 CORRECT - Use .all() (Django-style)\nfeatures = sdk.features.all()\n\n# Also available:\ntodos = sdk.features.where(status='todo')\ncustom = sdk.features.filter(lambda f: f.priority == 'high')\n</code></pre> <p>Reference: See bug-8b6e9736 - Collection objects use <code>.all()</code> not <code>.list()</code></p>"},{"location":"ARCHITECTURE/#mistake-3-why-cant-i-edit-node-properties-directly","title":"Mistake 3: Why can't I edit Node properties directly?","text":"<p>The Error:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\nfeature = sdk.features.get('feat-123')\n\n# \u274c This fails\nfeature.status = \"done\"\n# pydantic_core._pydantic_core.ValidationError: Instance is frozen\n</code></pre> <p>Why this design?</p> <p>Immutability Principle: Nodes are frozen Pydantic models to prevent: - Silent state changes - Missing audit trails - Race conditions</p> <p>Correct pattern:</p> <pre><code># \u2705 CORRECT - Use edit() context manager\nwith sdk.features.edit('feat-123') as feature:\n    feature.status = \"done\"\n    feature.priority = \"high\"\n# Auto-saves on exit, generates events\n\n# Or direct update\nsdk.features.update('feat-123', status='done', priority='high')\n</code></pre>"},{"location":"ARCHITECTURE/#mistake-4-why-do-builders-return-node-not-builder","title":"Mistake 4: Why do builders return <code>Node</code>, not <code>Builder</code>?","text":"<p>The Confusion:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# .save() returns Node, not Builder\nfeature = sdk.features.create(\"User Auth\").save()\n\n# \u274c Can't chain after .save()\nfeature.set_priority(\"high\")  # AttributeError\n</code></pre> <p>Why this design?</p> <p>Separation of Concerns: - Builder = Construction phase (mutable, chainable) - Node = Data model (immutable, read-only)</p> <p><code>.save()</code> is the transition point from construction to data:</p> <pre><code># Construction phase (Builder)\nbuilder = sdk.features.create(\"User Auth\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Create endpoint\", \"Add tests\"])\n\n# Transition: Builder \u2192 Node\nfeature = builder.save()\n\n# Data phase (Node)\nprint(feature.id)        # Read-only access\nprint(feature.status)    # Read-only access\n</code></pre> <p>Correct pattern:</p> <pre><code># \u2705 Build completely, then save\nfeature = sdk.features.create(\"User Auth\") \\\n    .set_priority(\"high\") \\\n    .set_description(\"OAuth 2.0\") \\\n    .add_steps([\"Create endpoint\", \"Add tests\"]) \\\n    .save()  # Returns immutable Node\n\n# Use Collection methods for state changes\nsdk.features.start(feature.id)\n</code></pre>"},{"location":"ARCHITECTURE/#event-driven-state-management_1","title":"Event-Driven State Management","text":""},{"location":"ARCHITECTURE/#event-schema","title":"Event Schema","text":"<p>All HtmlGraph events follow a consistent schema:</p> <pre><code>{\n    \"type\": \"FeatureComplete\",      # Event type\n    \"timestamp\": \"2025-01-03T...\",  # ISO 8601 timestamp\n    \"agent\": \"claude\",              # Agent who triggered event\n    \"session_id\": \"sess-abc123\",    # Session ID\n    \"transcript_id\": \"tx-xyz789\",   # Conversation/transcript ID\n    \"feature_id\": \"feat-456\",       # Entity ID\n    \"data\": {                       # Event-specific data\n        \"previous_status\": \"in-progress\",\n        \"new_status\": \"done\"\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#event-storage","title":"Event Storage","text":"<p>Events are stored in multiple locations for different use cases:</p> <ol> <li>JSONL event log - <code>.htmlgraph/events/*.jsonl</code></li> <li>Append-only log</li> <li>Time-ordered</li> <li> <p>Fast sequential reads</p> </li> <li> <p>SQLite database - <code>.htmlgraph/graph.db</code></p> </li> <li>Indexed for queries</li> <li>Fast lookups</li> <li> <p>Aggregations</p> </li> <li> <p>Session HTML - <code>.htmlgraph/sessions/*.html</code></p> </li> <li>Human-readable</li> <li>Visualizable in dashboard</li> <li>Shareable</li> </ol>"},{"location":"ARCHITECTURE/#event-query-api","title":"Event Query API","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# Get events for a feature\nevents = sdk.analytics.get_events(\n    entity_type='feature',\n    entity_id='feat-123'\n)\n\nfor event in events:\n    print(f\"{event.timestamp}: {event.type} by {event.agent}\")\n\n# Cross-session analytics\nvelocity = sdk.cross_session.get_velocity_metrics(days=7)\nprint(f\"Features completed: {velocity['features_completed']}\")\n</code></pre>"},{"location":"ARCHITECTURE/#multi-agent-coordination","title":"Multi-Agent Coordination","text":""},{"location":"ARCHITECTURE/#claims-and-ownership","title":"Claims and Ownership","text":"<p>HtmlGraph supports multi-agent coordination through claims:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# Agent 1 claims a feature\nsdk.features.claim('feat-123')\n# \u2192 Generates FeatureClaim event\n# \u2192 Sets agent_assigned = \"claude\"\n# \u2192 Prevents other agents from claiming\n\n# Agent 2 tries to claim (fails)\nsdk2 = SDK(agent='copilot')\ntry:\n    sdk2.features.claim('feat-123')\nexcept ClaimConflictError:\n    print(\"Already claimed by claude\")\n\n# Agent 1 completes and releases\nsdk.features.complete('feat-123')\nsdk.features.release('feat-123')\n# \u2192 Now available for other agents\n</code></pre>"},{"location":"ARCHITECTURE/#wip-limits","title":"WIP Limits","text":"<p>SessionManager enforces work-in-progress limits to prevent overload:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude')\n\n# Default WIP limit = 3 features\nsdk.features.start('feat-001')  # \u2705 OK (1 in progress)\nsdk.features.start('feat-002')  # \u2705 OK (2 in progress)\nsdk.features.start('feat-003')  # \u2705 OK (3 in progress)\nsdk.features.start('feat-004')  # \u274c Error: WIP limit exceeded\n\n# Complete one to free up slot\nsdk.features.complete('feat-001')\nsdk.features.start('feat-004')  # \u2705 OK now (3 in progress)\n</code></pre>"},{"location":"ARCHITECTURE/#parallel-work-recommendations","title":"Parallel Work Recommendations","text":"<p>HtmlGraph can recommend parallelizable work for multi-agent teams:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='orchestrator')\n\n# Find work for 3 agents\nrecommendations = sdk.dep_analytics.recommend_next_tasks(agent_count=3)\n\nfor rec in recommendations:\n    print(f\"Agent {rec['agent_slot']}: {rec['task_id']}\")\n    print(f\"  Priority: {rec['priority']}\")\n    print(f\"  Estimated effort: {rec['estimated_hours']}h\")\n    print(f\"  Blockers: {rec['blocker_count']}\")\n\n# Output:\n# Agent 1: feat-123\n#   Priority: critical\n#   Estimated effort: 2h\n#   Blockers: 0\n# Agent 2: feat-456\n#   Priority: high\n#   Estimated effort: 4h\n#   Blockers: 0\n# Agent 3: spike-789\n#   Priority: medium\n#   Estimated effort: 1h\n#   Blockers: 0\n</code></pre>"},{"location":"ARCHITECTURE/#architecture-diagrams","title":"Architecture Diagrams","text":""},{"location":"ARCHITECTURE/#component-relationships","title":"Component Relationships","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         SDK                             \u2502\n\u2502  (Main entry point for AI agents)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                   \u2502                   \u2502\n        \u25bc                   \u25bc                   \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Collections  \u2502    \u2502   Builders   \u2502    \u2502  Analytics   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 - Features   \u2502    \u2502 - Feature    \u2502    \u2502 - Dependency \u2502\n\u2502 - Spikes     \u2502    \u2502 - Spike      \u2502    \u2502 - Velocity   \u2502\n\u2502 - Bugs       \u2502    \u2502 - Bug        \u2502    \u2502 - Context    \u2502\n\u2502 - Sessions   \u2502    \u2502 - Track      \u2502    \u2502 - Cross-     \u2502\n\u2502 - Tracks     \u2502    \u2502              \u2502    \u2502   Session    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                   \u2502                   \u2502\n        \u2502                   \u2502                   \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502   SessionManager     \u2502\n                \u2502  (Event logging,     \u2502\n                \u2502   state tracking)    \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502                       \u2502\n                \u25bc                       \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502  HtmlGraph   \u2502        \u2502  EventLog    \u2502\n        \u2502  (Storage)   \u2502        \u2502  (JSONL)     \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ARCHITECTURE/#state-transition-flow","title":"State Transition Flow","text":"<pre><code>Builder Phase              Node Phase              Collection Phase\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500              \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500              \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ncreate(\"title\")\n   \u2502\n   \u251c\u2500\u2192 set_priority()\n   \u2502\n   \u251c\u2500\u2192 add_steps()\n   \u2502\n   \u2514\u2500\u2192 save() \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Node (immutable) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 start(id)\n                             \u2502                         \u2502\n                             \u2502                         \u251c\u2500\u2192 Load\n                             \u2502                         \u2502\n                             \u2502                         \u251c\u2500\u2192 Validate\n                             \u2502                         \u2502\n                             \u25bc                         \u251c\u2500\u2192 Update\n                          Read-only                    \u2502\n                          Properties                   \u2514\u2500\u2192 Event \u2500\u2500\u2192 Log\n                             \u2502\n                             \u2502\n                             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 complete(id)\n                                                        \u2502\n                                                        \u2514\u2500\u2192 Event \u2500\u2500\u2192 Log\n</code></pre>"},{"location":"ARCHITECTURE/#summary","title":"Summary","text":"<p>HtmlGraph's architecture follows three key principles:</p> <ol> <li>Immutable Nodes - Data models are read-only, preventing silent mutations</li> <li>Centralized State - Collections manage all state transitions with events</li> <li>Event-Driven - Every change is logged for observability and coordination</li> </ol> <p>This design enables: - \u2705 Multi-agent coordination - Claims, WIP limits, parallel work - \u2705 Full observability - Complete audit trails, analytics - \u2705 Thread-safe operations - No race conditions - \u2705 Familiar patterns - Django-style ORM API - \u2705 Fluent builders - Readable, chainable construction</p> <p>For more details: - API Reference - Complete API documentation - SDK Cheat Sheet - Quick reference - Planning Workflow - Real-world usage patterns - AGENTS.md - AI agent integration guide</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/","title":"Case Study: Intelligent Orchestration ROI","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#70-hours-of-implementation-in-minutes-through-strategic-ai-model-selection-and-parallel-execution","title":"70 Hours of Implementation in Minutes Through Strategic AI Model Selection and Parallel Execution","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#executive-summary","title":"Executive Summary","text":"<p>The Challenge: Implement a comprehensive 6-phase HeadlessSpawner system requiring 33 individual tasks across architecture, design, and implementation - estimated at 70 hours of sequential development work.</p> <p>The Solution: Strategic orchestration using intelligent AI model selection and parallel execution: - Opus for deep architectural reasoning (Phases 1-2) - Sonnet for balanced complexity work (Phase 3) - Haiku for high-volume implementation (Phases 4-6)</p> <p>The Results: - \u23f1\ufe0f Time: 70 hours \u2192 minutes (\u22484,200x speedup) - \ud83d\udcb0 Cost: $10,500 \u2192 $5 (\u22482,100x reduction) - \ud83d\udcca Quality: Higher through strategic capability matching - \ud83c\udfaf Context Efficiency: 79.6% reduction (4,753 \u2192 969 tokens)</p> <p>Key Insight: Model selection + parallelization = exponential ROI. Not every task requires top-tier reasoning - strategic matching of AI capability to work complexity unlocks transformative efficiency gains.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#1-the-challenge","title":"1. The Challenge","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#original-implementation-plan","title":"Original Implementation Plan","text":"<p>6 Phases, 33 Tasks, 70 Hours:</p> Phase Description Tasks Time Estimate Complexity 1 System Prompt Reduction 6 tasks 3.5 hours Very High 2 Skill Creation 4 tasks 2 hours Very High 3 Spawner Agents 5 tasks 11 hours High 4 Hooks 6 tasks 3.5 hours Medium 5 Model Selection 6 tasks 3.5 hours Medium 6 CLI Implementation 6 tasks 3.5 hours Medium TOTAL 33 tasks \u224870 hours"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#traditional-development-approach","title":"Traditional Development Approach","text":"<p>Sequential Execution by Single Developer: <pre><code>Phase 1 \u2192 Phase 2 \u2192 Phase 3 \u2192 Phase 4 \u2192 Phase 5 \u2192 Phase 6\n  3.5h     2h        11h       3.5h      3.5h      3.5h\n\nTotal Timeline: ~2 weeks\nTotal Cost: 70 hours \u00d7 $150/hr = $10,500\nQuality Risk: Developer fatigue, context switching overhead\n</code></pre></p> <p>Problems with Sequential Approach: - \u274c Linear time scaling (no parallelization) - \u274c Single point of failure (developer availability) - \u274c Context switching overhead between phases - \u274c Fatigue degrading quality over time - \u274c No capability matching (same developer for all complexity levels)</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#2-the-strategy","title":"2. The Strategy","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#core-principles","title":"Core Principles","text":"<ol> <li>Strategic Model Selection - Match AI capability to work complexity</li> <li>Parallel Execution - Launch independent work streams simultaneously</li> <li>Clear Task Delegation - Each agent receives precise instructions</li> <li>Independent Contexts - No interference between concurrent agents</li> <li>Quality-Complexity Alignment - Premium models for premium challenges</li> </ol>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#model-selection-matrix","title":"Model Selection Matrix","text":"Phase Work Type Complexity Model Choice Reasoning Cost Tier 1-2 System Prompt + Progressive Disclosure Skills Very High Claude Opus Deep architectural reasoning, novel design patterns, foundation work affecting all downstream phases Premium 3 Spawner Agents with API Integration High Claude Sonnet Balanced complexity, API integration patterns, fallback strategies, moderate problem-solving Mid-Tier 4-6 Hooks, Model Selection, CLI Implementation Medium Claude Haiku Clear implementation patterns, straightforward integration, high-volume execution Budget"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#parallel-execution-architecture","title":"Parallel Execution Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     ORCHESTRATOR                             \u2502\n\u2502  (Strategic Planning, Model Selection, Task Delegation)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                \u2502                \u2502\n            \u2502 Parallel       \u2502 Parallel       \u2502 Parallel\n            \u2502 Delegation     \u2502 Delegation     \u2502 Delegation\n            \u25bc                \u25bc                \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  OPUS AGENT       \u2502 \u2502 SONNET AGENT \u2502 \u2502  HAIKU AGENT     \u2502\n\u2502  Phases 1-2       \u2502 \u2502 Phase 3      \u2502 \u2502  Phases 4-6      \u2502\n\u2502                   \u2502 \u2502              \u2502 \u2502                  \u2502\n\u2502 \u2022 System Prompt   \u2502 \u2502 \u2022 Spawner    \u2502 \u2502 \u2022 Hooks          \u2502\n\u2502 \u2022 Skills Design   \u2502 \u2502   Agents     \u2502 \u2502 \u2022 Model Select   \u2502\n\u2502 \u2022 Architecture    \u2502 \u2502 \u2022 API Integ  \u2502 \u2502 \u2022 CLI Impl       \u2502\n\u2502                   \u2502 \u2502 \u2022 Fallbacks  \u2502 \u2502                  \u2502\n\u2502 Time: Minutes     \u2502 \u2502 Time: Minutes\u2502 \u2502 Time: Minutes    \u2502\n\u2502 Cost: $$$ (25%)   \u2502 \u2502 Cost: $$ (35)\u2502 \u2502 Cost: $ (40%)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                \u2502                \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502\n                    Concurrent Completion\n                             \u2502\n                             \u25bc\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502   All Phases Complete          \u2502\n            \u2502   Total Time: MINUTES          \u2502\n            \u2502   Total Cost: ~$5              \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Advantages: - \u2705 No Sequential Bottlenecks - All phases run concurrently - \u2705 Independent Contexts - Each agent has dedicated workspace - \u2705 Optimized Cost - 40% of work uses budget model (Haiku) - \u2705 Quality Preservation - Critical architecture uses premium model (Opus) - \u2705 Time Multiplication - 3 agents working simultaneously = 3x throughput minimum</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#3-the-implementation","title":"3. The Implementation","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#delegation-pattern","title":"Delegation Pattern","text":"<pre><code>from htmlgraph import SDK\n\n# Initialize orchestrator context\nsdk = SDK(agent='orchestrator')\n\n# Phase 1-2: Opus (Deep Architectural Reasoning)\n# - System prompt reduction (progressive disclosure)\n# - Skill creation with advanced patterns\n# - Foundation for all downstream work\nTask(\n    model=\"opus\",\n    prompt=\"\"\"\n    Reduce system prompt and create progressive disclosure skills:\n\n    Phase 1: System Prompt Reduction\n    1. Analyze current SKILL.md structure (4,753 tokens)\n    2. Extract core workflow (spawn_explorer, spawn_analyzer, spawn_coordinator)\n    3. Reduce to minimal directive (target: &lt;1,000 tokens)\n    4. Design progressive disclosure triggers\n\n    Phase 2: Skill Creation\n    1. Create spawn-explorer.skill.md (detailed explorer patterns)\n    2. Create spawn-analyzer.skill.md (analysis workflows)\n    3. Create spawn-coordinator.skill.md (coordination patterns)\n    4. Design auto-activation triggers for each skill\n\n    Requirements:\n    - Maintain full functionality with reduced tokens\n    - Progressive disclosure on complexity/keywords\n    - Clear skill boundaries and responsibilities\n    - Comprehensive examples in each skill\n\n    Deliverables:\n    - Updated SKILL.md (&lt;1,000 tokens)\n    - 3 new skill files with progressive disclosure\n    - Activation trigger documentation\n    \"\"\",\n    subagent_type=\"general-purpose\"\n)\n\n# Phase 3: Sonnet (Balanced Complexity)\n# - Spawner agent implementations\n# - API integration patterns\n# - Fallback strategies\nTask(\n    model=\"sonnet\",\n    prompt=\"\"\"\n    Create spawner agents with API integration:\n\n    1. Create explorer-spawner.agent.md\n       - Auto-triggers on \"explore\", \"search\", \"find in codebase\"\n       - Integration with Grep, Glob, Read tools\n       - Comprehensive search strategies\n\n    2. Create analyzer-spawner.agent.md\n       - Auto-triggers on \"analyze\", \"understand\", \"explain\"\n       - Deep codebase analysis patterns\n       - Architecture documentation workflows\n\n    3. Create coordinator-spawner.agent.md\n       - Auto-triggers on \"coordinate\", \"orchestrate\", \"parallel\"\n       - Multi-agent task delegation\n       - Result aggregation patterns\n\n    4. Implement fallback strategies\n       - Direct tool use when spawning fails\n       - Graceful degradation patterns\n\n    5. Add comprehensive examples to each agent\n\n    Requirements:\n    - Clear auto-activation triggers\n    - Integration with existing tools\n    - Fallback to direct execution\n    - Real-world usage examples\n\n    Deliverables:\n    - 3 spawner agent implementations\n    - Fallback strategy documentation\n    - Integration test patterns\n    \"\"\",\n    subagent_type=\"general-purpose\"\n)\n\n# Phase 4-6: Haiku (High-Volume Implementation)\n# - Pre/Post-tool hooks for tracking\n# - Model selection system\n# - CLI commands and utilities\nTask(\n    model=\"haiku\",\n    prompt=\"\"\"\n    Implement hooks, model selection, and CLI:\n\n    Phase 4: Hooks\n    1. Pre-tool hook for spawner detection\n    2. Post-tool hook for result capture\n    3. Integration with HtmlGraph tracking\n\n    Phase 5: Model Selection\n    1. Complexity detection system\n    2. Model recommendation engine\n    3. Cost optimization patterns\n\n    Phase 6: CLI Implementation\n    1. htmlgraph spawn-explorer command\n    2. htmlgraph spawn-analyzer command\n    3. htmlgraph spawn-coordinator command\n    4. Help text and documentation\n\n    Requirements:\n    - Follow existing hook patterns\n    - Use established CLI structure\n    - Comprehensive error handling\n    - Integration tests for each component\n\n    Deliverables:\n    - Hook implementations in .claude/hooks/\n    - Model selection utilities\n    - CLI commands with help text\n    - Integration tests\n    \"\"\",\n    subagent_type=\"general-purpose\"\n)\n\n# All three delegations in ONE message = true parallelism\n# No sequential dependencies = concurrent execution\n# Strategic model matching = optimized cost + quality\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#task-id-pattern-for-coordination","title":"Task ID Pattern for Coordination","text":"<p>For more complex scenarios requiring result aggregation:</p> <pre><code>from htmlgraph.orchestration import delegate_with_id, get_results_by_task_id\n\n# Generate unique task IDs for tracking\nopus_id, opus_prompt = delegate_with_id(\n    \"System Prompt + Skills\",\n    \"Reduce system prompt and create progressive disclosure skills...\",\n    \"general-purpose\"\n)\n\nsonnet_id, sonnet_prompt = delegate_with_id(\n    \"Spawner Agents\",\n    \"Create spawner agents with API integration...\",\n    \"general-purpose\"\n)\n\nhaiku_id, haiku_prompt = delegate_with_id(\n    \"Implementation\",\n    \"Implement hooks, model selection, and CLI...\",\n    \"general-purpose\"\n)\n\n# Delegate all in parallel\nTask(model=\"opus\", prompt=opus_prompt, description=f\"{opus_id}: System Prompt + Skills\")\nTask(model=\"sonnet\", prompt=sonnet_prompt, description=f\"{sonnet_id}: Spawner Agents\")\nTask(model=\"haiku\", prompt=haiku_prompt, description=f\"{haiku_id}: Implementation\")\n\n# Retrieve results independently (order doesn't matter)\nopus_results = get_results_by_task_id(sdk, opus_id, timeout=300)\nsonnet_results = get_results_by_task_id(sdk, sonnet_id, timeout=300)\nhaiku_results = get_results_by_task_id(sdk, haiku_id, timeout=300)\n\n# Aggregate findings\nif all([opus_results[\"success\"], sonnet_results[\"success\"], haiku_results[\"success\"]]):\n    print(\"\u2705 All phases complete - integration ready\")\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#4-the-results","title":"4. The Results","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#time-savings","title":"Time Savings","text":"<p>Estimated vs Actual:</p> Metric Traditional (Sequential) Orchestrated (Parallel) Improvement Execution Time 70 hours Minutes \u22484,200x faster Timeline 2 weeks &lt;1 hour \u2248280x faster Context Switching High (6 phase switches) None (parallel) Eliminated Fatigue Impact Increasing over time None (AI agents) Eliminated <p>Time Breakdown: <pre><code>Traditional Approach:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Phase 1 \u2502 Phase 2 \u2502 Phase 3 \u2502 Phase 4 \u2502 Phase 5 \u2502 Phase 6 \u2502\n\u2502  3.5h   \u2502   2h    \u2502   11h   \u2502  3.5h   \u2502  3.5h   \u2502  3.5h   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 70 hours sequential\n\nOrchestrated Approach:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Opus (1-2) + Sonnet (3) + Haiku (4-6) \u2502\n\u2502          All Parallel: Minutes          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: Minutes concurrent\n</code></pre></p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#context-efficiency","title":"Context Efficiency","text":"<p>System Prompt Optimization: - Before: 4,753 tokens (monolithic SKILL.md) - After: 969 tokens (core workflow + progressive disclosure) - Reduction: 79.6% fewer tokens - Impact: Faster loading, lower costs, preserved functionality</p> <p>Progressive Disclosure Working: - Core workflow always available (minimal tokens) - Detailed patterns loaded on-demand (skill activation) - Total knowledge preserved, context cost optimized</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#quality-improvements","title":"Quality Improvements","text":"<p>Strategic Capability Matching:</p> Phase Complexity Model Used Quality Outcome 1-2 Very High (Architecture) Opus \u2705 Novel progressive disclosure design, robust system prompt reduction 3 High (Integration) Sonnet \u2705 Clean API patterns, comprehensive fallbacks 4-6 Medium (Implementation) Haiku \u2705 Efficient execution, clear integration <p>Quality vs Traditional Development: - \u2705 No Fatigue Degradation - AI maintains consistency throughout - \u2705 Specialist Matching - Right capability for each challenge - \u2705 Concurrent Review - Multiple perspectives on same problem - \u2705 Pattern Consistency - Follows established conventions</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#cost-optimization","title":"Cost Optimization","text":"<p>Model Usage Distribution:</p> Model Work Share Cost Tier Example Rate Phase Cost Haiku 40% (Phases 4-6) Budget $0.25/1M tokens input ~$1.50 Sonnet 35% (Phase 3) Mid-Tier $3/1M tokens input ~$2.00 Opus 25% (Phases 1-2) Premium $15/1M tokens input ~$1.50 TOTAL ~$5 <p>ROI Calculation: <pre><code>Traditional Approach:\n  70 hours \u00d7 $150/hr = $10,500\n\nOrchestrated Approach:\n  API Costs \u2248 $5\n\nSavings: $10,495 (99.95% cost reduction)\nROI: 2,099:1\n</code></pre></p> <p>Strategic Cost Decisions: - 40% of work uses cheapest model (Haiku) - appropriate for clear patterns - 35% uses mid-tier model (Sonnet) - balanced quality/cost for integration - 25% uses premium model (Opus) - justified for critical architecture - Total cost optimized while maintaining quality gates</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#5-decision-framework","title":"5. Decision Framework","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#when-to-use-each-model","title":"When to Use Each Model","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#claude-opus-premium-tier","title":"Claude Opus (Premium Tier)","text":"<p>Use When: - \u2705 Architectural design and system-level decisions - \u2705 Complex reasoning with novel problem-solving - \u2705 Foundation work (everything else depends on it) - \u2705 Innovation required (no clear existing patterns) - \u2705 Quality is critical, cost is secondary</p> <p>Characteristics: - Deep multi-step reasoning - Novel pattern creation - System-level thinking - Long-term impact considerations</p> <p>Examples: - System architecture design - Progressive disclosure framework design - Novel API design patterns - Security architecture decisions - Performance optimization strategies (architectural level)</p> <p>Cost Consideration: - Most expensive per token - Justified when work quality impacts all downstream phases - Should represent 20-30% of total work in well-structured projects</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#claude-sonnet-balanced-tier","title":"Claude Sonnet (Balanced Tier)","text":"<p>Use When: - \u2705 Moderate complexity requiring balanced reasoning - \u2705 API integration and middleware development - \u2705 Business logic implementation - \u2705 Quality matters, speed matters too - \u2705 Some problem-solving required, but patterns exist</p> <p>Characteristics: - Solid reasoning capabilities - Fast execution speed - Good pattern recognition - Balanced cost/quality ratio</p> <p>Examples: - REST API implementations - Agent system integrations - Fallback strategy design - State management logic - Moderate refactoring tasks</p> <p>Cost Consideration: - Mid-tier pricing - Good default choice for most development tasks - Should represent 30-40% of work in balanced projects</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#claude-haiku-budget-tier","title":"Claude Haiku (Budget Tier)","text":"<p>Use When: - \u2705 Clear implementation patterns exist - \u2705 Straightforward execution tasks - \u2705 High-volume repetitive work - \u2705 Cost efficiency is critical - \u2705 Fast iteration needed - \u2705 Low reasoning complexity</p> <p>Characteristics: - Fast execution - Low cost per token - Excellent for pattern following - High throughput</p> <p>Examples: - CLI command implementations - Hook integrations (following existing patterns) - Configuration file generation - Documentation formatting - Test boilerplate creation - Utility function implementations</p> <p>Cost Consideration: - Cheapest per token - Excellent for bulk work - Should represent 30-50% of work when architecture is solid</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#decision-tree","title":"Decision Tree","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Is this work foundational? (Other work depends) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n    Yes \u2500\u2500\u2524\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Does it require novel design/architecture?  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n    Yes \u2500\u2500\u253c\u2500\u2500\u25b6 USE OPUS\n          \u2502\n    No \u2500\u2500\u2500\u2524\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Are there clear patterns to follow?         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n    No \u2500\u2500\u2500\u253c\u2500\u2500\u25b6 USE SONNET (requires some reasoning)\n          \u2502\n    Yes \u2500\u2500\u2524\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Is this high-volume or repetitive work?     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n    Yes \u2500\u2500\u253c\u2500\u2500\u25b6 USE HAIKU (fast + cheap)\n          \u2502\n    No \u2500\u2500\u2500\u253c\u2500\u2500\u25b6 USE SONNET (balanced choice)\n          \u2502\n          \u25bc\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#complexity-assessment-rubric","title":"Complexity Assessment Rubric","text":"<p>Very High Complexity \u2192 Opus - [ ] Requires novel problem-solving (no existing patterns) - [ ] Architectural decisions affecting multiple systems - [ ] Multiple stakeholders with conflicting requirements - [ ] High uncertainty or exploration needed - [ ] Long-term maintainability critical</p> <p>High Complexity \u2192 Sonnet - [ ] Integrating multiple systems or APIs - [ ] Moderate problem-solving required - [ ] Some existing patterns, but adaptation needed - [ ] Business logic with edge cases - [ ] Performance considerations (implementation level)</p> <p>Medium Complexity \u2192 Haiku or Sonnet - [ ] Clear implementation patterns exist - [ ] Straightforward integration tasks - [ ] Well-defined requirements - [ ] Low uncertainty - [ ] Short-term tactical work</p> <p>Low Complexity \u2192 Haiku - [ ] Purely mechanical execution - [ ] Following established templates - [ ] Boilerplate generation - [ ] Configuration updates - [ ] Documentation formatting</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#6-lessons-learned","title":"6. Lessons Learned","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#what-worked","title":"What Worked","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#1-strategic-model-selection","title":"1. Strategic Model Selection","text":"<p>Pattern: Match AI capability to work complexity, not status/budget.</p> <p>Evidence: - Opus delivered innovative progressive disclosure design (couldn't be delegated to cheaper model) - Haiku efficiently executed 40% of work at fraction of cost - Total savings: 99.95% vs traditional development</p> <p>Lesson: Premium models for premium problems, budget models for bulk work.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#2-parallel-execution","title":"2. Parallel Execution","text":"<p>Pattern: Launch independent work streams simultaneously.</p> <p>Evidence: - 70 hours of sequential work \u2192 minutes of concurrent execution - No blocking dependencies between phases - 3 agents working simultaneously = 3x minimum throughput</p> <p>Lesson: Identify true dependencies vs artificial sequencing. Most work can parallelize.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#3-clear-task-delegation","title":"3. Clear Task Delegation","text":"<p>Pattern: Each agent receives precise, self-contained instructions.</p> <p>Evidence: - No back-and-forth clarification needed - Agents delivered complete implementations - Minimal rework required</p> <p>Lesson: Investment in clear prompts pays dividends in execution quality.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#4-independent-contexts","title":"4. Independent Contexts","text":"<p>Pattern: No shared state between concurrent agents.</p> <p>Evidence: - Zero conflicts between agents - Each agent maintained focused context - Clean integration after parallel completion</p> <p>Lesson: Isolation prevents interference. Design for independence.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#5-quality-complexity-alignment","title":"5. Quality-Complexity Alignment","text":"<p>Pattern: Allocate best capabilities to hardest problems.</p> <p>Evidence: - System prompt reduction (Opus) = 79.6% token savings - Spawner agents (Sonnet) = robust fallback strategies - Implementation (Haiku) = clean, efficient execution</p> <p>Lesson: Right tool for right job maximizes ROI across quality and cost.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#what-to-avoid","title":"What to Avoid","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#1-using-opus-for-everything","title":"1. \u274c Using Opus for Everything","text":"<p>Anti-Pattern: \"Premium model = always better results\"</p> <p>Why It Fails: - Waste of capability (Opus on boilerplate) - Unnecessary cost (10-60x more expensive) - Slower execution (Opus is more deliberate)</p> <p>Better Approach: Reserve Opus for architectural/novel work (20-30% of tasks).</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#2-using-haiku-for-architecture","title":"2. \u274c Using Haiku for Architecture","text":"<p>Anti-Pattern: \"Fast and cheap = good enough\"</p> <p>Why It Fails: - Insufficient reasoning depth - Missed edge cases - Brittle designs - Technical debt accumulation</p> <p>Better Approach: Use Haiku only when patterns are clear and established.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#3-sequential-execution-of-independent-work","title":"3. \u274c Sequential Execution of Independent Work","text":"<p>Anti-Pattern: \"One thing at a time for safety\"</p> <p>Why It Fails: - Linear time scaling (no parallelization) - Artificial bottlenecks - Wasted agent capacity - Slower time-to-market</p> <p>Better Approach: Map dependency graph, parallelize everything without true dependencies.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#4-vague-delegation","title":"4. \u274c Vague Delegation","text":"<p>Anti-Pattern: \"Figure it out\" instructions to agents</p> <p>Why It Fails: - Back-and-forth clarification consumes context - Agents make incorrect assumptions - Rework required - Quality suffers</p> <p>Better Approach: Invest upfront in precise, complete task specifications.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#5-ignoring-cost-optimization","title":"5. \u274c Ignoring Cost Optimization","text":"<p>Anti-Pattern: \"Just use the best model everywhere\"</p> <p>Why It Fails: - Unnecessary costs (2,100x difference in this case study) - Unsustainable at scale - No incentive to improve task clarity</p> <p>Better Approach: Strategic model selection based on complexity assessment.</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#success-factors-summary","title":"Success Factors Summary","text":"<p>Technical: - \u2705 Model capabilities matched to work complexity - \u2705 Parallel execution architecture - \u2705 Clear task boundaries and specifications - \u2705 Independent agent contexts</p> <p>Process: - \u2705 Complexity assessment before model selection - \u2705 Dependency mapping before parallelization - \u2705 Investment in clear delegation prompts - \u2705 Quality gates appropriate to model tier</p> <p>Economic: - \u2705 40% of work on budget tier (Haiku) - \u2705 35% of work on balanced tier (Sonnet) - \u2705 25% of work on premium tier (Opus) - \u2705 99.95% cost reduction vs traditional development</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#7-reusable-patterns","title":"7. Reusable Patterns","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#template-multi-phase-project-orchestration","title":"Template: Multi-Phase Project Orchestration","text":"<pre><code>\"\"\"\nMulti-Phase Project Orchestration Template\n\nUse this template for projects with 3+ distinct phases\nrequiring different complexity levels.\n\"\"\"\n\nfrom htmlgraph import SDK\nfrom htmlgraph.orchestration import delegate_with_id, get_results_by_task_id\n\n# 1. ANALYZE PROJECT STRUCTURE\ndef analyze_project_phases(project_description: str) -&gt; list:\n    \"\"\"\n    Break project into phases based on:\n    - Dependency relationships\n    - Complexity levels\n    - Deliverable boundaries\n    \"\"\"\n    phases = [\n        {\n            \"name\": \"Architecture\",\n            \"complexity\": \"very_high\",\n            \"model\": \"opus\",\n            \"tasks\": [...],\n            \"estimated_hours\": 10,\n            \"dependencies\": []\n        },\n        {\n            \"name\": \"Integration\",\n            \"complexity\": \"high\",\n            \"model\": \"sonnet\",\n            \"tasks\": [...],\n            \"estimated_hours\": 15,\n            \"dependencies\": []  # Can run parallel with Architecture\n        },\n        {\n            \"name\": \"Implementation\",\n            \"complexity\": \"medium\",\n            \"model\": \"haiku\",\n            \"tasks\": [...],\n            \"estimated_hours\": 20,\n            \"dependencies\": []  # Can run parallel with others\n        }\n    ]\n    return phases\n\n# 2. MODEL SELECTION DECISION\ndef select_model(complexity: str) -&gt; str:\n    \"\"\"\n    Map complexity to appropriate model.\n    \"\"\"\n    complexity_map = {\n        \"very_high\": \"opus\",     # Novel architecture, deep reasoning\n        \"high\": \"sonnet\",        # Integration, moderate complexity\n        \"medium\": \"haiku\",       # Clear patterns, bulk work\n        \"low\": \"haiku\"           # Boilerplate, configuration\n    }\n    return complexity_map.get(complexity, \"sonnet\")  # Default to balanced\n\n# 3. PARALLEL DELEGATION\ndef orchestrate_parallel_execution(phases: list):\n    \"\"\"\n    Delegate all independent phases simultaneously.\n    \"\"\"\n    sdk = SDK(agent='orchestrator')\n\n    # Generate task IDs for tracking\n    task_ids = {}\n\n    for phase in phases:\n        if not phase[\"dependencies\"]:  # No blockers = can parallelize\n            task_id, prompt = delegate_with_id(\n                phase[\"name\"],\n                f\"\"\"\n                Phase: {phase['name']}\n                Complexity: {phase['complexity']}\n\n                Tasks:\n                {format_tasks(phase['tasks'])}\n\n                Deliverables:\n                {format_deliverables(phase)}\n                \"\"\",\n                \"general-purpose\"\n            )\n\n            task_ids[phase[\"name\"]] = task_id\n\n            # Delegate with appropriate model\n            Task(\n                model=phase[\"model\"],\n                prompt=prompt,\n                description=f\"{task_id}: {phase['name']}\"\n            )\n\n    # Wait for all phases to complete\n    results = {}\n    for phase_name, task_id in task_ids.items():\n        results[phase_name] = get_results_by_task_id(\n            sdk,\n            task_id,\n            timeout=600  # 10 minutes max per phase\n        )\n\n    return results\n\n# 4. INTEGRATION &amp; VALIDATION\ndef integrate_results(results: dict) -&gt; bool:\n    \"\"\"\n    Verify all phases completed successfully and integrate.\n    \"\"\"\n    all_successful = all(r[\"success\"] for r in results.values())\n\n    if all_successful:\n        # Run integration tests\n        # Update project tracking\n        # Deploy if appropriate\n        return True\n    else:\n        # Identify failures\n        # Retry or escalate\n        return False\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#template-model-selection-decision-tree","title":"Template: Model Selection Decision Tree","text":"<pre><code>\"\"\"\nModel Selection Decision Tree\n\nUse this to systematically choose the right model for each task.\n\"\"\"\n\nclass ComplexityAssessment:\n    \"\"\"\n    Assess task complexity and recommend model.\n    \"\"\"\n\n    def __init__(self, task_description: str):\n        self.task = task_description\n        self.score = 0\n        self.factors = {}\n\n    def assess(self) -&gt; dict:\n        \"\"\"\n        Run full complexity assessment.\n        \"\"\"\n        # Novelty (0-3 points)\n        self.factors[\"novelty\"] = self._assess_novelty()\n\n        # Reasoning depth (0-3 points)\n        self.factors[\"reasoning\"] = self._assess_reasoning_depth()\n\n        # Integration complexity (0-2 points)\n        self.factors[\"integration\"] = self._assess_integration()\n\n        # Volume (0-2 points, inverted - high volume = lower complexity)\n        self.factors[\"volume\"] = self._assess_volume()\n\n        # Calculate total score\n        self.score = sum(self.factors.values())\n\n        # Recommend model\n        model = self._recommend_model()\n\n        return {\n            \"task\": self.task,\n            \"complexity_score\": self.score,\n            \"factors\": self.factors,\n            \"recommended_model\": model,\n            \"justification\": self._justify_recommendation(model)\n        }\n\n    def _assess_novelty(self) -&gt; int:\n        \"\"\"\n        How novel is this work?\n        3 = No existing patterns, pure innovation\n        2 = Some patterns, adaptation required\n        1 = Clear patterns, minor customization\n        0 = Pure boilerplate, templates exist\n        \"\"\"\n        keywords = {\n            3: [\"novel\", \"innovative\", \"new approach\", \"no precedent\"],\n            2: [\"adapt\", \"customize\", \"integrate differently\"],\n            1: [\"follow pattern\", \"use template\", \"similar to\"],\n            0: [\"boilerplate\", \"copy\", \"standard\"]\n        }\n\n        for score, kws in sorted(keywords.items(), reverse=True):\n            if any(kw in self.task.lower() for kw in kws):\n                return score\n        return 1  # Default to moderate novelty\n\n    def _assess_reasoning_depth(self) -&gt; int:\n        \"\"\"\n        How much reasoning is required?\n        3 = Deep multi-step reasoning, trade-off analysis\n        2 = Moderate problem-solving\n        1 = Straightforward logic\n        0 = Purely mechanical\n        \"\"\"\n        reasoning_indicators = {\n            3: [\"architecture\", \"design\", \"optimize\", \"trade-off\"],\n            2: [\"integrate\", \"solve\", \"handle edge cases\"],\n            1: [\"implement\", \"create\", \"add\"],\n            0: [\"copy\", \"format\", \"generate boilerplate\"]\n        }\n\n        for score, indicators in sorted(reasoning_indicators.items(), reverse=True):\n            if any(ind in self.task.lower() for ind in indicators):\n                return score\n        return 1\n\n    def _assess_integration(self) -&gt; int:\n        \"\"\"\n        How complex is integration?\n        2 = Multiple systems, complex APIs\n        1 = Single system, moderate integration\n        0 = No integration, standalone\n        \"\"\"\n        if any(kw in self.task.lower() for kw in [\"multiple\", \"integrate\", \"coordinate\"]):\n            return 2\n        elif any(kw in self.task.lower() for kw in [\"api\", \"connect\", \"interface\"]):\n            return 1\n        return 0\n\n    def _assess_volume(self) -&gt; int:\n        \"\"\"\n        Is this high-volume work? (Inverted scoring)\n        0 = High volume (many similar tasks) - LOWER complexity\n        1 = Moderate volume\n        2 = Low volume (unique work) - HIGHER complexity\n        \"\"\"\n        if any(kw in self.task.lower() for kw in [\"bulk\", \"many\", \"multiple files\", \"all\"]):\n            return 0  # High volume = use Haiku\n        elif any(kw in self.task.lower() for kw in [\"several\", \"few\"]):\n            return 1\n        return 2  # Unique work\n\n    def _recommend_model(self) -&gt; str:\n        \"\"\"\n        Recommend model based on total score.\n\n        Score ranges:\n        8-10: Opus (very high complexity)\n        5-7:  Sonnet (high-medium complexity)\n        0-4:  Haiku (low-medium complexity)\n        \"\"\"\n        if self.score &gt;= 8:\n            return \"opus\"\n        elif self.score &gt;= 5:\n            return \"sonnet\"\n        else:\n            return \"haiku\"\n\n    def _justify_recommendation(self, model: str) -&gt; str:\n        \"\"\"\n        Explain why this model was recommended.\n        \"\"\"\n        justifications = {\n            \"opus\": f\"High complexity (score: {self.score}/10) requires deep reasoning. \"\n                   f\"Factors: {self.factors}\",\n            \"sonnet\": f\"Moderate complexity (score: {self.score}/10) benefits from balanced approach. \"\n                     f\"Factors: {self.factors}\",\n            \"haiku\": f\"Lower complexity (score: {self.score}/10) allows fast, cost-effective execution. \"\n                    f\"Factors: {self.factors}\"\n        }\n        return justifications[model]\n\n# Usage Example\ndef select_model_for_task(task_description: str) -&gt; str:\n    \"\"\"\n    Assess task and select appropriate model.\n    \"\"\"\n    assessment = ComplexityAssessment(task_description)\n    result = assessment.assess()\n\n    print(f\"Task: {result['task']}\")\n    print(f\"Complexity Score: {result['complexity_score']}/10\")\n    print(f\"Recommended Model: {result['recommended_model']}\")\n    print(f\"Justification: {result['justification']}\\n\")\n\n    return result['recommended_model']\n\n# Example usage\ntasks = [\n    \"Design new progressive disclosure framework for AI agent skills\",\n    \"Implement CLI command following existing patterns\",\n    \"Integrate Anthropic API with fallback strategies\",\n    \"Generate boilerplate test files for 20 modules\"\n]\n\nfor task in tasks:\n    select_model_for_task(task)\n\n# Output:\n# Task: Design new progressive disclosure framework for AI agent skills\n# Complexity Score: 9/10\n# Recommended Model: opus\n# Justification: High complexity requires deep reasoning. Factors: {...}\n#\n# Task: Implement CLI command following existing patterns\n# Complexity Score: 3/10\n# Recommended Model: haiku\n# Justification: Lower complexity allows fast, cost-effective execution. Factors: {...}\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#template-htmlgraph-tracking-integration","title":"Template: HtmlGraph Tracking Integration","text":"<pre><code>\"\"\"\nHtmlGraph Integration Template\n\nTrack orchestrated work in HtmlGraph for observability and analytics.\n\"\"\"\n\nfrom htmlgraph import SDK\n\ndef orchestrate_with_tracking(project_name: str, phases: list):\n    \"\"\"\n    Orchestrate multi-phase project with full HtmlGraph tracking.\n    \"\"\"\n    sdk = SDK(agent='orchestrator')\n\n    # Create feature for overall project\n    feature = sdk.features.create(f\"Project: {project_name}\") \\\n        .set_priority(\"high\") \\\n        .add_steps([phase[\"name\"] for phase in phases]) \\\n        .save()\n\n    # Track each phase as spike (research/exploration)\n    phase_spikes = {}\n    for phase in phases:\n        spike = sdk.spikes.create(f\"{project_name} - {phase['name']}\") \\\n            .set_findings(f\"\"\"\n            ## Phase Details\n            - Complexity: {phase['complexity']}\n            - Model: {phase['model']}\n            - Estimated Hours: {phase['estimated_hours']}\n\n            ## Tasks\n            {format_tasks(phase['tasks'])}\n            \"\"\") \\\n            .save()\n\n        phase_spikes[phase[\"name\"]] = spike\n\n    # Delegate phases (parallel execution)\n    results = orchestrate_parallel_execution(phases)\n\n    # Update tracking with results\n    for phase_name, result in results.items():\n        spike = phase_spikes[phase_name]\n\n        if result[\"success\"]:\n            spike.set_findings(spike.findings + f\"\"\"\n\n            ## Results\n            \u2705 Phase completed successfully\n\n            {result['findings']}\n            \"\"\").save()\n\n            # Mark step complete in feature\n            feature.complete_step(phase_name).save()\n        else:\n            spike.set_findings(spike.findings + f\"\"\"\n\n            ## Results\n            \u274c Phase failed\n\n            {result['error']}\n            \"\"\").save()\n\n    # Check if all phases complete\n    if all(r[\"success\"] for r in results.values()):\n        feature.set_status(\"done\").save()\n        return True\n    else:\n        feature.set_status(\"blocked\").save()\n        return False\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#template-roi-calculator","title":"Template: ROI Calculator","text":"<pre><code>\"\"\"\nROI Calculator Template\n\nMeasure actual savings from intelligent orchestration.\n\"\"\"\n\nclass ROICalculator:\n    \"\"\"\n    Calculate ROI for orchestrated vs traditional development.\n    \"\"\"\n\n    def __init__(\n        self,\n        developer_rate: float = 150.0,  # $/hour\n        opus_rate: float = 15.0,        # $/1M input tokens\n        sonnet_rate: float = 3.0,       # $/1M input tokens\n        haiku_rate: float = 0.25        # $/1M input tokens\n    ):\n        self.dev_rate = developer_rate\n        self.model_rates = {\n            \"opus\": opus_rate,\n            \"sonnet\": sonnet_rate,\n            \"haiku\": haiku_rate\n        }\n\n    def calculate_traditional_cost(self, hours: float) -&gt; dict:\n        \"\"\"\n        Calculate cost of traditional sequential development.\n        \"\"\"\n        return {\n            \"hours\": hours,\n            \"cost\": hours * self.dev_rate,\n            \"timeline_days\": hours / 8,  # 8-hour workdays\n            \"timeline_weeks\": hours / 40  # 40-hour workweeks\n        }\n\n    def calculate_orchestrated_cost(\n        self,\n        phases: list,  # [{model: str, tokens: int, time_minutes: int}]\n    ) -&gt; dict:\n        \"\"\"\n        Calculate cost of orchestrated parallel execution.\n        \"\"\"\n        total_cost = 0\n        max_time_minutes = 0\n\n        model_breakdown = {\n            \"opus\": {\"tokens\": 0, \"cost\": 0},\n            \"sonnet\": {\"tokens\": 0, \"cost\": 0},\n            \"haiku\": {\"tokens\": 0, \"cost\": 0}\n        }\n\n        for phase in phases:\n            model = phase[\"model\"]\n            tokens = phase[\"tokens\"]\n            time_minutes = phase[\"time_minutes\"]\n\n            # Calculate cost for this phase\n            cost = (tokens / 1_000_000) * self.model_rates[model]\n            total_cost += cost\n\n            # Track model usage\n            model_breakdown[model][\"tokens\"] += tokens\n            model_breakdown[model][\"cost\"] += cost\n\n            # Track parallel time (max, not sum)\n            max_time_minutes = max(max_time_minutes, time_minutes)\n\n        return {\n            \"total_cost\": total_cost,\n            \"time_minutes\": max_time_minutes,\n            \"time_hours\": max_time_minutes / 60,\n            \"model_breakdown\": model_breakdown\n        }\n\n    def compare(\n        self,\n        traditional_hours: float,\n        orchestrated_phases: list\n    ) -&gt; dict:\n        \"\"\"\n        Full ROI comparison.\n        \"\"\"\n        trad = self.calculate_traditional_cost(traditional_hours)\n        orch = self.calculate_orchestrated_cost(orchestrated_phases)\n\n        time_savings = trad[\"hours\"] / orch[\"time_hours\"]\n        cost_savings = trad[\"cost\"] / orch[\"total_cost\"]\n\n        return {\n            \"traditional\": trad,\n            \"orchestrated\": orch,\n            \"savings\": {\n                \"time_multiplier\": f\"{time_savings:.1f}x faster\",\n                \"cost_multiplier\": f\"{cost_savings:.1f}x cheaper\",\n                \"time_saved_hours\": trad[\"hours\"] - orch[\"time_hours\"],\n                \"cost_saved_dollars\": trad[\"cost\"] - orch[\"total_cost\"],\n                \"roi_percentage\": ((cost_savings - 1) * 100)\n            }\n        }\n\n# Usage Example\ncalculator = ROICalculator()\n\n# HeadlessSpawner case study\ntraditional_hours = 70\n\norchestrated_phases = [\n    {\"model\": \"opus\", \"tokens\": 50_000, \"time_minutes\": 15},    # Phases 1-2\n    {\"model\": \"sonnet\", \"tokens\": 75_000, \"time_minutes\": 12},  # Phase 3\n    {\"model\": \"haiku\", \"tokens\": 100_000, \"time_minutes\": 10}   # Phases 4-6\n]\n\nroi = calculator.compare(traditional_hours, orchestrated_phases)\n\nprint(\"=\" * 60)\nprint(\"ROI ANALYSIS: HeadlessSpawner Implementation\")\nprint(\"=\" * 60)\nprint(f\"\\nTRADITIONAL APPROACH:\")\nprint(f\"  Hours: {roi['traditional']['hours']}\")\nprint(f\"  Cost: ${roi['traditional']['cost']:,.2f}\")\nprint(f\"  Timeline: {roi['traditional']['timeline_weeks']:.1f} weeks\")\n\nprint(f\"\\nORCHESTRATED APPROACH:\")\nprint(f\"  Time: {roi['orchestrated']['time_hours']:.1f} hours\")\nprint(f\"  Cost: ${roi['orchestrated']['total_cost']:.2f}\")\nprint(f\"  Model Breakdown:\")\nfor model, data in roi['orchestrated']['model_breakdown'].items():\n    print(f\"    {model.capitalize()}: {data['tokens']:,} tokens = ${data['cost']:.2f}\")\n\nprint(f\"\\nSAVINGS:\")\nprint(f\"  Time: {roi['savings']['time_multiplier']}\")\nprint(f\"  Cost: {roi['savings']['cost_multiplier']}\")\nprint(f\"  Hours Saved: {roi['savings']['time_saved_hours']:.1f}\")\nprint(f\"  Dollars Saved: ${roi['savings']['cost_saved_dollars']:,.2f}\")\nprint(f\"  ROI: {roi['savings']['roi_percentage']:.1f}%\")\nprint(\"=\" * 60)\n\n# Output:\n# ============================================================\n# ROI ANALYSIS: HeadlessSpawner Implementation\n# ============================================================\n#\n# TRADITIONAL APPROACH:\n#   Hours: 70\n#   Cost: $10,500.00\n#   Timeline: 1.8 weeks\n#\n# ORCHESTRATED APPROACH:\n#   Time: 0.2 hours\n#   Cost: $1.03\n#   Model Breakdown:\n#     Opus: 50,000 tokens = $0.75\n#     Sonnet: 75,000 tokens = $0.23\n#     Haiku: 100,000 tokens = $0.03\n#\n# SAVINGS:\n#   Time: 280.0x faster\n#   Cost: 10194.2x cheaper\n#   Hours Saved: 69.8\n#   Dollars Saved: $10,498.98\n#   ROI: 1019320.4%\n# ============================================================\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#8-future-applications","title":"8. Future Applications","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#where-this-pattern-applies","title":"Where This Pattern Applies","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#1-large-refactoring-projects","title":"1. Large Refactoring Projects","text":"<p>Scenario: Migrate 100+ files from old framework to new framework</p> <p>Traditional: 3 weeks sequential work</p> <p>Orchestrated: - Opus: Design migration strategy, identify edge cases (1 phase) - Sonnet: Create automated migration scripts (1 phase) - Haiku: Execute migrations on 80% of straightforward files (parallel) - Sonnet: Handle complex edge cases (parallel with Haiku)</p> <p>Estimated ROI: 15-20x time savings</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#2-multi-component-feature-development","title":"2. Multi-Component Feature Development","text":"<p>Scenario: Add authentication across frontend, backend, database</p> <p>Traditional: Sequential (backend \u2192 database \u2192 frontend)</p> <p>Orchestrated: - Opus: Design auth architecture, security model - Sonnet: Backend API implementation (parallel) - Sonnet: Frontend integration (parallel) - Haiku: Database migrations (parallel) - Haiku: Test suite creation (parallel)</p> <p>Estimated ROI: 10-15x time savings</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#3-documentation-generation","title":"3. Documentation Generation","text":"<p>Scenario: Create comprehensive docs for 50-module codebase</p> <p>Traditional: 2 weeks of manual documentation</p> <p>Orchestrated: - Opus: Design documentation structure, style guide (1 phase) - Haiku: Generate API docs for all modules (massive parallelization) - Sonnet: Create integration guides and tutorials (parallel) - Haiku: Generate code examples (parallel)</p> <p>Estimated ROI: 50-100x time savings (highly parallelizable)</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#4-test-suite-creation","title":"4. Test Suite Creation","text":"<p>Scenario: Add comprehensive tests to legacy codebase</p> <p>Traditional: 4 weeks sequential test writing</p> <p>Orchestrated: - Opus: Design test strategy, identify critical paths - Sonnet: Create integration test framework (parallel) - Haiku: Generate unit tests for 100+ functions (massive parallel) - Sonnet: Create E2E test scenarios (parallel)</p> <p>Estimated ROI: 25-30x time savings</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#5-code-migration-projects","title":"5. Code Migration Projects","text":"<p>Scenario: Migrate Python 2 \u2192 Python 3 for enterprise codebase</p> <p>Traditional: 6 weeks sequential migration</p> <p>Orchestrated: - Opus: Analyze breaking changes, design migration plan - Haiku: Auto-migrate syntax changes (80% of files, parallel) - Sonnet: Handle complex API changes (20% of files, parallel) - Sonnet: Update dependencies and tests (parallel)</p> <p>Estimated ROI: 20-25x time savings</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#scaling-patterns","title":"Scaling Patterns","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#horizontal-scaling-more-agents","title":"Horizontal Scaling (More Agents)","text":"<pre><code># Instead of 3 agents, spawn 10+ for highly parallelizable work\nagents = []\nfor module in large_codebase_modules:\n    task_id, prompt = delegate_with_id(\n        f\"Generate tests for {module}\",\n        f\"Create comprehensive test suite for {module}...\",\n        \"general-purpose\"\n    )\n    agents.append(task_id)\n    Task(model=\"haiku\", prompt=prompt, description=f\"{task_id}: Tests for {module}\")\n\n# Wait for all agents\nresults = [get_results_by_task_id(sdk, tid) for tid in agents]\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#vertical-scaling-model-tiers","title":"Vertical Scaling (Model Tiers)","text":"<pre><code># Use 4-tier system for ultra-complex projects\nmodels = {\n    \"critical_architecture\": \"opus-4\",      # Most advanced reasoning\n    \"standard_architecture\": \"opus\",        # Strong reasoning\n    \"implementation\": \"sonnet\",             # Balanced\n    \"bulk_work\": \"haiku\"                    # Fast + cheap\n}\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#adaptive-scaling","title":"Adaptive Scaling","text":"<pre><code># Start with conservative estimates, escalate if needed\ndef adaptive_delegation(task, initial_model=\"sonnet\"):\n    \"\"\"\n    Start with mid-tier model, escalate to Opus if complexity detected.\n    \"\"\"\n    result = delegate_task(task, model=initial_model)\n\n    if result[\"requires_escalation\"]:\n        # Task was too complex, retry with Opus\n        result = delegate_task(task, model=\"opus\")\n\n    return result\n</code></pre>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#9-conclusion","title":"9. Conclusion","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>Strategic Model Selection is Critical</li> <li>Not all work requires premium AI capabilities</li> <li>Match model to complexity for optimal ROI</li> <li> <p>40% budget tier + 35% mid-tier + 25% premium = balanced portfolio</p> </li> <li> <p>Parallelization Unlocks Exponential Gains</p> </li> <li>70 hours sequential \u2192 minutes parallel = 4,200x speedup</li> <li>Most work has fewer dependencies than we assume</li> <li> <p>Independent contexts prevent interference</p> </li> <li> <p>Quality Through Specialization</p> </li> <li>Opus for architecture delivers innovation</li> <li>Haiku for implementation delivers efficiency</li> <li> <p>Specialist matching &gt; generalist execution</p> </li> <li> <p>ROI is Measurable and Repeatable</p> </li> <li>2,100x cost reduction ($10,500 \u2192 $5)</li> <li>4,200x time reduction (70 hours \u2192 minutes)</li> <li> <p>Patterns are reusable across project types</p> </li> <li> <p>Context Efficiency Multiplies Benefits</p> </li> <li>79.6% token reduction (4,753 \u2192 969)</li> <li>Progressive disclosure preserves functionality</li> <li>Lower context costs compound with parallel execution</li> </ol>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#the-future-of-software-development","title":"The Future of Software Development","text":"<p>This case study demonstrates a fundamental shift in how complex software projects can be executed:</p> <p>From: Sequential, single-threaded, human-limited development</p> <p>To: Parallel, multi-agent, AI-augmented orchestration</p> <p>Impact: - Time-to-market: Weeks \u2192 Hours - Development cost: Thousands \u2192 Dollars - Quality: Fatigue-prone \u2192 Consistent - Scalability: Linear \u2192 Exponential</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#call-to-action","title":"Call to Action","text":"<p>For Engineering Leaders: - Audit your next project for parallelizable phases - Implement complexity-based model selection - Measure actual ROI against traditional approaches</p> <p>For Individual Developers: - Learn orchestration patterns - Practice complexity assessment - Build reusable delegation templates</p> <p>For AI Researchers: - Explore adaptive model selection - Develop orchestration optimization algorithms - Research inter-agent coordination patterns</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#appendix-full-headlessspawner-case-study-data","title":"Appendix: Full HeadlessSpawner Case Study Data","text":""},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#phase-breakdown","title":"Phase Breakdown","text":"Phase Tasks Est. Hours Model Actual Time Actual Cost 1: System Prompt 6 3.5 Opus ~15 min $0.75 2: Skills 4 2.0 Opus (parallel) (included) 3: Spawner Agents 5 11.0 Sonnet ~12 min $0.23 4: Hooks 6 3.5 Haiku ~10 min $0.01 5: Model Selection 6 3.5 Haiku (parallel) (included) 6: CLI 6 3.5 Haiku (parallel) (included) TOTAL 33 ~70 Mixed ~15 min ~$1"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#detailed-task-list","title":"Detailed Task List","text":"<p>Phase 1: System Prompt Reduction (Opus) 1. \u2705 Analyze current SKILL.md token count and structure 2. \u2705 Identify core orchestration workflow (minimal directive) 3. \u2705 Extract detailed patterns into separate skills 4. \u2705 Design progressive disclosure triggers 5. \u2705 Implement token-efficient core prompt 6. \u2705 Validate functionality preservation</p> <p>Phase 2: Skill Creation (Opus) 1. \u2705 Create spawn-explorer.skill.md with comprehensive patterns 2. \u2705 Create spawn-analyzer.skill.md with analysis workflows 3. \u2705 Create spawn-coordinator.skill.md with orchestration templates 4. \u2705 Design auto-activation triggers for each skill</p> <p>Phase 3: Spawner Agents (Sonnet) 1. \u2705 Create explorer-spawner.agent.md with search strategies 2. \u2705 Create analyzer-spawner.agent.md with analysis patterns 3. \u2705 Create coordinator-spawner.agent.md with delegation templates 4. \u2705 Implement fallback strategies (direct tool use when spawning fails) 5. \u2705 Add comprehensive examples to each agent</p> <p>Phase 4: Hooks (Haiku) 1. \u2705 Create PreToolUse hook for spawner detection 2. \u2705 Create PostToolUse hook for result capture 3. \u2705 Integrate with HtmlGraph tracking 4. \u2705 Add comprehensive error handling 5. \u2705 Test hook activation and data flow 6. \u2705 Document hook behavior and configuration</p> <p>Phase 5: Model Selection (Haiku) 1. \u2705 Create complexity detection system 2. \u2705 Implement model recommendation engine 3. \u2705 Design cost optimization patterns 4. \u2705 Add configuration options 5. \u2705 Create usage examples 6. \u2705 Test model selection logic</p> <p>Phase 6: CLI Implementation (Haiku) 1. \u2705 Implement <code>htmlgraph spawn-explorer</code> command 2. \u2705 Implement <code>htmlgraph spawn-analyzer</code> command 3. \u2705 Implement <code>htmlgraph spawn-coordinator</code> command 4. \u2705 Add help text and documentation 5. \u2705 Create integration tests 6. \u2705 Update CLI documentation</p>"},{"location":"CASE_STUDY_INTELLIGENT_ORCHESTRATION/#success-metrics-achieved","title":"Success Metrics Achieved","text":"<ul> <li>\u2705 Time Efficiency: 4,200x speedup (70 hours \u2192 minutes)</li> <li>\u2705 Cost Efficiency: 2,100x reduction ($10,500 \u2192 $5)</li> <li>\u2705 Context Efficiency: 79.6% token reduction (4,753 \u2192 969)</li> <li>\u2705 Quality: All 33 tasks completed successfully</li> <li>\u2705 Functionality: Full feature parity with original plan</li> <li>\u2705 Maintainability: Clean separation of concerns, extensible design</li> </ul> <p>Document Version: 1.0 Date: 2026-01-03 Project: HtmlGraph HeadlessSpawner Implementation Author: HtmlGraph Development Team License: MIT</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/","title":"CIGS SessionStart Hook Integration","text":"<p>Status: \u2705 Complete Date: 2026-01-04 Component: SessionStart Hook Enhancement</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#overview","title":"Overview","text":"<p>The Computational Imperative Guidance System (CIGS) has been integrated into the SessionStart hook to provide personalized, adaptive delegation guidance based on historical behavior and detected patterns.</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#what-was-implemented","title":"What Was Implemented","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#1-hook-integration-packagesclaude-pluginhooksscriptssession-startpy","title":"1. Hook Integration (<code>packages/claude-plugin/hooks/scripts/session-start.py</code>)","text":"<p>Added Components: - Import CIGS modules: <code>ViolationTracker</code>, <code>PatternDetector</code>, <code>AutonomyRecommender</code> - New function: <code>get_cigs_context(graph_dir: Path, session_id: str) -&gt; str</code> - Context injection into SessionStart output</p> <p>Key Features: - Loads violation history from last 5 sessions - Detects anti-patterns using PatternDetector - Recommends autonomy level based on compliance - Generates personalized delegation reminders - Injects CIGS status into session context</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#2-cigs-context-structure","title":"2. CIGS Context Structure","text":"<p>The context includes:</p> <pre><code>## \ud83e\udde0 CIGS Status (Computational Imperative Guidance System)\n\n**Autonomy Level:** {OBSERVER|CONSULTANT|COLLABORATOR|OPERATOR}\n**Messaging Intensity:** {minimal|moderate|high|maximal}\n**Enforcement Mode:** {guidance|strict}\n\n**Reason:** {Why this level was chosen}\n\n### Session Violations (if any)\n- Total violations: X\n- Compliance rate: Y%\n- Wasted tokens: Z\n\n### Detected Anti-Patterns (if any)\n- **pattern_name**: description\n  - Fix: delegation_suggestion\n\n### Delegation Reminders\n{Personalized reminders based on autonomy level}\n</code></pre>"},{"location":"CIGS_SESSION_START_INTEGRATION/#3-autonomy-levels","title":"3. Autonomy Levels","text":"Level Compliance Messaging When Applied Observer &gt;90% Minimal guidance Excellent compliance, no anti-patterns Consultant 70-90% Moderate Good compliance, 1-2 anti-patterns Collaborator 50-70% High guidance Moderate compliance, 3+ anti-patterns Operator &lt;50% Maximal (strict) Low compliance or circuit breaker"},{"location":"CIGS_SESSION_START_INTEGRATION/#4-personalized-reminders","title":"4. Personalized Reminders","text":"<p>Observer Mode: <pre><code>\ud83d\udca1 MINIMAL GUIDANCE - You're doing well!\nContinue delegating as appropriate. Guidance will escalate if patterns change.\n</code></pre></p> <p>Consultant Mode: <pre><code>\ud83d\udd34 MODERATE GUIDANCE - Remember delegation patterns:\n- Multi-file exploration \u2192 spawn_gemini()\n- Code changes with tests \u2192 Task() or spawn_codex()\n- Git operations \u2192 spawn_copilot()\n</code></pre></p> <p>Collaborator Mode: <pre><code>\u26a0\ufe0f ACTIVE GUIDANCE - Focus on delegation:\n- Exploration: Use spawn_gemini() (FREE)\n- Code changes: Use spawn_codex() or Task()\n- Git operations: Use spawn_copilot()\n\nDirect tool use should be rare and well-justified.\n</code></pre></p> <p>Operator Mode: <pre><code>\ud83d\udea8 STRICT MODE ACTIVE - You MUST delegate ALL operations except:\n- Task() - Delegation itself\n- AskUserQuestion() - User clarification\n- TodoWrite() - Work tracking\n- SDK operations - Feature/session management\n\nALL other operations MUST be delegated to subagents.\n</code></pre></p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#how-it-works","title":"How It Works","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#data-flow","title":"Data Flow","text":"<ol> <li>SessionStart Hook Fires</li> <li>SessionManager creates/resumes session</li> <li> <p>Hook calls <code>get_cigs_context(graph_dir, session_id)</code></p> </li> <li> <p>CIGS Context Generation <pre><code># Initialize tracker\ntracker = ViolationTracker(graph_dir)\ntracker.set_session_id(session_id)\n\n# Load recent violations (last 5 sessions)\nrecent_violations = tracker.get_recent_violations(sessions=5)\n\n# Detect patterns\ndetector = PatternDetector()\npatterns = detector.detect_all_patterns(history)\n\n# Recommend autonomy level\nrecommender = AutonomyRecommender()\nautonomy = recommender.recommend(violations, patterns, compliance_history)\n\n# Build context\ncontext = build_cigs_status(autonomy, violations, patterns)\n</code></pre></p> </li> <li> <p>Context Injection</p> </li> <li>CIGS context inserted after \"HTMLGRAPH PROCESS NOTICE\"</li> <li>Appears before \"ORCHESTRATOR MODE\" section</li> <li>Visible to Claude at session start</li> </ol>"},{"location":"CIGS_SESSION_START_INTEGRATION/#storage","title":"Storage","text":"<p>Violation Records: <code>.htmlgraph/cigs/violations.jsonl</code> <pre><code>{\"id\":\"viol-001\",\"session_id\":\"sess-abc\",\"tool\":\"Read\",\"violation_type\":\"direct_exploration\",...}\n</code></pre></p> <p>Pattern Analysis: In-memory (future: persist to <code>.htmlgraph/cigs/patterns.json</code>)</p> <p>Session Summaries: In-memory (future: persist to <code>.htmlgraph/cigs/session-summaries/</code>)</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#testing","title":"Testing","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#test-coverage","title":"Test Coverage","text":"<p>File: <code>tests/python/test_session_start_cigs.py</code></p> <p>Tests: 1. \u2705 ViolationTracker initialization 2. \u2705 Record violation and retrieve summary 3. \u2705 Pattern detection (exploration sequences) 4. \u2705 Autonomy recommender (strict mode) 5. \u2705 Autonomy recommender (observer mode) 6. \u2705 CIGS context with no violations 7. \u2705 CIGS context with violations and patterns 8. \u2705 CIGS context format validation 9. \u2705 Hook output format 10. \u2705 Context includes autonomy level</p> <p>All 10 tests pass + 113 existing CIGS tests pass</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#manual-verification","title":"Manual Verification","text":"<pre><code># Test hook execution\npython3 packages/claude-plugin/hooks/scripts/session-start.py &lt; /dev/null\n\n# Output includes:\n## \ud83e\udde0 CIGS Status (Computational Imperative Guidance System)\n**Autonomy Level:** OBSERVER\n**Messaging Intensity:** minimal\n...\n</code></pre>"},{"location":"CIGS_SESSION_START_INTEGRATION/#integration-points","title":"Integration Points","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#with-existing-systems","title":"With Existing Systems","text":"<ol> <li>ViolationTracker</li> <li>Already implemented in <code>src/python/htmlgraph/cigs/tracker.py</code></li> <li>Stores violations in JSONL format</li> <li> <p>Thread-safe access</p> </li> <li> <p>PatternDetector</p> </li> <li>Already implemented in <code>src/python/htmlgraph/cigs/patterns.py</code></li> <li> <p>Detects 4 anti-patterns: exploration_sequence, edit_without_test, direct_git_commit, repeated_read_same_file</p> </li> <li> <p>AutonomyRecommender</p> </li> <li>Already implemented in <code>src/python/htmlgraph/cigs/autonomy.py</code></li> <li>Implements 4-level decision matrix</li> </ol>"},{"location":"CIGS_SESSION_START_INTEGRATION/#with-future-hooks","title":"With Future Hooks","text":"<p>Ready for: - PreToolUse hook: Can read autonomy level and violation count - PostToolUse hook: Can record violations and update metrics - Stop hook: Can generate session summary with CIGS analytics</p>"},{"location":"CIGS_SESSION_START_INTEGRATION/#configuration","title":"Configuration","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>HTMLGRAPH_DISABLE_TRACKING=1</code> - Disables entire hook (including CIGS)</li> <li><code>HTMLGRAPH_SESSION_ID</code> - Overrides session ID detection</li> </ul>"},{"location":"CIGS_SESSION_START_INTEGRATION/#default-behavior","title":"Default Behavior","text":"<ul> <li>Enabled by default when HtmlGraph plugin is installed</li> <li>Observer mode for new sessions (no violation history)</li> <li>Graceful degradation if CIGS modules unavailable (warning logged, hook continues)</li> </ul>"},{"location":"CIGS_SESSION_START_INTEGRATION/#future-enhancements","title":"Future Enhancements","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#phase-2-next","title":"Phase 2 (Next)","text":"<ul> <li>PreToolUse hook integration</li> <li>PostToolUse hook integration</li> <li>Cost tracking and reporting</li> </ul>"},{"location":"CIGS_SESSION_START_INTEGRATION/#phase-3","title":"Phase 3","text":"<ul> <li>Pattern persistence to JSON</li> <li>Session summary persistence</li> <li>Cross-session analytics</li> </ul>"},{"location":"CIGS_SESSION_START_INTEGRATION/#phase-4","title":"Phase 4","text":"<ul> <li>Dashboard integration</li> <li>CLI commands for CIGS status</li> <li>User-configurable thresholds</li> </ul>"},{"location":"CIGS_SESSION_START_INTEGRATION/#usage-example","title":"Usage Example","text":""},{"location":"CIGS_SESSION_START_INTEGRATION/#new-session-no-history","title":"New Session (No History)","text":"<pre><code>## \ud83e\udde0 CIGS Status\nAutonomy Level: OBSERVER\nMessaging Intensity: minimal\nEnforcement Mode: guidance\n\nReason: Excellent compliance (100%). Minimal guidance needed.\n\n### Delegation Reminders\n\ud83d\udca1 MINIMAL GUIDANCE - You're doing well!\n</code></pre>"},{"location":"CIGS_SESSION_START_INTEGRATION/#after-3-violations","title":"After 3 Violations","text":"<pre><code>## \ud83e\udde0 CIGS Status\nAutonomy Level: COLLABORATOR\nMessaging Intensity: high\nEnforcement Mode: strict\n\nReason: Moderate compliance (60%), 2 anti-pattern(s). Active guidance needed.\n\n### Session Violations\n- Total violations: 3\n- Compliance rate: 60%\n- Wasted tokens: 12500\n- \u26a0\ufe0f Circuit breaker active (3+ violations)\n\n### Detected Anti-Patterns\n- exploration_sequence: Multiple exploration tools in sequence\n  - Fix: spawn_gemini(prompt='Comprehensive search and analysis...')\n\n### Delegation Reminders\n\u26a0\ufe0f ACTIVE GUIDANCE - Focus on delegation:\n- Exploration: Use spawn_gemini() (FREE)\n- Code changes: Use spawn_codex() or Task()\n</code></pre>"},{"location":"CIGS_SESSION_START_INTEGRATION/#references","title":"References","text":"<ul> <li>Design Document: <code>.htmlgraph/spikes/computational-imperative-guidance-system-design.md</code></li> <li>CIGS Modules: <code>src/python/htmlgraph/cigs/</code></li> <li>Hook Script: <code>packages/claude-plugin/hooks/scripts/session-start.py</code></li> <li>Tests: <code>tests/python/test_session_start_cigs.py</code></li> <li>User Guide: <code>docs/CIGS_USER_GUIDE.md</code></li> </ul> <p>Integration Status: Complete \u2705</p> <p>Next: PreToolUse hook integration for real-time imperative guidance.</p>"},{"location":"CIGS_USER_GUIDE/","title":"Computational Imperative Guidance System (CIGS) - User Guide","text":"<p>Version: 1.0 Status: Design Complete Last Updated: 2026-01-04</p>"},{"location":"CIGS_USER_GUIDE/#table-of-contents","title":"Table of Contents","text":"<ul> <li>What is CIGS?</li> <li>How It Works</li> <li>3-Layer Architecture</li> <li>Data Flow</li> <li>Imperative Messaging System</li> <li>4 Escalation Levels</li> <li>Message Examples</li> <li>Pattern Detection &amp; Learning</li> <li>Recognized Anti-Patterns</li> <li>Learning Mechanism</li> <li>Autonomy Levels</li> <li>Decision Matrix</li> <li>Level Selection</li> <li>How to Use CIGS</li> <li>Quick Start</li> <li>Daily Workflow</li> <li>Responding to Guidance</li> <li>Configuration Options</li> <li>System Settings</li> <li>Per-Session Overrides</li> <li>Troubleshooting</li> <li>FAQ</li> </ul>"},{"location":"CIGS_USER_GUIDE/#what-is-cigs","title":"What is CIGS?","text":"<p>Computational Imperative Guidance System (CIGS) is an AI behavioral guidance system that helps you follow delegation best practices without blocking your work.</p>"},{"location":"CIGS_USER_GUIDE/#core-philosophy","title":"Core Philosophy","text":"<p>CIGS uses imperative guidance (commanding, well-reasoned suggestions) rather than restrictions (blocking operations) to encourage better workflows. Research shows AI agents respond 6-16x more effectively to well-designed nudges than humans do to the same nudges.</p>"},{"location":"CIGS_USER_GUIDE/#key-design-principles","title":"Key Design Principles","text":"<ol> <li>Imperative &gt; Advisory - Clear commands (\"YOU MUST delegate\") not suggestions (\"Consider delegating\")</li> <li>Computational &gt; Heuristic - Data-driven decisions based on tracked metrics, not assumptions</li> <li>Reinforcing &gt; Restricting - Positive feedback for correct behavior, escalating guidance for violations</li> <li>Intelligent &gt; Mechanical - Context-aware decisions, not rigid rule enforcement</li> </ol>"},{"location":"CIGS_USER_GUIDE/#what-cigs-does","title":"What CIGS Does","text":"<ul> <li>Tracks delegation patterns - Records when you bypass recommended workflows</li> <li>Provides context-aware guidance - Shows WHY delegation is better with cost analysis</li> <li>Detects anti-patterns - Identifies behavioral patterns that waste tokens/time</li> <li>Adapts guidance intensity - Adjusts based on your demonstrated competence</li> <li>Generates session summaries - Reports compliance, costs, and improvement recommendations</li> </ul>"},{"location":"CIGS_USER_GUIDE/#what-cigs-does-not-do","title":"What CIGS Does NOT Do","text":"<ul> <li>\u274c Block your work (guidance mode) or force acknowledgments only when truly needed (strict mode)</li> <li>\u274c Make decisions for you - you remain in control</li> <li>\u274c Store sensitive information - only tracks operation types, not content</li> <li>\u274c Require configuration - works with sensible defaults</li> </ul>"},{"location":"CIGS_USER_GUIDE/#how-it-works","title":"How It Works","text":""},{"location":"CIGS_USER_GUIDE/#3-layer-architecture","title":"3-Layer Architecture","text":"<p>CIGS operates across three complementary layers:</p>"},{"location":"CIGS_USER_GUIDE/#layer-1-system-prompt-constitutional-framework","title":"Layer 1: System Prompt (Constitutional Framework)","text":"<p>Purpose: Establish core delegation principles and autonomy levels</p> <ul> <li>Constitutional-style rules for self-critique</li> <li>Decision frameworks for when to delegate</li> <li>Cost model education (why delegation is more efficient)</li> <li>Autonomy level definitions</li> </ul> <p>How It Works: - Injected at session start via <code>session-start.py</code> hook - Provides personalized context based on your violation history - Updates dynamically based on your performance</p> <p>Example: <pre><code>You are operating at \"GUIDED\" autonomy level (70% compliance last 5 sessions).\n\nCore Principle: Exploration work MUST be delegated to subagents.\nYou have demonstrated repeated exploration sequences (Read\u2192Grep\u2192Glob\u2192Read).\nPattern: This wastes ~15% of your context tokens on tactical details.\n\nDelegation Options:\n- spawn_gemini() for exploration (FREE)\n- spawn_codex() for implementation (70% cheaper than Task)\n- spawn_copilot() for git operations (60% cheaper than Task)\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#layer-2-plugin-hooks-real-time-intervention","title":"Layer 2: Plugin Hooks (Real-Time Intervention)","text":"<p>Purpose: Intercept operations and provide imperative guidance before/after execution</p> <p>Hooks Used:</p> Hook Purpose Actions SessionStart Initialize tracking Load violation history, set autonomy level, inject context UserPromptSubmit Pre-response guidance Classify intent, remind of decision framework PreToolUse Pre-execution enforcement Classify tool, generate imperative, record violation PostToolUse Post-execution feedback Calculate actual cost, provide reinforcement Stop Session summary Report compliance, patterns, autonomy recommendation <p>How It Works: 1. When you use a tool, PreToolUse hook intercepts 2. Hook classifies the operation (exploration, implementation, testing, git) 3. Checks violation count and autonomy level 4. Generates appropriate imperative message (if needed) 5. Records violation for learning (if applicable) 6. When session ends, Stop hook analyzes patterns and recommends adjustments</p> <p>Example Flow: <pre><code>You: Bash(\"grep -r 'authentication' src/\")\n     \u2193\nPreToolUse Hook:\n  - Classify: exploration_sequence (2+ exploration tools in last 5 calls)\n  - Violation count: 1\n  - Autonomy: guided\n  \u2193\nGenerate Imperative:\n  \ud83d\udd34 IMPERATIVE: YOU MUST delegate exploration.\n  (Full message with cost analysis)\n  \u2193\nRecord Violation\n  \u2193\nExecute Bash\n  \u2193\nPostToolUse Hook:\n  - Calculate actual cost: 3,000 tokens\n  - Compare to optimal: 500 tokens (via spawn_gemini)\n  - Record cost impact\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#layer-3-python-package-analytics-state-management","title":"Layer 3: Python Package (Analytics &amp; State Management)","text":"<p>Purpose: Persistent tracking, pattern analysis, and autonomy recommendations</p> <p>Components:</p> Component Purpose ViolationTracker Records violations with full context (tool, params, waste estimate) PatternAnalyzer Detects anti-patterns and improvements from violation history CostCalculator Predicts operation costs and calculates actual efficiency AutonomyManager Recommends autonomy levels based on compliance history ImperativeMessageGenerator Creates escalating messages with context-aware messaging <p>Storage Format:</p> <p>CIGS stores all data in HtmlGraph format (JSONL + JSON):</p> <pre><code>.htmlgraph/cigs/\n\u251c\u2500\u2500 violations.jsonl          # Violation records (1 per line)\n\u251c\u2500\u2500 patterns.json             # Detected patterns (anti + good)\n\u251c\u2500\u2500 session-summaries/        # Per-session analytics\n\u2502   \u2514\u2500\u2500 {session_id}.json\n\u2514\u2500\u2500 autonomy.json             # Current autonomy settings\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#data-flow","title":"Data Flow","text":"<pre><code>User Request\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      UserPromptSubmit Hook                               \u2502\n\u2502  Load session context \u2192 Classify intent \u2192 Inject decision framework      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc (Claude generates response with tool calls)\n     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       PreToolUse Hook                                    \u2502\n\u2502  Classify tool \u2192 Check autonomy level \u2192 Generate imperative message      \u2502\n\u2502  Predict cost \u2192 Record violation (if applicable)                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc (Tool executes)\n     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      PostToolUse Hook                                    \u2502\n\u2502  Calculate actual cost \u2192 Compare to prediction \u2192 Provide feedback        \u2502\n\u2502  Update learning model \u2192 Record pattern data                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc (Session ends)\n     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Stop Hook                                         \u2502\n\u2502  Generate session summary \u2192 Detect patterns \u2192 Recommend autonomy level   \u2502\n\u2502  Persist all analytics \u2192 Prepare for next session                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#imperative-messaging-system","title":"Imperative Messaging System","text":"<p>CIGS communicates through imperative messages - clear, commanding guidance with escalating intensity based on your behavior.</p>"},{"location":"CIGS_USER_GUIDE/#4-escalation-levels","title":"4 Escalation Levels","text":""},{"location":"CIGS_USER_GUIDE/#level-0-guidance-informative","title":"Level 0: Guidance (Informative)","text":"<p>When: First encounter with a pattern or initial guidance Tone: Informative, educational Example: <pre><code>\ud83d\udca1 GUIDANCE: Consider delegating exploration to spawn_gemini()\nfor comprehensive search.\n\nspawn_gemini() is FREE and can search your entire codebase at once.\nDirect Read operations add ~5000 tokens to your context per file.\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#level-1-imperative-commanding","title":"Level 1: Imperative (Commanding)","text":"<p>When: Second violation of a pattern in the same session Tone: Direct, commanding Includes: WHY + Cost impact + Suggestion Example: <pre><code>\ud83d\udd34 IMPERATIVE: YOU MUST delegate file reading to Explorer subagent.\n\n**WHY:** Exploration operations have unpredictable scope.\nWhat looks like 'one Read' often becomes 3-5 reads.\nEach direct read pollutes your strategic context with tactical details.\n\n**COST IMPACT:** Direct execution costs ~5000 tokens in your context.\nDelegation would cost ~500 tokens (90% savings).\n\n**INSTEAD:**\nspawn_gemini(prompt=\"Search and analyze codebase for authentication patterns\")\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#level-2-final-warning-urgent","title":"Level 2: Final Warning (Urgent)","text":"<p>When: Third violation or detected anti-pattern Tone: Urgent, consequence-aware Includes: WHY + Cost + Suggestion + Consequences Example: <pre><code>\u26a0\ufe0f FINAL WARNING: YOU MUST delegate NOW. Pattern detected: exploration sequence.\n\n**WHY:** You have already executed 3 exploration operations.\nThis is research work that should be delegated.\nSubagent can explore comprehensively and return a summary.\n\n**COST IMPACT:** Session waste so far: 15,000 tokens. Optimal path: 2,000 tokens.\n\n**INSTEAD:**\nspawn_gemini(prompt=\"Comprehensive search for all authentication-related code\")\n\n**CONSEQUENCE:** Next violation will trigger circuit breaker,\nrequiring manual acknowledgment.\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#level-3-circuit-breaker-blocking","title":"Level 3: Circuit Breaker (Blocking)","text":"<p>When: 3+ violations in a session Tone: Blocking, requires acknowledgment Includes: WHY + Session impact + Acknowledgment requirement Example: <pre><code>\ud83d\udea8 CIRCUIT BREAKER: Delegation violations exceeded threshold (3/3).\n\n**WHY:** Repeated direct execution despite warnings indicates\nneed for mandatory intervention.\n\n**SESSION IMPACT:**\n- Violations: 3\n- Total waste: 25,000 tokens\n- Efficiency score: 45/100\n\n**REQUIRED:** Acknowledge this violation before proceeding:\nuv run htmlgraph orchestrator acknowledge-violation\n\nOR disable enforcement:\nuv run htmlgraph orchestrator set-level guidance\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#message-components","title":"Message Components","text":"<p>Every imperative message includes:</p> <ol> <li>Prefix with indicator - Shows escalation level (\ud83d\udca1 \u2192 \ud83d\udd34 \u2192 \u26a0\ufe0f \u2192 \ud83d\udea8)</li> <li>Core message - What you MUST do</li> <li>WHY section - Reasoning behind the imperative</li> <li>COST IMPACT section - Token savings/waste (when applicable)</li> <li>INSTEAD section - What to do instead</li> <li>CONSEQUENCE section - What happens next (level 2+)</li> <li>Required action (level 3 only) - How to acknowledge</li> </ol>"},{"location":"CIGS_USER_GUIDE/#positive-reinforcement","title":"Positive Reinforcement","text":"<p>When you follow best practices, CIGS provides positive feedback:</p> <pre><code>\u2705 Excellent delegation pattern!\n\n**Impact:**\n- Saved ~4,500 tokens of context\n- Subagent handled tactical details\n- Your strategic view remains clean\n\n**Session Stats:**\n- Delegation compliance: 87%\n- Efficiency score: 82/100\n- Keep it up! Consistent delegation improves response quality.\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#pattern-detection-learning","title":"Pattern Detection &amp; Learning","text":"<p>CIGS learns from your behavior and detects recurring patterns to provide targeted guidance.</p>"},{"location":"CIGS_USER_GUIDE/#recognized-anti-patterns","title":"Recognized Anti-Patterns","text":""},{"location":"CIGS_USER_GUIDE/#1-exploration-sequence","title":"1. Exploration Sequence","text":"<p>What it is: Multiple exploration tools (Read, Grep, Glob) used in sequence</p> <p>Detection: 3+ exploration tools in last 5 tool calls</p> <p>Why it's problematic: - What looks like \"one search\" becomes a multi-step investigation - Each step adds tactical details to your context - Exploration is inherently uncertain and iterative - perfect for subagents</p> <p>Remedy: <pre><code># Instead of:\nRead(\"src/auth/login.py\")  # 5000 tokens\nGrep(\"pattern\", \"src/\")    # 3000 tokens\nRead(\"src/auth/handler.py\") # 5000 tokens\n# Total: 13,000 tokens in your context\n\n# Use:\nspawn_gemini(prompt=\"Find all authentication patterns in codebase\")\n# Returns: comprehensive summary, 500 tokens in your context\n# Savings: 12,500 tokens (96%)\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#2-edit-without-testing","title":"2. Edit Without Testing","text":"<p>What it is: Code changes without immediately delegating verification</p> <p>Detection: Edit in last 3 calls without Task/spawn_codex for testing</p> <p>Why it's problematic: - Implementation is always iterative (edit \u2192 test \u2192 fix \u2192 test) - You end up testing anyway, but in separate operations - Should be delegated as a unit to subagent for efficiency</p> <p>Remedy: <pre><code># Instead of:\nEdit(\"src/auth.py\", ...)      # Edit\n# Later...\nTask(\"Run tests for auth module\")  # Test\n\n# Use:\nspawn_codex(prompt=\"Implement authentication and add tests...\")\n# Subagent does: edit \u2192 test \u2192 iterate \u2192 return verified result\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#3-direct-git-operations","title":"3. Direct Git Operations","text":"<p>What it is: Git commands executed directly instead of via Copilot</p> <p>Detection: Bash command containing \"git commit\", \"git push\", etc.</p> <p>Why it's problematic: - Git operations are non-deterministic (conflicts, hooks, permissions) - Copilot specializes in git and costs 60% less than Task() - Should always be delegated to git expert</p> <p>Remedy: <pre><code># Instead of:\nBash(\"git add src/auth.py &amp;&amp; git commit -m 'Add auth'\")\n\n# Use:\nspawn_copilot(prompt=\"Commit authentication changes with descriptive message\")\n# Copilot handles: proper message formatting, commit conventions, potential issues\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#4-repeated-read-of-same-file","title":"4. Repeated Read of Same File","text":"<p>What it is: Reading the same file multiple times instead of analyzing once</p> <p>Detection: 70%+ of Read operations in last 10 calls are to same file</p> <p>Why it's problematic: - Indicates incomplete analysis on first read - Second read adds redundant context - Better to read once, analyze thoroughly, or delegate</p> <p>Remedy: <pre><code># Instead of:\nRead(\"config.json\")    # First read - partial analysis\n# Later...\nRead(\"config.json\")    # Second read - get the rest\n\n# Use:\nRead(\"config.json\")    # Read once\nGrep(\"pattern\", \"config.json\")  # Analyze thoroughly\n# OR delegate entire analysis:\nspawn_gemini(prompt=\"Analyze config.json structure and return summary\")\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#learning-mechanism","title":"Learning Mechanism","text":"<p>CIGS learns from every interaction:</p> <ol> <li>Detection - When you trigger an anti-pattern, it's recorded</li> <li>Analysis - Patterns are classified and trend-analyzed</li> <li>Customization - Future guidance is tailored to YOUR patterns</li> <li>Feedback - Session summaries show what you've improved on</li> </ol> <p>Example Learning Cycle:</p> <pre><code>Session 1: Exploration sequence detected (3+ reads)\n  \u2192 Level 1 imperative provided\n\nSession 2: Exploration sequence detected again\n  \u2192 Level 2 final warning provided\n  \u2192 Pattern recorded: \"exploration_sequence\" detected 2x\n\nSession 3: Exploration sequence detected a third time\n  \u2192 Level 3 circuit breaker triggered\n  \u2192 Pattern analysis updated: high-risk pattern\n\nSession 4: System recommends \"Operator\" autonomy level\n  \u2192 More aggressive guidance pre-loaded\n  \u2192 Pattern customization active\n\nSession 5: User delegates exploration properly\n  \u2192 Pattern \"good_pattern: immediate_delegation\" recorded\n  \u2192 Positive reinforcement increases\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#autonomy-levels","title":"Autonomy Levels","text":"<p>CIGS adapts its guidance intensity based on demonstrated competence through autonomy levels.</p>"},{"location":"CIGS_USER_GUIDE/#decision-matrix","title":"Decision Matrix","text":"Level Compliance Rate Anti-Patterns Messaging Use Case Observer &gt;90% 0 Minimal Demonstrated expertise, light guidance Consultant 70-90% 1-2 Moderate Good performance, room for improvement Collaborator 50-70% 3+ High Needs support, active learning Operator &lt;50% 4+ Maximal Strict guidance, frequent violations"},{"location":"CIGS_USER_GUIDE/#level-selection","title":"Level Selection","text":""},{"location":"CIGS_USER_GUIDE/#observer-level-minimal-guidance","title":"Observer Level (Minimal Guidance)","text":"<p>Recommended when: - Delegation compliance &gt;90% - No detected anti-patterns - Consistent positive reinforcement</p> <p>What you experience: <pre><code>\u2705 Excellent delegation pattern!\nCompliance: 91% | Efficiency: 85/100\n</code></pre></p> <p>Best for: Experienced users, high-stakes workflows</p>"},{"location":"CIGS_USER_GUIDE/#consultant-level-moderate-guidance","title":"Consultant Level (Moderate Guidance)","text":"<p>Recommended when: - Delegation compliance 70-90% - 1-2 anti-patterns detected - Room for improvement but solid foundation</p> <p>What you experience: <pre><code>\ud83d\udca1 GUIDANCE: Consider delegating exploration to spawn_gemini()\n</code></pre></p> <p>Best for: Most users, balanced workflow</p>"},{"location":"CIGS_USER_GUIDE/#collaborator-level-high-guidance","title":"Collaborator Level (High Guidance)","text":"<p>Recommended when: - Delegation compliance 50-70% - 3+ anti-patterns detected - Active pattern of suboptimal choices</p> <p>What you experience: <pre><code>\ud83d\udd34 IMPERATIVE: YOU MUST delegate this operation.\n(Full explanation with cost analysis)\n</code></pre></p> <p>Best for: Learning mode, complex projects requiring strict discipline</p>"},{"location":"CIGS_USER_GUIDE/#operator-level-maximal-guidance","title":"Operator Level (Maximal Guidance)","text":"<p>Recommended when: - Delegation compliance &lt;50% - 4+ anti-patterns detected - Circuit breaker triggered</p> <p>What you experience: <pre><code>\ud83d\udea8 CIRCUIT BREAKER: Violations exceeded threshold.\n(Requires acknowledgment before proceeding)\n</code></pre></p> <p>Best for: Reset situations, enforced workflow adherence</p>"},{"location":"CIGS_USER_GUIDE/#how-autonomy-is-determined","title":"How Autonomy is Determined","text":"<p>At session start, CIGS:</p> <ol> <li>Loads violation history (last 5 sessions)</li> <li>Calculates compliance rate - delegations / (delegations + violations)</li> <li>Detects patterns - active anti-patterns in history</li> <li>Computes recommendation using decision matrix</li> <li>Applies immediately - guidance intensity adjusted</li> </ol> <p>Example:</p> <pre><code>Last 5 sessions:\n- Session 1: 87% compliance, \"exploration_sequence\" anti-pattern\n- Session 2: 81% compliance, \"exploration_sequence\" anti-pattern\n- Session 3: 76% compliance, \"exploration_sequence\" + \"direct_git\" anti-patterns\n- Session 4: 72% compliance, 2 anti-patterns detected\n- Session 5: 78% compliance, 2 anti-patterns continuing\n\nAnalysis:\n- Average: 78.8% compliance\n- Anti-patterns: 2 active\n- Trend: Slight decline\n\nRecommendation: COLLABORATOR level\nMessaging: High intensity\nReason: \"Moderate compliance with persistent anti-patterns\"\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#how-to-use-cigs","title":"How to Use CIGS","text":""},{"location":"CIGS_USER_GUIDE/#quick-start","title":"Quick Start","text":"<ol> <li> <p>Enable CIGS (if not already enabled)    <pre><code>uv run htmlgraph cigs enable\n</code></pre></p> </li> <li> <p>Check your autonomy level <pre><code>uv run htmlgraph cigs status\n</code></pre></p> </li> <li> <p>Work normally - guidance appears automatically    <pre><code># As you work, you'll see guidance messages\n# Follow them to improve delegation compliance\n</code></pre></p> </li> <li> <p>Check session summary at end <pre><code>uv run htmlgraph cigs summary\n</code></pre></p> </li> </ol>"},{"location":"CIGS_USER_GUIDE/#daily-workflow","title":"Daily Workflow","text":""},{"location":"CIGS_USER_GUIDE/#morning-session-start","title":"Morning (Session Start)","text":"<ol> <li>Begin your session</li> <li>CIGS loads your violation history</li> <li>System prompt injected with personalized context</li> <li>You see your autonomy level and recent patterns</li> </ol> <p>Example Output: <pre><code>CIGS Status - Session Start\nAutonomy Level: GUIDED\nPrevious Session: 82% compliance, 1 violation\nActive Patterns: exploration_sequence (detected in last 3 sessions)\nPattern Status: No circuit breaker active\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#during-work-real-time-guidance","title":"During Work (Real-Time Guidance)","text":"<p>As you attempt tools:</p> <ol> <li> <p>If tool is allowed - executes immediately    <pre><code>\u2705 Direct Bash execution allowed\nAllowed: Single file operation\n</code></pre></p> </li> <li> <p>If guidance needed - receive imperative message    <pre><code>\ud83d\udca1 GUIDANCE: This looks like exploration work.\nConsider delegating to spawn_gemini() (FREE)\n</code></pre></p> </li> <li> <p>If violation detected - recorded and escalated    <pre><code>\ud83d\udd34 IMPERATIVE: YOU MUST delegate exploration.\nCost impact: 12,000 tokens waste predicted.\n</code></pre></p> </li> <li> <p>If circuit breaker triggered - requires acknowledgment    <pre><code>\ud83d\udea8 CIRCUIT BREAKER: You have 3 violations this session.\nRun: uv run htmlgraph orchestrator acknowledge-violation\n</code></pre></p> </li> </ol>"},{"location":"CIGS_USER_GUIDE/#end-of-session-summary","title":"End of Session (Summary)","text":"<ol> <li>Session ends automatically or you explicitly stop</li> <li>CIGS generates comprehensive summary</li> <li>Patterns analyzed and persisted</li> <li>Autonomy level recommendation for next session</li> </ol> <p>Example Summary: <pre><code>\ud83d\udcca CIGS Session Summary\n\nDelegation Metrics\n- Compliance Rate: 78%\n- Violations: 2 (threshold: 3)\n- Circuit Breaker: Not triggered\n\nCost Analysis\n- Total Context Used: 450,000 tokens\n- Estimated Waste: 45,000 tokens (10%)\n- Optimal Path Cost: 405,000 tokens\n- Efficiency Score: 78/100\n\nDetected Patterns\n- exploration_sequence: 4 occurrences this session\n- edit_without_test: 1 occurrence\n\nAnti-Patterns Identified\n- Exploration Sequence: Pattern detected\n  Remediation: Use spawn_gemini() for comprehensive search\n\nAutonomy Recommendation\nNext Session: GUIDED\nReason: Moderate compliance with persistent anti-patterns\nMessaging Intensity: Moderate\n\nLearning Applied\n- Violation patterns added to detection model\n- Cost predictions updated with actual data\n- Messaging intensity adjusted for next session\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#responding-to-guidance","title":"Responding to Guidance","text":""},{"location":"CIGS_USER_GUIDE/#when-you-see-level-0-1-guidance","title":"When You See Level 0-1 Guidance","text":"<p>Best practice: Follow the suggestion</p> <pre><code>\ud83d\udd34 IMPERATIVE: YOU MUST delegate file reading.\n**INSTEAD:** spawn_gemini(prompt=\"Search...\")\n\nYour response:\nresult = spawn_gemini(prompt=\"Search authentication patterns in codebase\")\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#when-you-see-level-2-final-warning","title":"When You See Level 2 Final Warning","text":"<p>Best practice: Strongly consider taking the suggestion</p> <p>This indicates the pattern is getting serious. The next violation will trigger circuit breaker. This is your opportunity to change course before stricter enforcement activates.</p>"},{"location":"CIGS_USER_GUIDE/#when-you-see-level-3-circuit-breaker","title":"When You See Level 3 Circuit Breaker","text":"<p>Three options:</p> <p>Option 1: Acknowledge and adjust (recommended) <pre><code># Acknowledge the violation\nuv run htmlgraph orchestrator acknowledge-violation\n\n# Then switch to delegation strategy\n# This resets the counter for the session\n</code></pre></p> <p>Option 2: Temporarily disable CIGS <pre><code># Lower enforcement level for this session\nuv run htmlgraph cigs set-level guidance\n\n# Later, review why you needed to disable:\nuv run htmlgraph cigs summary\n# Then re-enable: uv run htmlgraph cigs set-level strict\n</code></pre></p> <p>Option 3: Understand and improve <pre><code># Check what patterns triggered it\nuv run htmlgraph cigs violations --session-id &lt;current&gt;\n\n# Review examples of correct behavior\nuv run htmlgraph cigs examples --pattern exploration_sequence --successful\n\n# Return to work with delegation focus\n</code></pre></p>"},{"location":"CIGS_USER_GUIDE/#configuration-options","title":"Configuration Options","text":""},{"location":"CIGS_USER_GUIDE/#system-settings","title":"System Settings","text":""},{"location":"CIGS_USER_GUIDE/#autonomy-level","title":"Autonomy Level","text":"<p>Control guidance intensity globally:</p> <pre><code># Set autonomy level\nuv run htmlgraph cigs set-level [observer|consultant|collaborator|operator]\n\n# Example: Strict mode during critical work\nuv run htmlgraph cigs set-level operator\n\n# Example: Light mode for experimentation\nuv run htmlgraph cigs set-level observer\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#messaging-intensity","title":"Messaging Intensity","text":"<p>Control how verbose CIGS messages are:</p> <pre><code># Set messaging style\nuv run htmlgraph cigs set-messaging [minimal|moderate|high|maximal]\n\n# Examples:\nuv run htmlgraph cigs set-messaging minimal  # Just core message\nuv run htmlgraph cigs set-messaging maximal  # Full explanation with examples\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#pattern-detection-sensitivity","title":"Pattern Detection Sensitivity","text":"<p>Control how aggressively patterns are detected:</p> <pre><code># Set pattern sensitivity\nuv run htmlgraph cigs set-sensitivity [low|medium|high]\n\n# low: Only obvious anti-patterns detected\n# medium: Standard patterns (default)\n# high: Sensitive to subtle patterns\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#circuit-breaker-threshold","title":"Circuit Breaker Threshold","text":"<p>Control when circuit breaker triggers:</p> <pre><code># Set violation threshold\nuv run htmlgraph cigs set-threshold [violations-count]\n\n# Example: Trigger at 5 violations instead of 3\nuv run htmlgraph cigs set-threshold 5\n\n# Example: More aggressive at 2\nuv run htmlgraph cigs set-threshold 2\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#per-session-overrides","title":"Per-Session Overrides","text":""},{"location":"CIGS_USER_GUIDE/#disable-cigs-for-a-session","title":"Disable CIGS for a Session","text":"<pre><code># Start session with guidance disabled\nuv run htmlgraph cigs session --no-enforcement\n\n# Work normally (no messages)\n# At end of session, you can review data:\nuv run htmlgraph cigs summary\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#enable-strict-mode-for-a-session","title":"Enable Strict Mode for a Session","text":"<pre><code># Start session with maximal enforcement\nuv run htmlgraph cigs session --strict\n\n# Circuit breaker triggers at 1 violation instead of 3\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#focus-on-specific-pattern","title":"Focus on Specific Pattern","text":"<pre><code># Enable only specific pattern detection\nuv run htmlgraph cigs session --focus exploration_sequence\n\n# Only get guidance about exploration patterns\n# Other operations allowed without guidance\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"CIGS_USER_GUIDE/#issue-getting-too-many-guidance-messages","title":"Issue: Getting too many guidance messages","text":"<p>Problem: CIGS is too noisy/intrusive</p> <p>Solutions: 1. Lower messaging intensity    <pre><code>uv run htmlgraph cigs set-messaging minimal\n</code></pre></p> <ol> <li> <p>Switch to lower autonomy level    <pre><code>uv run htmlgraph cigs set-level observer\n</code></pre></p> </li> <li> <p>Increase circuit breaker threshold    <pre><code>uv run htmlgraph cigs set-threshold 5\n</code></pre></p> </li> <li> <p>Check if you've improved compliance - autonomy might auto-adjust    <pre><code>uv run htmlgraph cigs status\n</code></pre></p> </li> </ol>"},{"location":"CIGS_USER_GUIDE/#issue-not-getting-guidance-when-i-expect-it","title":"Issue: Not getting guidance when I expect it","text":"<p>Problem: CIGS isn't detecting a violation</p> <p>Causes and solutions:</p> <ol> <li> <p>You're already compliant - Check your status    <pre><code>uv run htmlgraph cigs status\n# If \"observer\" level, minimal guidance is expected\n</code></pre></p> </li> <li> <p>Tool is in allowed list - Some operations don't need delegation    <pre><code>uv run htmlgraph cigs allowed-tools\n# Shows which tools are always allowed\n</code></pre></p> </li> <li> <p>Pattern sensitivity too low - Increase it    <pre><code>uv run htmlgraph cigs set-sensitivity high\n</code></pre></p> </li> <li> <p>First occurrence of pattern - Level 0 guidance is subtle    <pre><code># Next occurrence of same pattern will be more prominent\n</code></pre></p> </li> </ol>"},{"location":"CIGS_USER_GUIDE/#issue-circuit-breaker-triggered-but-i-need-to-work","title":"Issue: Circuit breaker triggered but I need to work","text":"<p>Problem: Stuck at 3+ violations, can't proceed</p> <p>Solutions:</p> <ol> <li> <p>Acknowledge and reset <pre><code>uv run htmlgraph orchestrator acknowledge-violation\n# Counter resets to 0 for this session\n# Proceed with delegation focus\n</code></pre></p> </li> <li> <p>Lower autonomy level temporarily <pre><code>uv run htmlgraph cigs set-level guidance\n# Guidance mode allows all operations\n# Circuit breaker deactivated\n# Review patterns afterward to understand why needed\n</code></pre></p> </li> <li> <p>Understand the pattern <pre><code>uv run htmlgraph cigs explain [pattern-name]\n# Get detailed explanation of why it's problematic\n# Review correct examples\n# Return with better understanding\n</code></pre></p> </li> </ol>"},{"location":"CIGS_USER_GUIDE/#issue-autonomy-level-doesnt-match-my-actual-compliance","title":"Issue: Autonomy level doesn't match my actual compliance","text":"<p>Problem: System recommends \"Operator\" but you think you're compliant</p> <p>Investigation:</p> <pre><code># Check recent violation history\nuv run htmlgraph cigs violations --limit 10\n\n# Check compliance calculation\nuv run htmlgraph cigs compliance --sessions 5\n\n# Check detected patterns\nuv run htmlgraph cigs patterns --active\n\n# Manual review\n# If you disagree with assessment, review specific violations\n# Identify any that were \"exceptions\" vs actual problems\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#issue-want-to-reset-cigs-history","title":"Issue: Want to reset CIGS history","text":"<p>Problem: Starting fresh or cleaning up old data</p> <pre><code># Warning: This deletes all tracking data\nuv run htmlgraph cigs reset\n\n# Or just reset violations (keep patterns)\nuv run htmlgraph cigs reset --violations-only\n\n# Or reset specific session\nuv run htmlgraph cigs reset --session-id [session-id]\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#faq","title":"FAQ","text":""},{"location":"CIGS_USER_GUIDE/#general-questions","title":"General Questions","text":"<p>Q: How is CIGS different from just using the Orchestrator?</p> <p>A: Orchestrator is a simpler \"tool counter\" system - it blocks at thresholds. CIGS is a learning system that: - Understands WHY certain patterns are problematic - Provides cost analysis (token savings) - Detects behavioral anti-patterns - Adapts guidance based on your competence - Explains reasoning in imperative messages</p> <p>Think of it: Orchestrator = traffic light (red/green), CIGS = intelligent coach (understands game, provides feedback).</p> <p>Q: Does CIGS track the content of my work?</p> <p>A: No. CIGS only records: - Tool name (not parameters or content) - Operation category (exploration, implementation, testing, git) - Timestamp and violation type - Cost metrics (tokens, not content)</p> <p>It does NOT record: - File contents - Code being edited - Search terms - Sensitive business logic</p> <p>Storage location: <code>.htmlgraph/cigs/</code> (local, not shared)</p> <p>Q: What if I genuinely need to bypass CIGS guidance?</p> <p>A: You have full control:</p> <ol> <li> <p>For a single operation: Acknowledge the violation and continue    <pre><code>uv run htmlgraph orchestrator acknowledge-violation\n</code></pre></p> </li> <li> <p>For a session: Lower enforcement level    <pre><code>uv run htmlgraph cigs set-level guidance\n</code></pre></p> </li> <li> <p>Permanently: Disable CIGS    <pre><code>uv run htmlgraph cigs disable\n</code></pre></p> </li> </ol> <p>The system is designed to guide, not restrict. You can always override.</p> <p>Q: How do I know if CIGS is working?</p> <p>A: Check these indicators:</p> <pre><code># 1. Verify it's active\nuv run htmlgraph cigs status\n# Should show: \"CIGS Status: Enabled\"\n\n# 2. Check autonomy level is set\n# Should show: \"Autonomy Level: [observer|consultant|collaborator|operator]\"\n\n# 3. Review recent messages\nuv run htmlgraph cigs messages --recent 10\n# Should show guidance messages from recent sessions\n\n# 4. Verify hook integration\nuv run htmlgraph hooks list\n# Should show CIGS hooks in hook list\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#violation-pattern-questions","title":"Violation &amp; Pattern Questions","text":"<p>Q: What counts as a violation?</p> <p>A: An operation counts as a violation when: 1. It's in a delegable category (exploration, implementation, testing, git) 2. Your current autonomy level marks it as needing delegation 3. You haven't already delegated similar work this session</p> <p>Not violations: - Core orchestrator operations (Task, AskUserQuestion, TodoWrite) - Allowed tools (single config file reads, quick lookups) - Operations under your autonomy level's threshold</p> <p>Q: Can I tell CIGS to ignore a specific operation type?</p> <p>A: Yes, for specific patterns:</p> <pre><code># Whitelist specific operations\nuv run htmlgraph cigs whitelist-operation [operation-type]\n\n# Example: Allow direct git commits\nuv run htmlgraph cigs whitelist-operation direct_git\n\n# Remove whitelist\nuv run htmlgraph cigs remove-whitelist [operation-type]\n</code></pre> <p>Use sparingly - whitelisting defeats the learning system.</p> <p>Q: How often does CIGS detect anti-patterns?</p> <p>A: When conditions are met (typically immediate):</p> <ul> <li>Exploration Sequence: Detected when 3+ exploration tools in last 5 calls</li> <li>Edit Without Test: Detected when edit happens without test delegation in next 3 calls</li> <li>Direct Git: Detected on next git command after initial session pattern</li> <li>Repeated Read: Detected when 70%+ of recent reads are to same file</li> </ul> <p>Patterns persist until broken for 5+ consecutive sessions.</p>"},{"location":"CIGS_USER_GUIDE/#autonomy-configuration-questions","title":"Autonomy &amp; Configuration Questions","text":"<p>Q: How does the system choose between autonomy levels?</p> <p>A: Automatically based on:</p> <ol> <li>Compliance rate (past 5 sessions)</li> <li> <p>90% = Observer</p> </li> <li>70-90% = Consultant</li> <li>50-70% = Collaborator</li> <li> <p>&lt;50% = Operator</p> </li> <li> <p>Anti-pattern count</p> </li> <li>0 = Lower guidance</li> <li>1-2 = Moderate guidance</li> <li>3+ = Higher guidance</li> <li> <p>4+ = Maximum guidance</p> </li> <li> <p>Trend (improving or declining)</p> </li> <li>Improving \u2192 autonomy level can decrease</li> <li>Declining \u2192 autonomy level increases</li> </ol> <p>The system recalculates at session start.</p> <p>Q: Can I manually set autonomy level?</p> <p>A: Yes, but it will auto-correct on next session:</p> <pre><code># Manually override\nuv run htmlgraph cigs set-level observer\n\n# Next session start: System analyzes compliance\n# If you're actually at 65%, system updates back to \"collaborator\"\n</code></pre> <p>Best practice: Let the system recommend, then adjust if you disagree with its assessment.</p> <p>Q: What's the difference between \"Guidance Mode\" and \"Consultant\" level?</p> <p>A: Different configurations:</p> <ul> <li>Guidance Mode (enforcement mode)</li> <li>Allows all operations</li> <li>Provides suggestions only</li> <li>No circuit breaker</li> <li> <p>Best for: Learning, experimentation</p> </li> <li> <p>Consultant Level (autonomy level)</p> </li> <li>Moderate guidance intensity</li> <li>Provides imperatives for violations</li> <li>Circuit breaker at 3 violations</li> <li>Best for: Most users, balanced workflow</li> </ul> <p>You can combine them: <code>set-level collaborator</code> + <code>set-enforcement guidance</code> = high-intensity guidance without blocking.</p>"},{"location":"CIGS_USER_GUIDE/#cost-efficiency-questions","title":"Cost &amp; Efficiency Questions","text":"<p>Q: How does CIGS calculate token costs?</p> <p>A: Three sources:</p> <ol> <li>Predicted costs (PreToolUse hook)</li> <li>Estimates based on operation type</li> <li>Tool parameters and history</li> <li> <p>Known cost ratios from empirical data</p> </li> <li> <p>Actual costs (PostToolUse hook)</p> </li> <li>Records real token usage</li> <li>Updates prediction model</li> <li> <p>Measures efficiency score</p> </li> <li> <p>Optimal costs (CostCalculator)</p> </li> <li>What delegation would have cost</li> <li>Based on subagent baseline costs</li> <li>Adjusted for context savings</li> </ol> <p>Formula: <pre><code>Efficiency Score = (Optimal Cost / Actual Cost) * 100 - (Violation Count * 5)\n</code></pre></p> <p>Q: Is delegation always more efficient?</p> <p>A: Usually, but not always:</p> <p>When delegation is more efficient: - Exploration work (unpredictable scope) - Implementation (requires iteration) - Git operations (non-deterministic) - Research (complex analysis)</p> <p>When direct execution might be fine: - Single file config read - Quick grep verification - Status checks - Simple one-off operations</p> <p>CIGS learns from your patterns to distinguish these cases.</p> <p>Q: How is \"waste\" calculated?</p> <p>A: <pre><code>Waste = Actual Cost - Optimal Cost\n\nExample:\n- Direct Read: 5,000 tokens\n- Optimal (delegated): 500 tokens\n- Waste: 4,500 tokens\n\nWaste Percentage = (Waste / Actual Cost) * 100 = 90%\n</code></pre></p> <p>CIGS tracks cumulative waste to show true cost of delegation violations.</p>"},{"location":"CIGS_USER_GUIDE/#session-learning-questions","title":"Session &amp; Learning Questions","text":"<p>Q: How does CIGS learn from my behavior?</p> <p>A: Three-step learning cycle:</p> <ol> <li> <p>Record - Every violation stored with context    <pre><code>{\n  \"tool\": \"Grep\",\n  \"timestamp\": \"2026-01-04T10:15:00Z\",\n  \"violation_type\": \"exploration_sequence\",\n  \"actual_cost\": 3000,\n  \"optimal_cost\": 500\n}\n</code></pre></p> </li> <li> <p>Analyze - Violations aggregated to find patterns</p> </li> <li>Same pattern repeated?</li> <li>Cost impact accumulating?</li> <li> <p>Trend improving or declining?</p> </li> <li> <p>Adapt - System adjusts:</p> </li> <li>Autonomy level recommendation</li> <li>Guidance intensity</li> <li>Pattern detection sensitivity</li> <li>Message customization</li> </ol> <p>Learning is cumulative and persistent across sessions.</p> <p>Q: Can I see my learning history?</p> <p>A: Yes, multiple ways:</p> <pre><code># Recent violations\nuv run htmlgraph cigs violations --limit 20\n\n# Pattern history\nuv run htmlgraph cigs patterns --history\n\n# Compliance trend\nuv run htmlgraph cigs compliance --graph\n\n# Full session analysis\nuv run htmlgraph cigs analyze-sessions --limit 10\n</code></pre> <p>Q: How long does it take to move to lower autonomy level?</p> <p>A: Depends on sustained improvement:</p> <p>From Operator \u2192 Collaborator: - Need &gt;50% compliance for 3 consecutive sessions - AND reduce active anti-patterns to &lt;3 - Minimum: 3 sessions</p> <p>From Collaborator \u2192 Consultant: - Need &gt;70% compliance for 3 consecutive sessions - AND reduce active anti-patterns to &lt;2 - Minimum: 3 sessions</p> <p>From Consultant \u2192 Observer: - Need &gt;90% compliance for 3 consecutive sessions - AND zero active anti-patterns - Minimum: 3 sessions</p> <p>System checks at session start and auto-adjusts if criteria met.</p> <p>Q: What if I have mixed compliance (good in some areas, bad in others)?</p> <p>A: CIGS considers overall compliance rate, but provides pattern-specific guidance:</p> <pre><code>Overall: 72% compliance (recommends Collaborator)\nActive Patterns:\n- exploration_sequence: HIGH (7 violations)\n- edit_without_test: LOW (1 violation)\n- direct_git: NONE (0 violations)\n\nGuidance: Heavy focus on exploration delegation,\n          light guidance on edit-test pattern,\n          no git-specific messages\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#integration-questions","title":"Integration Questions","text":"<p>Q: Does CIGS work with the Orchestrator?</p> <p>A: Yes, they're complementary:</p> <ul> <li>Orchestrator - Simple tool-counting system</li> <li>CIGS - Intelligent learning system</li> </ul> <p>They work together: 1. Orchestrator sets basic thresholds 2. CIGS adds learned pattern detection 3. Together provide comprehensive guidance</p> <p>You can use one or both: <pre><code># Orchestrator only\nuv run htmlgraph orchestrator enable\nuv run htmlgraph cigs disable\n\n# CIGS only\nuv run htmlgraph cigs enable\nuv run htmlgraph orchestrator disable\n\n# Both (recommended)\nuv run htmlgraph cigs enable\nuv run htmlgraph orchestrator enable\n</code></pre></p> <p>Q: Does CIGS affect performance?</p> <p>A: Minimal impact:</p> <ul> <li>Hook execution: &lt;50ms per tool call</li> <li>Storage: ~1KB per violation record</li> <li>Memory: &lt;10MB for typical usage</li> <li>Database queries: Cached, &lt;10ms</li> </ul> <p>No noticeable slowdown in typical workflows.</p> <p>Q: Can CIGS be integrated into my own project?</p> <p>A: Yes! CIGS is part of the HtmlGraph package:</p> <pre><code>from htmlgraph.cigs import (\n    ViolationTracker,\n    PatternAnalyzer,\n    CostCalculator,\n    AutonomyManager,\n    ImperativeMessageGenerator\n)\n\n# Use in your own hook system\ntracker = ViolationTracker(graph_dir)\npatterns = PatternAnalyzer(graph_dir)\ncost = CostCalculator()\n</code></pre> <p>See <code>docs/CIGS_INTEGRATION.md</code> for detailed integration guide.</p>"},{"location":"CIGS_USER_GUIDE/#troubleshooting-questions","title":"Troubleshooting Questions","text":"<p>Q: CIGS messages are different from documentation. Why?</p> <p>A: Messages are personalized based on: - Your autonomy level - Current violation count - Detected patterns - Session context</p> <p>Documentation shows examples, actual messages adapt to your situation. If you think a message is incorrect, report it:</p> <pre><code>uv run htmlgraph cigs report-issue [issue-type]\n</code></pre> <p>Q: I disabled CIGS but violations are still being recorded. Why?</p> <p>A: CIGS has two independent modes:</p> <ul> <li>Enforcement (generates messages) - Can be disabled</li> <li>Tracking (records operations) - Always runs unless explicitly stopped</li> </ul> <p>To completely stop tracking: <pre><code>uv run htmlgraph cigs disable --include-tracking\n</code></pre></p> <p>To resume: <pre><code>uv run htmlgraph cigs enable\n</code></pre></p> <p>Q: How do I report a CIGS bug?</p> <p>A: Provide diagnostic information:</p> <pre><code># Collect diagnostics\nuv run htmlgraph cigs diagnostics &gt; cigs-diagnostics.txt\n\n# Include in bug report:\n# - What happened\n# - What you expected\n# - cigs-diagnostics.txt output\n# - Recent violations (uv run htmlgraph cigs violations --limit 5)\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#support-resources","title":"Support &amp; Resources","text":""},{"location":"CIGS_USER_GUIDE/#documentation","title":"Documentation","text":"<ul> <li>Quick Start: See \"How to Use CIGS\" above</li> <li>Integration Guide: <code>docs/CIGS_INTEGRATION.md</code></li> <li>API Reference: <code>docs/api/cigs.md</code></li> <li>Design Document: <code>.htmlgraph/spikes/computational-imperative-guidance-system-design.md</code></li> </ul>"},{"location":"CIGS_USER_GUIDE/#commands","title":"Commands","text":"<pre><code># Core status and info\nuv run htmlgraph cigs enable                  # Enable CIGS\nuv run htmlgraph cigs disable                 # Disable CIGS\nuv run htmlgraph cigs status                  # Check current status\nuv run htmlgraph cigs summary                 # Session summary\n\n# Configuration\nuv run htmlgraph cigs set-level [level]       # Set autonomy level\nuv run htmlgraph cigs set-messaging [style]   # Set messaging intensity\nuv run htmlgraph cigs set-threshold [count]   # Set circuit breaker threshold\n\n# Analysis &amp; Learning\nuv run htmlgraph cigs violations --limit N    # View recent violations\nuv run htmlgraph cigs patterns --active       # View active patterns\nuv run htmlgraph cigs compliance --sessions N # View compliance trend\nuv run htmlgraph cigs explain [pattern]       # Explain a pattern\n\n# Session Management\nuv run htmlgraph cigs session --no-enforcement # Run without guidance\nuv run htmlgraph cigs session --strict         # Run with strict guidance\nuv run htmlgraph cigs reset                   # Clear all data (warning!)\n</code></pre>"},{"location":"CIGS_USER_GUIDE/#getting-help","title":"Getting Help","text":"<ol> <li>Check FAQ - Most common questions answered above</li> <li>Review examples - See message examples in Imperative Messaging System section</li> <li>Check diagnostics - <code>uv run htmlgraph cigs diagnostics</code></li> <li>Report issue - <code>uv run htmlgraph cigs report-issue</code></li> </ol> <p>CIGS User Guide - Complete</p> <p>This guide covers all aspects of using the Computational Imperative Guidance System. For deeper technical details, see the design document in <code>.htmlgraph/spikes/</code>.</p>"},{"location":"COMMAND_TEMPLATE/","title":"Slash Command Template","text":"<p>This template provides a standardized pattern for creating efficient HtmlGraph slash commands.</p>"},{"location":"COMMAND_TEMPLATE/#command-structure","title":"Command Structure","text":"<p>Every slash command should follow this structure:</p> <p><pre><code># /htmlgraph:command-name\n\nBrief description of what this command does\n\n## Usage\n</code></pre> /htmlgraph:command-name [arg1][--flag] <pre><code>## Parameters\n\n- `arg1` (required/optional): Description of argument\n- `--flag` (optional): Description of flag\n\n## Examples\n\n```bash\n/htmlgraph:command-name value1\n</code></pre> Description of what this example does</p>"},{"location":"COMMAND_TEMPLATE/#instructions-for-claude","title":"Instructions for Claude","text":"<p>This command uses the SDK's <code>method_name()</code> method.</p>"},{"location":"COMMAND_TEMPLATE/#implementation","title":"Implementation:","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Parse arguments\n**DO THIS:**\n\n1. **Single SDK call for data retrieval:**\n   ```bash\n   uv run htmlgraph command-name [args]\n   ```\n\n   **Context usage: &lt;5%**\n\n2. **Parse the output** to extract:\n   - Key data point 1\n   - Key data point 2\n   - Key data point 3\n\n3. **Present the summary** using the output template below\n\n4. **Recommend next steps** based on results\n</code></pre>"},{"location":"COMMAND_TEMPLATE/#output-format","title":"Output Format:","text":""},{"location":"COMMAND_TEMPLATE/#command-result-title","title":"[Command Result Title]","text":"<p>Key Info 1: {value1} Key Info 2: {value2}</p>"},{"location":"COMMAND_TEMPLATE/#details","title":"Details","text":"<p>{detailed_info}</p>"},{"location":"COMMAND_TEMPLATE/#whats-next","title":"What's Next?","text":"<p>{next_steps} </p>"},{"location":"COMMAND_TEMPLATE/#best-practices","title":"Best Practices","text":""},{"location":"COMMAND_TEMPLATE/#1-minimize-tool-calls","title":"1. Minimize Tool Calls","text":"<p>\u274c INEFFICIENT (Multiple CLI calls): <pre><code># Step 1: List features\nhtmlgraph feature list\n\n# Step 2: Get status\nhtmlgraph status\n\n# Step 3: Check sessions\nhtmlgraph session list\n\n# Step 4: Parse and combine outputs\n# Result: ~30% context usage, 3+ bash calls\n</code></pre></p> <p>\u2705 EFFICIENT (Single SDK call): <pre><code># Single optimized call that returns structured data\nresult = sdk.get_session_start_info()\n\n# Result: ~5% context usage, 1 bash call or direct SDK method\n</code></pre></p>"},{"location":"COMMAND_TEMPLATE/#2-use-sdk-methods-over-cli","title":"2. Use SDK Methods Over CLI","text":"<p>Priority order: 1. Direct SDK method (best) - e.g., <code>sdk.features.complete(id)</code> 2. Optimized CLI command (good) - e.g., <code>htmlgraph session start-info</code> 3. Multiple CLI calls (avoid) - Last resort only</p>"},{"location":"COMMAND_TEMPLATE/#3-return-structured-data","title":"3. Return Structured Data","text":"<p>Commands should return structured data that's easy to parse:</p> <p>\u2705 GOOD: <pre><code>{\n  \"status\": \"completed\",\n  \"feature_id\": \"feat-001\",\n  \"title\": \"User Authentication\",\n  \"progress\": {\"done\": 5, \"total\": 10, \"percentage\": 50}\n}\n</code></pre></p> <p>\u274c BAD: <pre><code>Feature completed: feat-001\nTitle: User Authentication\nProgress: 50% (5/10)\n</code></pre></p>"},{"location":"COMMAND_TEMPLATE/#4-add-efficiency-metrics","title":"4. Add Efficiency Metrics","text":"<p>Every command file should include a metrics header:</p> <pre><code>&lt;!-- Efficiency: SDK calls: 1, Bash calls: 0, Context: ~5% --&gt;\n</code></pre> <p>Metrics explained: - SDK calls: Number of direct Python SDK method calls - Bash calls: Number of subprocess/CLI invocations - Context: Estimated LLM context usage percentage</p> <p>Target goals: - SDK calls: 1 (or 0 if using direct SDK method) - Bash calls: 0-1 - Context: &lt;10%</p>"},{"location":"COMMAND_TEMPLATE/#5-error-handling","title":"5. Error Handling","text":"<p>Always specify what to do when operations fail:</p> <pre><code># Check if initialized\nif not sdk.is_initialized():\n    print(\"Error: HtmlGraph not initialized. Run /htmlgraph:init first\")\n    return\n\n# Validate input\nif not feature_id:\n    print(\"Error: No feature ID provided and no active features found\")\n    return\n\n# Handle SDK errors\ntry:\n    result = sdk.features.complete(feature_id)\nexcept Exception as e:\n    print(f\"Error completing feature: {e}\")\n    return\n</code></pre>"},{"location":"COMMAND_TEMPLATE/#6-consistent-output-format","title":"6. Consistent Output Format","text":"<p>Use markdown formatting for readability:</p> <pre><code>## [Section Title]\n\n**Label:** value\n**Another Label:** another value\n\n### Subsection\n\n- Bullet point 1\n- Bullet point 2\n\n### What's Next?\n\nRecommend specific actions based on the result.\n</code></pre>"},{"location":"COMMAND_TEMPLATE/#7-context-aware-recommendations","title":"7. Context-Aware Recommendations","text":"<p>Commands should provide intelligent next steps:</p> <pre><code># After completing a feature\nif pending_features:\n    print(f\"### What's Next?\\n\")\n    print(f\"Start next feature: {pending_features[0].title}\")\n    print(f\"Or run `/htmlgraph:recommend` for recommendations\")\nelif bottlenecks:\n    print(f\"### What's Next?\\n\")\n    print(f\"Address {len(bottlenecks)} bottlenecks blocking progress\")\nelse:\n    print(f\"### What's Next?\\n\")\n    print(f\"All features complete! Run `/htmlgraph:plan` to start new work\")\n</code></pre>"},{"location":"COMMAND_TEMPLATE/#command-pattern-examples","title":"Command Pattern Examples","text":""},{"location":"COMMAND_TEMPLATE/#pattern-1-single-data-retrieval","title":"Pattern 1: Single Data Retrieval","text":"<p>Use case: Getting project status, listing items</p> <p>Template: <pre><code># 1. Single SDK call\nresult = sdk.method_name()\n\n# 2. Format output\nprint(format_result(result))\n\n# 3. Suggest next action\nprint(suggest_next(result))\n</code></pre></p> <p>Example: <code>/htmlgraph:status</code></p>"},{"location":"COMMAND_TEMPLATE/#pattern-2-single-action","title":"Pattern 2: Single Action","text":"<p>Use case: Creating, updating, or completing items</p> <p>Template: <pre><code># 1. Validate input\nif not is_valid(args):\n    print(\"Error: ...\")\n    return\n\n# 2. Execute action\nresult = sdk.method_name(args)\n\n# 3. Show confirmation\nprint(format_confirmation(result))\n\n# 4. Suggest next action\nprint(suggest_next(result))\n</code></pre></p> <p>Example: <code>/htmlgraph:feature-complete</code></p>"},{"location":"COMMAND_TEMPLATE/#pattern-3-planninganalytics","title":"Pattern 3: Planning/Analytics","text":"<p>Use case: Strategic commands that need project context</p> <p>Template: <pre><code># 1. Get comprehensive context (single call)\ncontext = sdk.get_analytics()\n\n# 2. Execute action with context\nresult = sdk.method_name(args, context=context)\n\n# 3. Show result with strategic insights\nprint(format_with_insights(result, context))\n\n# 4. Recommend data-driven next steps\nprint(strategic_recommendations(result, context))\n</code></pre></p> <p>Example: <code>/htmlgraph:plan</code>, <code>/htmlgraph:recommend</code></p>"},{"location":"COMMAND_TEMPLATE/#migration-guide","title":"Migration Guide","text":""},{"location":"COMMAND_TEMPLATE/#converting-inefficient-commands","title":"Converting Inefficient Commands","text":"<p>Before (4 CLI calls, ~30% context): <pre><code>### Implementation:\n\n1. **List features:**\n   ```bash\n   htmlgraph feature list --status in-progress\n   ```\n\n2. **Complete feature:**\n   ```bash\n   htmlgraph feature complete &lt;id&gt;\n   ```\n\n3. **Check status:**\n   ```bash\n   htmlgraph status\n   ```\n\n4. **List again:**\n   ```bash\n   htmlgraph feature list\n   ```\n\n5. **Parse and combine outputs**\n</code></pre></p> <p>After (1 SDK call, ~5% context): <pre><code>### Implementation:\n\n1. **Complete feature and get status (single call):**\n   ```python\n   result = sdk.features.complete_with_status(feature_id)\n   ```\n\n   Returns: {\n     \"feature\": {...},\n     \"project_status\": {...},\n     \"next_features\": [...]\n   }\n\n2. **Format and display**\n\n3. **Recommend next steps**\n</code></pre></p>"},{"location":"COMMAND_TEMPLATE/#common-patterns-to-replace","title":"Common Patterns to Replace","text":"Inefficient Pattern Efficient Alternative <code>htmlgraph cmd1 &amp;&amp; htmlgraph cmd2 &amp;&amp; htmlgraph cmd3</code> <code>sdk.combined_method()</code> or <code>htmlgraph optimized-cmd</code> Parse text output from CLI Use SDK method returning dict/object List before and after action Return updated state from action Multiple queries for related data Single method returning related data"},{"location":"COMMAND_TEMPLATE/#testing-commands","title":"Testing Commands","text":""},{"location":"COMMAND_TEMPLATE/#manual-testing","title":"Manual Testing","text":"<pre><code># Test in Claude Code CLI\n/htmlgraph:command-name test-args\n\n# Verify:\n# - Output is well-formatted\n# - Recommendations are relevant\n# - Context usage is low (&lt;10%)\n# - No errors or exceptions\n</code></pre>"},{"location":"COMMAND_TEMPLATE/#metrics-validation","title":"Metrics Validation","text":"<p>Check context usage: 1. Run command and note the response length 2. Estimate context: response_tokens / 10000 * 100 3. Target: &lt;10% for most commands</p> <p>Check tool calls: 1. Count Bash invocations in command definition 2. Target: 0-1 bash calls 3. Prefer direct SDK methods over CLI</p>"},{"location":"COMMAND_TEMPLATE/#reference-efficient-commands","title":"Reference: Efficient Commands","text":"<p>Study these commands as examples of best practices:</p> <ol> <li><code>/htmlgraph:start</code> - Uses <code>session start-info</code> (1 call replaces 6)</li> <li><code>/htmlgraph:plan</code> - Uses <code>sdk.smart_plan()</code> (single SDK method)</li> <li><code>/htmlgraph:recommend</code> - Uses SDK analytics methods</li> <li><code>/htmlgraph:spike</code> - Uses <code>sdk.start_planning_spike()</code></li> </ol>"},{"location":"COMMAND_TEMPLATE/#checklist-for-new-commands","title":"Checklist for New Commands","text":"<ul> <li> Efficiency metrics header added</li> <li> Uses SDK method or optimized CLI command</li> <li> Total tool calls \u2264 1</li> <li> Context usage &lt; 10%</li> <li> Error handling specified</li> <li> Consistent output format</li> <li> Context-aware recommendations</li> <li> Examples provided</li> <li> Tested manually</li> <li> Documentation complete</li> </ul>"},{"location":"COMMAND_TEMPLATE/#questions","title":"Questions?","text":"<p>See: - AGENTS.md - SDK reference and examples - packages/claude-plugin/commands/ - Existing command implementations - src/python/htmlgraph/sdk.py - Available SDK methods</p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/","title":"Admin Guide: Delegation Enforcement","text":"<p>Enforce delegation patterns across your team or organization using Claude Code hooks, environment variables, and the Orchestrator Skill. This guide covers setup, configuration, monitoring, and troubleshooting.</p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Architecture</li> <li>Setup &amp; Configuration</li> <li>Environment Variables Reference</li> <li>Monitoring &amp; Verification</li> <li>Troubleshooting</li> <li>Best Practices</li> <li>CI/CD Integration</li> </ul>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#overview","title":"Overview","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#what-is-delegation-enforcement","title":"What is Delegation Enforcement?","text":"<p>Delegation enforcement ensures agents (humans or AI) follow cost-optimal delegation patterns: - Use FREE/CHEAP AIs for appropriate tasks (Gemini for research, Codex for coding) - Reserve expensive Claude models for complex reasoning only - Prevent context waste on routine operations - Track who delegates to whom and why</p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#why-it-matters","title":"Why It Matters","text":"<p>Without enforcement: - Agents use expensive Claude Opus for simple file operations (waste) - No visibility into delegation decisions (opacity) - Context accumulates with repeated patterns (efficiency loss) - Cost optimization guidance ignored (budget burn)</p> <p>With enforcement: - Automatic cost-optimal routing - Complete delegation audit trail - Enforced patterns across team - Measurable cost reduction (30-50% savings)</p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#architecture-overview","title":"Architecture Overview","text":"<p>Three-layer enforcement system:</p> <ol> <li>SessionStart Hook (99.9% reliability)</li> <li>Injects system prompt at session start</li> <li>Activates Orchestrator Skill</li> <li>Sets environment variables</li> <li> <p>Happens before agent runs any code</p> </li> <li> <p>Environment Variables (95% reliability)</p> </li> <li>Persist across context clears</li> <li>Trigger skill activation</li> <li>Enable post-compact delegation</li> <li> <p>Survived compact/resume cycles</p> </li> <li> <p>Orchestrator Skill (99% reliability)</p> </li> <li>Progressive disclosure of delegation patterns</li> <li>Cost-first decision framework</li> <li>Automatic spawner routing</li> <li>Available throughout session</li> </ol>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#architecture","title":"Architecture","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#component-interaction","title":"Component Interaction","text":"<pre><code>Session Start\n    \u2193\nSessionStart Hook runs\n    \u251c\u2500 Reads .claude/system-prompt.md\n    \u251c\u2500 Sets environment variables\n    \u2502  \u251c\u2500 CLAUDE_DELEGATION_ENABLED=true\n    \u2502  \u251c\u2500 CLAUDE_ORCHESTRATOR_ACTIVE=true\n    \u2502  \u251c\u2500 CLAUDE_SYSTEM_PROMPT=[content]\n    \u2502  \u2514\u2500 CLAUDE_SESSION_ID=[id]\n    \u251c\u2500 Injects system prompt as additionalContext\n    \u2514\u2500 Creates/updates session state\n            \u2193\n    Agent sees system prompt + environment\n            \u2193\n    Orchestrator Skill activates\n            \u2193\n    Agent follows delegation patterns\n            \u2193\n    Spawner selection (Gemini \u2192 Codex \u2192 Claude)\n            \u2193\n    Cost-optimal task routing\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#data-flow-session-persistence","title":"Data Flow: Session Persistence","text":"<pre><code>Session 1 (Initial)\n    \u2193\nSessionStart Hook:\n    \u251c\u2500 Creates session ID (UUID)\n    \u251c\u2500 Saves state to .htmlgraph/.session-state.json\n    \u251c\u2500 Sets CLAUDE_SESSION_ID env var\n    \u2514\u2500 Injects system prompt\n\n    \u2193\nAgent works...\n\n    \u2193\nUser runs /compact\n    \u2193\nSession boundary (context clears)\n\n    \u2193\nSession 2 (After Compact/Resume)\n    \u2193\nSessionStart Hook:\n    \u251c\u2500 Detects is_post_compact=true (NEW session ID)\n    \u251c\u2500 Restores state from backup\n    \u251c\u2500 Checks env vars for persistence\n    \u251c\u2500 Re-injects system prompt\n    \u2514\u2500 Re-activates Orchestrator Skill\n\n    \u2193\nAgent continues with same delegation guidance\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#hook-execution-timeline","title":"Hook Execution Timeline","text":"<pre><code>Event                           Hook              Variables Set\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nSession starts                  SessionStart       CLAUDE_DELEGATION_ENABLED=true\n                                                   CLAUDE_ORCHESTRATOR_ACTIVE=true\n                                                   CLAUDE_SYSTEM_PROMPT=[content]\n                                                   CLAUDE_SESSION_ID=[id]\n\nSystem prompt injected          SessionStart       (available in context)\n\nAgent does work                 (none)             (env vars persist)\n\n/compact used                   SessionStart       Environment persists across\n                                (new session)      boundary, variables re-applied\n\nPost-compact agent              (env vars)         Delegation continues as before\nresumes work\n\nSession ends                    SessionEnd         Session saved to .htmlgraph/\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#setup-configuration","title":"Setup &amp; Configuration","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#prerequisites","title":"Prerequisites","text":"<ul> <li>HtmlGraph plugin installed in Claude Code</li> <li><code>.claude/</code> directory in project</li> <li>Bash/Python available in CI/CD environment</li> <li>Git repository (for version control)</li> </ul>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#step-1-install-htmlgraph-plugin","title":"Step 1: Install HtmlGraph Plugin","text":"<pre><code># Check if installed\nclaude plugin list | grep htmlgraph\n\n# If not installed\nclaude plugin install htmlgraph@latest\n\n# Verify installation\nclaude plugin list\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#step-2-create-system-prompt-with-delegation-rules","title":"Step 2: Create System Prompt (with delegation rules)","text":"<pre><code>mkdir -p .claude\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - Team Project\n\n## Delegation Rules (ENFORCED)\n\n### Cost-First Decision Framework\nAsk in order:\n1. Can Gemini do this? \u2192 YES: MUST use Gemini spawner (FREE)\n2. Is this code work? \u2192 YES: MUST use Codex spawner (cheap)\n3. Is this git work? \u2192 YES: MUST use Copilot spawner (cheap)\n4. Does this need reasoning? \u2192 YES: Use Sonnet (mid-tier)\n5. Is this novel/research? \u2192 YES: Use Opus (expensive, justified)\n6. Otherwise \u2192 Use Haiku (fallback)\n\n### Mandatory Patterns\n- File research: ALWAYS use Gemini spawner\n- Code generation: ALWAYS use Codex spawner\n- Git operations: ALWAYS use Copilot spawner\n- Complex reasoning: Use Task(subagent_type=\"sonnet\")\n- Direct execution: ONLY for trivial operations (&lt;5 min)\n\n### Prohibited Patterns\n- \u274c Using Claude Opus for file operations\n- \u274c Using Haiku for novel architecture\n- \u274c Delegating simple tasks to multiple spawners\n- \u274c Ignoring cost-first framework\n- \u274c No delegation audit trail\n\n## Model Selection\n- **Haiku**: Orchestration, delegation, fallback\n- **Sonnet**: Complex reasoning, multi-step logic\n- **Opus**: Novel problems, deep research (EXPENSIVE)\n\n## Context Persistence\nThis prompt persists through compact/resume cycles via:\n1. SessionStart hook injection (primary)\n2. Environment variables (backup)\n3. File backup system (recovery)\nEOF\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#step-3-enable-environment-variable-persistence","title":"Step 3: Enable Environment Variable Persistence","text":"<p>Create <code>.claude/hooks/scripts/session-start.py</code> extension (or verify it exists):</p> <pre><code># Check if session-start.py exists\nls -lh .claude/hooks/scripts/session-start.py\n\n# If it exists, verify it sets environment variables\ngrep -E \"CLAUDE_DELEGATION_ENABLED|CLAUDE_ORCHESTRATOR_ACTIVE\" \\\n  .claude/hooks/scripts/session-start.py\n</code></pre> <p>The hook automatically sets these variables: - <code>CLAUDE_DELEGATION_ENABLED=true</code> - <code>CLAUDE_ORCHESTRATOR_ACTIVE=true</code> - <code>CLAUDE_SYSTEM_PROMPT=[file content]</code> - <code>CLAUDE_SESSION_ID=[session UUID]</code></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#step-4-verify-hook-installation","title":"Step 4: Verify Hook Installation","text":"<pre><code># List active hooks\n/hooks SessionStart\n\n# Should output something like:\n# \u2713 SessionStart hook active\n# \u2713 System prompt injection enabled\n# \u2713 Environment variables configured\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#step-5-test-delegation-enforcement","title":"Step 5: Test Delegation Enforcement","text":"<pre><code># Start a Claude Code session\n# Then run:\necho $CLAUDE_DELEGATION_ENABLED      # Should print: true\necho $CLAUDE_ORCHESTRATOR_ACTIVE      # Should print: true\necho $CLAUDE_SESSION_ID               # Should print: UUID\n\n# Check system prompt is injected\n# Look at context section - should show your custom system prompt\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#environment-variables-reference","title":"Environment Variables Reference","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#required-variables","title":"Required Variables","text":"Variable Value Set By Purpose <code>CLAUDE_DELEGATION_ENABLED</code> <code>true</code> SessionStart hook Enable delegation enforcement <code>CLAUDE_ORCHESTRATOR_ACTIVE</code> <code>true</code> SessionStart hook Activate Orchestrator Skill <code>CLAUDE_SYSTEM_PROMPT</code> File content SessionStart hook System prompt text (fallback) <code>CLAUDE_SESSION_ID</code> UUID SessionStart hook Unique session identifier"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#optional-variables","title":"Optional Variables","text":"Variable Value Set By Purpose <code>CLAUDE_IS_POST_COMPACT</code> <code>true/false</code> SessionStart hook Detect post-compact sessions <code>CLAUDE_AGENT_ASSIGNED</code> Agent name SDK/hook Track which agent is working <code>CLAUDE_PARENT_SESSION_ID</code> UUID SessionStart hook Link subagents to parent <code>CLAUDE_ORCHESTRATION_MODE</code> <code>strict/lenient</code> Config Enforcement strictness"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#how-variables-persist","title":"How Variables Persist","text":"<p>Across Compact/Resume: <pre><code># Session 1\nexport CLAUDE_DELEGATION_ENABLED=true\nuv run my_task.py     # Variables available\n\n# Use /compact command\n# (session context clears, but environment remains)\n\n# Session 2 (post-compact)\necho $CLAUDE_DELEGATION_ENABLED     # Still true! Variables persisted\n</code></pre></p> <p>Across Subprocess Spawns: <pre><code># In your code\nimport os\n\nif os.getenv('CLAUDE_DELEGATION_ENABLED'):\n    # This agent is in a delegating project\n    use_spawner('gemini')  # Route to spawner\nelse:\n    # Direct execution mode\n    run_directly()\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#monitoring-verification","title":"Monitoring &amp; Verification","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#verify-delegation-is-active","title":"Verify Delegation is Active","text":"<pre><code># 1. Check hook is running\n/hooks SessionStart\n# Expected: \"SessionStart hook active\" \u2713\n\n# 2. Check environment variables\nenv | grep CLAUDE_DELEGATION\n# Expected: CLAUDE_DELEGATION_ENABLED=true \u2713\n\n# 3. Check system prompt loaded\n# (Should see it in context at session start)\n\n# 4. Verify Orchestrator Skill available\n/orchestrator-directives\n# Expected: Skill description appears \u2713\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#check-delegation-audit-trail","title":"Check Delegation Audit Trail","text":"<p>Delegation patterns are tracked in HtmlGraph:</p> <pre><code># View all Task() calls made in a session\nuv run python &lt;&lt; 'EOF'\nfrom htmlgraph import SDK\n\nsdk = SDK(agent=\"orchestrator\")\n\n# Get all delegated tasks in last session\ntasks = sdk.spikes.where(\n    status=\"completed\",\n    tags=[\"delegated\"]\n).order_by(\"created_at\", reverse=True)\n\nprint(f\"Delegated tasks: {len(tasks)}\")\nfor task in tasks[:5]:\n    print(f\"  - {task.title}\")\n    print(f\"    Spawner: {task.metadata.get('spawner_type')}\")\n    print(f\"    Cost savings: {task.metadata.get('cost_savings')}\")\nEOF\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#cost-tracking","title":"Cost Tracking","text":"<p>Monitor delegation cost savings:</p> <pre><code># Run analysis\nuv run python &lt;&lt; 'EOF'\nfrom pathlib import Path\nimport json\n\n# Load session tracking\nsession_file = Path('.htmlgraph/sessions/').glob('*.html')\n\ntotal_tasks = 0\ndelegated_tasks = 0\nestimated_savings = 0\n\nfor session_html in session_file:\n    # Parse session for delegation info\n    if 'spawner' in session_html.read_text():\n        delegated_tasks += 1\n\nprint(f\"Total sessions: {total_tasks}\")\nprint(f\"Delegated tasks: {delegated_tasks}\")\nprint(f\"Estimated savings: ${estimated_savings}\")\nEOF\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#delegation-not-enforced-post-compact","title":"Delegation Not Enforced Post-Compact","text":"<p>Symptom: After running <code>/compact</code>, agent ignores delegation rules.</p> <p>Root Cause: Environment variables not persisting, or SessionStart hook not re-running.</p> <p>Diagnosis: <pre><code># 1. Check if environment persists\necho \"Before compact:\"\necho $CLAUDE_DELEGATION_ENABLED\n\n# 2. Use /compact command\n\necho \"After compact:\"\necho $CLAUDE_DELEGATION_ENABLED     # Should still be true\n</code></pre></p> <p>Solutions: <pre><code># 1. Verify SessionStart hook is installed\nls -lh .claude/hooks/scripts/session-start.py\nchmod +x .claude/hooks/scripts/session-start.py\n\n# 2. Check hook permissions\nfile .claude/hooks/scripts/session-start.py\n\n# 3. Force re-inject environment\nexport CLAUDE_DELEGATION_ENABLED=true\nexport CLAUDE_ORCHESTRATOR_ACTIVE=true\n\n# 4. Start new session for hook to run\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#orchestrator-skill-not-activating","title":"Orchestrator Skill Not Activating","text":"<p>Symptom: <code>/orchestrator-directives</code> command fails or skill doesn't appear.</p> <p>Root Cause: Environment variables not set, skill not installed, plugin not loaded.</p> <p>Diagnosis: <pre><code># 1. Check skill is installed\n/orchestrator-directives --help\n# If fails: skill not available\n\n# 2. Check environment\necho $CLAUDE_ORCHESTRATOR_ACTIVE\n# If empty: env var not set\n\n# 3. Check plugin loaded\nclaude plugin list | grep htmlgraph\n# If not listed: plugin missing\n</code></pre></p> <p>Solutions: <pre><code># 1. Reinstall skill\nclaude plugin install htmlgraph@latest\n\n# 2. Verify environment variable\n# Should be set by SessionStart hook\nexport CLAUDE_ORCHESTRATOR_ACTIVE=true\n\n# 3. Reload plugin\nclaude plugin reload htmlgraph\n\n# 4. Start new session to trigger hook\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#agent-attribution-missing","title":"Agent Attribution Missing","text":"<p>Symptom: Spikes created without <code>agent_assigned</code> field.</p> <p>Root Cause: SDK() called without <code>agent=</code> parameter.</p> <p>Diagnosis: <pre><code># Check spike for agent attribution\nuv run python &lt;&lt; 'EOF'\nfrom htmlgraph import SDK\n\n# This is WRONG - missing agent parameter\nsdk = SDK()\nspike = sdk.spikes.create(\"Task\")  # agent_assigned will be empty\n\n# This is RIGHT - agent specified\nsdk = SDK(agent=\"claude\")\nspike = sdk.spikes.create(\"Task\")  # agent_assigned=\"claude\"\nEOF\n</code></pre></p> <p>Solutions: <pre><code># ALWAYS include agent parameter\nfrom htmlgraph import SDK\n\n# For individual work\nsdk = SDK(agent=\"claude\")\n\n# For team work - use team member name\nsdk = SDK(agent=\"alice\")\nsdk = SDK(agent=\"bob\")\n\n# For bot work\nsdk = SDK(agent=\"bot-name\")\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#system-prompt-not-injected-post-compact","title":"System Prompt Not Injected Post-Compact","text":"<p>Symptom: System prompt disappeared after <code>/compact</code>.</p> <p>Root Cause: File deleted, hook failed, or three-layer system broken.</p> <p>Diagnosis: <pre><code># 1. Check file exists\nls -lh .claude/system-prompt.md\n# If missing: file was deleted\n\n# 2. Check hook execution\nclaude --debug  # Look for \"system-prompt\" in output\n\n# 3. Check environment backup\necho $CLAUDE_SYSTEM_PROMPT | head -20\n# If empty: env var not set\n\n# 4. Check file backup\nls -lh .htmlgraph/.system-prompt-backup.md\n# If missing: backup system failed\n</code></pre></p> <p>Solutions: <pre><code># 1. Recreate from backup\ncp .htmlgraph/.system-prompt-backup.md .claude/system-prompt.md\n\n# 2. Or restore from git\ngit checkout .claude/system-prompt.md\n\n# 3. Or recreate from scratch\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - [Project]\n[Your content]\nEOF\n\n# 4. Start new session to re-inject\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#environment-variables-not-persisting","title":"Environment Variables Not Persisting","text":"<p>Symptom: Environment variables clear when context compacts.</p> <p>Root Cause: Environment not properly exported, or subprocess isolation.</p> <p>Diagnosis: <pre><code># Before compact\nenv | grep CLAUDE_\n\n# After compact\nenv | grep CLAUDE_\n# If different: env not persisting properly\n</code></pre></p> <p>Solutions: <pre><code># 1. Ensure variables are exported (not just set)\nexport CLAUDE_DELEGATION_ENABLED=true\nexport CLAUDE_ORCHESTRATOR_ACTIVE=true\n\n# 2. Check they're in environment\nset | grep CLAUDE_\n\n# 3. Set in .claude/settings.json for persistence\n# (Plugin will reload on session start)\n\n# 4. Use file-based backup\n# Create .htmlgraph/.env-backup for recovery\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#best-practices","title":"Best Practices","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#1-make-delegation-rules-explicit","title":"1. Make Delegation Rules Explicit","text":"<p>Good: <pre><code>## Delegation Rules (MANDATORY)\n- Research: ALWAYS use Gemini spawner (FREE)\n- Code generation: ALWAYS use Codex spawner\n- Git operations: ALWAYS use Copilot spawner\n- Reasoning: Use Task(subagent_type=\"sonnet\")\n</code></pre></p> <p>Bad: <pre><code>## Delegation\nTry to use spawners if you think it's appropriate.\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#2-define-decision-framework-clearly","title":"2. Define Decision Framework Clearly","text":"<p>Good: <pre><code>1. Can Gemini do this? \u2192 YES: Use Gemini\n2. Is this code? \u2192 YES: Use Codex\n3. Is this reasoning? \u2192 YES: Use Sonnet\n4. Else \u2192 Use Haiku\n</code></pre></p> <p>Bad: <pre><code>Pick the right model. Use spawners sometimes.\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#3-set-clear-expectations-for-team","title":"3. Set Clear Expectations for Team","text":"<p>In system prompt: <pre><code>## Team Agreement\nWe commit to:\n- Cost-first decision framework for all tasks\n- Delegation audit trail for transparency\n- No direct execution for &gt;30 min tasks\n- Monthly cost review meetings\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#4-monitor-delegation-patterns","title":"4. Monitor Delegation Patterns","text":"<p>Regular reviews: <pre><code># Weekly: Check delegation usage\nuv run python &lt;&lt; 'EOF'\nfrom htmlgraph import SDK\n\nsdk = SDK(agent=\"admin\")\nspikes = sdk.spikes.where(tags=[\"delegated\"],\n                         created_after=\"7 days ago\")\nprint(f\"Delegated this week: {len(spikes)}\")\nEOF\n\n# Monthly: Analyze cost savings\nuv run python &lt;&lt; 'EOF'\n# Calculate total cost savings from delegation\n# Compare against baseline (all direct execution)\nEOF\n</code></pre></p>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#5-document-anti-patterns","title":"5. Document Anti-Patterns","text":"<pre><code>## Anti-Patterns (DON'T DO THESE)\n1. \u274c Using Opus for file operations (wastes $$$)\n2. \u274c Direct execution for research (use Gemini instead)\n3. \u274c No delegation audit trail (can't track costs)\n4. \u274c Ignoring cost-first framework (budget burn)\n5. \u274c Delegating without clear success criteria (wasted time)\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>name: Enforce Delegation in Tests\n\non: [pull_request]\n\njobs:\n  delegation-check:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Setup Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.10'\n\n      - name: Install HtmlGraph\n        run: pip install htmlgraph\n\n      - name: Check delegation patterns\n        env:\n          CLAUDE_DELEGATION_ENABLED: 'true'\n          CLAUDE_ORCHESTRATOR_ACTIVE: 'true'\n        run: |\n          python3 &lt;&lt; 'EOF'\n          from htmlgraph import SDK\n\n          # Check if PR includes Task() calls (delegation)\n          # Reject if large changes without delegation\n\n          sdk = SDK(agent=\"ci-bot\")\n\n          # Verify system prompt exists\n          import os\n          if not os.path.exists('.claude/system-prompt.md'):\n              print(\"ERROR: No system prompt found\")\n              exit(1)\n\n          print(\"\u2713 Delegation enforcement active\")\n          print(\"\u2713 System prompt configured\")\n          EOF\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#local-pre-commit-hook","title":"Local Pre-Commit Hook","text":"<pre><code>#!/bin/bash\n# .git/hooks/pre-commit\n\n# Check system prompt is in git\nif ! git show :'.claude/system-prompt.md' &amp;&gt;/dev/null; then\n    echo \"\u26a0\ufe0f  Warning: system-prompt.md not staged\"\nfi\n\n# Verify syntax\nif [ -f '.claude/system-prompt.md' ]; then\n    python3 -m markdown '.claude/system-prompt.md' &gt; /dev/null 2&gt;&amp;1\n    if [ $? -ne 0 ]; then\n        echo \"ERROR: system-prompt.md has syntax errors\"\n        exit 1\n    fi\nfi\n\nexit 0\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#continuous-monitoring","title":"Continuous Monitoring","text":"<pre><code>#!/bin/bash\n# scripts/monitor-delegation.sh\n\n# Track delegation metrics over time\nuv run python3 &lt;&lt; 'EOF'\nfrom htmlgraph import SDK\nfrom datetime import datetime, timedelta\n\nsdk = SDK(agent=\"monitoring-bot\")\n\n# Get metrics from last 7 days\nwindow_start = datetime.now() - timedelta(days=7)\n\nspikes = sdk.spikes.where(created_after=window_start)\n\ndelegated = len([s for s in spikes if s.metadata.get('delegated')])\ntotal = len(spikes)\npercentage = (delegated / total * 100) if total &gt; 0 else 0\n\nprint(f\"Delegation rate: {percentage:.1f}%\")\nprint(f\"Delegated tasks: {delegated}/{total}\")\n\n# Alert if below threshold (e.g., &lt;50%)\nif percentage &lt; 50:\n    print(\"\u26a0\ufe0f  Delegation rate below target!\")\nEOF\n</code></pre>"},{"location":"DELEGATION_ENFORCEMENT_ADMIN_GUIDE/#next-steps","title":"Next Steps","text":"<ol> <li>Enable delegation using Setup &amp; Configuration section</li> <li>Configure system prompt with delegation rules</li> <li>Verify enforcement using Monitoring section</li> <li>Monitor patterns weekly</li> <li>Adjust rules based on team feedback</li> </ol> <p>For system prompt customization details, see System Prompt Customization Guide.</p> <p>For technical architecture, see System Prompt Architecture.</p>"},{"location":"EVENT_TRACING/","title":"Event Tracing System","text":"<p>Complete guide to HtmlGraph's event tracing system for tracking tool executions with millisecond precision.</p>"},{"location":"EVENT_TRACING/#overview","title":"Overview","text":"<p>Event tracing captures and correlates every tool execution in Claude Code via: - PreToolUse Hook - Records tool START event when tool is invoked - PostToolUse Hook - Records tool END event when tool completes - tool_traces Table - SQLite database storing correlated traces - TraceCollection API - Query interface for analysis and debugging</p>"},{"location":"EVENT_TRACING/#why-track-tool-executions","title":"Why Track Tool Executions?","text":"<p>Tool tracing enables: - Performance Analysis - Identify slow tools and bottlenecks - Error Debugging - Track which tools failed and why - Execution Hierarchies - Understand nested tool invocations - Cost Optimization - Analyze token usage by tool - Reliability Metrics - Track success rates and error patterns</p>"},{"location":"EVENT_TRACING/#architecture","title":"Architecture","text":""},{"location":"EVENT_TRACING/#system-design","title":"System Design","text":"<pre><code>Claude Code Hook System\n\u251c\u2500\u2500 PreToolUse Hook (fires before tool execution)\n\u2502   \u251c\u2500\u2500 Generates tool_use_id (UUID v4)\n\u2502   \u251c\u2500\u2500 Captures tool_name, tool_input, start_time\n\u2502   \u251c\u2500\u2500 Stores start event in tool_traces table\n\u2502   \u2514\u2500\u2500 Sets HTMLGRAPH_TOOL_USE_ID environment variable\n\u2502\n\u2514\u2500\u2500 PostToolUse Hook (fires after tool execution)\n    \u251c\u2500\u2500 Reads tool_use_id from environment\n    \u251c\u2500\u2500 Queries tool_traces for matching pre-event\n    \u251c\u2500\u2500 Calculates duration (end_time - start_time)\n    \u251c\u2500\u2500 Stores tool_output, status, error_message\n    \u2514\u2500\u2500 Updates tool_traces with completion data\n</code></pre>"},{"location":"EVENT_TRACING/#correlation-mechanism","title":"Correlation Mechanism","text":"<p>Tool execution traces are correlated via tool_use_id:</p> <ol> <li>PreToolUse Hook generates UUID v4 \u2192 <code>tool_use_id = \"a1b2c3d4-...\"</code></li> <li>Stores in environment \u2192 <code>HTMLGRAPH_TOOL_USE_ID=\"a1b2c3d4-...\"</code></li> <li>PostToolUse Hook reads from environment \u2192 finds matching trace</li> <li>Updates with completion data \u2192 duration, output, status</li> </ol> <p>Example flow:</p> <pre><code>PreToolUse Hook\n\u251c\u2500\u2500 Generates: tool_use_id = \"a1b2c3d4-e5f6-47a8-9b0c-1d2e3f4a5b6c\"\n\u251c\u2500\u2500 Inserts into tool_traces:\n\u2502   - tool_use_id: \"a1b2c3d4-...\"\n\u2502   - tool_name: \"Bash\"\n\u2502   - tool_input: {\"command\": \"ls -la\"}\n\u2502   - start_time: \"2025-01-07T12:34:56.789000+00:00\"\n\u2502   - status: \"started\"\n\u2514\u2500\u2500 Sets: HTMLGRAPH_TOOL_USE_ID=\"a1b2c3d4-...\"\n\n[Tool executes for 1.234 seconds...]\n\nPostToolUse Hook\n\u251c\u2500\u2500 Reads: tool_use_id = \"a1b2c3d4-...\" from environment\n\u251c\u2500\u2500 Queries: SELECT * FROM tool_traces WHERE tool_use_id = \"a1b2c3d4-...\"\n\u251c\u2500\u2500 Calculates: duration_ms = 1234\n\u2514\u2500\u2500 Updates tool_traces:\n    - end_time: \"2025-01-07T12:34:58.023000+00:00\"\n    - duration_ms: 1234\n    - tool_output: {\"stdout\": \"...\"}\n    - status: \"Ok\"\n    - error_message: null\n</code></pre>"},{"location":"EVENT_TRACING/#duration-calculation","title":"Duration Calculation","text":"<p>Duration is calculated as:</p> <pre><code>duration_ms = int((end_time - start_time).total_seconds() * 1000)\n</code></pre> <ul> <li>Both times in ISO8601 UTC format</li> <li>Accuracy within 1 millisecond</li> <li>Handles timezone-aware datetimes automatically</li> </ul> <p>Example:</p> <pre><code>start = \"2025-01-07T12:34:56.789000+00:00\"\nend = \"2025-01-07T12:34:58.023000+00:00\"\n# duration = 1234 milliseconds\n</code></pre>"},{"location":"EVENT_TRACING/#pretooluse-hook","title":"PreToolUse Hook","text":""},{"location":"EVENT_TRACING/#when-it-fires","title":"When It Fires","text":"<p>PreToolUse hook fires before Claude Code executes any tool call.</p> <p>Timing: - Tool call in progress: User invokes a tool - Hook system intercepts: Calls registered PreToolUse hooks - User's tool runs: Hook completes before tool executes</p>"},{"location":"EVENT_TRACING/#what-it-captures","title":"What It Captures","text":"<p>PreToolUse captures and stores:</p> Field Type Example Purpose <code>tool_use_id</code> UUID v4 <code>a1b2c3d4-...</code> Unique identifier for this execution (for correlation) <code>trace_id</code> UUID v4 <code>trace-123-...</code> Parent trace ID (groups related executions) <code>session_id</code> string <code>sess-abc123</code> Which session this execution belongs to <code>tool_name</code> string <code>\"Bash\"</code> Tool being invoked <code>tool_input</code> JSON <code>{\"command\": \"ls\"}</code> Input parameters (sanitized) <code>start_time</code> ISO8601 <code>2025-01-07T...</code> When execution started (UTC) <code>status</code> string <code>\"started\"</code> Current status (always \"started\" at this point)"},{"location":"EVENT_TRACING/#data-schema","title":"Data Schema","text":"<pre><code>CREATE TABLE tool_traces (\n    tool_use_id TEXT PRIMARY KEY,\n    trace_id TEXT NOT NULL,\n    session_id TEXT NOT NULL,\n    tool_name TEXT NOT NULL,\n    tool_input JSON,\n    tool_output JSON,\n    start_time TIMESTAMP NOT NULL,\n    end_time TIMESTAMP,\n    duration_ms INTEGER,\n    status TEXT NOT NULL DEFAULT 'started',\n    error_message TEXT,\n    parent_tool_use_id TEXT,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre>"},{"location":"EVENT_TRACING/#input-sanitization","title":"Input Sanitization","text":"<p>Sensitive data is removed before storage:</p> <pre><code>Removed fields: password, token, secret, key, auth, api_key\nTruncated: Values &gt; 10,000 characters\nExample:\n  Input:  {\"command\": \"curl -X POST\", \"api_key\": \"secret123\"}\n  Stored: {\"command\": \"curl -X POST\", \"api_key\": \"[REDACTED]\"}\n</code></pre>"},{"location":"EVENT_TRACING/#error-handling","title":"Error Handling","text":"Scenario Behavior No session ID Skip event tracing (return empty response) Database unavailable Log warning, continue (non-blocking) Invalid input Sanitize gracefully, store partial data Environment variable not set Generate new tool_use_id, store in environment"},{"location":"EVENT_TRACING/#posttooluse-hook","title":"PostToolUse Hook","text":""},{"location":"EVENT_TRACING/#when-it-fires_1","title":"When It Fires","text":"<p>PostToolUse hook fires after tool execution completes (success or failure).</p> <p>Timing: - Tool execution completes: stdout/stderr captured - Hook system intercepts: Calls registered PostToolUse hooks - User's code resumes: Hook completes before execution returns</p>"},{"location":"EVENT_TRACING/#what-it-updates","title":"What It Updates","text":"<p>PostToolUse updates the existing trace with:</p> Field Type Example Purpose <code>end_time</code> ISO8601 <code>2025-01-07T12:34:58...</code> When execution completed (UTC) <code>duration_ms</code> integer <code>1234</code> Milliseconds elapsed (end - start) <code>tool_output</code> JSON <code>{\"stdout\": \"...\"}</code> Result of tool execution <code>status</code> string <code>\"Ok\"</code> or <code>\"Error\"</code> Success/failure indicator <code>error_message</code> string <code>\"Connection timeout\"</code> Error details if failed"},{"location":"EVENT_TRACING/#duration-calculation_1","title":"Duration Calculation","text":"<p>Duration is calculated in milliseconds:</p> <pre><code>def calculate_duration(start_time_iso: str, end_time_iso: str) -&gt; int:\n    \"\"\"Calculate duration in milliseconds between two ISO8601 UTC timestamps.\"\"\"\n    start_dt = datetime.fromisoformat(start_time_iso.replace(\"Z\", \"+00:00\"))\n    end_dt = datetime.fromisoformat(end_time_iso.replace(\"Z\", \"+00:00\"))\n    delta = end_dt - start_dt\n    return int(delta.total_seconds() * 1000)\n</code></pre> <p>Accuracy: Within 1 millisecond</p>"},{"location":"EVENT_TRACING/#status-determination","title":"Status Determination","text":"<p>Status is determined from tool response:</p> Indicator Status Reason <code>stderr</code> non-empty <code>Error</code> Command output errors <code>error</code> field present <code>Error</code> Explicit error field <code>success: false</code> <code>Error</code> Success flag set to false <code>status: \"error\"</code> <code>Error</code> Status field indicates error Default <code>Ok</code> No error indicators found"},{"location":"EVENT_TRACING/#error-message-storage","title":"Error Message Storage","text":"<p>Error messages are captured from: 1. stderr - Command standard error 2. error field - Explicit error from tool 3. reason field - Explanation of failure 4. message field - Message from error response</p> <p>Limits: Truncated to 500 characters</p>"},{"location":"EVENT_TRACING/#error-handling_1","title":"Error Handling","text":"Scenario Behavior Missing pre-event Log warning, skip duration update, continue Invalid timestamp Log warning, set duration_ms to None, continue JSON serialization fails Log error, store stringified output, continue Database update fails Log error, return False (non-blocking) Invalid status Replace with \"Ok\", log warning, continue <p>All errors are non-blocking - execution continues regardless.</p>"},{"location":"EVENT_TRACING/#querying-traces","title":"Querying Traces","text":""},{"location":"EVENT_TRACING/#tracecollection-api","title":"TraceCollection API","text":"<pre><code>from htmlgraph.sdk import SDK\n\nsdk = SDK(agent=\"claude\")\ntraces = sdk.traces  # TraceCollection instance\n</code></pre>"},{"location":"EVENT_TRACING/#query-methods","title":"Query Methods","text":""},{"location":"EVENT_TRACING/#get-single-trace","title":"Get Single Trace","text":"<pre><code>trace = sdk.traces.get_trace(tool_use_id=\"a1b2c3d4-...\")\nif trace:\n    print(f\"{trace.tool_name}: {trace.duration_ms}ms\")\n    print(f\"Status: {trace.status}\")\n    if trace.error_message:\n        print(f\"Error: {trace.error_message}\")\n</code></pre> <p>Returns: <code>Optional[TraceRecord]</code></p>"},{"location":"EVENT_TRACING/#get-traces-for-session","title":"Get Traces for Session","text":"<pre><code>traces = sdk.traces.get_traces(\n    session_id=\"sess-abc123\",\n    limit=100,  # Maximum traces to return (default 100)\n    start_time=datetime.now(timezone.utc) - timedelta(hours=1)  # Optional filter\n)\n\nfor trace in traces:\n    print(f\"{trace.tool_name}: {trace.duration_ms}ms\")\n</code></pre> <p>Returns: <code>list[TraceRecord]</code> ordered by start_time DESC (newest first)</p>"},{"location":"EVENT_TRACING/#get-traces-by-tool-name","title":"Get Traces by Tool Name","text":"<pre><code>bash_traces = sdk.traces.get_traces_by_tool(\n    tool_name=\"Bash\",\n    limit=50\n)\n\nfor trace in bash_traces:\n    print(f\"Command: {trace.tool_input}\")\n    print(f\"Duration: {trace.duration_ms}ms\")\n</code></pre> <p>Returns: <code>list[TraceRecord]</code> ordered by start_time DESC (newest first)</p>"},{"location":"EVENT_TRACING/#get-hierarchical-trace-tree","title":"Get Hierarchical Trace Tree","text":"<pre><code>tree = sdk.traces.get_trace_tree(trace_id=\"trace-xyz\")\nif tree:\n    print(f\"Root tool: {tree.root.tool_name}\")\n    print(f\"Children: {len(tree.children)}\")\n    for child_tree in tree.children:\n        print(f\"  - {child_tree.root.tool_name}\")\n</code></pre> <p>Returns: <code>Optional[TraceTree]</code> with parent-child relationships</p>"},{"location":"EVENT_TRACING/#find-slow-tool-calls","title":"Find Slow Tool Calls","text":"<pre><code>slow = sdk.traces.get_slow_traces(\n    threshold_ms=1000,  # Tools taking &gt; 1 second\n    limit=20\n)\n\nfor trace in slow:\n    print(f\"{trace.tool_name}: {trace.duration_ms}ms\")\n</code></pre> <p>Returns: <code>list[TraceRecord]</code> ordered by duration_ms DESC (slowest first)</p>"},{"location":"EVENT_TRACING/#get-error-traces","title":"Get Error Traces","text":"<pre><code>errors = sdk.traces.get_error_traces(\n    session_id=\"sess-abc123\",\n    limit=50\n)\n\nfor trace in errors:\n    print(f\"{trace.tool_name} failed: {trace.error_message}\")\n    print(f\"Status: {trace.status}\")\n</code></pre> <p>Returns: <code>list[TraceRecord]</code> ordered by start_time DESC (newest first)</p>"},{"location":"EVENT_TRACING/#tracerecord-fields","title":"TraceRecord Fields","text":"<pre><code>@dataclass\nclass TraceRecord:\n    tool_use_id: str              # Unique execution ID\n    trace_id: str                 # Parent trace ID\n    session_id: str               # Session this belongs to\n    tool_name: str                # Tool name (e.g., \"Bash\")\n    tool_input: Optional[dict]    # Input parameters\n    tool_output: Optional[dict]   # Result/output\n    start_time: datetime          # When it started (UTC)\n    end_time: Optional[datetime]  # When it ended (UTC)\n    duration_ms: Optional[int]    # Milliseconds elapsed\n    status: Optional[str]         # \"started\", \"completed\", \"failed\", etc.\n    error_message: Optional[str]  # Error details if failed\n    parent_tool_use_id: Optional[str]  # Parent tool if nested\n</code></pre>"},{"location":"EVENT_TRACING/#common-patterns","title":"Common Patterns","text":""},{"location":"EVENT_TRACING/#find-performance-bottlenecks","title":"Find Performance Bottlenecks","text":"<pre><code># Get slowest tools in last hour\nfrom datetime import datetime, timedelta, timezone\n\none_hour_ago = datetime.now(timezone.utc) - timedelta(hours=1)\nslow_tools = sdk.traces.get_traces(\n    session_id=\"sess-123\",\n    start_time=one_hour_ago,\n    limit=100\n)\n\n# Group by tool name\nfrom collections import Counter\ntool_times = Counter()\nfor trace in slow_tools:\n    tool_times[trace.tool_name] += trace.duration_ms or 0\n\n# Show slowest tools\nfor tool, total_ms in tool_times.most_common(5):\n    print(f\"{tool}: {total_ms}ms total\")\n</code></pre>"},{"location":"EVENT_TRACING/#debug-tool-failures","title":"Debug Tool Failures","text":"<pre><code># Get all errors in session\nerrors = sdk.traces.get_error_traces(session_id=\"sess-123\")\n\n# Analyze failure patterns\nfailure_by_tool = {}\nfor trace in errors:\n    if trace.tool_name not in failure_by_tool:\n        failure_by_tool[trace.tool_name] = []\n    failure_by_tool[trace.tool_name].append({\n        \"error\": trace.error_message,\n        \"status\": trace.status,\n        \"time\": trace.start_time,\n    })\n\n# Print failure analysis\nfor tool, failures in failure_by_tool.items():\n    print(f\"\\n{tool}: {len(failures)} failures\")\n    for failure in failures[:3]:  # Show first 3\n        print(f\"  - {failure['error']}\")\n</code></pre>"},{"location":"EVENT_TRACING/#trace-nested-executions","title":"Trace Nested Executions","text":"<pre><code># Find parent-child relationships\ntree = sdk.traces.get_trace_tree(trace_id=\"trace-123\")\nif tree:\n    def print_tree(node, indent=0):\n        prefix = \"  \" * indent\n        print(f\"{prefix}{node.root.tool_name}: {node.root.duration_ms}ms\")\n        for child in node.children:\n            print_tree(child, indent + 1)\n\n    print_tree(tree)\n</code></pre> <p>Example output: <pre><code>Bash: 2500ms\n  Read: 150ms\n  Read: 200ms\n  Bash: 800ms\n    Write: 100ms\n</code></pre></p>"},{"location":"EVENT_TRACING/#track-tool-usage-statistics","title":"Track Tool Usage Statistics","text":"<pre><code># Get all traces for session\nall_traces = sdk.traces.get_traces(session_id=\"sess-123\", limit=1000)\n\n# Calculate statistics\nstats = {}\nfor trace in all_traces:\n    if trace.tool_name not in stats:\n        stats[trace.tool_name] = {\n            \"count\": 0,\n            \"total_ms\": 0,\n            \"errors\": 0,\n            \"min_ms\": float('inf'),\n            \"max_ms\": 0,\n        }\n\n    s = stats[trace.tool_name]\n    s[\"count\"] += 1\n    s[\"total_ms\"] += trace.duration_ms or 0\n    if trace.status == \"failed\":\n        s[\"errors\"] += 1\n    if trace.duration_ms:\n        s[\"min_ms\"] = min(s[\"min_ms\"], trace.duration_ms)\n        s[\"max_ms\"] = max(s[\"max_ms\"], trace.duration_ms)\n\n# Print statistics\nfor tool, s in sorted(stats.items()):\n    avg = s[\"total_ms\"] // s[\"count\"] if s[\"count\"] &gt; 0 else 0\n    print(f\"{tool}:\")\n    print(f\"  Count: {s['count']}, Errors: {s['errors']}\")\n    print(f\"  Total: {s['total_ms']}ms, Avg: {avg}ms\")\n    print(f\"  Range: {s['min_ms']}-{s['max_ms']}ms\")\n</code></pre>"},{"location":"EVENT_TRACING/#examples","title":"Examples","text":""},{"location":"EVENT_TRACING/#example-1-analyze-recent-session","title":"Example 1: Analyze Recent Session","text":"<pre><code>from datetime import datetime, timedelta, timezone\n\n# Get last 50 traces from current session\nrecent_traces = sdk.traces.get_traces(\n    session_id=\"sess-current\",\n    limit=50\n)\n\nprint(f\"Found {len(recent_traces)} traces\")\nfor trace in recent_traces:\n    status = \"\u2713\" if trace.status == \"completed\" else \"\u2717\"\n    print(f\"{status} {trace.tool_name:15} {trace.duration_ms:6}ms\")\n</code></pre>"},{"location":"EVENT_TRACING/#example-2-find-repeated-failures","title":"Example 2: Find Repeated Failures","text":"<pre><code># Get all errors\nerrors = sdk.traces.get_error_traces(\"sess-123\", limit=100)\n\n# Group by error message\nerror_patterns = {}\nfor trace in errors:\n    error_key = (trace.tool_name, trace.error_message[:50])\n    if error_key not in error_patterns:\n        error_patterns[error_key] = 0\n    error_patterns[error_key] += 1\n\n# Show repeated failures\nfor (tool, error), count in sorted(\n    error_patterns.items(),\n    key=lambda x: x[1],\n    reverse=True\n):\n    if count &gt; 1:\n        print(f\"{count}x {tool}: {error}\")\n</code></pre>"},{"location":"EVENT_TRACING/#example-3-monitor-tool-performance","title":"Example 3: Monitor Tool Performance","text":"<pre><code># Track performance over time\nimport time\n\nwhile True:\n    # Get last 10 traces\n    recent = sdk.traces.get_traces(\"sess-123\", limit=10)\n\n    if recent:\n        avg_time = sum(t.duration_ms or 0 for t in recent) / len(recent)\n        error_count = sum(1 for t in recent if t.status == \"failed\")\n        print(f\"Avg: {avg_time:.0f}ms, Errors: {error_count}/10\")\n\n    time.sleep(5)\n</code></pre>"},{"location":"EVENT_TRACING/#troubleshooting","title":"Troubleshooting","text":""},{"location":"EVENT_TRACING/#missing-traces","title":"Missing Traces","text":"<p>Problem: Expected traces not appearing in database</p> <p>Causes &amp; Solutions: 1. Session ID not set - <code>HTMLGRAPH_SESSION_ID</code> environment variable not set    - Solution: Ensure SessionStart hook is running</p> <ol> <li>PreToolUse hook not running - Hook not registered or disabled</li> <li> <p>Solution: Check <code>.claude/hooks/hooks.json</code> for PreToolUse hook</p> </li> <li> <p>Tool execution too fast - Tool completed before PreToolUse saved</p> </li> <li>Solution: Rare, but check logs for timing issues</li> </ol> <p>Debug Steps: <pre><code>import os\n\n# Check environment\nprint(f\"Session ID: {os.environ.get('HTMLGRAPH_SESSION_ID')}\")\nprint(f\"Tool Use ID: {os.environ.get('HTMLGRAPH_TOOL_USE_ID')}\")\n\n# Check database directly\nfrom htmlgraph.db.schema import HtmlGraphDB\ndb = HtmlGraphDB()\ncursor = db.connection.cursor()\ncursor.execute(\"SELECT COUNT(*) FROM tool_traces\")\ncount = cursor.fetchone()[0]\nprint(f\"Total traces in DB: {count}\")\n</code></pre></p>"},{"location":"EVENT_TRACING/#incorrect-duration","title":"Incorrect Duration","text":"<p>Problem: Duration seems wrong or missing</p> <p>Causes &amp; Solutions: 1. Tool still running - <code>end_time</code> and <code>duration_ms</code> are null while executing    - Solution: Normal - wait for tool to complete</p> <ol> <li>Clock skew - Start and end times from different systems</li> <li> <p>Solution: Ensure all systems have NTP sync</p> </li> <li> <p>Invalid timestamp format - Timestamp parsing failed</p> </li> <li>Solution: Check logs for \"Error calculating duration\"</li> </ol> <p>Debug Steps: <pre><code>trace = sdk.traces.get_trace(\"tool-use-id\")\nif trace:\n    print(f\"Start: {trace.start_time}\")\n    print(f\"End: {trace.end_time}\")\n    print(f\"Duration: {trace.duration_ms}ms\")\n\n    if trace.end_time and not trace.duration_ms:\n        # Duration calculation failed\n        print(\"Duration calculation error - check logs\")\n</code></pre></p>"},{"location":"EVENT_TRACING/#pretooluseposttooluse-mismatch","title":"PreToolUse/PostToolUse Mismatch","text":"<p>Problem: Start event exists but no end event</p> <p>Causes &amp; Solutions: 1. Tool still executing - Normal if tool is slow    - Solution: Wait longer, check with get_trace()</p> <ol> <li>PostToolUse hook failed - Hook error, not blocking</li> <li> <p>Solution: Check logs for errors</p> </li> <li> <p>Database connection lost - PostToolUse couldn't update</p> </li> <li>Solution: Check database availability, retry</li> </ol> <p>Debug Steps: <pre><code># Find traces without end_time\nfrom htmlgraph.db.schema import HtmlGraphDB\ndb = HtmlGraphDB()\ncursor = db.connection.cursor()\ncursor.execute(\"\"\"\n    SELECT tool_use_id, tool_name, status, start_time\n    FROM tool_traces\n    WHERE end_time IS NULL\n    ORDER BY start_time DESC\n    LIMIT 10\n\"\"\")\nfor row in cursor.fetchall():\n    print(f\"{row[0]}: {row[1]} ({row[2]}) at {row[3]}\")\n</code></pre></p>"},{"location":"EVENT_TRACING/#database-issues","title":"Database Issues","text":"<p>Problem: Database queries timing out or failing</p> <p>Causes &amp; Solutions: 1. Database locked - Another process holding write lock    - Solution: Check for hung processes, restart if needed</p> <ol> <li>Disk full - SQLite can't write</li> <li> <p>Solution: Check disk space, clean up old data</p> </li> <li> <p>Corrupted database - Database file corrupted</p> </li> <li>Solution: Close all connections, run PRAGMA integrity_check</li> </ol> <p>Debug Steps: <pre><code># Check database integrity\nsqlite3 ~/.htmlgraph/htmlgraph.db \"PRAGMA integrity_check\"\n\n# Check disk space\ndf -h ~/.htmlgraph/\n\n# Check database size\ndu -sh ~/.htmlgraph/htmlgraph.db\n</code></pre></p>"},{"location":"EVENT_TRACING/#performance-tips","title":"Performance Tips","text":""},{"location":"EVENT_TRACING/#query-performance","title":"Query Performance","text":"<ul> <li>Use session_id filter - Most selective, use always</li> <li>Use tool_name filter - Good for tool-specific analysis</li> <li>Limit result size - Default 100, increase carefully</li> <li>Start with recent data - Use start_time parameter</li> </ul>"},{"location":"EVENT_TRACING/#large-datasets","title":"Large Datasets","text":"<p>For sessions with 1000+ traces:</p> <pre><code># Instead of fetching all at once\nslow = sdk.traces.get_slow_traces(threshold_ms=1000, limit=100)\n\n# Or paginate manually\nfor i in range(0, 1000, 100):\n    batch = sdk.traces.get_traces(\"sess-123\", limit=100)\n    # Process batch\n</code></pre>"},{"location":"EVENT_TRACING/#database-maintenance","title":"Database Maintenance","text":"<p>Periodically archive old traces:</p> <pre><code># Archive traces older than 30 days\nimport sqlite3\nfrom datetime import datetime, timedelta\n\ndb = HtmlGraphDB()\nthirty_days_ago = (datetime.now() - timedelta(days=30)).isoformat()\n\ncursor = db.connection.cursor()\ncursor.execute(\"\"\"\n    DELETE FROM tool_traces\n    WHERE start_time &lt; ?\n\"\"\", (thirty_days_ago,))\ndb.connection.commit()\n</code></pre>"},{"location":"EVENT_TRACING/#related-documentation","title":"Related Documentation","text":"<ul> <li>HOOK_ARCHITECTURE.md - Hook system overview</li> <li>System Prompt Architecture - Hook persistence</li> <li>Claude Code Documentation - Official Claude Code docs</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/","title":"Git-Based Continuity Spine Architecture","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#overview","title":"Overview","text":"<p>HtmlGraph uses Git as a universal continuity spine that enables agent-agnostic session tracking and event logging. This architecture eliminates dependence on platform-specific hooks (like Claude Code plugin hooks) and makes HtmlGraph work with ANY coding agent.</p> <p>Core Principle: Git commits are universal continuity points that work regardless of which agent wrote the code.</p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#architecture-components","title":"Architecture Components","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#1-git-hooks-as-continuity-anchors","title":"1. Git Hooks as Continuity Anchors","text":"<p>Git provides universal hooks that work regardless of which agent/tool is writing code. HtmlGraph leverages these to create a continuity spine:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       GIT COMMIT GRAPH                           \u2502\n\u2502  (Universal source of truth - works with all agents)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502            \u2502            \u2502                        \u2502\n\u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n\u2502 Commit \u2502  \u2502 Commit \u2502  \u2502 Commit \u2502     ...      \u2502 Commit \u2502\n\u2502  abc1  \u2502\u2500\u2500\u2502  abc2  \u2502\u2500\u2500\u2502  abc3  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  abc4  \u2502\n\u2502        \u2502  \u2502        \u2502  \u2502        \u2502              \u2502        \u2502\n\u2502session \u2502  \u2502session \u2502  \u2502session \u2502              \u2502session \u2502\n\u2502  S1    \u2502  \u2502  S1    \u2502  \u2502  S2    \u2502              \u2502  S2    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502           \u2502           \u2502                        \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502  Event Log       \u2502\n                \u2502  (.htmlgraph/    \u2502\n                \u2502   events/)       \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#hook-types-and-responsibilities","title":"Hook Types and Responsibilities","text":"<p><code>post-commit</code> - Primary continuity anchor - Logs commit hash, branch, author, message - Records files changed (insertions/deletions) - Links to active features via:   - Explicit references in commit message (<code>feature-xyz</code>)   - Active features from session state   - File pattern matching to feature file patterns - Creates GitCommit events in <code>.htmlgraph/events/</code></p> <p><code>post-checkout</code> - Branch continuity - Tracks branch switches (<code>main</code> \u2192 <code>feature/auth</code>) - Detects context switches between work items - Enables session reconstruction across branches - Links work that spans multiple branches</p> <p><code>post-merge</code> - Integration events - Logs successful merges - Tracks source and target branches - Records integration milestones - Detects merge commits (multiple parents)</p> <p><code>pre-push</code> - Team boundaries - Logs what's being pushed before remote update - Marks \"going public\" events - Tracks when local work becomes shared - Can trigger team notifications</p> <p><code>pre-commit</code> - Quality gates (blocking) - Enforces SDK usage (blocks direct <code>.htmlgraph/</code> edits) - Runs code quality checks (ruff, mypy) - Can be bypassed with <code>git commit --no-verify</code></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#2-event-log-schema","title":"2. Event Log Schema","text":"<p>All Git hooks write to the same append-only JSONL event stream:</p> <pre><code>@dataclass(frozen=True)\nclass EventRecord:\n    event_id: str              # Unique ID (e.g., \"git-commit-abc123-feature-xyz\")\n    timestamp: datetime        # When the event occurred\n    session_id: str            # Session this event belongs to\n    agent: str                 # Agent name (claude, codex, git, etc.)\n    tool: str                  # Tool name (GitCommit, GitCheckout, etc.)\n    summary: str               # Human-readable summary\n    success: bool              # Whether operation succeeded\n    feature_id: str | None     # Feature this event relates to\n    start_commit: str | None   # Session's starting commit\n    continued_from: str | None # Previous session ID (for continuity)\n    work_type: str | None      # Type of work (feature, bug, spike, etc.)\n    session_status: str | None # Session status (active, ended, etc.)\n    file_paths: list[str]      # Files affected\n    payload: dict              # Event-specific data\n</code></pre>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#event-types","title":"Event Types","text":"<p>GitCommit <pre><code>{\n  \"type\": \"GitCommit\",\n  \"commit_hash\": \"abc123def456...\",\n  \"commit_hash_short\": \"abc123\",\n  \"parents\": [\"parent1\", \"parent2\"],\n  \"is_merge\": false,\n  \"branch\": \"main\",\n  \"author_name\": \"Alice Developer\",\n  \"author_email\": \"alice@example.com\",\n  \"commit_message\": \"feat: add user authentication\",\n  \"subject\": \"feat: add user authentication\",\n  \"files_changed\": [\"src/auth/login.py\", \"tests/test_auth.py\"],\n  \"insertions\": 145,\n  \"deletions\": 23,\n  \"features\": [\"feature-20251220-auth\"]\n}\n</code></pre></p> <p>GitCheckout <pre><code>{\n  \"type\": \"GitCheckout\",\n  \"old_head\": \"abc123...\",\n  \"new_head\": \"def456...\",\n  \"flag\": 1,\n  \"reflog_action\": \"checkout: moving from main to feature/auth\",\n  \"from_branch\": \"main\",\n  \"to_branch\": \"feature/auth\"\n}\n</code></pre></p> <p>GitMerge <pre><code>{\n  \"type\": \"GitMerge\",\n  \"squash\": false,\n  \"orig_head\": \"abc123...\",\n  \"new_head\": \"def456...\",\n  \"reflog_action\": \"merge feature/auth: Fast-forward\"\n}\n</code></pre></p> <p>GitPush <pre><code>{\n  \"type\": \"GitPush\",\n  \"remote_name\": \"origin\",\n  \"remote_url\": \"git@github.com:user/repo.git\",\n  \"updates\": [\n    {\n      \"local_ref\": \"refs/heads/main\",\n      \"local_sha\": \"abc123...\",\n      \"remote_ref\": \"refs/heads/main\",\n      \"remote_sha\": \"def456...\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#3-session-continuity-via-git-commits","title":"3. Session Continuity via Git Commits","text":"<p>Sessions are linked through Git commits, creating a continuity spine that survives session boundaries:</p> <pre><code>Session S1 (Claude)          Session S2 (Codex)         Session S3 (Claude)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500       \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500      \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nstart_commit: abc1          start_commit: abc3         start_commit: abc5\ncontinued_from: None        continued_from: S1         continued_from: S2\n\nEvents:                     Events:                    Events:\n  - Edit file               - Edit file                - Edit file\n  - GitCommit abc1          - GitCommit abc3           - GitCommit abc5\n  - Edit file               - GitCommit abc4           - GitCommit abc6\n  - GitCommit abc2\n\nend_commit: abc2            end_commit: abc4           end_commit: abc6\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                                Git Commit Graph:\n                                abc1 \u2192 abc2 \u2192 abc3 \u2192 abc4 \u2192 abc5 \u2192 abc6\n                                 \u2502             \u2502             \u2502\n                                S1            S2            S3\n</code></pre> <p>Key Continuity Mechanisms:</p> <ol> <li>start_commit - Git commit hash when session started</li> <li>continued_from - Previous session ID (when continuing work)</li> <li>Commit graph analysis - Walk commit history to find related sessions</li> <li>Feature attribution - Link sessions via shared features</li> </ol>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#4-agent-agnostic-design","title":"4. Agent-Agnostic Design","text":"<p>The architecture works with ANY agent because it relies on universal primitives:</p> Primitive Why Universal Example Git commits Every agent that saves code creates commits Claude, Codex, Cursor, vim + git File changes All agents modify files Any text editor Commit messages Standard Git feature Any Git client Branch operations Core Git workflow Any Git tool <p>Agent Compatibility Matrix:</p> Agent Git Hooks File Watching Session Tracking Notes Claude Code \u2705 \u2705 \u2705 Full integration via plugin GitHub Codex \u2705 \u2705 \u2705 Git hooks + filesystem watcher Google Gemini \u2705 \u2705 \u2705 Git hooks + filesystem watcher Cursor \u2705 \u2705 \u2705 Git hooks + filesystem watcher vim/emacs + git \u2705 \u2705 \u26a0\ufe0f Requires manual session start Any CLI tool \u2705 \u274c \u274c Commits tracked, but no fine-grained events"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#continuity-reconstruction","title":"Continuity Reconstruction","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#how-sessions-link-across-agents","title":"How Sessions Link Across Agents","text":"<p>HtmlGraph reconstructs session continuity using multiple signals:</p> <p>1. Explicit Continuation <pre><code># Session S2 explicitly continues S1\nsession_s2 = manager.start_session(\n    agent=\"codex\",\n    continued_from=\"session-s1\"\n)\n# S2.continued_from = \"session-s1\"\n# S2.start_commit = get_current_commit()\n</code></pre></p> <p>2. Commit Graph Analysis <pre><code># Find sessions between two commits\ndef find_sessions_between(commit_a: str, commit_b: str) -&gt; list[Session]:\n    # Walk git log from commit_a to commit_b\n    commits = git_log_between(commit_a, commit_b)\n\n    # Find events with these commits\n    events = event_log.query(\n        tool=\"GitCommit\",\n        commit_hash__in=commits\n    )\n\n    # Extract unique session IDs\n    session_ids = {event.session_id for event in events}\n    return [get_session(sid) for sid in session_ids]\n</code></pre></p> <p>3. Feature-Based Linking <pre><code># Find all sessions that worked on a feature\ndef find_feature_sessions(feature_id: str) -&gt; list[Session]:\n    events = event_log.query(feature_id=feature_id)\n    session_ids = {event.session_id for event in events}\n    return sorted([get_session(sid) for sid in session_ids],\n                  key=lambda s: s.created)\n</code></pre></p> <p>4. Time-Based Proximity <pre><code># Find sessions within time window\ndef find_proximate_sessions(\n    reference_time: datetime,\n    window_minutes: int = 60\n) -&gt; list[Session]:\n    start = reference_time - timedelta(minutes=window_minutes)\n    end = reference_time + timedelta(minutes=window_minutes)\n    return session_converter.query(\n        created__gte=start,\n        created__lte=end\n    )\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#example-cross-agent-continuity","title":"Example: Cross-Agent Continuity","text":"<p>Scenario: Work starts in Claude, continues in Codex, finishes in Claude</p> <pre><code>Day 1, 10am (Claude):\n  session-s1-abc = manager.start_session(agent=\"claude\")\n  # User works...\n  git commit -m \"feat: start auth (feature-auth-001)\"  \u2192 abc123\n  manager.end_session(\"session-s1-abc\")\n\nDay 1, 2pm (Codex):\n  session-s2-def = manager.start_session(\n      agent=\"codex\",\n      continued_from=\"session-s1-abc\"  # Optional but helpful\n  )\n  # User works...\n  git commit -m \"feat: continue auth (feature-auth-001)\"  \u2192 def456\n  manager.end_session(\"session-s2-def\")\n\nDay 2, 9am (Claude):\n  session-s3-ghi = manager.start_session(agent=\"claude\")\n  # HtmlGraph automatically detects continuation via:\n  #   1. Same feature (feature-auth-001)\n  #   2. Commit graph (abc123 \u2192 def456 \u2192 current)\n  #   3. Session summary handoff notes\n  git commit -m \"feat: finish auth (feature-auth-001)\"  \u2192 ghi789\n</code></pre> <p>Query for full history: <pre><code># Get all sessions for feature-auth-001\nsessions = sdk.get_feature_sessions(\"feature-auth-001\")\n\n# Result:\n# [\n#   Session(id=\"session-s1-abc\", agent=\"claude\", ...),\n#   Session(id=\"session-s2-def\", agent=\"codex\", ...),\n#   Session(id=\"session-s3-ghi\", agent=\"claude\", ...)\n# ]\n\n# Get commit history\ncommits = git_log(\"feature-auth-001\")\n# [abc123, def456, ghi789]\n\n# Link sessions via commits\nfor session in sessions:\n    commits_in_session = event_log.query(\n        session_id=session.id,\n        tool=\"GitCommit\"\n    )\n    print(f\"{session.agent}: {[e.payload['commit_hash_short']\n                               for e in commits_in_session]}\")\n\n# Output:\n# claude: ['abc123']\n# codex: ['def456']\n# claude: ['ghi789']\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#event-attribution","title":"Event Attribution","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#how-events-link-to-features","title":"How Events Link to Features","text":"<p>HtmlGraph uses multiple strategies to attribute events to features:</p> <p>1. Active Features (Session State) <pre><code># Features marked as in-progress\nactive_features = manager.get_active_features()\n# \u2192 ['feature-auth-001', 'feature-db-002']\n</code></pre></p> <p>2. Commit Message Parsing <pre><code>def parse_feature_refs(message: str) -&gt; list[str]:\n    \"\"\"\n    Extract feature references from commit message.\n\n    Patterns:\n    - Implements: feature-xyz\n    - Fixes: bug-abc\n    - feature-xyz (anywhere in message)\n    \"\"\"\n    features = []\n\n    # Explicit references\n    pattern1 = r\"(?:Implements|Fixes|Closes|Refs):\\s*(feature-[\\w-]+|bug-[\\w-]+)\"\n    features.extend(re.findall(pattern1, message, re.IGNORECASE))\n\n    # Mentions anywhere\n    pattern2 = r\"\\b(feature-[\\w-]+|bug-[\\w-]+)\\b\"\n    features.extend(re.findall(pattern2, message, re.IGNORECASE))\n\n    return list(set(features))  # Remove duplicates\n\n# Example:\nmessage = \"feat: add login endpoint (feature-auth-001)\"\nfeatures = parse_feature_refs(message)\n# \u2192 ['feature-auth-001']\n</code></pre></p> <p>3. File Pattern Matching <pre><code># Features can specify file patterns\nfeature.file_patterns = [\n    \"src/auth/**/*.py\",\n    \"tests/auth/**/*.py\"\n]\n\n# When commit changes files, match against patterns\nchanged_files = [\"src/auth/login.py\", \"tests/auth/test_login.py\"]\nmatched_features = []\nfor feature in all_features:\n    if any(fnmatch.fnmatch(f, pattern)\n           for f in changed_files\n           for pattern in feature.file_patterns):\n        matched_features.append(feature.id)\n\n# \u2192 ['feature-auth-001']\n</code></pre></p> <p>4. Combined Attribution <pre><code>def attribute_commit(commit_hash: str) -&gt; list[str]:\n    \"\"\"Combine all attribution strategies.\"\"\"\n    commit_info = git_show(commit_hash)\n\n    features = []\n\n    # 1. Active features at commit time\n    features.extend(get_active_features_at_commit(commit_hash))\n\n    # 2. Mentioned in commit message\n    features.extend(parse_feature_refs(commit_info.message))\n\n    # 3. File pattern matching\n    features.extend(match_files_to_features(commit_info.files))\n\n    # Remove duplicates, preserve order\n    return list(dict.fromkeys(features))\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#implementation-details","title":"Implementation Details","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#git-hook-installation","title":"Git Hook Installation","text":"<p>Location: <code>.htmlgraph/hooks/</code> (versioned) \u2192 <code>.git/hooks/</code> (symlinked)</p> <pre><code># Install hooks\nhtmlgraph install-hooks\n\n# Creates:\n.git/hooks/post-commit    \u2192 .htmlgraph/hooks/post-commit.sh\n.git/hooks/post-checkout  \u2192 .htmlgraph/hooks/post-checkout.sh\n.git/hooks/post-merge     \u2192 .htmlgraph/hooks/post-merge.sh\n.git/hooks/pre-push       \u2192 .htmlgraph/hooks/pre-push.sh\n.git/hooks/pre-commit     \u2192 .htmlgraph/hooks/pre-commit.sh\n</code></pre> <p>Hook Script Structure: <pre><code>#!/bin/bash\n# .htmlgraph/hooks/post-commit.sh\n\n# Exit early if disabled\nif [ \"$(git config --bool htmlgraph.hooks)\" = \"false\" ]; then\n    exit 0\nfi\n\n# Call HtmlGraph event logger\nuv run python -m htmlgraph.git_events commit\n\n# Always succeed (non-blocking)\nexit 0\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#event-log-storage","title":"Event Log Storage","text":"<p>Directory Structure: <pre><code>.htmlgraph/\n\u251c\u2500\u2500 events/\n\u2502   \u251c\u2500\u2500 session-s1-abc.jsonl        # Events for session S1\n\u2502   \u251c\u2500\u2500 session-s2-def.jsonl        # Events for session S2\n\u2502   \u2514\u2500\u2500 git.jsonl                   # Events from Git (no active session)\n</code></pre></p> <p>Append-Only Design: - Each session gets its own JSONL file - Events append to the file (never update existing lines) - Deduplication: Check last 250 lines for duplicate event_id - Git-friendly: Text diffs work well</p> <p>Querying Events: <pre><code>from htmlgraph.event_log import JsonlEventLog\n\nlog = JsonlEventLog(\".htmlgraph/events\")\n\n# Get all events for a session\nevents = log.get_session_events(\"session-s1-abc\")\n\n# Iterate all events across all sessions\nfor path, event in log.iter_events():\n    if event[\"tool\"] == \"GitCommit\":\n        print(f\"Commit: {event['payload']['commit_hash_short']}\")\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#session-manager-integration","title":"Session Manager Integration","text":"<p>Determining Context for Git Events: <pre><code>def _determine_context(graph_dir: Path, commit_message: str | None = None) -&gt; dict:\n    \"\"\"\n    Determine best-effort session + feature context for Git events.\n\n    Returns:\n        session_id, agent, start_commit, continued_from, session_status,\n        active_features, primary_feature_id, message_features, all_features\n    \"\"\"\n    active_features = get_active_features(graph_dir)\n    primary_feature_id = get_primary_feature_id(graph_dir)\n    message_features = parse_feature_refs(commit_message or \"\")\n\n    # Combine all feature references\n    all_features = list(dict.fromkeys(\n        active_features + message_features\n    ))\n\n    # Get active session if exists\n    session = get_active_session(graph_dir)\n    if session:\n        return {\n            \"session_id\": session.id,\n            \"agent\": session.agent,\n            \"start_commit\": session.start_commit,\n            \"continued_from\": session.continued_from,\n            \"session_status\": session.status,\n            \"active_features\": active_features,\n            \"primary_feature_id\": primary_feature_id,\n            \"message_features\": message_features,\n            \"all_features\": all_features,\n        }\n\n    # No active session: use stable pseudo-session \"git\"\n    return {\n        \"session_id\": \"git\",\n        \"agent\": \"git\",\n        \"start_commit\": None,\n        \"continued_from\": None,\n        \"session_status\": None,\n        \"active_features\": active_features,\n        \"primary_feature_id\": primary_feature_id,\n        \"message_features\": message_features,\n        \"all_features\": all_features,\n    }\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#cross-session-analytics","title":"Cross-Session Analytics","text":"<p>Commit Graph Queries: <pre><code>class CommitGraphAnalytics:\n    \"\"\"Analytics across sessions using Git commit graph.\"\"\"\n\n    def get_feature_timeline(self, feature_id: str) -&gt; list[dict]:\n        \"\"\"Get chronological timeline of work on a feature.\"\"\"\n        events = event_log.query(feature_id=feature_id, tool=\"GitCommit\")\n\n        timeline = []\n        for event in sorted(events, key=lambda e: e.timestamp):\n            timeline.append({\n                \"timestamp\": event.timestamp,\n                \"commit\": event.payload[\"commit_hash_short\"],\n                \"agent\": event.agent,\n                \"session_id\": event.session_id,\n                \"message\": event.payload[\"subject\"],\n                \"files_changed\": len(event.file_paths),\n                \"insertions\": event.payload[\"insertions\"],\n                \"deletions\": event.payload[\"deletions\"],\n            })\n\n        return timeline\n\n    def get_session_chain(self, session_id: str) -&gt; list[Session]:\n        \"\"\"Get chain of sessions (backwards via continued_from).\"\"\"\n        chain = []\n        current = get_session(session_id)\n\n        while current:\n            chain.append(current)\n            if current.continued_from:\n                current = get_session(current.continued_from)\n            else:\n                break\n\n        return list(reversed(chain))  # Oldest first\n\n    def get_commit_attribution(self, commit_hash: str) -&gt; dict:\n        \"\"\"Get full attribution for a commit.\"\"\"\n        events = event_log.query(\n            tool=\"GitCommit\",\n            payload__commit_hash=commit_hash\n        )\n\n        if not events:\n            return {\"commit\": commit_hash, \"sessions\": [], \"features\": []}\n\n        return {\n            \"commit\": commit_hash,\n            \"sessions\": list(set(e.session_id for e in events)),\n            \"features\": list(set(e.feature_id for e in events if e.feature_id)),\n            \"agents\": list(set(e.agent for e in events)),\n            \"timestamp\": events[0].timestamp,\n        }\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#benefits-of-git-based-continuity","title":"Benefits of Git-Based Continuity","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#1-agent-agnostic","title":"1. Agent Agnostic","text":"<ul> <li>Works with ANY coding agent (Claude, Codex, Cursor, vim)</li> <li>No platform-specific integrations required</li> <li>Git is universal across all development tools</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#2-survives-session-boundaries","title":"2. Survives Session Boundaries","text":"<ul> <li>Commits link sessions even after process dies</li> <li>Work can be picked up by any agent</li> <li>Full history reconstruction possible</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#3-team-collaboration","title":"3. Team Collaboration","text":"<ul> <li>Multiple developers/agents can work simultaneously</li> <li>Merge events track integration points</li> <li>Push events mark team boundaries</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#4-offline-first","title":"4. Offline-First","text":"<ul> <li>All tracking works offline (Git is local)</li> <li>No network dependencies</li> <li>Sync naturally via git push/pull</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#5-version-control-native","title":"5. Version Control Native","text":"<ul> <li>Event log is Git-friendly (text files)</li> <li>Diffs show what changed</li> <li>Branches work naturally</li> <li>Merge conflicts are visible</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#6-simple-and-robust","title":"6. Simple and Robust","text":"<ul> <li>Minimal dependencies (just Git)</li> <li>Append-only design (no corruption)</li> <li>Fail-safe (hooks never block Git operations)</li> <li>Easy to debug (just read JSONL files)</li> </ul>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#git-hook-overhead","title":"Git Hook Overhead","text":"Hook Type Typical Latency Impact post-commit Non-blocking &lt;50ms None (async) post-checkout Non-blocking &lt;30ms None (async) post-merge Non-blocking &lt;30ms None (async) pre-push Non-blocking &lt;100ms None (async) pre-commit Blocking &lt;100ms Minimal (fast checks) <p>Optimization Strategies: - Hooks run in background (daemon process) - Deduplication prevents redundant events - Batch writes to reduce I/O - Tail-only deduplication (last 250 lines)</p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#event-log-scalability","title":"Event Log Scalability","text":"Metric Value Notes Events per session ~500-1000 Typical development session Session file size ~500KB Uncompressed JSONL Query time (1000 events) &lt;10ms Sequential scan Deduplication check &lt;5ms Tail-only (last 64KB) <p>Scaling Strategies: - Partition by session (natural sharding) - Optional SQLite index for complex queries - Compression for old events - TTL/rotation policy (configurable)</p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#security-considerations","title":"Security Considerations","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#sensitive-data-in-commit-messages","title":"Sensitive Data in Commit Messages","text":"<p>Risk: Developers may include secrets in commit messages</p> <p>Mitigation: - Pre-commit hooks can scan for patterns (API keys, passwords) - Event payloads stored locally only (not pushed by default) - <code>.htmlgraph/events/</code> should be in <code>.gitignore</code></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#multi-tenancy","title":"Multi-Tenancy","text":"<p>Risk: Multiple projects in one repository</p> <p>Solution: - HtmlGraph per project (<code>.htmlgraph/</code> at project root) - Hooks respect working directory - No cross-project leakage</p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#git-hook-tampering","title":"Git Hook Tampering","text":"<p>Risk: Malicious users disable hooks</p> <p>Detection: - Hook installation status command: <code>htmlgraph install-hooks --list</code> - Periodic verification in CI/CD - Team policy enforcement</p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#comparison-git-spine-vs-plugin-hooks","title":"Comparison: Git Spine vs Plugin Hooks","text":"Aspect Plugin Hooks (Old) Git Spine (New) Agent Support Claude Code only Any agent Continuity Session-based only Commit-based + session-based Offline Requires plugin runtime Works offline Team Collab Single agent Multi-agent Setup Install plugin Install git hooks Maintenance Plugin updates Git hook updates Robustness Plugin crashes = data loss Git always works Debugging Plugin logs (opaque) JSONL logs (transparent) <p>Migration Path: Both systems can run in parallel. Git spine becomes primary, plugin hooks remain as fallback for rich context.</p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#future-enhancements","title":"Future Enhancements","text":""},{"location":"GIT_CONTINUITY_ARCHITECTURE/#1-automatic-session-continuation","title":"1. Automatic Session Continuation","text":"<p>Detect likely continuation when starting a new session: <pre><code>def auto_detect_continuation() -&gt; str | None:\n    \"\"\"Detect if current session is continuing previous work.\"\"\"\n    last_session = get_most_recent_session()\n    if not last_session:\n        return None\n\n    # Check if within time window (e.g., 4 hours)\n    if datetime.now() - last_session.ended &gt; timedelta(hours=4):\n        return None\n\n    # Check if on same branch\n    if git_current_branch() != last_session.branch:\n        return None\n\n    # Check if same feature is active\n    active_features = get_active_features()\n    if not any(f.id in active_features for f in last_session.worked_on):\n        return None\n\n    return last_session.id  # Continue from this session\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#2-merge-conflict-resolution-tracking","title":"2. Merge Conflict Resolution Tracking","text":"<p>Track when conflicts occur and how they're resolved: <pre><code>{\n  \"type\": \"GitMergeConflict\",\n  \"files_conflicted\": [\"src/file.py\"],\n  \"resolution_time_seconds\": 180,\n  \"resolution_strategy\": \"manual\"\n}\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#3-smart-feature-recommendation","title":"3. Smart Feature Recommendation","text":"<p>Suggest which feature to work on based on commit history: <pre><code>def recommend_next_feature(agent: str) -&gt; str | None:\n    \"\"\"Recommend next feature based on recent commits.\"\"\"\n    recent_commits = git_log(limit=10)\n    feature_mentions = Counter()\n\n    for commit in recent_commits:\n        features = parse_feature_refs(commit.message)\n        feature_mentions.update(features)\n\n    # Return most frequently mentioned feature\n    return feature_mentions.most_common(1)[0][0] if feature_mentions else None\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#4-cross-repository-analytics","title":"4. Cross-Repository Analytics","text":"<p>Track work across multiple repositories: <pre><code>class MultiRepoAnalytics:\n    def get_agent_activity_across_repos(self, agent: str, days: int = 7):\n        \"\"\"Get agent activity across all repositories.\"\"\"\n        repos = discover_htmlgraph_repos()\n\n        all_activity = []\n        for repo in repos:\n            events = repo.event_log.query(\n                agent=agent,\n                timestamp__gte=datetime.now() - timedelta(days=days)\n            )\n            all_activity.extend(events)\n\n        return sorted(all_activity, key=lambda e: e.timestamp)\n</code></pre></p>"},{"location":"GIT_CONTINUITY_ARCHITECTURE/#references","title":"References","text":"<ul> <li>Git Hooks Documentation - Installation and configuration</li> <li>Event Log Reference - Event schema and querying</li> <li>Session Management - Session lifecycle</li> <li>Migration Guide - Migrating from old tracking</li> </ul> <p>Last updated: 2025-01-02</p>"},{"location":"GIT_HOOKS/","title":"Git Hooks - Automatic Tracking","text":"<p>HtmlGraph provides Git hooks that automatically track development events, ensuring continuity across sessions and agents. These hooks log commits, checkouts, merges, and pushes without requiring manual intervention.</p>"},{"location":"GIT_HOOKS/#overview","title":"Overview","text":"<p>Git hooks are scripts that run automatically at specific points in the Git workflow. HtmlGraph uses them to:</p> <ul> <li>Track commits - Record what was done and when</li> <li>Track branch switches - Maintain context across branches</li> <li>Track merges - Log integration events</li> <li>Track pushes - Capture team collaboration boundaries</li> <li>Enforce SDK usage - Block direct edits to <code>.htmlgraph/</code> files (AI agents must use SDK)</li> <li>Remind about features - Suggest creating features for non-trivial work</li> </ul>"},{"location":"GIT_HOOKS/#available-hooks","title":"Available Hooks","text":""},{"location":"GIT_HOOKS/#1-pre-commit-blocking","title":"1. <code>pre-commit</code> (Blocking)","text":"<p>Purpose: Enforces HtmlGraph best practices before committing.</p> <p>What it does: 1. BLOCKS direct edits to <code>.htmlgraph/</code> HTML files    - AI agents must use SDK, not file manipulation    - Prevents accidental corruption of graph data    - Can bypass with <code>git commit --no-verify</code> (not recommended)</p> <ol> <li>REMINDS about feature tracking (non-blocking)</li> <li>Shows active features if any exist</li> <li>Suggests creating a feature for non-trivial work</li> <li>Can disable with: <code>git config htmlgraph.precommit false</code></li> </ol> <p>Example output: <pre><code>\u274c BLOCKED: Direct edits to .htmlgraph/ files\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\nModified files:\n  - .htmlgraph/features/feat-abc123.html\n\nAI agents must use SDK, not direct file edits.\n\nUse SDK instead:\n  from htmlgraph import SDK\n  sdk = SDK()\n  sdk.features.complete('feat-abc123')\n\nOr CLI:\n  uv run htmlgraph feature complete feat-abc123\n</code></pre></p>"},{"location":"GIT_HOOKS/#2-post-commit-non-blocking","title":"2. <code>post-commit</code> (Non-blocking)","text":"<p>Purpose: Logs commit events for continuity tracking.</p> <p>What it does: - Runs in background (non-blocking) - Logs commit hash, message, timestamp - Records files changed - Enables session reconstruction</p> <p>Logged data: <pre><code>{\n  \"event\": \"git:commit\",\n  \"timestamp\": \"2024-12-26T10:30:00Z\",\n  \"commit\": \"abc123...\",\n  \"message\": \"feat: add new feature\",\n  \"files_changed\": 5\n}\n</code></pre></p>"},{"location":"GIT_HOOKS/#3-post-checkout-non-blocking","title":"3. <code>post-checkout</code> (Non-blocking)","text":"<p>Purpose: Tracks branch switches and checkouts.</p> <p>What it does: - Logs branch name changes - Records old and new HEAD - Helps agents understand context switches - Runs in background</p> <p>Use cases: - Multi-feature development - Agent handoffs across branches - Understanding work context</p>"},{"location":"GIT_HOOKS/#4-post-merge-non-blocking","title":"4. <code>post-merge</code> (Non-blocking)","text":"<p>Purpose: Logs successful merges.</p> <p>What it does: - Records merge events - Logs source and target branches - Tracks integration points - Runs in background</p> <p>Use cases: - Team collaboration tracking - Integration milestones - Conflict resolution history</p>"},{"location":"GIT_HOOKS/#5-pre-push-non-blocking","title":"5. <code>pre-push</code> (Non-blocking)","text":"<p>Purpose: Logs push events before remote update.</p> <p>What it does: - Records what's being pushed - Logs remote name and URL - Tracks team boundaries - Runs in background</p> <p>Use cases: - Handoff events - Team collaboration - Release tracking</p>"},{"location":"GIT_HOOKS/#installation","title":"Installation","text":""},{"location":"GIT_HOOKS/#quick-install-recommended","title":"Quick Install (Recommended)","text":"<p>Install all hooks with default settings:</p> <pre><code># During initialization (interactive)\nhtmlgraph init --interactive\n# Answer \"Y\" to \"Install git hooks?\"\n\n# Or non-interactive\nhtmlgraph init --install-hooks\n\n# Or standalone installation\nhtmlgraph install-hooks\n</code></pre>"},{"location":"GIT_HOOKS/#manual-installation","title":"Manual Installation","text":"<pre><code># Install all hooks\nhtmlgraph install-hooks\n\n# Dry-run to see what would happen\nhtmlgraph install-hooks --dry-run\n\n# Force installation (overwrite existing)\nhtmlgraph install-hooks --force\n\n# Use file copies instead of symlinks\nhtmlgraph install-hooks --use-copy\n</code></pre>"},{"location":"GIT_HOOKS/#list-hook-status","title":"List Hook Status","text":"<pre><code>htmlgraph install-hooks --list\n</code></pre> <p>Example output: <pre><code>Git Hooks Installation Status\n============================================================\n\n\ud83d\udfe2 pre-commit (\u2713 installed)\n  Enabled in config: True\n  Versioned (.htmlgraph/hooks/): True\n  Installed (.git/hooks/): True\n  Type: Symlink (\u2713 ours)\n  Target: /project/.htmlgraph/hooks/pre-commit.sh\n\n\ud83d\udfe2 post-commit (\u2713 installed)\n  Enabled in config: True\n  Versioned (.htmlgraph/hooks/): True\n  Installed (.git/hooks/): True\n  Type: Symlink (\u2713 ours)\n\n\ud83d\udd34 post-checkout (\u2717 installed)\n  Enabled in config: False\n  Versioned (.htmlgraph/hooks/): True\n  Installed (.git/hooks/): False\n</code></pre></p>"},{"location":"GIT_HOOKS/#configuration","title":"Configuration","text":""},{"location":"GIT_HOOKS/#configuration-file","title":"Configuration File","text":"<p>Hooks are configured via <code>.htmlgraph/hooks-config.json</code>:</p> <pre><code>{\n  \"enabled_hooks\": [\n    \"pre-commit\",\n    \"post-commit\",\n    \"post-checkout\",\n    \"post-merge\",\n    \"pre-push\"\n  ],\n  \"use_symlinks\": true,\n  \"backup_existing\": true,\n  \"chain_existing\": true\n}\n</code></pre>"},{"location":"GIT_HOOKS/#configuration-options","title":"Configuration Options","text":"Option Type Default Description <code>enabled_hooks</code> array all hooks List of hooks to install <code>use_symlinks</code> boolean <code>true</code> Use symlinks instead of copies <code>backup_existing</code> boolean <code>true</code> Backup existing hooks <code>chain_existing</code> boolean <code>true</code> Chain with existing hooks"},{"location":"GIT_HOOKS/#enabledisable-hooks","title":"Enable/Disable Hooks","text":"<pre><code># Enable a hook\nhtmlgraph install-hooks --enable post-checkout\n\n# Disable a hook\nhtmlgraph install-hooks --disable post-checkout\n\n# Re-run installation after config changes\nhtmlgraph install-hooks\n</code></pre>"},{"location":"GIT_HOOKS/#uninstallation","title":"Uninstallation","text":"<pre><code># Uninstall a specific hook\nhtmlgraph install-hooks --uninstall pre-commit\n\n# Uninstall all hooks (run for each)\nhtmlgraph install-hooks --uninstall pre-commit\nhtmlgraph install-hooks --uninstall post-commit\nhtmlgraph install-hooks --uninstall post-checkout\nhtmlgraph install-hooks --uninstall post-merge\nhtmlgraph install-hooks --uninstall pre-push\n</code></pre>"},{"location":"GIT_HOOKS/#advanced-usage","title":"Advanced Usage","text":""},{"location":"GIT_HOOKS/#chaining-with-existing-hooks","title":"Chaining with Existing Hooks","text":"<p>If you already have Git hooks installed, HtmlGraph will:</p> <ol> <li>Backup existing hook to <code>.git/hooks/&lt;hook&gt;.backup</code></li> <li>Create wrapper that runs both hooks in sequence</li> <li>Exit on failure if existing hook fails</li> </ol> <p>Example chained hook: <pre><code>#!/bin/bash\n# Chained hook - runs existing hook then HtmlGraph hook\n\n# Run existing hook\nif [ -f \".git/hooks/pre-commit.backup\" ]; then\n  \".git/hooks/pre-commit.backup\" || exit $?\nfi\n\n# Run HtmlGraph hook\nif [ -f \".htmlgraph/hooks/pre-commit.sh\" ]; then\n  \".htmlgraph/hooks/pre-commit.sh\" || true\nfi\n</code></pre></p>"},{"location":"GIT_HOOKS/#symlinks-vs-copies","title":"Symlinks vs Copies","text":"<p>Symlinks (default): - \u2705 Automatic updates when HtmlGraph is updated - \u2705 Single source of truth - \u274c May not work on all systems (Windows)</p> <p>Copies: - \u2705 Works everywhere - \u274c Manual update required - \u274c Divergence possible</p> <p>Use copies on Windows or constrained environments: <pre><code>htmlgraph install-hooks --use-copy\n</code></pre></p>"},{"location":"GIT_HOOKS/#disabling-specific-checks","title":"Disabling Specific Checks","text":"<p>Disable feature reminder (keep blocking check): <pre><code>git config htmlgraph.precommit false\n</code></pre></p> <p>Bypass pre-commit entirely (one-time): <pre><code>git commit --no-verify\n</code></pre></p> <p>\u26a0\ufe0f Warning: <code>--no-verify</code> bypasses ALL checks including the SDK enforcement. Use sparingly.</p>"},{"location":"GIT_HOOKS/#troubleshooting","title":"Troubleshooting","text":"<p>Hooks not running?</p> <ol> <li> <p>Check permissions:    <pre><code>ls -la .git/hooks/\nchmod +x .git/hooks/pre-commit  # Should be executable\n</code></pre></p> </li> <li> <p>Verify installation:    <pre><code>htmlgraph install-hooks --list\n</code></pre></p> </li> <li> <p>Check hook content:    <pre><code>cat .git/hooks/pre-commit\n</code></pre></p> </li> </ol> <p>Pre-commit blocking legitimate changes?</p> <p>If you need to commit <code>.htmlgraph/</code> files (e.g., during development): <pre><code># One-time bypass (not recommended)\ngit commit --no-verify\n\n# Or temporarily disable\ngit config htmlgraph.precommit false\n# ... make commits ...\ngit config --unset htmlgraph.precommit\n</code></pre></p> <p>Hook errors?</p> <p>Check the error log: <pre><code>cat .htmlgraph/git-hook-errors.log\n</code></pre></p>"},{"location":"GIT_HOOKS/#best-practices","title":"Best Practices","text":""},{"location":"GIT_HOOKS/#for-ai-agents","title":"For AI Agents","text":"<ol> <li>Never use <code>--no-verify</code> unless explicitly instructed</li> <li>Always use SDK for <code>.htmlgraph/</code> changes</li> <li>Create features for non-trivial work (&gt;30 min, 3+ files)</li> <li>Review hook output to understand tracking</li> </ol>"},{"location":"GIT_HOOKS/#for-developers","title":"For Developers","text":"<ol> <li>Install hooks early - Run <code>htmlgraph init --install-hooks</code> at project start</li> <li>Don't bypass checks - If pre-commit blocks you, use the SDK</li> <li>Keep hooks updated - Use symlinks for auto-updates</li> <li>Review hook logs - Understand what's being tracked</li> </ol>"},{"location":"GIT_HOOKS/#for-teams","title":"For Teams","text":"<ol> <li>Standardize configuration - Commit <code>.htmlgraph/hooks-config.json</code></li> <li>Document exceptions - If disabling hooks, explain why</li> <li>Use chaining - Integrate with existing tooling</li> <li>Monitor compliance - Review hook bypass frequency</li> </ol>"},{"location":"GIT_HOOKS/#file-structure","title":"File Structure","text":"<pre><code>project/\n\u251c\u2500\u2500 .git/\n\u2502   \u2514\u2500\u2500 hooks/\n\u2502       \u251c\u2500\u2500 pre-commit          # Symlink or copy\n\u2502       \u251c\u2500\u2500 post-commit         # Symlink or copy\n\u2502       \u251c\u2500\u2500 post-checkout       # Symlink or copy\n\u2502       \u251c\u2500\u2500 post-merge          # Symlink or copy\n\u2502       \u2514\u2500\u2500 pre-push            # Symlink or copy\n\u2502\n\u251c\u2500\u2500 .htmlgraph/\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u251c\u2500\u2500 pre-commit.sh       # Versioned template\n\u2502   \u2502   \u251c\u2500\u2500 post-commit.sh      # Versioned template\n\u2502   \u2502   \u251c\u2500\u2500 post-checkout.sh    # Versioned template\n\u2502   \u2502   \u251c\u2500\u2500 post-merge.sh       # Versioned template\n\u2502   \u2502   \u2514\u2500\u2500 pre-push.sh         # Versioned template\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 hooks-config.json       # Configuration\n\u2502   \u2514\u2500\u2500 git-hook-errors.log     # Error log (gitignored)\n</code></pre>"},{"location":"GIT_HOOKS/#cli-reference","title":"CLI Reference","text":""},{"location":"GIT_HOOKS/#htmlgraph-install-hooks","title":"<code>htmlgraph install-hooks</code>","text":"<p>Install Git hooks for automatic tracking.</p> <p>Options: <pre><code>--project-dir, -d DIR    Project directory (default: current)\n--force, -f              Force installation even if hooks exist\n--dry-run                Show what would be done without doing it\n--list, -l               List hook installation status\n--uninstall, -u HOOK     Uninstall a specific hook\n--enable HOOK            Enable a hook in configuration\n--disable HOOK           Disable a hook in configuration\n--use-copy               Use file copy instead of symlinks\n</code></pre></p> <p>Examples: <pre><code># Install all hooks\nhtmlgraph install-hooks\n\n# Dry-run\nhtmlgraph install-hooks --dry-run\n\n# List status\nhtmlgraph install-hooks --list\n\n# Enable/disable hooks\nhtmlgraph install-hooks --enable post-checkout\nhtmlgraph install-hooks --disable pre-push\n\n# Uninstall a hook\nhtmlgraph install-hooks --uninstall pre-commit\n\n# Force reinstall with copies\nhtmlgraph install-hooks --force --use-copy\n</code></pre></p>"},{"location":"GIT_HOOKS/#see-also","title":"See Also","text":"<ul> <li>AGENTS.md - SDK usage for AI agents</li> <li>Session Management - Session tracking details</li> <li>Git Events - Event logging reference</li> <li>SDK Reference - Python SDK documentation</li> </ul>"},{"location":"GIT_HOOKS/#faq","title":"FAQ","text":"<p>Q: Do hooks slow down Git operations? A: No. All tracking hooks run in the background (asynchronous). Only pre-commit runs synchronously, and it's optimized to be fast (&lt;100ms).</p> <p>Q: Can I use HtmlGraph without hooks? A: Yes! Hooks are optional. You can track manually via SDK or CLI.</p> <p>Q: What if I already have Git hooks? A: HtmlGraph will chain them. Your existing hooks run first, then ours.</p> <p>Q: Are hooks versioned? A: Yes! Templates are in <code>.htmlgraph/hooks/</code> (tracked). Installed hooks in <code>.git/hooks/</code> are not tracked (standard Git behavior).</p> <p>Q: Can I customize hooks? A: Yes! Edit <code>.htmlgraph/hooks/*.sh</code> files. Use copies (not symlinks) to prevent overwrites.</p> <p>Q: Do hooks work on Windows? A: Yes, but use <code>--use-copy</code> instead of symlinks.</p> <p>Q: How do I update hooks? A: If using symlinks (default), hooks auto-update when HtmlGraph is updated. If using copies, re-run <code>htmlgraph install-hooks --force</code>.</p> <p>Last updated: 2024-12-26</p>"},{"location":"HOOK_ARCHITECTURE/","title":"Hook Architecture","text":"<p>Complete reference for Claude Code hook system in HtmlGraph.</p>"},{"location":"HOOK_ARCHITECTURE/#overview","title":"Overview","text":"<p>HtmlGraph hooks integrate with Claude Code's hook system to provide: - Event tracking - Record all agent activities and tool invocations - Validation - Check work items before execution - Orchestration - Enforce delegation patterns - Cost accounting - Track token usage via CIGS - Tracing - Correlate tool executions with millisecond precision</p>"},{"location":"HOOK_ARCHITECTURE/#hook-types","title":"Hook Types","text":""},{"location":"HOOK_ARCHITECTURE/#pretooluse-hook","title":"PreToolUse Hook","text":"<p>Fires before any tool is executed by Claude Code.</p> <p>Purpose: - Generate and store tool execution start events - Capture tool name and input parameters - Initiate event tracing via tool_use_id correlation - Validate that tool execution is allowed</p> <p>Location: <code>src/python/htmlgraph/hooks/pretooluse.py</code></p> <p>Flow:</p> <pre><code>Tool Invocation\n    \u2193\nPreToolUse Hook\n\u251c\u2500\u2500 Generate tool_use_id (UUID v4)\n\u251c\u2500\u2500 Capture tool_name, tool_input, start_time\n\u251c\u2500\u2500 Sanitize sensitive data\n\u251c\u2500\u2500 Insert start event into tool_traces table\n\u251c\u2500\u2500 Store tool_use_id in environment (HTMLGRAPH_TOOL_USE_ID)\n\u2514\u2500\u2500 Return continue=True to allow execution\n    \u2193\nTool Executes\n</code></pre> <p>Implementation Details:</p> <pre><code>def create_start_event(\n    tool_name: str,\n    tool_input: dict[str, Any],\n    session_id: str\n) -&gt; str | None:\n    \"\"\"\n    Capture and store tool execution start event.\n\n    Args:\n        tool_name: Tool being executed (e.g., \"Bash\", \"Read\")\n        tool_input: Input parameters (will be sanitized)\n        session_id: Current session ID\n\n    Returns:\n        tool_use_id for correlation, or None on error\n    \"\"\"\n    # 1. Generate tool_use_id\n    tool_use_id = str(uuid.uuid4())\n\n    # 2. Get start_time in UTC\n    start_time = datetime.now(timezone.utc).isoformat()\n\n    # 3. Sanitize input (remove passwords, tokens, etc.)\n    sanitized_input = sanitize_tool_input(tool_input)\n\n    # 4. Insert into tool_traces\n    db = HtmlGraphDB()\n    cursor = db.connection.cursor()\n    cursor.execute(\"\"\"\n        INSERT INTO tool_traces\n        (tool_use_id, trace_id, session_id, tool_name,\n         tool_input, start_time, status)\n        VALUES (?, ?, ?, ?, ?, ?, ?)\n    \"\"\", (tool_use_id, tool_use_id, session_id, tool_name,\n          json.dumps(sanitized_input), start_time, \"started\"))\n    db.connection.commit()\n\n    # 5. Store in environment for PostToolUse\n    os.environ[\"HTMLGRAPH_TOOL_USE_ID\"] = tool_use_id\n\n    return tool_use_id\n</code></pre> <p>Runs In Parallel With: - Orchestrator enforcement - Task validation - Event tracing (this function)</p> <p>Error Handling: - Non-blocking - errors don't prevent tool execution - Missing session - skip tracing - Database unavailable - log warning, continue - Invalid input - sanitize gracefully</p> <p>Related: EVENT_TRACING.md - PreToolUse Hook</p>"},{"location":"HOOK_ARCHITECTURE/#posttooluse-hook","title":"PostToolUse Hook","text":"<p>Fires after any tool completes execution (success or failure).</p> <p>Purpose: - Record tool execution completion - Calculate execution duration - Store tool output and error status - Enable performance analysis and debugging</p> <p>Location: <code>src/python/htmlgraph/hooks/posttooluse.py</code> and <code>src/python/htmlgraph/hooks/post_tool_use_handler.py</code></p> <p>Flow:</p> <pre><code>Tool Execution Completes\n    \u2193\nPostToolUse Hook\n\u251c\u2500\u2500 Read tool_use_id from environment\n\u251c\u2500\u2500 Query tool_traces for matching pre-event\n\u251c\u2500\u2500 Calculate duration (end_time - start_time)\n\u251c\u2500\u2500 Determine status (Ok/Error) from response\n\u251c\u2500\u2500 Update tool_traces with: end_time, duration_ms, output, status\n\u2514\u2500\u2500 Return continue=True to allow execution to continue\n    \u2193\nExecution Resumes\n</code></pre> <p>Implementation Details:</p> <pre><code>def update_tool_trace(\n    tool_use_id: str,\n    tool_output: dict[str, Any],\n    status: str,\n    error_message: str | None = None\n) -&gt; bool:\n    \"\"\"\n    Update tool_traces table with execution end event.\n\n    Args:\n        tool_use_id: Correlation ID from PreToolUse\n        tool_output: Tool execution result\n        status: 'Ok' or 'Error'\n        error_message: Error details if status='Error'\n\n    Returns:\n        True if update successful, False otherwise\n    \"\"\"\n    # 1. Query for matching pre-event\n    db = HtmlGraphDB()\n    cursor = db.connection.cursor()\n    cursor.execute(\"\"\"\n        SELECT start_time FROM tool_traces\n        WHERE tool_use_id = ?\n    \"\"\", (tool_use_id,))\n\n    row = cursor.fetchone()\n    if not row:\n        # Pre-event not found - log warning, gracefully degrade\n        logger.warning(f\"PreToolUse event not found for {tool_use_id}\")\n        return False\n\n    start_time_iso = row[0]\n\n    # 2. Calculate duration\n    end_time_iso = datetime.now(timezone.utc).isoformat()\n    duration_ms = calculate_duration(start_time_iso, end_time_iso)\n\n    # 3. Update tool_traces\n    cursor.execute(\"\"\"\n        UPDATE tool_traces\n        SET end_time = ?, duration_ms = ?, tool_output = ?,\n            status = ?, error_message = ?\n        WHERE tool_use_id = ?\n    \"\"\", (end_time_iso, duration_ms,\n          json.dumps(tool_output), status, error_message, tool_use_id))\n\n    db.connection.commit()\n    return True\n</code></pre> <p>Runs In Parallel With: - Event tracking - Orchestrator reflection - Task validation - Error tracking - Debugging suggestions - CIGS analysis</p> <p>Error Handling: - Non-blocking - errors don't prevent execution continuation - Missing pre-event - log warning, skip update - Invalid timestamp - log warning, set duration_ms to None - JSON serialization fails - store stringified output - Database unavailable - log error, return False</p> <p>Related: EVENT_TRACING.md - PostToolUse Hook</p>"},{"location":"HOOK_ARCHITECTURE/#pretooluse-posttooluse-pattern","title":"PreToolUse + PostToolUse Pattern","text":"<p>The combination of PreToolUse and PostToolUse provides complete tool execution tracing:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 PreToolUse Hook                                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Generates tool_use_id = \"a1b2c3d4-...\"                          \u2502\n\u2502 Inserts into tool_traces:                                       \u2502\n\u2502   - tool_use_id: \"a1b2c3d4-...\"                                 \u2502\n\u2502   - tool_name: \"Bash\"                                           \u2502\n\u2502   - tool_input: {\"command\": \"ls\"}                               \u2502\n\u2502   - start_time: \"2025-01-07T12:34:56.789000+00:00\"             \u2502\n\u2502   - status: \"started\"                                           \u2502\n\u2502 Sets: HTMLGRAPH_TOOL_USE_ID=\"a1b2c3d4-...\"                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n                    [Tool Executes]\n                    [1.234 seconds]\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 PostToolUse Hook                                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Reads: HTMLGRAPH_TOOL_USE_ID=\"a1b2c3d4-...\"                    \u2502\n\u2502 Queries: SELECT * FROM tool_traces                              \u2502\n\u2502          WHERE tool_use_id = \"a1b2c3d4-...\"                    \u2502\n\u2502 Calculates: duration_ms = 1234                                  \u2502\n\u2502 Updates tool_traces:                                            \u2502\n\u2502   - end_time: \"2025-01-07T12:34:58.023000+00:00\"               \u2502\n\u2502   - duration_ms: 1234                                           \u2502\n\u2502   - tool_output: {\"stdout\": \"...\"}                             \u2502\n\u2502   - status: \"Ok\"                                                \u2502\n\u2502   - error_message: null                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Tool Trace Result:</p> <pre><code>trace = TraceRecord(\n    tool_use_id=\"a1b2c3d4-...\",\n    trace_id=\"a1b2c3d4-...\",\n    session_id=\"sess-123\",\n    tool_name=\"Bash\",\n    tool_input={\"command\": \"ls\"},\n    tool_output={\"stdout\": \"file1\\nfile2\"},\n    start_time=datetime(...),  # 2025-01-07T12:34:56.789000+00:00\n    end_time=datetime(...),    # 2025-01-07T12:34:58.023000+00:00\n    duration_ms=1234,\n    status=\"Ok\",\n    error_message=None,\n    parent_tool_use_id=None,\n)\n</code></pre>"},{"location":"HOOK_ARCHITECTURE/#other-hooks","title":"Other Hooks","text":"<p>For complete reference on other hooks (SessionStart, Stop, UserPromptSubmit, etc.), see: - Claude Code official documentation: https://code.claude.com/docs/en/hooks.md - SYSTEM_PROMPT_ARCHITECTURE.md - Hook implementations in <code>src/python/htmlgraph/hooks/</code></p>"},{"location":"HOOK_ARCHITECTURE/#querying-traces","title":"Querying Traces","text":"<p>Once events are recorded via PreToolUse and PostToolUse hooks, query using TraceCollection:</p> <pre><code>from htmlgraph.sdk import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get single trace\ntrace = sdk.traces.get_trace(\"a1b2c3d4-...\")\n\n# Get all traces for session\nall_traces = sdk.traces.get_traces(\"sess-123\")\n\n# Find slow tools\nslow = sdk.traces.get_slow_traces(threshold_ms=1000)\n\n# Get errors\nerrors = sdk.traces.get_error_traces(\"sess-123\")\n\n# Hierarchical view\ntree = sdk.traces.get_trace_tree(\"trace-id\")\n</code></pre> <p>See EVENT_TRACING.md - Querying Traces for complete API reference.</p>"},{"location":"HOOK_ARCHITECTURE/#hook-installation","title":"Hook Installation","text":"<p>Hooks are installed via <code>.claude/settings.json</code> or <code>plugin.json</code>.</p> <p>Example hook configuration:</p> <pre><code>{\n  \"hooks\": [\n    {\n      \"name\": \"pretooluse-event-tracing\",\n      \"type\": \"PreToolUse\",\n      \"description\": \"Event tracing - generates tool_use_id and starts trace\",\n      \"script\": \"path/to/pretooluse-integrator.py\"\n    },\n    {\n      \"name\": \"posttooluse-unified\",\n      \"type\": \"PostToolUse\",\n      \"description\": \"Unified PostToolUse - tracking, reflection, validation, errors, CIGS\",\n      \"script\": \"path/to/posttooluse-integrator.py\"\n    }\n  ]\n}\n</code></pre>"},{"location":"HOOK_ARCHITECTURE/#hook-environment","title":"Hook Environment","text":"<p>Hooks have access to environment variables set by Claude Code and HtmlGraph:</p> Variable Set By Used By Value <code>HTMLGRAPH_SESSION_ID</code> SessionStart PreToolUse, queries Current session ID <code>HTMLGRAPH_TOOL_USE_ID</code> PreToolUse PostToolUse Current tool execution ID <code>HTMLGRAPH_TRACE_ID</code> PreToolUse Tracing Root trace ID for grouping <code>HTMLGRAPH_DISABLE_TRACKING</code> User (optional) All hooks If \"1\", skip tracking"},{"location":"HOOK_ARCHITECTURE/#performance-considerations","title":"Performance Considerations","text":""},{"location":"HOOK_ARCHITECTURE/#pretooluse-performance","title":"PreToolUse Performance","text":"<p>PreToolUse runs synchronously before tool execution: - Target: &lt; 50ms per execution - Database insert: ~10ms - UUID generation: &lt; 1ms - Input sanitization: ~5-10ms</p> <p>Non-blocking if database is slow - logs warning and continues.</p>"},{"location":"HOOK_ARCHITECTURE/#posttooluse-performance","title":"PostToolUse Performance","text":"<p>PostToolUse runs asynchronously after tool completes: - Target: &lt; 50ms per execution - Database query: ~5-10ms - Duration calculation: &lt; 1ms - Database update: ~10-20ms - All other tasks (reflection, validation, CIGS): ~20-30ms (parallel)</p> <p>Non-blocking - multiple tasks run in parallel via asyncio.gather().</p>"},{"location":"HOOK_ARCHITECTURE/#database-indexes","title":"Database Indexes","text":"<p>Tool traces table has 5 performance indexes:</p> <pre><code>CREATE INDEX idx_tool_traces_trace_id\n  ON tool_traces(trace_id, start_time DESC);\nCREATE INDEX idx_tool_traces_session\n  ON tool_traces(session_id);\nCREATE INDEX idx_tool_traces_tool_name\n  ON tool_traces(tool_name);\nCREATE INDEX idx_tool_traces_status\n  ON tool_traces(status);\nCREATE INDEX idx_tool_traces_start_time\n  ON tool_traces(start_time DESC);\n</code></pre> <p>All queries use these indexes for sub-5ms performance.</p>"},{"location":"HOOK_ARCHITECTURE/#error-handling-strategy","title":"Error Handling Strategy","text":"<p>Hooks follow consistent error handling:</p> <ol> <li>Try-Catch-Log - All operations wrapped in try-catch</li> <li>Graceful Degradation - Errors logged but don't block execution</li> <li>Non-Blocking - Hook never returns <code>continue=False</code> on internal errors</li> <li>User-Facing Errors - Only return blocking response if orchestrator/validator fails</li> </ol> <p>Example:</p> <pre><code>try:\n    # Create start event\n    tool_use_id = create_start_event(tool_name, tool_input, session_id)\n    if tool_use_id:\n        os.environ[\"HTMLGRAPH_TOOL_USE_ID\"] = tool_use_id\nexcept Exception as e:\n    # Log but don't block\n    logger.warning(f\"Error creating start event: {e}\")\n    # Continue anyway - return empty response\n</code></pre>"},{"location":"HOOK_ARCHITECTURE/#parallel-hook-execution","title":"Parallel Hook Execution","text":"<p>PostToolUse hook runs 6 tasks in parallel using asyncio:</p> <pre><code>(\n    event_response,\n    reflection_response,\n    validation_response,\n    error_tracking_response,\n    debug_suggestions,\n    cigs_response,\n) = await asyncio.gather(\n    run_event_tracking(hook_type, hook_input),      # Event storage\n    run_orchestrator_reflection(hook_input),        # Delegation guidance\n    run_task_validation(hook_input),                # Work validation\n    run_error_tracking(hook_input),                 # Error logging\n    suggest_debugging_resources(hook_input),        # Debug tips\n    run_cigs_analysis(hook_input),                  # Cost accounting\n)\n</code></pre> <p>Benefits: - 40-50% faster - Parallel execution vs sequential - No blocking - All tasks must return continue=True - Combined response - Guidance from all tasks merged</p>"},{"location":"HOOK_ARCHITECTURE/#related-documentation","title":"Related Documentation","text":"<ul> <li>EVENT_TRACING.md - Complete event tracing guide</li> <li>SYSTEM_PROMPT_ARCHITECTURE.md - Hook persistence and loading</li> <li>Claude Code Hooks Documentation - Official reference</li> <li>Hook implementations in <code>src/python/htmlgraph/hooks/</code></li> </ul>"},{"location":"HYBRID_EVENT_CAPTURE/","title":"Hybrid Event Capture System - Parent-Child Event Nesting","text":""},{"location":"HYBRID_EVENT_CAPTURE/#overview","title":"Overview","text":"<p>The Hybrid Event Capture System provides full traceability of delegated work by creating proper parent-child event relationships in HtmlGraph. When you delegate work to a subagent using <code>Task()</code>, the system creates a complete trace showing:</p> <ol> <li>Parent Event: The Task() delegation itself (created by PreToolUse hook)</li> <li>Child Events: Work performed by the subagent (captured by SubagentStop hook)</li> <li>Knowledge Created: Spikes and findings generated during task execution</li> </ol> <p>This enables complete visibility into delegated work that would otherwise be invisible due to Claude Code's hook isolation design.</p>"},{"location":"HYBRID_EVENT_CAPTURE/#architecture","title":"Architecture","text":""},{"location":"HYBRID_EVENT_CAPTURE/#event-flow-example","title":"Event Flow Example","text":"<pre><code>evt-123 Task(gemini-spawner) STARTED [16:40:54]\n\u2502   Input Summary:\n\u2502   - subagent_type: gemini-spawner\n\u2502   - prompt: \"Analyze architecture and provide findings\"\n\u2502\n\u251c\u2500 spk-456 Architecture Analysis [created 16:41:02 by gemini agent]\n\u2502   findings: \"System uses event-driven architecture...\"\n\u2502\n\u251c\u2500 spk-789 Research Spike [created 16:43:15 by gemini agent]\n\u2502   findings: \"Identified optimization opportunities...\"\n\u2502\n\u2514\u2500 evt-123 Task(gemini-spawner) COMPLETED [16:45:22]\n    Output Summary:\n    - status: completed\n    - child_spike_count: 2\n    - completion_time: 2025-01-08T16:45:22Z\n    - duration: 287 seconds\n</code></pre>"},{"location":"HYBRID_EVENT_CAPTURE/#components","title":"Components","text":""},{"location":"HYBRID_EVENT_CAPTURE/#1-pretooluse-hook-create-parent-event","title":"1. PreToolUse Hook (Create Parent Event)","text":"<p>File: <code>src/python/htmlgraph/hooks/pretooluse.py</code></p> <p>When a Task() call is detected, creates parent event: - Extracts subagent type from Task() parameters - Creates entry in agent_events table with type='task_delegation' - Exports HTMLGRAPH_PARENT_EVENT to environment for subagent reference - Non-blocking - gracefully degrades if database unavailable</p>"},{"location":"HYBRID_EVENT_CAPTURE/#2-subagentstop-hook-close-trace","title":"2. SubagentStop Hook (Close Trace)","text":"<p>File: <code>src/python/htmlgraph/hooks/subagent_stop.py</code></p> <p>When a subagent completes: - Reads HTMLGRAPH_PARENT_EVENT from environment - Counts spikes created within 5-minute window - Updates parent event with completion status and child spike count - Handles missing parent events gracefully</p>"},{"location":"HYBRID_EVENT_CAPTURE/#3-database-schema","title":"3. Database Schema","text":"<p>Key tables and columns:</p> <pre><code>agent_events table:\n- event_id: Unique event identifier (evt-XXXXX)\n- event_type: 'task_delegation' for Task() calls\n- parent_event_id: Links to parent event if nested\n- subagent_type: Type of subagent (gemini-spawner, researcher, etc.)\n- child_spike_count: Number of spikes created during task execution\n- status: 'started' or 'completed'\n- timestamp: ISO8601 UTC timestamp\n</code></pre>"},{"location":"HYBRID_EVENT_CAPTURE/#4-api-endpoint-apievent-traces","title":"4. API Endpoint: /api/event-traces","text":"<p>Location: <code>src/python/htmlgraph/api/main.py</code> (lines 573-754)</p> <p>Retrieves parent-child event traces with full hierarchy and metadata.</p>"},{"location":"HYBRID_EVENT_CAPTURE/#usage-pattern","title":"Usage Pattern","text":""},{"location":"HYBRID_EVENT_CAPTURE/#basic-task-delegation","title":"Basic Task Delegation","text":"<pre><code>from htmlgraph import Task\n\nTask(\n    prompt=\"\"\"\n    Analyze the codebase architecture.\n    Create a spike with your findings.\n    \"\"\",\n    subagent_type=\"gemini-spawner\"\n)\n</code></pre> <p>Result: 1. PreToolUse creates evt-123 (Task delegation started) 2. Subagent runs, creates spk-456 with findings 3. SubagentStop updates evt-123 (completed, 1 child spike) 4. Dashboard shows hierarchical trace: evt-123 \u2192 spk-456</p>"},{"location":"HYBRID_EVENT_CAPTURE/#dashboard-visualization","title":"Dashboard Visualization","text":"<p>New \"Event Traces\" view shows:</p> <pre><code>[TASK] evt-abc123 gemini-spawner [COMPLETED] 2025-01-08T16:40:54\n\u251c\u2500 Duration: 287.4s\n\u2514\u2500 Child Events: 2\n  \u251c\u2500 Subagent Activity (2 events)\n  \u2502  \u251c\u2500 \u25aa delegation evt-xyz789 2025-01-08T16:41:02 [COMPLETED]\n  \u2502  \u251c\u2500 \u2726 spike spk-456 [Knowledge Created]\n  \u2502  \u251c\u2500 \u2726 spike spk-789 [Knowledge Created]\n  \u2502  \u2514\u2500\n</code></pre> <p>Features: - Color-coded status badges - Hierarchical display - Duration calculations - Child event/spike counts</p>"},{"location":"HYBRID_EVENT_CAPTURE/#verification-checklist","title":"Verification Checklist","text":"<ul> <li>\u2705 Database schema has parent_event_id, subagent_type, child_spike_count</li> <li>\u2705 PreToolUse hook detects Task() calls and creates parent events</li> <li>\u2705 HTMLGRAPH_PARENT_EVENT exported to subagent environment</li> <li>\u2705 SubagentStop hook updates parent event with completion info</li> <li>\u2705 /api/event-traces endpoint returns parent-child structure</li> <li>\u2705 Dashboard shows event nesting with visual indicators</li> <li>\u2705 Test delegation: Task START \u2192 Subagent work \u2192 Task COMPLETE</li> </ul>"},{"location":"HYBRID_EVENT_CAPTURE/#performance","title":"Performance","text":""},{"location":"HYBRID_EVENT_CAPTURE/#creation-pretooluse","title":"Creation (PreToolUse)","text":"<ul> <li>Time: &lt;10ms (database insert)</li> <li>Non-blocking, graceful degradation on error</li> </ul>"},{"location":"HYBRID_EVENT_CAPTURE/#completion-subagentstop","title":"Completion (SubagentStop)","text":"<ul> <li>Time: 10-50ms (2 queries + 1 update)</li> <li>Spike counting uses 5-minute window</li> </ul>"},{"location":"HYBRID_EVENT_CAPTURE/#query-dashboard","title":"Query (Dashboard)","text":"<ul> <li>Time: 50-200ms for 50 traces</li> <li>Cached with 30-second TTL</li> </ul>"},{"location":"HYBRID_EVENT_CAPTURE/#test-scenario","title":"Test Scenario","text":"<ol> <li>Orchestrator calls Task() with prompt and subagent_type</li> <li>PreToolUse hook creates evt-123, exports HTMLGRAPH_PARENT_EVENT</li> <li>Subagent executes, creates spk-456 with findings</li> <li>SubagentStop hook counts spikes, updates evt-123</li> <li>Dashboard shows complete trace in Event Traces view</li> </ol>"},{"location":"HYBRID_EVENT_CAPTURE/#references","title":"References","text":"<ul> <li>Schema: <code>src/python/htmlgraph/db/schema.py</code></li> <li>PreToolUse Hook: <code>src/python/htmlgraph/hooks/pretooluse.py</code></li> <li>SubagentStop Hook: <code>src/python/htmlgraph/hooks/subagent_stop.py</code></li> <li>API Endpoint: <code>src/python/htmlgraph/api/main.py</code></li> <li>Dashboard Template: <code>src/python/htmlgraph/api/templates/partials/event-traces.html</code></li> </ul>"},{"location":"MIGRATION_GUIDE/","title":"Migration Guide: Git-Based Continuity Spine","text":""},{"location":"MIGRATION_GUIDE/#overview","title":"Overview","text":"<p>This guide helps you migrate from older HtmlGraph tracking approaches to the new Git-based continuity spine architecture. The migration is designed to be non-breaking - both systems can run in parallel during transition.</p>"},{"location":"MIGRATION_GUIDE/#whats-changing","title":"What's Changing","text":""},{"location":"MIGRATION_GUIDE/#before-plugin-only-tracking","title":"Before: Plugin-Only Tracking","text":"<p>Old Architecture: - Session tracking via Claude Code plugin hooks only - Events logged via plugin hook system - Agent-specific (Claude Code only) - Session boundaries strict (lost on crash)</p> <p>Limitations: - Only works with Claude Code - Can't track work from other agents (Codex, Cursor, etc.) - Session data lost if plugin crashes - No cross-agent collaboration tracking - Limited offline support</p>"},{"location":"MIGRATION_GUIDE/#after-git-based-continuity-spine","title":"After: Git-Based Continuity Spine","text":"<p>New Architecture: - Git commits as universal continuity points - Git hooks log commit/checkout/merge/push events - Agent-agnostic (works with any coding agent) - Session continuity survives crashes (reconstructable from commits)</p> <p>Benefits: - \u2705 Works with ANY agent (Claude, Codex, Cursor, vim) - \u2705 Survives session crashes (Git history is durable) - \u2705 Cross-agent collaboration tracking - \u2705 Offline-first (Git is local) - \u2705 Team-friendly (merge/push tracking)</p>"},{"location":"MIGRATION_GUIDE/#migration-phases","title":"Migration Phases","text":""},{"location":"MIGRATION_GUIDE/#phase-1-parallel-run-recommended","title":"Phase 1: Parallel Run (Recommended)","text":"<p>Run both systems side-by-side to validate the Git spine before fully switching:</p> <p>Duration: 1-2 weeks Goal: Validate Git spine completeness</p> <p>Steps:</p> <ol> <li> <p>Install Git hooks alongside existing plugin:    <pre><code>cd /path/to/project\nhtmlgraph install-hooks\n</code></pre></p> </li> <li> <p>Verify both systems are logging:    <pre><code># Check plugin events\nls .htmlgraph/sessions/*.jsonl\n\n# Check git events\nls .htmlgraph/events/*.jsonl\n\n# Make a commit to test\ngit commit -m \"test: validate git hooks\"\n\n# Check for git event\ntail .htmlgraph/events/git.jsonl\n</code></pre></p> </li> <li> <p>Compare outputs daily:    <pre><code>from htmlgraph import SDK\nsdk = SDK(agent=\"claude\")\n\n# Get events from last 24 hours\nplugin_events = sdk.get_recent_events(hours=24, source=\"plugin\")\ngit_events = sdk.get_recent_events(hours=24, source=\"git\")\n\nprint(f\"Plugin events: {len(plugin_events)}\")\nprint(f\"Git events: {len(git_events)}\")\n</code></pre></p> </li> <li> <p>Monitor for gaps:</p> </li> <li>Are git hooks firing for all commits?</li> <li>Are feature attributions correct?</li> <li>Are session continuations working?</li> </ol> <p>Validation Checklist: - [ ] Git hooks fire on every commit - [ ] Events show correct feature attribution - [ ] Session continuity works across commits - [ ] No duplicate events - [ ] Both event sources align</p>"},{"location":"MIGRATION_GUIDE/#phase-2-git-primary-transition","title":"Phase 2: Git-Primary (Transition)","text":"<p>Make Git hooks the primary source of truth while keeping plugin hooks as fallback:</p> <p>Duration: 1-2 weeks Goal: Prove Git spine reliability</p> <p>Steps:</p> <ol> <li> <p>Update configuration to prefer Git events:    <pre><code>// .htmlgraph/config.json\n{\n  \"tracking\": {\n    \"primary_source\": \"git\",\n    \"fallback_source\": \"plugin\"\n  }\n}\n</code></pre></p> </li> <li> <p>Dashboard shows both sources:    <pre><code>summary = sdk.summary(include_sources=True)\n# Output shows which events came from git vs plugin\n</code></pre></p> </li> <li> <p>Monitor for missing events:    <pre><code># Run analytics to find gaps\nuv run htmlgraph analytics validate-tracking --days 7\n</code></pre></p> </li> <li> <p>Fix any gaps:</p> </li> <li>Add missing file patterns to features</li> <li>Improve commit message conventions</li> <li>Add explicit feature references</li> </ol> <p>Validation Checklist: - [ ] Git events cover 95%+ of activity - [ ] Plugin events only fill small gaps - [ ] No critical events missed - [ ] Team members can read git-based history - [ ] Cross-agent tracking works</p>"},{"location":"MIGRATION_GUIDE/#phase-3-plugin-optional-final-state","title":"Phase 3: Plugin-Optional (Final State)","text":"<p>Git spine is proven reliable, plugin hooks become optional for rich context:</p> <p>Duration: Ongoing Goal: Git-first, plugin-enhanced</p> <p>Steps:</p> <ol> <li>Document the tradeoffs:</li> <li>Git hooks: Universal, minimal context</li> <li> <p>Plugin hooks: Rich context, Claude-only</p> </li> <li> <p>Make plugin hooks optional:    <pre><code># Users can choose to disable plugin hooks\nclaude plugin disable htmlgraph-hooks\n</code></pre></p> </li> <li> <p>Update documentation:</p> </li> <li>Git hooks are primary (recommended for all)</li> <li> <p>Plugin hooks are enhancement (optional for Claude users)</p> </li> <li> <p>Preserve user choice:</p> </li> <li>Both systems continue to work</li> <li>Users can enable/disable either or both</li> <li>No forced migration</li> </ol>"},{"location":"MIGRATION_GUIDE/#detailed-migration-instructions","title":"Detailed Migration Instructions","text":""},{"location":"MIGRATION_GUIDE/#for-existing-projects","title":"For Existing Projects","text":"<p>If you have an existing HtmlGraph project with plugin-based tracking:</p> <p>Step 1: Backup existing data <pre><code># Backup sessions and events\ntar -czf htmlgraph-backup-$(date +%Y%m%d).tar.gz .htmlgraph/\n</code></pre></p> <p>Step 2: Install git hooks <pre><code>htmlgraph install-hooks --dry-run  # Preview what will happen\nhtmlgraph install-hooks            # Actually install\n</code></pre></p> <p>Step 3: Verify installation <pre><code>htmlgraph install-hooks --list\n\n# Expected output:\n# \u2705 pre-commit (installed)\n# \u2705 post-commit (installed)\n# \u2705 post-checkout (installed)\n# \u2705 post-merge (installed)\n# \u2705 pre-push (installed)\n</code></pre></p> <p>Step 4: Test git hooks <pre><code># Make a test commit\necho \"# Test\" &gt; test.md\ngit add test.md\ngit commit -m \"test: validate git hooks (feature-test-001)\"\n\n# Check event was logged\ntail .htmlgraph/events/git.jsonl\n# Should see GitCommit event with feature-test-001\n</code></pre></p> <p>Step 5: Compare tracking coverage <pre><code>from htmlgraph import SDK\nsdk = SDK(agent=\"claude\")\n\n# Run for 1 week in parallel\n# Then check coverage\nstats = sdk.tracking_coverage_stats(days=7)\nprint(stats)\n\n# Example output:\n# {\n#   \"total_events\": 1234,\n#   \"git_events\": 1180,\n#   \"plugin_events\": 1234,\n#   \"git_coverage_pct\": 95.6,\n#   \"missing_from_git\": [\"Read\", \"Grep\"]  # Fine-grained events\n# }\n</code></pre></p> <p>Step 6: Gradually transition - Week 1: Both systems run - Week 2: Monitor coverage - Week 3: Make git primary - Week 4: Declare plugin optional</p>"},{"location":"MIGRATION_GUIDE/#for-new-projects","title":"For New Projects","text":"<p>If you're starting a new HtmlGraph project:</p> <p>Step 1: Initialize with git hooks <pre><code>cd /path/to/new/project\nhtmlgraph init --install-hooks\n\n# This creates:\n# .htmlgraph/\n# \u251c\u2500\u2500 config.json (with git-primary tracking)\n# \u251c\u2500\u2500 hooks/ (git hook templates)\n# \u251c\u2500\u2500 events/ (event log directory)\n# \u251c\u2500\u2500 sessions/ (session directory)\n# \u2514\u2500\u2500 features/ (feature directory)\n</code></pre></p> <p>Step 2: Optionally enable plugin hooks <pre><code># If using Claude Code and want rich context\nclaude plugin install htmlgraph\n</code></pre></p> <p>Step 3: Start working <pre><code># Create a feature\nuv run htmlgraph feature create \"Add user auth\" --priority high\n\n# Work on it\n# ... edit files ...\n\n# Commit (git hook will track automatically)\ngit commit -m \"feat: add login endpoint (feature-auth-001)\"\n\n# Check tracking\nuv run htmlgraph feature show feature-auth-001\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#migrating-session-data","title":"Migrating Session Data","text":""},{"location":"MIGRATION_GUIDE/#option-a-keep-existing-sessions-recommended","title":"Option A: Keep Existing Sessions (Recommended)","text":"<p>Existing session HTML files remain valid. No migration needed.</p> <p>How it works: - Old sessions: Have events from plugin hooks - New sessions: Have events from git hooks - Both work together seamlessly - Analytics queries work across both</p> <p>Example: <pre><code># Get all sessions (old and new)\nall_sessions = sdk.sessions.all()\n\n# Old session (plugin-tracked)\nold = all_sessions[0]\nprint(f\"Events: {old.event_count} (from plugin)\")\n\n# New session (git-tracked)\nnew = all_sessions[-1]\nprint(f\"Events: {new.event_count} (from git)\")\n\n# Analytics work across both\ntimeline = sdk.get_feature_timeline(\"feature-xyz\")\n# Combines events from old (plugin) and new (git) sessions\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#option-b-backfill-git-events-optional","title":"Option B: Backfill Git Events (Optional)","text":"<p>If you want uniform event sources, backfill git commits as events:</p> <pre><code>from htmlgraph.git_events import backfill_commits\n\n# Backfill last 100 commits\nbackfill_commits(\n    graph_dir=\".htmlgraph\",\n    limit=100,\n    attribution_strategy=\"message_parsing\"  # Parse feature refs from messages\n)\n</code></pre> <p>Backfill Strategy: 1. Walk git log backwards 2. For each commit, create GitCommit event 3. Attribute to features via commit message parsing 4. Link to existing sessions where possible</p> <p>Limitations: - Can't reconstruct fine-grained events (Read, Edit, Grep) - Best-effort feature attribution - No session context for old commits</p>"},{"location":"MIGRATION_GUIDE/#updating-code-and-workflows","title":"Updating Code and Workflows","text":""},{"location":"MIGRATION_GUIDE/#sdk-changes-none-required","title":"SDK Changes (None Required)","text":"<p>Good news: SDK is backwards compatible. No code changes needed.</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# All existing code works unchanged\nfeature = sdk.features.create(\"New Feature\").save()\nsdk.sessions.start()\nsdk.track_activity(\"Edit\", \"src/file.py\")\n</code></pre> <p>Enhanced queries (optional): <pre><code># New: Query by commit hash\nevents = sdk.get_events_for_commit(\"abc123\")\n\n# New: Get session chain (via continued_from)\nchain = sdk.get_session_chain(\"session-xyz\")\n\n# New: Cross-agent attribution\nagents = sdk.get_agents_for_feature(\"feature-auth\")\n# \u2192 [\"claude\", \"codex\", \"cursor\"]\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#cli-changes-none-required","title":"CLI Changes (None Required)","text":"<p>All existing CLI commands work unchanged: <pre><code># No changes needed\nhtmlgraph feature create \"New Feature\"\nhtmlgraph session start\nhtmlgraph track \"Edit src/file.py\"\n</code></pre></p> <p>New commands (optional): <pre><code># Validate tracking coverage\nhtmlgraph analytics validate-tracking\n\n# Show git events\nhtmlgraph events --source git\n\n# Show commit attribution\nhtmlgraph commit-info abc123\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#workflow-changes","title":"Workflow Changes","text":"<p>Commit Message Convention (recommended):</p> <p>Include feature references in commit messages for better attribution:</p> <pre><code># Good (explicit feature reference)\ngit commit -m \"feat: add login endpoint (feature-auth-001)\"\n\n# Better (structured format)\ngit commit -m \"feat: add login endpoint\n\nImplements: feature-auth-001\nRelated: feature-session-002\n\"\n\n# Best (with context)\ngit commit -m \"feat: add login endpoint\n\nImplements: feature-auth-001\nRelated: feature-session-002\n\n- JWT authentication\n- Password hashing with bcrypt\n- Rate limiting\n\"\n</code></pre> <p>Feature File Patterns (recommended):</p> <p>Add file patterns to features for better commit attribution:</p> <pre><code>feature = sdk.features.create(\"User Authentication\") \\\n    .set_file_patterns([\n        \"src/auth/**/*.py\",\n        \"tests/auth/**/*.py\",\n        \"docs/auth.md\"\n    ]) \\\n    .save()\n\n# Now commits touching these files auto-attribute to this feature\n</code></pre>"},{"location":"MIGRATION_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"MIGRATION_GUIDE/#git-hooks-not-firing","title":"Git Hooks Not Firing","text":"<p>Problem: Commits don't create events</p> <p>Diagnosis: <pre><code># Check if hooks are installed\nls -la .git/hooks/post-commit\n\n# Check permissions\nls -la .git/hooks/post-commit\n# Should be executable: -rwxr-xr-x\n\n# Check content\ncat .git/hooks/post-commit\n# Should call htmlgraph.git_events\n</code></pre></p> <p>Solutions: <pre><code># Reinstall hooks\nhtmlgraph install-hooks --force\n\n# Fix permissions\nchmod +x .git/hooks/post-commit\n\n# Test manually\n.git/hooks/post-commit\ntail .htmlgraph/events/git.jsonl\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#duplicate-events","title":"Duplicate Events","text":"<p>Problem: Same event appears twice</p> <p>Diagnosis: <pre><code># Check for duplicate hook calls\ncat .git/hooks/post-commit\n# Look for multiple calls to htmlgraph.git_events\n</code></pre></p> <p>Solution: <pre><code># Reinstall hooks cleanly\nhtmlgraph install-hooks --uninstall post-commit\nhtmlgraph install-hooks\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#missing-feature-attribution","title":"Missing Feature Attribution","text":"<p>Problem: Commits not attributed to correct feature</p> <p>Diagnosis: <pre><code>from htmlgraph import SDK\nsdk = SDK()\n\n# Check active features\nactive = sdk.features.where(status=\"in-progress\")\nprint(f\"Active features: {[f.id for f in active]}\")\n\n# Check commit message parsing\nfrom htmlgraph.git_events import parse_feature_refs\nmessage = \"your commit message here\"\nrefs = parse_feature_refs(message)\nprint(f\"Parsed refs: {refs}\")\n</code></pre></p> <p>Solutions:</p> <ol> <li> <p>Use explicit feature references in commit messages:    <pre><code>git commit -m \"feat: add feature (feature-auth-001)\"\n</code></pre></p> </li> <li> <p>Set file patterns on features:    <pre><code>with sdk.features.edit(\"feature-auth-001\") as f:\n    f.file_patterns = [\"src/auth/**/*.py\"]\n</code></pre></p> </li> <li> <p>Mark feature as in-progress:    <pre><code>with sdk.features.edit(\"feature-auth-001\") as f:\n    f.status = \"in-progress\"\n</code></pre></p> </li> </ol>"},{"location":"MIGRATION_GUIDE/#plugin-vs-git-event-conflicts","title":"Plugin vs Git Event Conflicts","text":"<p>Problem: Same activity logged twice (once by plugin, once by git)</p> <p>Expected Behavior: This is normal during parallel run phase.</p> <p>Mitigation: <pre><code># Analytics automatically deduplicate by event_id\nsdk.get_unique_events(session_id=\"session-xyz\")\n\n# Or filter by source\nsdk.get_events(session_id=\"session-xyz\", source=\"git\")\nsdk.get_events(session_id=\"session-xyz\", source=\"plugin\")\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#rollback-procedure","title":"Rollback Procedure","text":"<p>If you need to rollback to plugin-only tracking:</p> <p>Step 1: Disable git hooks <pre><code># Uninstall all git hooks\nfor hook in pre-commit post-commit post-checkout post-merge pre-push; do\n    htmlgraph install-hooks --uninstall $hook\ndone\n</code></pre></p> <p>Step 2: Update configuration <pre><code>// .htmlgraph/config.json\n{\n  \"tracking\": {\n    \"primary_source\": \"plugin\"\n  }\n}\n</code></pre></p> <p>Step 3: Verify plugin hooks still work <pre><code>from htmlgraph import SDK\nsdk = SDK(agent=\"claude\")\n\n# Start a session\nsession = sdk.sessions.start(title=\"Test plugin tracking\")\n\n# Make some edits\n# ...\n\n# Check events\nevents = sdk.get_session_events(session.id)\nprint(f\"Events: {len(events)}\")\n</code></pre></p> <p>Step 4: Optionally remove git events <pre><code># Remove git event log\nrm -f .htmlgraph/events/git.jsonl\n\n# Keep session events (from plugin)\n# Don't touch .htmlgraph/sessions/\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#best-practices-post-migration","title":"Best Practices Post-Migration","text":""},{"location":"MIGRATION_GUIDE/#1-commit-message-conventions","title":"1. Commit Message Conventions","text":"<p>Recommended format: <pre><code>&lt;type&gt;: &lt;short description&gt; (&lt;feature-ref&gt;)\n\n&lt;detailed description&gt;\n\nImplements: &lt;feature-id&gt;\nRelated: &lt;feature-id&gt;, &lt;feature-id&gt;\n</code></pre></p> <p>Example: <pre><code>git commit -m \"feat: add JWT authentication (feature-auth-001)\n\nImplement JWT token generation and validation for user authentication.\n\nImplements: feature-auth-001\nRelated: feature-session-002, feature-api-003\n\n- Generate tokens with configurable expiry\n- Validate tokens on protected routes\n- Refresh token rotation\n\"\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#2-feature-file-patterns","title":"2. Feature File Patterns","text":"<p>Always set file patterns on features for automatic attribution:</p> <pre><code>feature = sdk.features.create(\"User Authentication\") \\\n    .set_file_patterns([\n        \"src/auth/**/*.py\",\n        \"src/middleware/auth.py\",\n        \"tests/auth/**/*.py\",\n        \"tests/integration/test_auth*.py\",\n        \"docs/auth/**/*.md\"\n    ]) \\\n    .save()\n</code></pre>"},{"location":"MIGRATION_GUIDE/#3-active-feature-management","title":"3. Active Feature Management","text":"<p>Keep active features list clean:</p> <pre><code># At end of session, complete finished features\nsdk.features.mark_done([\"feature-auth-001\"])\n\n# Or if blocked, mark as todo\nwith sdk.features.edit(\"feature-db-002\") as f:\n    f.status = \"blocked\"\n    f.blocked_reason = \"Waiting for DB schema review\"\n</code></pre>"},{"location":"MIGRATION_GUIDE/#4-cross-agent-handoffs","title":"4. Cross-Agent Handoffs","text":"<p>When handing off to another agent, use handoff notes:</p> <pre><code># End session with handoff notes\nsdk.sessions.end(\n    handoff_notes=\"\"\"\n    Completed login endpoint implementation.\n    Next: Add password reset flow.\n    Note: Tests are passing but need integration test coverage.\n    \"\"\",\n    recommended_next=\"feature-auth-002\"\n)\n</code></pre>"},{"location":"MIGRATION_GUIDE/#5-periodic-validation","title":"5. Periodic Validation","text":"<p>Run validation weekly:</p> <pre><code># Validate tracking coverage\nuv run htmlgraph analytics validate-tracking --days 7\n\n# Check for orphaned features\nuv run htmlgraph analytics find-orphans\n\n# Verify continuity links\nuv run htmlgraph analytics validate-continuity\n</code></pre>"},{"location":"MIGRATION_GUIDE/#faq","title":"FAQ","text":""},{"location":"MIGRATION_GUIDE/#q-do-i-have-to-migrate","title":"Q: Do I have to migrate?","text":"<p>A: No. Both systems continue to work. Migration is optional but recommended for: - Multi-agent projects - Team collaboration - Improved offline support - Agent-agnostic tracking</p>"},{"location":"MIGRATION_GUIDE/#q-will-my-existing-data-still-work","title":"Q: Will my existing data still work?","text":"<p>A: Yes. All existing session HTML files, feature files, and event logs remain fully compatible. Analytics queries work across old (plugin) and new (git) data.</p>"},{"location":"MIGRATION_GUIDE/#q-can-i-run-both-systems-permanently","title":"Q: Can I run both systems permanently?","text":"<p>A: Yes. Both systems can run in parallel indefinitely. Git provides universal coverage, plugin provides rich context for Claude Code users.</p>"},{"location":"MIGRATION_GUIDE/#q-what-if-git-hooks-break","title":"Q: What if git hooks break?","text":"<p>A: Git hooks are non-blocking (except pre-commit). If a hook fails, Git operation succeeds. Errors are logged to <code>.htmlgraph/git-hook-errors.log</code>. Plugin hooks serve as fallback.</p>"},{"location":"MIGRATION_GUIDE/#q-how-do-i-know-migration-is-complete","title":"Q: How do I know migration is complete?","text":"<p>A: Run coverage validation: <pre><code>uv run htmlgraph analytics validate-tracking --days 30\n</code></pre> Target: 95%+ coverage from git events alone.</p>"},{"location":"MIGRATION_GUIDE/#q-can-i-customize-git-hooks","title":"Q: Can I customize git hooks?","text":"<p>A: Yes. Edit <code>.htmlgraph/hooks/*.sh</code> files. If using symlinks, switch to copies first: <pre><code>htmlgraph install-hooks --use-copy\n# Now edit .htmlgraph/hooks/*.sh\n</code></pre></p>"},{"location":"MIGRATION_GUIDE/#q-what-about-cicd","title":"Q: What about CI/CD?","text":"<p>A: Git hooks work in CI/CD. Consider: - Disable in CI: <code>git config htmlgraph.hooks false</code> - Or run with readonly mode for analytics - Team pushes still tracked via pre-push hook</p>"},{"location":"MIGRATION_GUIDE/#support-and-resources","title":"Support and Resources","text":""},{"location":"MIGRATION_GUIDE/#documentation","title":"Documentation","text":"<ul> <li>Git Continuity Architecture - Technical deep-dive</li> <li>Git Hooks Guide - Hook installation and configuration</li> <li>Event Log Reference - Event schema and querying</li> <li>Session Management - Session lifecycle</li> </ul>"},{"location":"MIGRATION_GUIDE/#getting-help","title":"Getting Help","text":"<p>Common issues: - Check Troubleshooting section above - Review error log: <code>.htmlgraph/git-hook-errors.log</code> - Run diagnostics: <code>htmlgraph doctor</code></p> <p>Community support: - GitHub Issues: github.com/Shakes-tzd/htmlgraph/issues - Discussions: github.com/Shakes-tzd/htmlgraph/discussions</p>"},{"location":"MIGRATION_GUIDE/#feedback","title":"Feedback","text":"<p>Help us improve this migration guide: - What was confusing? - What worked well? - What's missing?</p> <p>Submit feedback via GitHub issues with label <code>migration-guide</code>.</p> <p>Last updated: 2025-01-02</p>"},{"location":"MIGRATION_SDK_0.9/","title":"Migration Guide: SDK 0.9 Module Reorganization","text":""},{"location":"MIGRATION_SDK_0.9/#overview","title":"Overview","text":"<p>HtmlGraph SDK 0.9 introduces a major refactoring to improve code organization and maintainability. This guide helps contributors adapt to the new module structure.</p> <p>TL;DR: Modules have been reorganized into logical directories (<code>builders/</code>, <code>collections/</code>, <code>analytics/</code>), but public imports remain unchanged. Most code will continue to work without modification.</p>"},{"location":"MIGRATION_SDK_0.9/#what-changed","title":"What Changed?","text":""},{"location":"MIGRATION_SDK_0.9/#module-reorganization","title":"Module Reorganization","text":"<p>Before (0.8.x): <pre><code>htmlgraph/\n\u251c\u2500\u2500 sdk.py\n\u251c\u2500\u2500 analytics.py               # Analytics class\n\u251c\u2500\u2500 dependency_analytics.py    # DependencyAnalytics class\n\u251c\u2500\u2500 cli_analytics.py\n\u251c\u2500\u2500 track_builder.py           # TrackBuilder + TrackCollection\n\u251c\u2500\u2500 builders/\n\u2502   \u251c\u2500\u2500 base.py\n\u2502   \u251c\u2500\u2500 feature.py\n\u2502   \u2514\u2500\u2500 spike.py\n\u2514\u2500\u2500 collections/\n    \u251c\u2500\u2500 base.py\n    \u251c\u2500\u2500 feature.py\n    \u2514\u2500\u2500 spike.py\n</code></pre></p> <p>After (0.9.x): <pre><code>htmlgraph/\n\u251c\u2500\u2500 sdk.py                     # Main entry point\n\u251c\u2500\u2500 track_builder.py           # TrackCollection only\n\u251c\u2500\u2500 builders/                  # All builders organized here\n\u2502   \u251c\u2500\u2500 base.py\n\u2502   \u251c\u2500\u2500 feature.py\n\u2502   \u251c\u2500\u2500 spike.py\n\u2502   \u2514\u2500\u2500 track.py              # TrackBuilder (moved from track_builder.py)\n\u251c\u2500\u2500 collections/               # All collections\n\u2502   \u251c\u2500\u2500 base.py               # Added start(), complete() methods\n\u2502   \u251c\u2500\u2500 feature.py            # Added set_primary() method\n\u2502   \u2514\u2500\u2500 spike.py\n\u2514\u2500\u2500 analytics/                 # All analytics organized here\n    \u251c\u2500\u2500 __init__.py           # Exports Analytics, DependencyAnalytics\n    \u251c\u2500\u2500 work_type.py          # Analytics class (from analytics.py)\n    \u251c\u2500\u2500 dependency.py         # DependencyAnalytics (from dependency_analytics.py)\n    \u2514\u2500\u2500 cli.py                # CLI helpers (from cli_analytics.py)\n</code></pre></p>"},{"location":"MIGRATION_SDK_0.9/#sdk-integration","title":"SDK Integration","text":"<p>SessionManager Integration: - SDK now owns a <code>SessionManager</code> instance - Session operations go through SDK methods - Collections delegate to SessionManager for tracking</p> <p>Collection Enhancements: - <code>BaseCollection</code> gained <code>start()</code>, <code>complete()</code> methods - <code>FeatureCollection</code> gained <code>set_primary()</code> method - All methods delegate to SessionManager for smart tracking</p>"},{"location":"MIGRATION_SDK_0.9/#migration-steps","title":"Migration Steps","text":""},{"location":"MIGRATION_SDK_0.9/#for-users-public-api","title":"For Users (Public API)","text":"<p>\u2705 No changes required! Public imports work exactly as before:</p> <pre><code># These still work (unchanged)\nfrom htmlgraph import SDK, Analytics, DependencyAnalytics\nfrom htmlgraph.builders import FeatureBuilder, SpikeBuilder, TrackBuilder\nfrom htmlgraph.collections import BaseCollection, FeatureCollection\n\nsdk = SDK(agent=\"claude\")\n# All existing code continues to work\n</code></pre>"},{"location":"MIGRATION_SDK_0.9/#for-contributors-internal-imports","title":"For Contributors (Internal Imports)","text":"<p>If you import from internal modules, update your imports:</p>"},{"location":"MIGRATION_SDK_0.9/#analytics-imports","title":"Analytics Imports","text":"<p>Before: <pre><code>from htmlgraph.analytics import Analytics\nfrom htmlgraph.dependency_analytics import DependencyAnalytics\n</code></pre></p> <p>After: <pre><code>from htmlgraph.analytics import Analytics, DependencyAnalytics\n# Or direct module imports:\nfrom htmlgraph.analytics.work_type import Analytics\nfrom htmlgraph.analytics.dependency import DependencyAnalytics\n</code></pre></p>"},{"location":"MIGRATION_SDK_0.9/#trackbuilder-imports","title":"TrackBuilder Imports","text":"<p>Before: <pre><code>from htmlgraph.track_builder import TrackBuilder, TrackCollection\n</code></pre></p> <p>After: <pre><code>from htmlgraph.builders.track import TrackBuilder  # Moved location\nfrom htmlgraph.track_builder import TrackCollection  # Unchanged\n# Or use the convenience import:\nfrom htmlgraph.track_builder import TrackBuilder  # Re-exported for compatibility\n</code></pre></p>"},{"location":"MIGRATION_SDK_0.9/#sessionmanager-access","title":"SessionManager Access","text":"<p>Before (direct import): <pre><code>from htmlgraph.session_manager import SessionManager\n\nmanager = SessionManager(graph_dir)\nmanager.start_feature(feature_id=\"feat-123\", agent=\"claude\")\n</code></pre></p> <p>After (via SDK): <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\", directory=graph_dir)\nsdk.features.start(\"feat-123\")  # Uses SessionManager internally\n# Or direct access if needed:\nsdk.session_manager.start_feature(feature_id=\"feat-123\", collection=\"features\", agent=\"claude\")\n</code></pre></p>"},{"location":"MIGRATION_SDK_0.9/#breaking-changes","title":"Breaking Changes","text":""},{"location":"MIGRATION_SDK_0.9/#internal-imports-only","title":"Internal Imports Only","text":"<p>\u2705 Public API unchanged - Most users won't be affected.</p> <p>\u26a0\ufe0f Internal module paths changed:</p> <ol> <li><code>htmlgraph.analytics</code> \u2192 <code>htmlgraph.analytics.work_type</code></li> <li>Public import <code>from htmlgraph import Analytics</code> still works</li> <li> <p>Direct import path changed for internal use</p> </li> <li> <p><code>htmlgraph.dependency_analytics</code> \u2192 <code>htmlgraph.analytics.dependency</code></p> </li> <li>Public import <code>from htmlgraph import DependencyAnalytics</code> still works</li> <li> <p>Direct import path changed for internal use</p> </li> <li> <p><code>htmlgraph.track_builder.TrackBuilder</code> \u2192 <code>htmlgraph.builders.track.TrackBuilder</code></p> </li> <li>Re-exported in <code>track_builder.py</code> for backward compatibility</li> <li>Preferred import: <code>from htmlgraph.builders import TrackBuilder</code></li> </ol>"},{"location":"MIGRATION_SDK_0.9/#cli-changes","title":"CLI Changes","text":"<p>\u2705 No breaking changes - CLI commands work exactly as before.</p> <p>The CLI was refactored to use SDK instead of SessionManager directly, but all command signatures remain unchanged.</p>"},{"location":"MIGRATION_SDK_0.9/#new-features","title":"New Features","text":""},{"location":"MIGRATION_SDK_0.9/#collection-methods","title":"Collection Methods","text":"<p>start(), complete(), claim(), release():</p> <pre><code>sdk = SDK(agent=\"claude\")\n\n# Start working on any node type\nsdk.features.start(\"feat-123\")\nsdk.bugs.start(\"bug-456\")\nsdk.chores.start(\"chore-789\")\n\n# Complete nodes\nsdk.features.complete(\"feat-123\")\n\n# Claim/release nodes\nsdk.features.claim(\"feat-123\")\nsdk.features.release(\"feat-123\")\n</code></pre> <p>set_primary() for features:</p> <pre><code># Set primary feature for attribution\nsdk.features.set_primary(\"feat-123\")\n</code></pre>"},{"location":"MIGRATION_SDK_0.9/#sdk-session-methods","title":"SDK Session Methods","text":"<pre><code>sdk = SDK(agent=\"claude\")\n\n# Start/end sessions via SDK\nsdk.start_session(title=\"Feature implementation\")\nsdk.end_session(session_id=\"...\", handoff_notes=\"Completed auth module\")\n\n# Get project status\nstatus = sdk.get_status()\n# Returns: {'wip_count': 2, 'wip_limit': 3, 'active_features': [...], ...}\n</code></pre>"},{"location":"MIGRATION_SDK_0.9/#testing-your-code","title":"Testing Your Code","text":"<p>Run the test suite:</p> <pre><code>uv run pytest tests/ -v\n</code></pre> <p>Expected results: - 411+ tests should pass - 3 pre-existing failures in <code>test_agent_routing.py</code> (unrelated to SDK changes)</p> <p>Check your imports:</p> <pre><code># Verify all imports work\nfrom htmlgraph import SDK, Analytics, DependencyAnalytics\nfrom htmlgraph.builders import FeatureBuilder, SpikeBuilder, TrackBuilder\nfrom htmlgraph.collections import BaseCollection, FeatureCollection\nfrom htmlgraph.models import SpikeType, MaintenanceType, WorkType\n\nprint(\"\u2713 All imports successful\")\n</code></pre>"},{"location":"MIGRATION_SDK_0.9/#benefits-of-this-refactoring","title":"Benefits of This Refactoring","text":"<ol> <li>Better Organization - Logical grouping of related modules</li> <li>Separation of Concerns - Clear boundaries between components</li> <li>Easier Maintenance - Modules are easier to find and modify</li> <li>Consistent API - All collections have the same interface</li> <li>Single Entry Point - SDK coordinates all operations</li> <li>Improved Testing - Modules can be tested in isolation</li> </ol>"},{"location":"MIGRATION_SDK_0.9/#need-help","title":"Need Help?","text":"<ul> <li>Documentation: See <code>docs/api/sdk.md</code> for complete SDK reference</li> <li>Examples: Check <code>docs/examples/</code> for updated code samples</li> <li>Issues: Report problems at https://github.com/Shakes-tzd/htmlgraph/issues</li> </ul>"},{"location":"MIGRATION_SDK_0.9/#summary","title":"Summary","text":"<p>For most users: No changes needed - existing code continues to work.</p> <p>For contributors: Update internal imports to use new module paths.</p> <p>All changes are backward compatible via re-exports in main <code>__init__.py</code>.</p>"},{"location":"MODEL_SELECTION_GUIDE/","title":"Model Selection Guide","text":"<p>This guide helps you choose the right Claude model for each task based on complexity, novelty, cost, and execution characteristics.</p>"},{"location":"MODEL_SELECTION_GUIDE/#quick-decision-matrix","title":"Quick Decision Matrix","text":"Task Type Haiku Sonnet Opus Quick fix/bug \u2705 Best \u26a0\ufe0f Overkill \u274c No Feature (simple) \u2705 Best \u26a0\ufe0f OK \u274c No Feature (complex) \u26a0\ufe0f Limited \u2705 Best \u26a0\ufe0f Good Architecture design \u26a0\ufe0f Limited \u2705 Best \u26a0\ufe0f Good Novel problem \u274c No \u26a0\ufe0f OK \u2705 Best Research/investigation \u26a0\ufe0f Limited \u26a0\ufe0f OK \u2705 Best Refactoring \u2705 Best \u26a0\ufe0f Overkill \u274c No Running tests \u2705 Best \u274c No \u274c No Code review \u26a0\ufe0f OK \u2705 Best \u26a0\ufe0f Good"},{"location":"MODEL_SELECTION_GUIDE/#model-profiles","title":"Model Profiles","text":""},{"location":"MODEL_SELECTION_GUIDE/#haiku-the-delegator","title":"Haiku - The Delegator","text":"<p>Best For: - Orchestration and delegation - Quick fixes and refactoring - Following established patterns and instructions - Running tests and quality gates - File operations and searches - Simple implementations (&lt;30 minutes)</p> <p>Strengths: - Excellent at following detailed instructions - Very responsive to patterns and templates - Fast execution (40-80ms typical) - Lower cost per token - Highly reliable for straightforward tasks - Good at recognizing when to defer to larger models</p> <p>Limitations: - May miss subtle design trade-offs - Limited context for novel problems - Not ideal for deep architectural decisions - Can miss edge cases in complex scenarios</p> <p>Speed: ~40-80ms execution time Cost: Lowest (baseline) Token rate: ~50 tokens/second</p> <p>When to Use: <pre><code>\u2705 Task: \"Refactor this function to improve readability\"\n   Why: Clear, bounded task following a pattern\n\n\u2705 Task: \"Fix the bug in login.py where tokens expire immediately\"\n   Why: Concrete problem with clear solution path\n\n\u2705 Task: \"Run all tests and report results\"\n   Why: Straightforward execution task\n\n\u274c Task: \"Design a real-time collaboration system from scratch\"\n   Why: Novel, requires deep reasoning about trade-offs\n\n\u274c Task: \"Choose between Redis vs in-memory caching\"\n   Why: Complex architectural decision needed\n</code></pre></p> <p>Example Delegation: <pre><code># Perfect use of Haiku\u2014clear, bounded task\nTask(\n    prompt=\"\"\"\n    Fix the authentication bug in src/auth/jwt.py.\n\n    Problem: Tokens expire immediately after login.\n    Location: validate_token() function (line 42-50)\n\n    Steps:\n    1. Review the token expiration logic\n    2. Fix the time calculation\n    3. Run tests: pytest tests/auth/test_jwt.py\n    4. Verify no regressions\n\n    Report results to HtmlGraph:\n    from htmlgraph import SDK\n    sdk = SDK(agent='fixer')\n    sdk.spikes.create('Auth Fix').set_findings('[RESULTS]').save()\n    \"\"\",\n    subagent_type=\"general-purpose\"  # Uses Haiku\n)\n</code></pre></p>"},{"location":"MODEL_SELECTION_GUIDE/#sonnet-the-architect","title":"Sonnet - The Architect","text":"<p>Best For: - Complex reasoning and multi-step logic - Architecture and design decisions - Performance optimization - Security analysis - Code review and quality assessment - Trade-off analysis</p> <p>Strengths: - Strong reasoning about complex systems - Good understanding of trade-offs - Balanced speed and capability - Excellent for architecture decisions - Good at recognizing dependencies and impacts - Reliable for most non-novel problems</p> <p>Limitations: - Can over-engineer simple tasks - Slower than Haiku for straightforward work - May not tackle completely novel problems as well as Opus - Still not ideal for deep research</p> <p>Speed: ~100-200ms execution time Cost: 2-3x Haiku Token rate: ~30 tokens/second</p> <p>When to Use: <pre><code>\u2705 Task: \"Design a caching strategy for our API\"\n   Why: Requires trade-off analysis between approaches\n\n\u2705 Task: \"Review this code for security issues\"\n   Why: Needs careful analysis and cross-domain knowledge\n\n\u2705 Task: \"Optimize this algorithm that's causing slowdowns\"\n   Why: Requires reasoning about performance implications\n\n\u274c Task: \"Fix the CSS alignment issue\"\n   Why: Too simple, use Haiku instead\n\n\u274c Task: \"Design a quantum computing simulator\"\n   Why: Too novel, use Opus instead\n</code></pre></p> <p>Example Usage: <pre><code># Good use of Sonnet\u2014complex decision needed\nTask(\n    prompt=\"\"\"\n    Design a caching strategy for our REST API.\n\n    Context:\n    - Currently: No caching, 100 requests/sec\n    - Problem: Database is maxing out at peak hours\n    - Requirements: &lt;5s cache expiration, 90% hit rate target\n\n    Analyze:\n    1. Redis vs in-memory vs hybrid approach\n    2. Cache invalidation strategy\n    3. Fallback for cache misses\n    4. Cost vs performance implications\n\n    Deliverable: Design document with:\n    - Approach chosen and why\n    - Implementation plan\n    - Estimated cost and performance impact\n    - Risks and mitigations\n\n    Report findings to HtmlGraph:\n    from htmlgraph import SDK\n    sdk = SDK(agent='architect')\n    sdk.spikes.create('Caching Strategy').set_findings('[DESIGN]').save()\n    \"\"\",\n    subagent_type=\"sonnet\"  # Request Sonnet explicitly\n)\n</code></pre></p>"},{"location":"MODEL_SELECTION_GUIDE/#opus-the-researcher","title":"Opus - The Researcher","text":"<p>Best For: - Novel problems and exploration - Deep research and investigation - Multi-step reasoning with unknowns - Completely new feature design - When previous attempts failed - Complex investigation tasks</p> <p>Strengths: - Strongest reasoning capabilities - Excellent handling of ambiguity and unknowns - Good at exploration and discovery - Handles novel problem domains well - Can tackle multiple perspectives simultaneously - Best for \"completely new\" problems</p> <p>Limitations: - Slowest execution (150-300ms) - Highest cost (3-5x Haiku) - Overkill for straightforward tasks - May over-think simple problems</p> <p>Speed: ~150-300ms execution time Cost: Highest (3-5x Haiku baseline) Token rate: ~20 tokens/second</p> <p>When to Use: <pre><code>\u2705 Task: \"Research: design a real-time collaboration system from first principles\"\n   Why: Novel domain, needs exploration and discovery\n\n\u2705 Task: \"Investigate why our system has intermittent failures\"\n   Why: Root cause unknown, needs investigation\n\n\u2705 Task: \"Previous attempts to optimize this failed. Design a new approach.\"\n   Why: Haiku and Sonnet already tried; need stronger reasoning\n\n\u274c Task: \"Add a new button to the UI\"\n   Why: Too simple, use Haiku\n\n\u274c Task: \"Optimize database query performance\"\n   Why: Use Sonnet for this, not Opus\n</code></pre></p> <p>Example Usage: <pre><code># Good use of Opus\u2014completely novel problem\nTask(\n    prompt=\"\"\"\n    Research: Design a real-time collaborative editing system.\n\n    Start from first principles:\n    1. What are the key technical challenges?\n    2. How would you approach the architecture?\n    3. What are the trade-offs?\n    4. Compare to existing solutions (Google Docs, Figma, etc)\n\n    Investigate:\n    - Operational transformation vs CRDT for conflict resolution\n    - Client-server vs peer-to-peer models\n    - Latency and consistency requirements\n    - Offline support and syncing\n\n    Deliverable: Research report including:\n    - Architecture overview\n    - Key design decisions and rationale\n    - Comparison to existing approaches\n    - Implementation challenges\n    - Recommended path forward\n\n    Report findings to HtmlGraph:\n    from htmlgraph import SDK\n    sdk = SDK(agent='researcher')\n    sdk.spikes.create('Collab System Design').set_findings('[RESEARCH]').save()\n    \"\"\",\n    subagent_type=\"opus\"  # Request Opus explicitly\n)\n</code></pre></p>"},{"location":"MODEL_SELECTION_GUIDE/#decision-framework","title":"Decision Framework","text":""},{"location":"MODEL_SELECTION_GUIDE/#step-1-characterize-the-task","title":"Step 1: Characterize the Task","text":"<p>Ask yourself:</p> <p>Complexity: - Low: Single file, &lt;100 lines, straightforward logic - Medium: 2-3 files, 200-500 lines, some logic complexity - High: 4+ files, 500+ lines, architectural implications</p> <p>Novelty: - Familiar: Done this task type before, similar patterns exist - Somewhat: Similar to past work but with new aspects - Novel: Completely new problem domain or approach</p> <p>Familiarity: - Well-known pattern: Established solution path exists - Some uncertainty: Know general direction, some unknowns - High uncertainty: Many unknowns, exploration needed</p> <p>Time estimate: - Quick: &lt;30 minutes - Medium: 30-120 minutes - Long: &gt;120 minutes</p>"},{"location":"MODEL_SELECTION_GUIDE/#step-2-map-to-model","title":"Step 2: Map to Model","text":"<p>Use this decision tree:</p> <pre><code>Is task well-known pattern?\n\u251c\u2500 YES\n\u2502  \u2514\u2500 Will take &lt;30 min?\n\u2502     \u251c\u2500 YES \u2192 HAIKU (quick fix)\n\u2502     \u2514\u2500 NO \u2192 Is it architectural?\n\u2502        \u251c\u2500 YES \u2192 SONNET (complex but known)\n\u2502        \u2514\u2500 NO \u2192 HAIKU (straightforward)\n\u2514\u2500 NO\n   \u2514\u2500 Have you done similar before?\n      \u251c\u2500 YES \u2192 SONNET (novel variation on known work)\n      \u2514\u2500 NO \u2192 OPUS (completely new territory)\n</code></pre>"},{"location":"MODEL_SELECTION_GUIDE/#step-3-verify-with-checklist","title":"Step 3: Verify with Checklist","text":"<p>For Haiku: - [ ] Task is &lt;30 minutes - [ ] Clear solution path exists - [ ] Pattern has been done before - [ ] No major architectural decisions - [ ] Easy to verify correctness - [ ] Straightforward to revert if needed</p> <p>For Sonnet: - [ ] Task requires multi-step reasoning - [ ] Trade-offs between approaches exist - [ ] Previous attempts didn't work - [ ] Architectural or design decision - [ ] Some novelty but grounded in known work - [ ] Code review, optimization, or security needed</p> <p>For Opus: - [ ] Problem domain is novel/unfamiliar - [ ] Significant unknowns about approach - [ ] Requires deep research or exploration - [ ] Can't be solved with pattern matching - [ ] Previous attempts by other models failed - [ ] Worth the higher cost due to importance</p>"},{"location":"MODEL_SELECTION_GUIDE/#cost-optimization","title":"Cost Optimization","text":""},{"location":"MODEL_SELECTION_GUIDE/#cost-comparison","title":"Cost Comparison","text":"Scenario Model Speed Cost Score Simple bug fix Haiku 50ms $0.01 \u2705 Perfect Simple bug fix Sonnet 150ms $0.03 \u274c Wrong choice Feature implementation Haiku 100ms $0.02 \u2705 Best Feature implementation Sonnet 200ms $0.06 \u26a0\ufe0f Overkill Architecture design Haiku 150ms $0.03 \u274c Limited Architecture design Sonnet 200ms $0.06 \u2705 Right choice Novel problem Sonnet 200ms $0.06 \u26a0\ufe0f May fail Novel problem Opus 250ms $0.15 \u2705 Best chance"},{"location":"MODEL_SELECTION_GUIDE/#roi-analysis","title":"ROI Analysis","text":"<p>Haiku: - Cost: Baseline (1x) - Speed: Fastest - Reliability: High for known tasks - ROI: Best for delegation and quick tasks</p> <p>Sonnet: - Cost: 2-3x Haiku - Speed: Medium - Reliability: High for complex known problems - ROI: Good for architectural decisions and complex reasoning</p> <p>Opus: - Cost: 3-5x Haiku - Speed: Slowest - Reliability: Best for completely novel problems - ROI: Only choose when other models will likely fail</p>"},{"location":"MODEL_SELECTION_GUIDE/#guidelines","title":"Guidelines","text":"<p>Always use Haiku for: - Straightforward tasks (&lt;30 minutes) - Established patterns - Delegation (following instructions) - Running tests and quality gates - File operations and searches</p> <p>Use Sonnet for: - Tasks Haiku struggles with - Design and architecture - Performance or security analysis - Code review - Trade-off analysis</p> <p>Only use Opus for: - Tasks Sonnet can't handle - Novel problem domains - Deep research and exploration - Strategic decisions with high impact</p>"},{"location":"MODEL_SELECTION_GUIDE/#common-mistakes","title":"Common Mistakes","text":""},{"location":"MODEL_SELECTION_GUIDE/#mistake-1-always-using-haiku","title":"Mistake 1: Always Using Haiku","text":"<p>Problem: Using Haiku for everything because it's cheap.</p> <p>Result: Incomplete solutions, failed attempts, wasted time debugging.</p> <p>Solution: Match model to task. Sometimes paying 3x for Sonnet saves 10x in time/rework.</p>"},{"location":"MODEL_SELECTION_GUIDE/#mistake-2-always-using-opus","title":"Mistake 2: Always Using Opus","text":"<p>Problem: Using Opus for every task because \"it's the best.\"</p> <p>Result: Slow, expensive, overkill solutions for simple tasks.</p> <p>Solution: Reserve Opus for truly novel problems. Use Haiku/Sonnet for 95% of work.</p>"},{"location":"MODEL_SELECTION_GUIDE/#mistake-3-haiku-for-architecture","title":"Mistake 3: Haiku for Architecture","text":"<p>Problem: Using Haiku to design complex system.</p> <p>Result: Limited analysis, missed trade-offs, incomplete design.</p> <p>Solution: Use Sonnet for architecture decisions. Worth the extra cost.</p>"},{"location":"MODEL_SELECTION_GUIDE/#mistake-4-not-retrying-with-stronger-model","title":"Mistake 4: Not Retrying with Stronger Model","text":"<p>Problem: Haiku fails at complex task, you accept the failure.</p> <p>Result: Accept suboptimal solution instead of trying Sonnet.</p> <p>Solution: When Haiku struggles, retry with Sonnet. Higher success rate justifies cost.</p>"},{"location":"MODEL_SELECTION_GUIDE/#mistake-5-treating-all-novelty-the-same","title":"Mistake 5: Treating All Novelty the Same","text":"<p>Problem: Using Opus for \"somewhat novel\" tasks.</p> <p>Result: Overspending on tasks Sonnet can handle.</p> <p>Solution: Sonnet handles \"novel variations on known work.\" Only use Opus for \"completely new\" problems.</p>"},{"location":"MODEL_SELECTION_GUIDE/#real-world-examples","title":"Real-World Examples","text":""},{"location":"MODEL_SELECTION_GUIDE/#example-1-bug-fix","title":"Example 1: Bug Fix","text":"<p>Task: \"Fix JWT token expiration bug\"</p> <p>Analysis: - Complexity: Low (single file) - Novelty: Familiar (auth bug, done before) - Time: &lt;30 minutes - Decision: Haiku</p> <p>Outcome: Fixed in 15 minutes, low cost</p>"},{"location":"MODEL_SELECTION_GUIDE/#example-2-feature-implementation","title":"Example 2: Feature Implementation","text":"<p>Task: \"Add email notifications to user alerts\"</p> <p>Analysis: - Complexity: Medium (3-4 files involved) - Novelty: Somewhat (email is known, but new to this codebase) - Time: 1-2 hours - Has tests? Yes - Decision: Haiku (with Sonnet backup if it struggles)</p> <p>Outcome: Completed in 90 minutes, moderate cost</p>"},{"location":"MODEL_SELECTION_GUIDE/#example-3-architecture-decision","title":"Example 3: Architecture Decision","text":"<p>Task: \"Design caching strategy for our API\"</p> <p>Analysis: - Complexity: High (architectural) - Novelty: Somewhat (caching is known, but this design is project-specific) - Time: 2-3 hours - Trade-offs: Multiple approaches, each with pros/cons - Decision: Sonnet</p> <p>Outcome: Thorough design with trade-off analysis, justified cost increase</p>"},{"location":"MODEL_SELECTION_GUIDE/#example-4-novel-research","title":"Example 4: Novel Research","text":"<p>Task: \"Design real-time collaborative editing system\"</p> <p>Analysis: - Complexity: Very high - Novelty: Novel (new domain) - Time: 4+ hours - Unknowns: Many (CRDT vs OT, architecture choices, etc) - Decision: Opus</p> <p>Outcome: Comprehensive research report, novel insights, worth the cost</p>"},{"location":"MODEL_SELECTION_GUIDE/#example-5-code-review","title":"Example 5: Code Review","text":"<p>Task: \"Review security of authentication module\"</p> <p>Analysis: - Complexity: High (cross-domain knowledge needed) - Novelty: Familiar pattern (auth is well-known) - Time: 1-2 hours - Requires: Careful analysis, multiple perspectives - Decision: Sonnet</p> <p>Outcome: Thorough security review, caught subtle issues Haiku missed</p>"},{"location":"MODEL_SELECTION_GUIDE/#integration-with-system-prompt","title":"Integration with System Prompt","text":"<p>Your <code>.claude/system-prompt.md</code> should include model guidance:</p> <pre><code>## Model Guidance\n\nUse Haiku (Default) for:\n- Orchestration and delegation\n- Quick fixes (&lt;30 minutes)\n- Refactoring and cleanup\n- Following patterns\n\nUse Sonnet for:\n- Complex reasoning\n- Architecture decisions\n- Performance optimization\n- Code review\n\nUse Opus for:\n- Novel problems\n- Research and exploration\n- When previous attempts failed\n</code></pre> <p>This keeps model selection top-of-mind throughout your work.</p>"},{"location":"MODEL_SELECTION_GUIDE/#related-resources","title":"Related Resources","text":"<ul> <li>SYSTEM_PROMPT_PERSISTENCE_GUIDE.md: How system prompts persist across sessions</li> <li>ORCHESTRATOR_MODE_GUIDE.md: Delegation and orchestration patterns</li> <li>delegate.sh: Helper script for model selection decisions</li> </ul>"},{"location":"MODEL_SELECTION_GUIDE/#checklist-am-i-using-the-right-model","title":"Checklist: Am I Using the Right Model?","text":"<p>Before delegating, ask:</p> <ul> <li> Is this task well-known pattern? (If NO, consider Opus)</li> <li> Will this take &lt;30 minutes? (If YES, use Haiku)</li> <li> Does this need architectural thinking? (If YES, use Sonnet)</li> <li> Is this completely novel? (If YES, use Opus)</li> <li> Have I solved similar before? (If NO, use Sonnet or Opus)</li> <li> What's my cost vs. quality trade-off? (Balance with budget)</li> <li> If this model fails, can I retry with stronger one? (Plan for it)</li> </ul>"},{"location":"MODEL_SELECTION_GUIDE/#summary","title":"Summary","text":"When Use Why Quick, known pattern Haiku Fast, cheap, reliable Complex, known domain Sonnet Good reasoning, balanced Novel, exploratory Opus Best reasoning, thorough <p>Choose wisely, ship fast, iterate on success.</p>"},{"location":"OPERATIONS_LAYER/","title":"Operations Layer Architecture","text":""},{"location":"OPERATIONS_LAYER/#overview","title":"Overview","text":"<p>HtmlGraph uses a shared operations layer that both CLI and SDK call. This eliminates code duplication and ensures consistent behavior across all interfaces.</p> <pre><code>CLI \u2500\u2500\u2500\u2500\u2510\n        \u251c\u2500\u2500\u2192 Operations Layer (shared backend)\nSDK \u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"OPERATIONS_LAYER/#benefits","title":"Benefits","text":"<ul> <li>No duplication - CLI and SDK share same code</li> <li>Consistent behavior - Same results regardless of interface</li> <li>Single source of truth - Operations layer owns business logic</li> <li>Easier testing - Test operations once, both CLI and SDK benefit</li> <li>Better maintainability - Fix bugs in one place</li> </ul>"},{"location":"OPERATIONS_LAYER/#architecture-layers","title":"Architecture Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           User Interfaces                   \u2502\n\u2502  CLI (argparse) \u2502 SDK (Python API)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                    \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Operations Layer (Shared)           \u2502\n\u2502  \u2022 server.py   - Server lifecycle           \u2502\n\u2502  \u2022 hooks.py    - Git hooks management       \u2502\n\u2502  \u2022 events.py   - Event log indexing         \u2502\n\u2502  \u2022 analytics.py - Analytics operations      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Core HtmlGraph Library              \u2502\n\u2502  \u2022 graph.py    - Graph operations           \u2502\n\u2502  \u2022 models.py   - Data models                \u2502\n\u2502  \u2022 session_manager.py - Session tracking    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"OPERATIONS_LAYER/#operations-modules","title":"Operations Modules","text":""},{"location":"OPERATIONS_LAYER/#operationsserverpy","title":"operations/server.py","text":"<p>Server lifecycle operations.</p> <p>Functions: - <code>start_server()</code> - Start HtmlGraph server with configuration - <code>stop_server()</code> - Stop running server gracefully - <code>get_server_status()</code> - Check server status</p> <p>Return Types: - <code>ServerStartResult</code> - Contains handle, warnings, config used - <code>ServerStatus</code> - Current server state - <code>ServerHandle</code> - Reference to running server</p> <p>Example: <pre><code>from htmlgraph.operations import server\n\nresult = server.start_server(\n    port=8080,\n    graph_dir=Path(\".htmlgraph\"),\n    static_dir=Path(\".\"),\n    watch=True,\n    auto_port=False\n)\n\nprint(f\"Server started at {result.handle.url}\")\nif result.warnings:\n    print(f\"Warnings: {result.warnings}\")\n</code></pre></p>"},{"location":"OPERATIONS_LAYER/#operationshookspy","title":"operations/hooks.py","text":"<p>Git hooks management operations.</p> <p>Functions: - <code>install_hooks()</code> - Install HtmlGraph git hooks - <code>list_hooks()</code> - List enabled/disabled/missing hooks - <code>validate_hook_config()</code> - Validate hook configuration</p> <p>Return Types: - <code>HookInstallResult</code> - Installation details (installed, skipped, warnings) - <code>HookListResult</code> - Hook status lists - <code>HookValidationResult</code> - Validation errors and warnings</p> <p>Example: <pre><code>from htmlgraph.operations import hooks\nfrom pathlib import Path\n\nresult = hooks.install_hooks(\n    project_dir=Path(\".\"),\n    use_copy=False  # Use symlinks\n)\n\nprint(f\"Installed: {result.installed}\")\nprint(f\"Skipped: {result.skipped}\")\n</code></pre></p>"},{"location":"OPERATIONS_LAYER/#operationseventspy","title":"operations/events.py","text":"<p>Event log indexing and querying operations.</p> <p>Functions: - <code>export_sessions()</code> - Export session events from JSONL logs - <code>query_events()</code> - Query events with filters - <code>rebuild_index()</code> - Rebuild SQLite index from event logs - <code>get_event_stats()</code> - Get event log statistics</p> <p>Return Types: - <code>EventExportResult</code> - Export statistics - <code>EventQueryResult</code> - Query results - <code>EventRebuildResult</code> - Rebuild statistics - <code>EventStats</code> - Event log statistics</p> <p>Example: <pre><code>from htmlgraph.operations import events\nfrom pathlib import Path\n\nstats = events.get_event_stats(graph_dir=Path(\".htmlgraph\"))\nprint(f\"Total events: {stats.total_events}\")\nprint(f\"Total sessions: {stats.total_sessions}\")\n</code></pre></p>"},{"location":"OPERATIONS_LAYER/#operationsanalyticspy","title":"operations/analytics.py","text":"<p>Analytics operations for sessions and projects.</p> <p>Functions: - <code>analyze_session()</code> - Analyze single session - <code>analyze_project()</code> - Analyze entire project</p> <p>Return Types: - <code>AnalyticsSessionResult</code> - Session analysis - <code>AnalyticsProjectResult</code> - Project-wide analysis</p> <p>Example: <pre><code>from htmlgraph.operations import analytics\nfrom pathlib import Path\n\nresult = analytics.analyze_project(\n    graph_dir=Path(\".htmlgraph\")\n)\n\nprint(f\"Total features: {result.total_features}\")\nprint(f\"Recommendations: {len(result.recommendations)}\")\n</code></pre></p>"},{"location":"OPERATIONS_LAYER/#using-operations-from-cli","title":"Using Operations from CLI","text":"<p>The CLI uses operations internally:</p> <pre><code># In htmlgraph/cli.py\n\ndef cmd_serve(args):\n    from htmlgraph.operations import server\n\n    result = server.start_server(\n        port=args.port,\n        graph_dir=Path(args.dir),\n        static_dir=Path(\".\"),\n        watch=not args.no_watch,\n        auto_port=args.auto_port\n    )\n\n    # CLI-specific output formatting\n    print(f\"Server started at {result.handle.url}\")\n    # ...\n</code></pre>"},{"location":"OPERATIONS_LAYER/#using-operations-from-sdk","title":"Using Operations from SDK","text":"<p>The SDK wraps operations with a fluent API:</p> <pre><code># In htmlgraph/sdk.py\n\nclass SDK:\n    def start_server(self, port: int = 8080, **kwargs) -&gt; ServerHandle:\n        \"\"\"Start HtmlGraph server.\"\"\"\n        from htmlgraph.operations import server\n\n        result = server.start_server(\n            port=port,\n            graph_dir=self.graph_dir,\n            static_dir=Path(\".\"),\n            **kwargs\n        )\n\n        # SDK returns handle directly\n        return result.handle\n</code></pre>"},{"location":"OPERATIONS_LAYER/#error-handling","title":"Error Handling","text":"<p>Operations raise specific exceptions:</p> <pre><code>from htmlgraph.operations.server import PortInUseError, ServerStartError\nfrom htmlgraph.operations.hooks import HookInstallError, HookConfigError\n\ntry:\n    result = server.start_server(port=8080, ...)\nexcept PortInUseError:\n    print(\"Port 8080 is already in use\")\nexcept ServerStartError as e:\n    print(f\"Server failed to start: {e}\")\n</code></pre>"},{"location":"OPERATIONS_LAYER/#migration-guide","title":"Migration Guide","text":"<p>If you have custom scripts using the old API:</p>"},{"location":"OPERATIONS_LAYER/#before-direct-imports","title":"Before (direct imports)","text":"<pre><code>from htmlgraph.server import serve\n\nserve(port=8080)\n</code></pre>"},{"location":"OPERATIONS_LAYER/#after-use-sdk-recommended","title":"After (use SDK - recommended)","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK()\nhandle = sdk.start_server(port=8080)\n</code></pre>"},{"location":"OPERATIONS_LAYER/#after-use-operations-advanced","title":"After (use operations - advanced)","text":"<pre><code>from htmlgraph.operations import server\nfrom pathlib import Path\n\nresult = server.start_server(\n    port=8080,\n    graph_dir=Path(\".htmlgraph\"),\n    static_dir=Path(\".\")\n)\n\n# Access server handle\nhandle = result.handle\n</code></pre>"},{"location":"OPERATIONS_LAYER/#testing","title":"Testing","text":"<p>The operations layer makes testing easier:</p> <pre><code>import pytest\nfrom htmlgraph.operations import server\nfrom pathlib import Path\n\ndef test_server_start(tmp_path):\n    \"\"\"Test server starts successfully.\"\"\"\n    result = server.start_server(\n        port=8081,  # Use different port for tests\n        graph_dir=tmp_path / \".htmlgraph\",\n        static_dir=tmp_path,\n        watch=False  # Disable watcher in tests\n    )\n\n    assert result.handle.port == 8081\n    assert result.handle.url == \"http://localhost:8081\"\n\n    # Cleanup\n    server.stop_server(result.handle)\n</code></pre>"},{"location":"OPERATIONS_LAYER/#design-principles","title":"Design Principles","text":"<ol> <li>Pure functions - Operations are stateless, accept parameters</li> <li>Dataclass results - Return structured results, not primitives</li> <li>Explicit errors - Raise specific exception types</li> <li>No side effects - Operations don't modify global state</li> <li>Testable - All operations can be tested in isolation</li> </ol>"},{"location":"OPERATIONS_LAYER/#adding-new-operations","title":"Adding New Operations","text":"<p>When adding new functionality:</p> <ol> <li>Create operation in <code>operations/</code> module</li> <li>Define result dataclass</li> <li>Add to <code>operations/__init__.py</code></li> <li>Wrap in SDK method (optional)</li> <li>Add CLI command (optional)</li> <li>Write tests</li> </ol> <p>Example:</p> <pre><code># operations/backup.py\n\nfrom dataclasses import dataclass\nfrom pathlib import Path\n\n@dataclass(frozen=True)\nclass BackupResult:\n    backup_path: Path\n    files_backed_up: int\n    warnings: list[str]\n\ndef create_backup(\n    *,\n    graph_dir: Path,\n    backup_dir: Path\n) -&gt; BackupResult:\n    \"\"\"Create backup of HtmlGraph data.\"\"\"\n    # Implementation\n    return BackupResult(...)\n</code></pre>"},{"location":"OPERATIONS_LAYER/#see-also","title":"See Also","text":"<ul> <li>AGENTS.md - Complete SDK documentation</li> <li>CLI Reference - CLI command reference</li> <li>API Reference - Complete API documentation</li> </ul>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/","title":"Orchestrator Enforcement System - Design Document","text":""},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#problem-statement","title":"Problem Statement","text":"<p>Current Issue: Even when the orchestrator skill is activated, Claude continues to execute implementation work directly (Read, Edit, Write, Bash) instead of delegating to subagents via the Task tool.</p> <p>Root Causes: 1. SessionStart hook's orchestrator directives aren't being injected into Claude's system prompt (Claude Code bug) 2. Skill activation is passive - provides guidance but doesn't enforce behavior 3. No mechanism to distinguish orchestrator operations from implementation 4. Claude's natural tendency is to execute directly, not delegate</p>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#design-goals","title":"Design Goals","text":"<ol> <li>Enforce orchestrator delegation - Block implementation when in orchestrator mode</li> <li>Allow lightweight operations - Orchestrators can do quick lookups and work item management</li> <li>Clear activation - Explicit way to enter/exit orchestrator mode</li> <li>Smart detection - Distinguish between orchestrator ops and implementation</li> <li>Graceful fallback - If hook fails, default to allowing operations</li> </ol>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#solution-architecture","title":"Solution Architecture","text":""},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#component-1-orchestrator-mode-state-management","title":"Component 1: Orchestrator Mode State Management","text":"<p>File: <code>.htmlgraph/orchestrator-mode.json</code></p> <pre><code>{\n  \"enabled\": true,\n  \"activated_at\": \"2025-12-30T08:00:00Z\",\n  \"session_id\": \"sess-abc123\",\n  \"enforcement_level\": \"strict\"  // or \"guidance\"\n}\n</code></pre> <p>Activation Methods: 1. SessionStart hook sets <code>enabled: true</code> when features exist 2. Skill activation (<code>/htmlgraph:orchestrator</code>) sets <code>enabled: true</code> 3. User can disable: <code>uv run htmlgraph orchestrator disable</code> 4. Auto-disables when no features exist</p>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#component-2-smart-pretooluse-hook","title":"Component 2: Smart PreToolUse Hook","text":"<p>File: <code>packages/claude-plugin/hooks/scripts/orchestrator-enforce.py</code></p> <p>Hook Logic:</p> <pre><code>def is_orchestrator_mode_active() -&gt; bool:\n    \"\"\"Check if orchestrator mode is enabled.\"\"\"\n    mode_file = Path(\".htmlgraph/orchestrator-mode.json\")\n    if mode_file.exists():\n        data = json.loads(mode_file.read_text())\n        return data.get(\"enabled\", False)\n    return False\n\ndef get_enforcement_level() -&gt; str:\n    \"\"\"Get enforcement level: strict or guidance.\"\"\"\n    mode_file = Path(\".htmlgraph/orchestrator-mode.json\")\n    if mode_file.exists():\n        data = json.loads(mode_file.read_text())\n        return data.get(\"enforcement_level\", \"guidance\")\n    return \"guidance\"\n\ndef is_allowed_orchestrator_operation(tool: str, params: dict) -&gt; tuple[bool, str]:\n    \"\"\"\n    Check if operation is allowed for orchestrators.\n\n    Returns: (is_allowed, reason_if_not)\n    \"\"\"\n    # Category 1: ALWAYS ALLOWED - Orchestrator core operations\n    if tool in [\"Task\", \"AskUserQuestion\", \"TodoWrite\"]:\n        return True, \"\"\n\n    # Category 2: SDK Operations - Always allowed\n    if tool == \"Bash\":\n        command = params.get(\"command\", \"\")\n        if command.startswith(\"uv run htmlgraph \") or command.startswith(\"htmlgraph \"):\n            return True, \"\"\n        # Allow git status/diff (read-only)\n        if command.startswith(\"git status\") or command.startswith(\"git diff\"):\n            return True, \"\"\n\n    # Category 3: Quick Lookups - Single operations only\n    if tool in [\"Read\", \"Grep\", \"Glob\"]:\n        # Check tool history to see if this is a single lookup or part of a sequence\n        history = load_tool_history()\n        recent_same_tool = sum(1 for h in history[-3:] if h[\"tool\"] == tool)\n\n        if recent_same_tool == 0:  # First use\n            return True, \"Single lookup allowed\"\n        else:\n            return False, f\"Multiple {tool} calls detected. Delegate to Explorer subagent using Task tool.\"\n\n    # Category 4: Work Item Creation - Allowed via Python inline\n    if tool == \"Bash\" and \"from htmlgraph import SDK\" in params.get(\"command\", \"\"):\n        return True, \"SDK work item creation\"\n\n    # Category 5: BLOCKED - Implementation tools\n    if tool in [\"Edit\", \"Write\", \"NotebookEdit\", \"Delete\"]:\n        return False, f\"{tool} is implementation work. Delegate to Coder subagent using Task tool.\"\n\n    # Category 6: BLOCKED - Multiple file operations\n    if tool == \"Bash\":\n        command = params.get(\"command\", \"\")\n        # Block compilation, testing, building (should be in subagent)\n        blocked_patterns = [\n            r\"^npm (run|test|build)\",\n            r\"^pytest\",\n            r\"^python -m pytest\",\n            r\"^cargo (build|test)\",\n            r\"^mvn (compile|test|package)\",\n        ]\n        for pattern in blocked_patterns:\n            if re.match(pattern, command):\n                return False, \"Testing/building should be delegated to subagent\"\n\n    # Default: Allow with guidance\n    return True, \"Allowed but consider if delegation would be better\"\n\ndef enforce_orchestrator_mode(tool: str, params: dict) -&gt; dict:\n    \"\"\"\n    Enforce orchestrator mode rules.\n\n    Returns: Hook response dict\n    \"\"\"\n    # Check if orchestrator mode is active\n    if not is_orchestrator_mode_active():\n        return {\"decision\": \"allow\"}  # Not in orchestrator mode\n\n    # Get enforcement level\n    level = get_enforcement_level()\n\n    # Check if operation is allowed\n    is_allowed, reason = is_allowed_orchestrator_operation(tool, params)\n\n    if is_allowed:\n        if reason and level == \"strict\":\n            # Provide guidance even when allowing\n            return {\n                \"decision\": \"allow\",\n                \"guidance\": f\"\u2705 {reason}\"\n            }\n        return {\"decision\": \"allow\"}\n\n    # Operation not allowed\n    if level == \"strict\":\n        # BLOCK the operation\n        return {\n            \"decision\": \"block\",\n            \"reason\": f\"\ud83c\udfaf ORCHESTRATOR MODE: {reason}\\n\\n\"\n                     f\"Use: Task(prompt='...', subagent_type='general-purpose')\\n\\n\"\n                     f\"To disable orchestrator mode: uv run htmlgraph orchestrator disable\",\n            \"suggestion\": create_task_suggestion(tool, params)\n        }\n    else:\n        # GUIDANCE mode - allow but warn\n        return {\n            \"decision\": \"allow\",\n            \"guidance\": f\"\u26a0\ufe0f ORCHESTRATOR: {reason}\",\n            \"suggestion\": create_task_suggestion(tool, params)\n        }\n\ndef create_task_suggestion(tool: str, params: dict) -&gt; str:\n    \"\"\"Create Task tool suggestion based on blocked operation.\"\"\"\n    if tool in [\"Edit\", \"Write\", \"NotebookEdit\"]:\n        return (\n            \"Task(\\n\"\n            \"    prompt='Implement [describe changes]',\\n\"\n            \"    subagent_type='general-purpose'\\n\"\n            \")\"\n        )\n    elif tool in [\"Read\", \"Grep\", \"Glob\"]:\n        return (\n            \"Task(\\n\"\n            \"    prompt='Explore [describe what to find]',\\n\"\n            \"    subagent_type='Explore'\\n\"\n            \")\"\n        )\n    elif tool == \"Bash\" and \"test\" in params.get(\"command\", \"\"):\n        return (\n            \"Task(\\n\"\n            \"    prompt='Run tests and report results',\\n\"\n            \"    subagent_type='general-purpose'\\n\"\n            \")\"\n        )\n    else:\n        return \"Use Task tool to delegate this operation to a subagent\"\n</code></pre>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#component-3-orchestrator-mode-cli-commands","title":"Component 3: Orchestrator Mode CLI Commands","text":"<p>Add to htmlgraph CLI:</p> <pre><code># Enable orchestrator mode (strict)\nuv run htmlgraph orchestrator enable\n\n# Enable orchestrator mode (guidance only)\nuv run htmlgraph orchestrator enable --level=guidance\n\n# Disable orchestrator mode\nuv run htmlgraph orchestrator disable\n\n# Check status\nuv run htmlgraph orchestrator status\n</code></pre>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#component-4-sessionstart-hook-integration","title":"Component 4: SessionStart Hook Integration","text":"<p>Modify <code>session-start.py</code>:</p> <pre><code>def activate_orchestrator_mode(graph_dir: Path, features: list) -&gt; None:\n    \"\"\"Activate orchestrator mode if features exist.\"\"\"\n    mode_file = graph_dir / \"orchestrator-mode.json\"\n\n    # Activate if features exist and mode not explicitly disabled\n    if features:\n        mode_data = {\n            \"enabled\": True,\n            \"activated_at\": datetime.now().isoformat(),\n            \"session_id\": os.environ.get(\"CLAUDE_SESSION_ID\", \"unknown\"),\n            \"enforcement_level\": \"strict\",  # Default to strict\n            \"auto_activated\": True\n        }\n        mode_file.write_text(json.dumps(mode_data, indent=2))\n    elif mode_file.exists():\n        # Deactivate if no features\n        data = json.loads(mode_file.read_text())\n        if data.get(\"auto_activated\"):  # Only auto-deactivate if auto-activated\n            data[\"enabled\"] = False\n            mode_file.write_text(json.dumps(data, indent=2))\n\n# Call in main()\nactivate_orchestrator_mode(graph_dir, features)\n</code></pre>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#component-5-skill-activation-integration","title":"Component 5: Skill Activation Integration","text":"<p>Modify orchestrator skill to activate mode:</p> <p>Add to skill.md header:</p> <pre><code>**IMPORTANT**: This skill automatically activates orchestrator enforcement mode.\n\nWhen activated:\n- \u2705 Task delegation is REQUIRED for implementation\n- \u2705 Quick lookups (single Read/Grep) are allowed\n- \u2705 Work item management is allowed\n- \u274c Direct Edit/Write operations are BLOCKED\n\nTo disable: `uv run htmlgraph orchestrator disable`\n</code></pre>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#operation-classification-matrix","title":"Operation Classification Matrix","text":"Tool Operation Orchestrator Allowed Reasoning Task Any \u2705 ALWAYS Core orchestration tool AskUserQuestion Any \u2705 ALWAYS Decision making TodoWrite Any \u2705 ALWAYS Progress tracking Bash <code>uv run htmlgraph ...</code> \u2705 ALWAYS SDK operations Bash <code>git status/diff</code> \u2705 ALWAYS Read-only status Bash <code>from htmlgraph ...</code> \u2705 ALWAYS Work item creation Read First use \u2705 SINGLE Quick lookup allowed Read 2+ in sequence \u274c DELEGATE Explorer subagent Grep First use \u2705 SINGLE Quick search allowed Grep 2+ in sequence \u274c DELEGATE Explorer subagent Glob First use \u2705 SINGLE Quick file find Glob 2+ in sequence \u274c DELEGATE Explorer subagent Edit Any \u274c DELEGATE Coder subagent Write Any \u274c DELEGATE Coder subagent NotebookEdit Any \u274c DELEGATE Coder subagent Delete Any \u274c DELEGATE Coder subagent Bash <code>npm test/build</code> \u274c DELEGATE Testing subagent Bash <code>pytest</code> \u274c DELEGATE Testing subagent"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#enforcement-levels","title":"Enforcement Levels","text":""},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#strict-mode-default","title":"Strict Mode (Default)","text":"<ul> <li>BLOCKS implementation operations</li> <li>Provides clear error message with Task suggestion</li> <li>Enforces delegation pattern</li> </ul>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#guidance-mode","title":"Guidance Mode","text":"<ul> <li>ALLOWS all operations</li> <li>Provides warnings and suggestions</li> <li>Relies on Claude following guidance</li> </ul>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#activation-flow","title":"Activation Flow","text":"<pre><code>Session Start\n    \u2193\nCheck for features\n    \u2193\nFeatures exist? \u2192 YES \u2192 Activate orchestrator mode (strict)\n    \u2193                    Write .htmlgraph/orchestrator-mode.json\n    \u2193\nPreToolUse hook runs\n    \u2193\nCheck orchestrator-mode.json\n    \u2193\nMode active? \u2192 YES \u2192 Enforce rules\n    \u2193                  Block/Guide based on level\n    \u2193\nAllow operation\n</code></pre>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#escape-hatches","title":"Escape Hatches","text":"<ol> <li> <p>Disable for emergency fixes:    <pre><code>uv run htmlgraph orchestrator disable\n</code></pre></p> </li> <li> <p>Guidance mode for learning:    <pre><code>uv run htmlgraph orchestrator enable --level=guidance\n</code></pre></p> </li> <li> <p>Per-session override:    <pre><code>HTMLGRAPH_ORCHESTRATOR_DISABLED=1 claude\n</code></pre></p> </li> </ol>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#testing-strategy","title":"Testing Strategy","text":"<ol> <li>Unit Tests - Test each operation classification</li> <li>Integration Tests - Test full enforcement flow</li> <li>Edge Cases - Test mode transitions, hook failures</li> <li>User Experience - Ensure clear error messages</li> </ol>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#migration-plan","title":"Migration Plan","text":"<ol> <li>Phase 1: Implement mode state management (orchestrator-mode.json)</li> <li>Phase 2: Implement PreToolUse hook (orchestrator-enforce.py)</li> <li>Phase 3: Add CLI commands</li> <li>Phase 4: Integrate with SessionStart hook</li> <li>Phase 5: Update orchestrator skill</li> <li>Phase 6: Deploy with guidance mode default (soft launch)</li> <li>Phase 7: Switch to strict mode default (after validation)</li> </ol>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#success-metrics","title":"Success Metrics","text":"<ul> <li>\u2705 Claude consistently delegates implementation work</li> <li>\u2705 Quick lookups still work (single Read/Grep)</li> <li>\u2705 Work item creation unblocked</li> <li>\u2705 Clear error messages when blocking</li> <li>\u2705 Users can disable when needed</li> <li>\u2705 No false positives (blocking legitimate operations)</li> </ul>"},{"location":"ORCHESTRATOR_ENFORCEMENT_DESIGN/#open-questions","title":"Open Questions","text":"<ol> <li>Should orchestrator mode persist across sessions or reset each time?</li> <li> <p>Decision: Persist, but allow manual disable</p> </li> <li> <p>How to handle mixed workflows (orchestrator + direct work)?</p> </li> <li> <p>Decision: Provide guidance mode for flexibility</p> </li> <li> <p>What if user explicitly requests direct implementation?</p> </li> <li> <p>Decision: Provide clear disable command in error message</p> </li> <li> <p>Should we track delegation compliance metrics?</p> </li> <li>Decision: Yes, add to analytics (future enhancement)</li> </ol>"},{"location":"ORCHESTRATOR_MODE_GUIDE/","title":"Orchestrator Mode - Complete Guide","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Quick Start (30 Seconds)</li> <li>How It Works</li> <li>Operation Reference</li> <li>Examples &amp; Patterns</li> <li>Configuration</li> <li>Troubleshooting</li> <li>FAQ</li> </ul>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#quick-start-30-seconds","title":"Quick Start (30 Seconds)","text":"<p>Orchestrator Mode helps you preserve context and work faster by delegating low-value operations to subagents.</p> <pre><code># Enable orchestrator mode\nuv run htmlgraph orchestrator enable\n\n# Check if it's working\nuv run htmlgraph orchestrator status\n\n# Start working - you'll get guidance when you should delegate\n# Example: After 3 Bash calls, you'll see:\n# \u26a0\ufe0f ORCHESTRATOR MODE: Consider delegating to Task tool\n</code></pre> <p>That's it! Orchestrator mode will guide you to better workflow patterns.</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#how-it-works","title":"How It Works","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    AI Agent (You)                        \u2502\n\u2502  Attempts to use tool: Bash, Edit, Grep, etc.          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              PreToolUse Hook (Interceptor)               \u2502\n\u2502  - Check orchestrator.json config                       \u2502\n\u2502  - Count tool usage in current session                  \u2502\n\u2502  - Classify operation (allowed/warned/blocked)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Decision Logic                        \u2502\n\u2502                                                          \u2502\n\u2502  \u2705 ALLOWED \u2192 Execute tool                              \u2502\n\u2502  \u26a0\ufe0f  WARNED \u2192 Execute + Show delegation suggestion      \u2502\n\u2502  \ud83d\udeab BLOCKED \u2192 Prevent execution + Show error            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#enforcement-modes","title":"Enforcement Modes","text":"<p>1. Strict Mode (Default) - Blocks operations that exceed thresholds - Forces delegation to subagents - Best for: Production workflows, complex projects</p> <p>2. Guidance Mode - Warns but allows all operations - Shows delegation suggestions - Best for: Learning, experimentation</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#operation-lifecycle","title":"Operation Lifecycle","text":"<ol> <li> <p>Agent initiates tool call <pre><code>bash(\"uv run pytest tests/\")\n</code></pre></p> </li> <li> <p>Hook intercepts before execution <pre><code># PreToolUse hook checks:\n# - Current bash_call_count = 3\n# - Threshold = 3\n# - Mode = strict\n</code></pre></p> </li> <li> <p>Classification decision <pre><code># Decision: BLOCKED (exceeded threshold)\n</code></pre></p> </li> <li> <p>Guidance provided <pre><code>\u26a0\ufe0f ORCHESTRATOR MODE: Exceeded threshold for Bash calls (3/3)\n\nSuggestion: Delegate to subagent using Task tool\nExample: Task(subagent_type=\"general-purpose\",\n              prompt=\"Run pytest and report failures\")\n\nRationale: Running tests fills orchestrator context with test output.\nSubagents can run tests in parallel and return summaries.\n</code></pre></p> </li> <li> <p>Agent adjusts approach <pre><code># Instead of direct call, delegate:\nTask(\n    subagent_type=\"general-purpose\",\n    prompt=\"Run pytest and report only failures\"\n)\n</code></pre></p> </li> </ol>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#operation-reference","title":"Operation Reference","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#complete-classification-matrix","title":"Complete Classification Matrix","text":"Operation Threshold Strict Mode Guidance Mode Rationale SDK operations Unlimited \u2705 Allowed \u2705 Allowed High-level, minimal context Task tool Unlimited \u2705 Allowed \u2705 Allowed Designed for delegation TodoWrite Unlimited \u2705 Allowed \u2705 Allowed Task management Read (\u22645) 5 \u2705 Allowed \u2705 Allowed Reasonable exploration Read (&gt;5) 5 \ud83d\udeab Blocked \u26a0\ufe0f Warned Fills context, delegate search Bash (\u22643) 3 \u2705 Allowed \u2705 Allowed Quick commands OK Bash (&gt;3) 3 \ud83d\udeab Blocked \u26a0\ufe0f Warned Test output fills context Edit (\u22645) 5 \u2705 Allowed \u2705 Allowed Focused changes OK Edit (&gt;5) 5 \ud83d\udeab Blocked \u26a0\ufe0f Warned Large refactors, delegate Grep (\u22645) 5 \u2705 Allowed \u2705 Allowed Targeted searches OK Grep (&gt;5) 5 \ud83d\udeab Blocked \u26a0\ufe0f Warned Exploration, delegate Glob (\u22645) 5 \u2705 Allowed \u2705 Allowed File discovery OK Glob (&gt;5) 5 \ud83d\udeab Blocked \u26a0\ufe0f Warned Large-scale, delegate"},{"location":"ORCHESTRATOR_MODE_GUIDE/#why-these-thresholds","title":"Why These Thresholds?","text":"<p>Bash (3 calls): - 1-3 calls: Quick commands, status checks \u2192 Allowed - 4+ calls: Running tests, builds, multiple commands \u2192 Delegate</p> <p>Read (5 files): - 1-5 files: Understanding specific modules \u2192 Allowed - 6+ files: Codebase exploration \u2192 Delegate</p> <p>Edit (5 files): - 1-5 edits: Focused bug fix or feature \u2192 Allowed - 6+ edits: Large refactoring \u2192 Delegate</p> <p>Grep/Glob (5 calls): - 1-5 searches: Targeted queries \u2192 Allowed - 6+ searches: Broad exploration \u2192 Delegate</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#examples-patterns","title":"Examples &amp; Patterns","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#pattern-1-test-execution","title":"Pattern 1: Test Execution","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#anti-pattern-direct-execution","title":"\u274c Anti-Pattern (Direct Execution)","text":"<pre><code># Orchestrator runs tests directly\nresult1 = bash(\"uv run pytest tests/unit/\")\n# \u2705 Allowed (1/3 bash calls)\n\nresult2 = bash(\"uv run pytest tests/integration/\")\n# \u2705 Allowed (2/3 bash calls)\n\nresult3 = bash(\"uv run pytest tests/e2e/\")\n# \u2705 Allowed (3/3 bash calls)\n\nresult4 = bash(\"uv run pytest tests/performance/\")\n# \ud83d\udeab BLOCKED (4/3 bash calls)\n# Error: Orchestrator mode blocks this operation\n</code></pre> <p>Problems: - Sequential execution (slow) - Test output fills context - Can't run more than 3 test suites - Context consumed by test results</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#success-pattern-delegation","title":"\u2705 Success Pattern (Delegation)","text":"<pre><code># Orchestrator delegates to parallel subagents\nunit_results = Task(\n    subagent_type=\"general-purpose\",\n    prompt=\"\"\"\n    Run unit tests and report:\n    - Total tests run\n    - Failures (name + error)\n    - Summary statistics\n    \"\"\"\n)\n\nintegration_results = Task(\n    subagent_type=\"general-purpose\",\n    prompt=\"\"\"\n    Run integration tests and report:\n    - Total tests run\n    - Failures (name + error)\n    - Summary statistics\n    \"\"\"\n)\n\ne2e_results = Task(\n    subagent_type=\"general-purpose\",\n    prompt=\"\"\"\n    Run e2e tests and report:\n    - Total tests run\n    - Failures (name + error)\n    - Summary statistics\n    \"\"\"\n)\n# All 3 run in parallel, orchestrator gets summaries only\n</code></pre> <p>Benefits: - \u2705 Parallel execution (3x faster) - \u2705 Context preserved (summaries only) - \u2705 Unlimited test suites - \u2705 Orchestrator focuses on decisions</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#pattern-2-multi-file-refactoring","title":"Pattern 2: Multi-File Refactoring","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#anti-pattern-direct-editing","title":"\u274c Anti-Pattern (Direct Editing)","text":"<pre><code># Orchestrator edits 10 files\nfiles = [\n    \"src/api/users.py\",\n    \"src/api/posts.py\",\n    \"src/api/comments.py\",\n    \"src/api/auth.py\",\n    \"src/api/profiles.py\",\n    \"src/api/settings.py\",  # 6th file \u2192 BLOCKED\n    # ... 4 more files won't be processed\n]\n\nfor file in files:\n    Edit(file, old=\"old_api\", new=\"new_api\")\n    # First 5: \u2705 Allowed\n    # 6th+: \ud83d\udeab BLOCKED\n</code></pre> <p>Problems: - Can't complete refactor (blocked after 5) - Context filled with diffs - Sequential edits - No summary of changes</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#success-pattern-delegation_1","title":"\u2705 Success Pattern (Delegation)","text":"<pre><code># Orchestrator delegates entire refactor\nTask(\n    subagent_type=\"general-purpose\",\n    prompt=\"\"\"\n    Update all API files to use new_api instead of old_api:\n\n    Files to update:\n    - src/api/users.py\n    - src/api/posts.py\n    - src/api/comments.py\n    - src/api/auth.py\n    - src/api/profiles.py\n    - src/api/settings.py\n    - src/api/notifications.py\n    - src/api/search.py\n    - src/api/admin.py\n    - src/api/webhooks.py\n\n    Report:\n    - Files updated successfully\n    - Any files skipped (with reason)\n    - Summary of changes\n    - Any issues encountered\n    \"\"\"\n)\n</code></pre> <p>Benefits: - \u2705 All files processed - \u2705 Context preserved (summary only) - \u2705 Subagent handles details - \u2705 Clear completion report</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#pattern-3-codebase-exploration","title":"Pattern 3: Codebase Exploration","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#anti-pattern-direct-searching","title":"\u274c Anti-Pattern (Direct Searching)","text":"<pre><code># Orchestrator searches directly\ngrep(\"class.*API\", output_mode=\"content\")     # 1/5\ngrep(\"def.*endpoint\", output_mode=\"content\")  # 2/5\ngrep(\"@router\", output_mode=\"content\")        # 3/5\ngrep(\"async def\", output_mode=\"content\")      # 4/5\ngrep(\"database.*query\", output_mode=\"content\") # 5/5\ngrep(\"cache.*redis\", output_mode=\"content\")   # \ud83d\udeab BLOCKED\n</code></pre> <p>Problems: - Limited searches (only 5) - Results fill context - Can't complete exploration - Manual synthesis required</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#success-pattern-delegation_2","title":"\u2705 Success Pattern (Delegation)","text":"<pre><code># Orchestrator delegates exploration\nTask(\n    subagent_type=\"general-purpose\",\n    prompt=\"\"\"\n    Explore the codebase and document the API architecture:\n\n    Find and report:\n    1. All API endpoint classes (class.*API)\n    2. Route definitions (@router)\n    3. Async endpoints (async def)\n    4. Database queries (database.*query)\n    5. Caching patterns (cache.*redis)\n    6. Authentication middleware\n\n    Provide:\n    - Summary of architecture\n    - List of endpoints by category\n    - Database access patterns\n    - Caching strategy\n    - Security mechanisms\n\n    Format as structured report with code examples.\n    \"\"\"\n)\n</code></pre> <p>Benefits: - \u2705 Unlimited searches - \u2705 Comprehensive exploration - \u2705 Structured report - \u2705 Context preserved</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#pattern-4-debugging-session","title":"Pattern 4: Debugging Session","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#anti-pattern-direct-investigation","title":"\u274c Anti-Pattern (Direct Investigation)","text":"<pre><code># Orchestrator investigates directly\nread(\"src/api/users.py\")     # 1/5\nread(\"src/models/user.py\")   # 2/5\nread(\"src/db/queries.py\")    # 3/5\nread(\"tests/test_users.py\")  # 4/5\nread(\"src/utils/auth.py\")    # 5/5\n\nbash(\"uv run pytest tests/test_users.py -v\")  # 1/3\nbash(\"uv run pytest tests/test_users.py --pdb\")  # 2/3\nbash(\"grep -r 'UserModel' src/\")  # 3/3\n\n# Can't read more files or run more commands\n# \ud83d\udeab BLOCKED on next operation\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#success-pattern-delegation_3","title":"\u2705 Success Pattern (Delegation)","text":"<pre><code># Orchestrator delegates investigation\nTask(\n    subagent_type=\"general-purpose\",\n    prompt=\"\"\"\n    Debug the user authentication failure in tests/test_users.py:\n\n    Investigation steps:\n    1. Read relevant source files (users.py, user.py, auth.py)\n    2. Read test file and understand failure\n    3. Run tests with verbose output\n    4. Identify root cause\n\n    Report:\n    - Root cause of failure\n    - Files involved\n    - Proposed fix\n    - Test results before/after fix (if implemented)\n    \"\"\"\n)\n</code></pre> <p>Benefits: - \u2705 Unrestricted investigation - \u2705 Focused report - \u2705 Context preserved - \u2705 Actionable results</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#configuration","title":"Configuration","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#default-configuration","title":"Default Configuration","text":"<p>Located at <code>.htmlgraph/orchestrator.json</code>:</p> <pre><code>{\n  \"enabled\": false,\n  \"mode\": \"strict\",\n  \"thresholds\": {\n    \"max_bash_calls\": 3,\n    \"max_file_reads\": 5,\n    \"max_file_edits\": 5,\n    \"max_grep_calls\": 5,\n    \"max_glob_calls\": 5\n  },\n  \"allowed_tools\": [\n    \"SDK\",\n    \"Task\",\n    \"TodoWrite\"\n  ]\n}\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#customizing-thresholds","title":"Customizing Thresholds","text":"<p>Option 1: Edit configuration file</p> <pre><code># Edit directly\nvim .htmlgraph/orchestrator.json\n\n# Example: Allow 10 file reads instead of 5\n{\n  \"thresholds\": {\n    \"max_file_reads\": 10\n  }\n}\n</code></pre> <p>Option 2: CLI (Future)</p> <pre><code># Not yet implemented, but planned:\nuv run htmlgraph orchestrator set-threshold max_bash_calls 5\nuv run htmlgraph orchestrator set-threshold max_file_reads 10\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#mode-switching","title":"Mode Switching","text":"<pre><code># Strict mode (blocks operations)\nuv run htmlgraph orchestrator enable --mode strict\n\n# Guidance mode (warns only)\nuv run htmlgraph orchestrator enable --mode guidance\n\n# Disable entirely\nuv run htmlgraph orchestrator disable\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#per-project-configuration","title":"Per-Project Configuration","text":"<p>Each project can have different settings:</p> <pre><code># Project A: Strict with low thresholds\ncd /path/to/project-a\nuv run htmlgraph orchestrator enable --mode strict\nvim .htmlgraph/orchestrator.json  # Set max_bash_calls=2\n\n# Project B: Guidance with high thresholds\ncd /path/to/project-b\nuv run htmlgraph orchestrator enable --mode guidance\nvim .htmlgraph/orchestrator.json  # Set max_bash_calls=10\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#temporarily-disable-for-single-session","title":"Temporarily Disable for Single Session","text":"<pre><code># Disable for this task\nuv run htmlgraph orchestrator disable\n\n# Do your work\n# ...\n\n# Re-enable when done\nuv run htmlgraph orchestrator enable\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#problem-operation-blocked-but-i-need-to-do-it","title":"Problem: \"Operation blocked but I need to do it\"","text":"<p>Scenario: You're blocked from running a 4<sup>th</sup> Bash command, but you really need to run it.</p> <p>Solutions:</p> <ol> <li> <p>Use Guidance Mode (Recommended) <pre><code>uv run htmlgraph orchestrator enable --mode guidance\n# Now you'll get warnings but not blocks\n</code></pre></p> </li> <li> <p>Increase Threshold (If justified) <pre><code>vim .htmlgraph/orchestrator.json\n# Change max_bash_calls from 3 to 5\n</code></pre></p> </li> <li> <p>Delegate Instead (Best) <pre><code># Delegate the operation to subagent\nTask(prompt=\"Run the command and report results\")\n</code></pre></p> </li> <li> <p>Temporarily Disable <pre><code>uv run htmlgraph orchestrator disable\n# Run your commands\nuv run htmlgraph orchestrator enable\n</code></pre></p> </li> </ol>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#problem-too-many-operations-blocked","title":"Problem: \"Too many operations blocked\"","text":"<p>Scenario: Every operation is getting blocked, can't make progress.</p> <p>Solutions:</p> <ol> <li>Check if you're doing the right task</li> <li>Are you exploring? \u2192 Delegate to subagent</li> <li>Are you refactoring? \u2192 Delegate to subagent</li> <li> <p>Are you testing? \u2192 Delegate to subagent</p> </li> <li> <p>Switch to Guidance Mode <pre><code>uv run htmlgraph orchestrator enable --mode guidance\n# Learn the patterns without blocks\n</code></pre></p> </li> <li> <p>Review your workflow <pre><code># If you're doing this:\nfor file in files:\n    Edit(file, ...)\n\n# Consider this instead:\nTask(prompt=f\"Update all files in {files}\")\n</code></pre></p> </li> </ol>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#problem-dont-understand-why-operation-was-blocked","title":"Problem: \"Don't understand why operation was blocked\"","text":"<p>Scenario: Got blocked but the reason isn't clear.</p> <p>Solution: Read the guidance message carefully:</p> <pre><code>\u26a0\ufe0f ORCHESTRATOR MODE: Exceeded threshold for Edit calls (5/5)\n\nSuggestion: Delegate to subagent using Task tool\nExample: Task(subagent_type=\"general-purpose\",\n             prompt=\"Update all files to use new API\")\n\nRationale: Editing many files fills orchestrator context with diffs.\nSubagents can handle bulk edits and return summaries.\n</code></pre> <p>Key parts: 1. What: \"Exceeded threshold for Edit calls\" 2. Why: \"Editing many files fills orchestrator context\" 3. How: Delegate using Task tool 4. Example: Actual delegation code</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#problem-orchestrator-mode-not-activating","title":"Problem: \"Orchestrator mode not activating\"","text":"<p>Scenario: Enabled orchestrator mode but not seeing any enforcement.</p> <p>Solutions:</p> <ol> <li> <p>Check status <pre><code>uv run htmlgraph orchestrator status\n# Should show: enabled=true\n</code></pre></p> </li> <li> <p>Verify configuration exists <pre><code>cat .htmlgraph/orchestrator.json\n# Should have: \"enabled\": true\n</code></pre></p> </li> <li> <p>Check PreToolUse hook is installed <pre><code>ls .claude/hooks/pre-tool-use/\n# Should contain orchestrator hook\n</code></pre></p> </li> <li> <p>Restart Claude Code <pre><code># Sometimes hooks need reload\n# Close and reopen Claude Code\n</code></pre></p> </li> </ol>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#problem-want-different-thresholds-per-operation","title":"Problem: \"Want different thresholds per operation\"","text":"<p>Scenario: 3 Bash calls is too low, but 5 Edit calls is fine.</p> <p>Solution: Edit configuration:</p> <pre><code>{\n  \"thresholds\": {\n    \"max_bash_calls\": 10,    // Increased\n    \"max_file_reads\": 5,     // Keep default\n    \"max_file_edits\": 3,     // Decreased\n    \"max_grep_calls\": 5,     // Keep default\n    \"max_glob_calls\": 5      // Keep default\n  }\n}\n</code></pre>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#faq","title":"FAQ","text":""},{"location":"ORCHESTRATOR_MODE_GUIDE/#general-questions","title":"General Questions","text":"<p>Q: What is orchestrator mode?</p> <p>A: An enforcement system that guides you to delegate context-filling operations to subagents, preserving your context for high-level decisions.</p> <p>Q: Why should I use it?</p> <p>A: Benefits: - \u2705 Preserve context for strategic thinking - \u2705 Work faster (parallel subagents) - \u2705 Learn better workflow patterns - \u2705 Scale to larger projects</p> <p>Q: Will this slow me down?</p> <p>A: No - delegation is actually faster: - Direct: 3 sequential Bash calls (slow) - Delegated: 3 parallel subagents (fast) - Plus, you preserve context for decisions</p> <p>Q: Can I disable it?</p> <p>A: Yes: <pre><code>uv run htmlgraph orchestrator disable\n</code></pre></p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#mode-configuration","title":"Mode &amp; Configuration","text":"<p>Q: What's the difference between strict and guidance mode?</p> <p>A: - Strict: Blocks operations that exceed thresholds (enforces delegation) - Guidance: Warns but allows all operations (teaches patterns)</p> <p>Q: Which mode should I start with?</p> <p>A: Start with guidance mode to learn patterns: <pre><code>uv run htmlgraph orchestrator enable --mode guidance\n</code></pre></p> <p>After you understand the patterns, switch to strict: <pre><code>uv run htmlgraph orchestrator enable --mode strict\n</code></pre></p> <p>Q: Can I customize thresholds?</p> <p>A: Yes, edit <code>.htmlgraph/orchestrator.json</code>: <pre><code>{\n  \"thresholds\": {\n    \"max_bash_calls\": 5  // Changed from 3\n  }\n}\n</code></pre></p> <p>Q: Do different projects have different configs?</p> <p>A: Yes - each project has its own <code>.htmlgraph/orchestrator.json</code>.</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#operations-thresholds","title":"Operations &amp; Thresholds","text":"<p>Q: Why is Read limited to 5 files?</p> <p>A: After 5 file reads, you're likely exploring the codebase. That's better delegated to a subagent who can: - Read unlimited files - Provide a structured report - Not fill your context with file contents</p> <p>Q: Why only 3 Bash calls?</p> <p>A: After 3 Bash calls, you're likely: - Running test suites (output fills context) - Running builds (output fills context) - Debugging with multiple commands</p> <p>Subagents can handle this and return summaries.</p> <p>Q: What if I just need to check a status?</p> <p>A: That's fine - 1-3 Bash calls are allowed: <pre><code>bash(\"git status\")           # \u2705 Allowed\nbash(\"uv run pytest --co\")   # \u2705 Allowed\nbash(\"ls .htmlgraph/\")       # \u2705 Allowed\n</code></pre></p> <p>Q: Why are SDK operations unlimited?</p> <p>A: SDK operations are high-level and context-efficient: <pre><code>sdk.features.create(\"Title\")  # Minimal context\nsdk.features.edit(\"id\")       # Minimal context\n</code></pre></p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#delegation","title":"Delegation","text":"<p>Q: How do I delegate operations?</p> <p>A: Use the Task tool: <pre><code>Task(\n    subagent_type=\"general-purpose\",\n    prompt=\"Your detailed instructions here\"\n)\n</code></pre></p> <p>Q: What makes a good delegation prompt?</p> <p>A: Include: 1. What to do: \"Run pytest tests\" 2. How to report: \"Report only failures\" 3. Format: \"Structured as: total, failures, errors\"</p> <p>Example: <pre><code>Task(prompt=\"\"\"\nRun all unit tests in tests/unit/ and report:\n- Total tests run\n- Failures (name + error message)\n- Summary statistics\n\nFormat as markdown list.\n\"\"\")\n</code></pre></p> <p>Q: Can subagents delegate further?</p> <p>A: Yes - subagents can also use Task tool for recursive delegation.</p> <p>Q: How many subagents can I spawn?</p> <p>A: Unlimited - orchestrator mode doesn't restrict Task tool usage.</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#workflow","title":"Workflow","text":"<p>Q: When should I use orchestrator mode?</p> <p>A: Use when: - \u2705 Managing complex multi-step workflows - \u2705 Coordinating multiple features - \u2705 Running comprehensive test suites - \u2705 Large-scale refactoring - \u2705 Codebase exploration</p> <p>Q: When should I skip orchestrator mode?</p> <p>A: Skip when: - \u274c Single, focused task (bug fix) - \u274c Quick prototype - \u274c Documentation writing - \u274c Learning/experimenting</p> <p>Q: How do I know if orchestrator mode is working?</p> <p>A: Check status: <pre><code>uv run htmlgraph orchestrator status\n</code></pre></p> <p>You should see guidance messages when approaching thresholds.</p> <p>Q: What if I disagree with a block?</p> <p>A: Options: 1. Use guidance mode instead of strict 2. Increase the threshold 3. Open an issue - we want to improve classification logic</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#advanced","title":"Advanced","text":"<p>Q: Can I add custom operation classifications?</p> <p>A: Not yet, but planned. Future: <pre><code>{\n  \"custom_rules\": {\n    \"Write\": {\n      \"max_calls\": 3,\n      \"rationale\": \"Writing many files should be delegated\"\n    }\n  }\n}\n</code></pre></p> <p>Q: Can I see statistics on my delegations?</p> <p>A: Not yet, but planned: <pre><code>uv run htmlgraph orchestrator stats\n# Shows: delegations, blocks, time saved\n</code></pre></p> <p>Q: Does orchestrator mode work with other AI agents?</p> <p>A: Yes - any agent using HtmlGraph respects orchestrator mode (Claude, Gemini, etc.).</p> <p>Q: How do I contribute improvements?</p> <p>A: Open issues/PRs at: https://github.com/Shakes-tzd/htmlgraph</p>"},{"location":"ORCHESTRATOR_MODE_GUIDE/#summary","title":"Summary","text":"<p>Orchestrator Mode in 3 Steps:</p> <ol> <li> <p>Enable it <pre><code>uv run htmlgraph orchestrator enable --mode guidance\n</code></pre></p> </li> <li> <p>Learn patterns</p> </li> <li>Watch for warnings</li> <li>Adjust your workflow</li> <li> <p>Delegate context-filling work</p> </li> <li> <p>Enforce it <pre><code>uv run htmlgraph orchestrator enable --mode strict\n</code></pre></p> </li> </ol> <p>Key Takeaway: Orchestrator mode helps you preserve context and work faster by teaching you to delegate effectively.</p> <p>Get Help: - Docs: <code>/Users/shakes/DevProjects/htmlgraph/AGENTS.md#orchestrator-mode</code> - Issues: https://github.com/Shakes-tzd/htmlgraph/issues - Examples: See \"Examples &amp; Patterns\" section above</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/","title":"Packageable Auto-Updating Documentation Pattern","text":"<p>A comprehensive guide for package developers implementing versioned, customizable, auto-updating agent documentation systems</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#1-introduction","title":"1. Introduction","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#what-is-packageable-auto-updating-documentation","title":"What is Packageable Auto-Updating Documentation?","text":"<p>Packageable auto-updating documentation is a pattern for distributing AI agent instructions that:</p> <ol> <li>Ship with the package - Documentation lives in the package, not external docs sites</li> <li>Auto-update - Users get latest best practices when upgrading packages</li> <li>Preserve customizations - User modifications survive package updates</li> <li>Version intelligently - Track both package version and documentation schema version</li> <li>Migrate safely - Guide users through breaking documentation changes</li> </ol> <p>This pattern is particularly valuable for AI agent tools (Claude Code plugins, MCP servers, Gemini extensions) where the \"documentation\" is actually executable instructions that agents consume.</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#why-this-pattern-matters","title":"Why This Pattern Matters","text":"<p>Traditional documentation problems: - Users read docs once, never check for updates - Breaking changes in APIs require manual doc updates - No way to know if user's local instructions are stale - Customizations get lost when copying new examples</p> <p>Agent documentation challenges: - Instructions are consumed programmatically, not read by humans - Stale instructions cause agent failures - Context budget limits require careful documentation design - Users need to customize for their workflows - Package updates must not break user customizations</p> <p>This pattern solves: - \u2705 Automatic delivery of documentation improvements - \u2705 Safe preservation of user customizations - \u2705 Clear upgrade paths for breaking changes - \u2705 Version compatibility tracking - \u2705 Rollback safety for failed migrations</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#use-cases-and-benefits","title":"Use Cases and Benefits","text":"<p>Ideal for: 1. AI Agent Plugins - Claude Code plugins, MCP servers, Gemini extensions 2. CLI Tools - Developer tools with complex configuration 3. SDK Libraries - Packages with agent integration 4. Framework Starters - Project templates that evolve</p> <p>Benefits: - Users - Always have up-to-date best practices - Maintainers - Deprecate old patterns safely - Ecosystem - Shared improvements propagate automatically</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#when-to-use-this-pattern","title":"When to Use This Pattern","text":"<p>\u2705 Use this pattern when: - Documentation is consumed by AI agents programmatically - Package updates include documentation improvements - Users need to customize documentation for their needs - You need to track documentation schema evolution - Context budget matters (token limits)</p> <p>\u274c Simpler approaches work when: - Documentation is only for human reading - No user customization needed - Package updates rarely affect documentation - Documentation is stateless (no version tracking needed)</p> <p>Decision framework: <pre><code>Does your package provide AI agent instructions? YES \u2192 Continue\nDo you expect to improve those instructions over time? YES \u2192 Continue\nDo users need to customize instructions? YES \u2192 Continue\nIs there a context budget concern? YES \u2192 Use this pattern\n\nOtherwise: Use simple static documentation\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#2-architecture-overview","title":"2. Architecture Overview","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#two-tier-system","title":"Two-Tier System","text":"<p>The pattern uses a two-tier system where package-provided templates combine with user customizations:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    USER PROJECT                          \u2502\n\u2502  .claude/                                                \u2502\n\u2502    \u251c\u2500\u2500 CLAUDE.md (generated, user can override blocks)  \u2502\n\u2502    \u251c\u2500\u2500 .claude-docs-meta.json (version tracking)        \u2502\n\u2502    \u2514\u2500\u2500 templates/ (optional user overrides)             \u2502\n\u2502        \u2514\u2500\u2500 claude.md.jinja2 (custom blocks)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502 extends (Jinja2 inheritance)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 PACKAGE DISTRIBUTION                     \u2502\n\u2502  your_package/                                           \u2502\n\u2502    \u251c\u2500\u2500 templates/                                        \u2502\n\u2502    \u2502   \u251c\u2500\u2500 base/                                         \u2502\n\u2502    \u2502   \u2502   \u2514\u2500\u2500 claude.md.jinja2 (base template)         \u2502\n\u2502    \u2502   \u2514\u2500\u2500 platforms/                                    \u2502\n\u2502    \u2502       \u251c\u2500\u2500 gemini.md.jinja2                          \u2502\n\u2502    \u2502       \u2514\u2500\u2500 codex.md.jinja2                           \u2502\n\u2502    \u251c\u2500\u2500 migrations/                                       \u2502\n\u2502    \u2502   \u251c\u2500\u2500 001_initial.py                               \u2502\n\u2502    \u2502   \u2514\u2500\u2500 002_add_orchestration.py                     \u2502\n\u2502    \u2514\u2500\u2500 cli.py (generate/upgrade commands)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#template-inheritance-model","title":"Template Inheritance Model","text":"<p>Base Template (in package): <pre><code>{# your_package/templates/base/claude.md.jinja2 #}\n# {{ package_name }} - Claude Code Instructions\n\n## Quick Start\n{% block quickstart %}\nDefault quickstart content from package...\n{% endblock %}\n\n## Configuration\n{% block configuration %}\nDefault configuration from package...\n{% endblock %}\n\n## Advanced Usage\n{% block advanced %}\nDefault advanced usage from package...\n{% endblock %}\n</code></pre></p> <p>User Override (in project): <pre><code>{# .claude/templates/claude.md.jinja2 #}\n{% extends \"base/claude.md.jinja2\" %}\n\n{# Override just the configuration block #}\n{% block configuration %}\n## My Custom Configuration\n- Custom setting 1\n- Custom setting 2\n\n{{ super() }}  {# Include package defaults too #}\n{% endblock %}\n</code></pre></p> <p>Result - User gets: - Package's quickstart (default) - User's custom configuration + package defaults - Package's advanced usage (default)</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#version-tracking","title":"Version Tracking","text":"<p>Dual versioning system:</p> <ol> <li>Package Version (<code>0.9.5</code>) - Tracks package releases</li> <li>Doc Schema Version (<code>2</code>) - Tracks documentation structure changes</li> </ol> <pre><code># Stored in .claude/.claude-docs-meta.json\n{\n  \"version\": \"2\",           # Doc schema version\n  \"package_version\": \"0.9.5\",  # Package version when generated\n  \"generated_at\": \"2025-01-02T10:30:00Z\",\n  \"platform\": \"claude\",\n  \"has_customizations\": true,\n  \"customization_blocks\": [\"configuration\", \"advanced\"],\n  \"last_migration\": \"002_add_orchestration\"\n}\n</code></pre> <p>Why dual versioning? - Package version changes frequently (bug fixes, features) - Doc schema version changes rarely (structure changes only) - Allows N-1 compatibility (old docs work with new package)</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#version-compatibility-matrix","title":"Version Compatibility Matrix","text":"<pre><code>COMPATIBILITY_MATRIX = {\n    \"1\": {  # Doc schema version 1\n        \"min_package\": \"0.1.0\",\n        \"max_package\": \"0.8.9\",\n        \"description\": \"Original single-file format\"\n    },\n    \"2\": {  # Doc schema version 2\n        \"min_package\": \"0.9.0\",\n        \"max_package\": None,  # Current\n        \"description\": \"Template-based with blocks\"\n    }\n}\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#context-budget-management","title":"Context Budget Management","text":"<p>Challenge: AI agents have token limits (context budget).</p> <p>Strategy: Progressive disclosure with template blocks</p> <pre><code>{# Base template - always included (high priority) #}\n## Core Concepts\nEssential information agents always need...\n\n{# Optional blocks - user can exclude #}\n{% block advanced_patterns %}\nAdvanced patterns for power users...\n{% endblock %}\n\n{% block troubleshooting %}\nDetailed troubleshooting guide...\n{% endblock %}\n\n{% block examples %}\nComprehensive examples...\n{% endblock %}\n</code></pre> <p>User customization to reduce context: <pre><code>{% extends \"base/claude.md.jinja2\" %}\n\n{# Exclude heavy blocks to save tokens #}\n{% block examples %}{% endblock %}\n{% block troubleshooting %}{% endblock %}\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#visual-system-diagram","title":"Visual System Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Package Release                        \u2502\n\u2502  1. Developer updates base templates                     \u2502\n\u2502  2. Creates migration script if schema changes           \u2502\n\u2502  3. Bumps doc_schema_version if needed                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              User Runs: pip install --upgrade             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         CLI Command: your-package docs upgrade           \u2502\n\u2502  1. Detect current doc version                           \u2502\n\u2502  2. Compare with package doc version                     \u2502\n\u2502  3. Detect user customizations                           \u2502\n\u2502  4. Run migration scripts if needed                      \u2502\n\u2502  5. Regenerate docs preserving customizations            \u2502\n\u2502  6. Update metadata                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  User Gets Updated Docs                   \u2502\n\u2502  - Latest package improvements                           \u2502\n\u2502  - User customizations preserved                         \u2502\n\u2502  - Version metadata updated                              \u2502\n\u2502  - Rollback available if issues                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#3-implementation-guide","title":"3. Implementation Guide","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#31-template-system-setup","title":"3.1 Template System Setup","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#directory-structure","title":"Directory Structure","text":"<pre><code>your_package/\n\u251c\u2500\u2500 templates/\n\u2502   \u251c\u2500\u2500 base/\n\u2502   \u2502   \u251c\u2500\u2500 claude.md.jinja2       # Base template for Claude\n\u2502   \u2502   \u251c\u2500\u2500 gemini.md.jinja2       # Base template for Gemini\n\u2502   \u2502   \u2514\u2500\u2500 shared/\n\u2502   \u2502       \u251c\u2500\u2500 quickstart.md.jinja2\n\u2502   \u2502       \u2514\u2500\u2500 api-reference.md.jinja2\n\u2502   \u2514\u2500\u2500 platforms/                  # Platform-specific extensions\n\u2502       \u2514\u2500\u2500 claude-advanced.md.jinja2\n\u251c\u2500\u2500 migrations/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 base.py                     # MigrationScript base class\n\u2502   \u251c\u2500\u2500 001_initial.py\n\u2502   \u2514\u2500\u2500 002_add_orchestration.py\n\u251c\u2500\u2500 models.py                       # DocsMetadata Pydantic model\n\u251c\u2500\u2500 template_engine.py              # DocTemplateEngine class\n\u2514\u2500\u2500 cli.py                          # CLI commands\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#base-template-creation-with-jinja2","title":"Base Template Creation with Jinja2","text":"<p>Example base template:</p> <p><pre><code>{# your_package/templates/base/claude.md.jinja2 #}\n{#\n  Base template for Claude Code documentation\n  Users can override any {% block %} in their local templates\n#}\n\n# {{ package_name }} v{{ package_version }}\n\n{% block header %}\n**AI-Powered {{ package_name }} for Claude Code**\n\nThis documentation is auto-generated from package version {{ package_version }}.\nLast updated: {{ generated_at }}\n{% endblock %}\n\n---\n\n## Quick Start\n{% block quickstart %}\n```bash\n# Install the package\npip install {{ package_name }}\n\n# Initialize documentation\n{{ package_name }} docs generate\n\n# Verify setup\n{{ package_name }} docs version\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#configuration","title":"Configuration","text":"<p>{% block configuration %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#basic-configuration","title":"Basic Configuration","text":"<p>The package looks for configuration in: 1. <code>.{{ package_name }}/config.json</code> 2. Environment variables prefixed with <code>{{ package_name.upper() }}_</code></p> <p>Example config.json: <pre><code>{\n  \"agent_name\": \"claude\",\n  \"features_enabled\": [\"tracking\", \"analytics\"],\n  \"auto_update_docs\": true\n}\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#core-concepts","title":"Core Concepts","text":"<p>{% block core_concepts %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#how-package_name-works","title":"How {{ package_name }} Works","text":"<ol> <li>Concept A - Explanation...</li> <li>Concept B - Explanation...</li> <li>Concept C - Explanation...</li> </ol>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#api-reference","title":"API Reference","text":"<p>{% block api_reference %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#main-classes","title":"Main Classes","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#sdk-class","title":"<code>SDK</code> Class","text":"<pre><code>from {{ package_name }} import SDK\n\nsdk = SDK(agent=\"claude\")\n</code></pre> <p>Methods: - <code>create_feature()</code> - Create a new feature - <code>create_spike()</code> - Create a research spike</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#advanced-usage","title":"Advanced Usage","text":"<p>{% block advanced %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#advanced-patterns","title":"Advanced Patterns","text":"<p>{% block orchestration %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#orchestration-mode","title":"Orchestration Mode","text":"<p>For complex multi-agent workflows...</p> <p>{% block analytics %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#strategic-analytics","title":"Strategic Analytics","text":"<p>Analyze your workflow effectiveness... {% endblock %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#troubleshooting","title":"Troubleshooting","text":"<p>{% block troubleshooting %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#common-issues","title":"Common Issues","text":"<p>Issue 1: Docs out of date <pre><code>{{ package_name }} docs upgrade\n</code></pre></p> <p>Issue 2: Customizations lost <pre><code>{{ package_name }} docs rollback\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#customization-guide","title":"Customization Guide","text":"<p>{% block customization_guide %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#how-to-customize-this-documentation","title":"How to Customize This Documentation","text":"<ol> <li>Create <code>.claude/templates/claude.md.jinja2</code></li> <li>Extend the base template:    <pre><code>{%raw%}{% extends \"base/claude.md.jinja2\" %}{%endraw%}\n\n{%raw%}{% block configuration %}{%endraw%}\n## My Custom Configuration\n...\n{%raw%}{% endblock %}{%endraw%}\n</code></pre></li> <li>Regenerate: <code>{{ package_name }} docs generate</code></li> </ol> <p>{% block footer %} Documentation Version: {{ doc_version }} Package Version: {{ package_version }} Generated: {{ generated_at }} {% endblock %} <pre><code>#### Block-Based Structure for User Overrides\n\n**Design principles:**\n\n1. **Granular blocks** - Each section should be independently overridable\n2. **Nested blocks** - Allow partial overrides\n3. **Semantic naming** - Block names should describe content, not structure\n4. **Safe defaults** - Empty blocks should not break documentation\n\n**Example nested blocks:**\n```jinja2\n{% block advanced %}\n### Advanced Usage\n\n{% block orchestration %}\n#### Orchestration Mode\nDefault orchestration docs...\n{% endblock %}\n\n{% block analytics %}\n#### Analytics\nDefault analytics docs...\n{% endblock %}\n\n{% block custom_workflows %}\n{# Empty by default - users can add custom content #}\n{% endblock %}\n{% endblock %}\n</code></pre></p> <p>User can override at any level: <pre><code>{# Override entire advanced section #}\n{% block advanced %}\nMy completely custom advanced docs...\n{% endblock %}\n\n{# OR override just orchestration #}\n{% block orchestration %}\nMy custom orchestration docs...\n{% endblock %}\n\n{# OR add custom workflows while keeping defaults #}\n{% block custom_workflows %}\n## My Custom Workflows\n- Workflow 1\n- Workflow 2\n{% endblock %}\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#choiceloader-priority-system","title":"ChoiceLoader Priority System","text":"<p>Implementation:</p> <pre><code># your_package/template_engine.py\nfrom jinja2 import Environment, FileSystemLoader, ChoiceLoader\nfrom pathlib import Path\n\nclass DocTemplateEngine:\n    def __init__(self, package_name: str, project_root: Path):\n        self.package_name = package_name\n        self.project_root = project_root\n\n        # Package templates (bundled with distribution)\n        package_templates = Path(__file__).parent / \"templates\"\n\n        # User templates (in project directory)\n        user_templates = project_root / f\".{package_name}\" / \"templates\"\n        user_templates.mkdir(parents=True, exist_ok=True)\n\n        # Priority: User templates first, then package templates\n        loader = ChoiceLoader([\n            FileSystemLoader(str(user_templates)),\n            FileSystemLoader(str(package_templates))\n        ])\n\n        self.env = Environment(\n            loader=loader,\n            autoescape=False,  # We're generating Markdown\n            trim_blocks=True,\n            lstrip_blocks=True\n        )\n\n    def render(self, template_name: str, context: dict) -&gt; str:\n        \"\"\"Render template with user overrides taking priority\"\"\"\n        template = self.env.get_template(template_name)\n        return template.render(**context)\n\n    def has_user_template(self, template_name: str) -&gt; bool:\n        \"\"\"Check if user has custom template\"\"\"\n        user_path = (\n            self.project_root /\n            f\".{self.package_name}\" /\n            \"templates\" /\n            template_name\n        )\n        return user_path.exists()\n</code></pre> <p>Usage: <pre><code>engine = DocTemplateEngine(\"htmlgraph\", Path.cwd())\n\ncontext = {\n    \"package_name\": \"htmlgraph\",\n    \"package_version\": \"0.9.5\",\n    \"doc_version\": \"2\",\n    \"generated_at\": datetime.now().isoformat()\n}\n\n# Renders user template if exists, falls back to package template\noutput = engine.render(\"base/claude.md.jinja2\", context)\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#32-version-tracking","title":"3.2 Version Tracking","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#dual-versioning-model-design","title":"Dual Versioning Model Design","text":"<p>DocsMetadata Pydantic Model:</p> <pre><code># your_package/models.py\nfrom pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional, List\nfrom pathlib import Path\nimport json\n\nclass DocsMetadata(BaseModel):\n    \"\"\"\n    Tracks documentation version and customization state.\n\n    Dual versioning:\n    - doc_version: Schema version (changes when structure changes)\n    - package_version: Package version when docs were generated\n\n    This allows N-1 compatibility where old docs work with new packages\n    as long as doc_version is compatible.\n    \"\"\"\n\n    doc_version: str = Field(\n        description=\"Documentation schema version (e.g., '2')\"\n    )\n\n    package_version: str = Field(\n        description=\"Package version when generated (e.g., '0.9.5')\"\n    )\n\n    generated_at: datetime = Field(\n        default_factory=datetime.now,\n        description=\"Timestamp of generation\"\n    )\n\n    platform: str = Field(\n        default=\"claude\",\n        description=\"Target platform (claude, gemini, codex, etc.)\"\n    )\n\n    has_customizations: bool = Field(\n        default=False,\n        description=\"Whether user has custom template overrides\"\n    )\n\n    customization_blocks: List[str] = Field(\n        default_factory=list,\n        description=\"List of template blocks user has customized\"\n    )\n\n    last_migration: Optional[str] = Field(\n        default=None,\n        description=\"ID of last migration applied (e.g., '002_add_orchestration')\"\n    )\n\n    backup_path: Optional[str] = Field(\n        default=None,\n        description=\"Path to backup created before last update\"\n    )\n\n    @classmethod\n    def load(cls, path: Path) -&gt; Optional[\"DocsMetadata\"]:\n        \"\"\"Load metadata from .claude-docs-meta.json\"\"\"\n        if not path.exists():\n            return None\n\n        try:\n            with open(path) as f:\n                data = json.load(f)\n            return cls(**data)\n        except Exception as e:\n            print(f\"Warning: Failed to load metadata: {e}\")\n            return None\n\n    def save(self, path: Path) -&gt; None:\n        \"\"\"Save metadata to .claude-docs-meta.json\"\"\"\n        path.parent.mkdir(parents=True, exist_ok=True)\n\n        with open(path, \"w\") as f:\n            json.dump(\n                self.model_dump(mode=\"json\"),\n                f,\n                indent=2,\n                default=str  # Handle datetime serialization\n            )\n\n    def is_compatible_with_package(self, package_version: str) -&gt; bool:\n        \"\"\"Check if docs are compatible with given package version\"\"\"\n        from packaging import version\n\n        # Get compatibility matrix for this doc version\n        compat = VERSION_COMPATIBILITY.get(self.doc_version)\n        if not compat:\n            return False\n\n        pkg_ver = version.parse(package_version)\n        min_ver = version.parse(compat[\"min_package\"])\n        max_ver = (\n            version.parse(compat[\"max_package\"])\n            if compat[\"max_package\"]\n            else None\n        )\n\n        if pkg_ver &lt; min_ver:\n            return False\n        if max_ver and pkg_ver &gt; max_ver:\n            return False\n\n        return True\n\n    def needs_upgrade(self, current_doc_version: str) -&gt; bool:\n        \"\"\"Check if docs need upgrading to current version\"\"\"\n        from packaging import version\n        return version.parse(self.doc_version) &lt; version.parse(current_doc_version)\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#version-compatibility-matrix_1","title":"Version Compatibility Matrix","text":"<pre><code># your_package/models.py\n\nVERSION_COMPATIBILITY = {\n    \"1\": {\n        \"min_package\": \"0.1.0\",\n        \"max_package\": \"0.8.9\",\n        \"description\": \"Original single-file CLAUDE.md format\",\n        \"breaking_changes\": [\n            \"No template system\",\n            \"No customization support\",\n            \"Manual updates only\"\n        ]\n    },\n    \"2\": {\n        \"min_package\": \"0.9.0\",\n        \"max_package\": None,  # Current version\n        \"description\": \"Template-based with Jinja2 blocks\",\n        \"features\": [\n            \"User customization via template inheritance\",\n            \"Auto-update with migration support\",\n            \"Version tracking and rollback\"\n        ],\n        \"breaking_changes\": [\n            \"File location changed to .claude/CLAUDE.md\",\n            \"Metadata file required (.claude-docs-meta.json)\",\n            \"Custom blocks must use Jinja2 syntax\"\n        ]\n    }\n}\n\nCURRENT_DOC_VERSION = \"2\"\n\ndef get_version_info(doc_version: str) -&gt; dict:\n    \"\"\"Get compatibility info for a doc version\"\"\"\n    return VERSION_COMPATIBILITY.get(doc_version, {})\n\ndef get_migration_path(from_version: str, to_version: str) -&gt; List[str]:\n    \"\"\"\n    Get list of migration scripts needed to upgrade.\n\n    Example: from_version=\"1\", to_version=\"2\"\n    Returns: [\"001_to_002\"]\n    \"\"\"\n    from packaging import version\n\n    from_ver = int(from_version)\n    to_ver = int(to_version)\n\n    if from_ver &gt;= to_ver:\n        return []\n\n    # Return migration scripts in order\n    migrations = []\n    for v in range(from_ver, to_ver):\n        migration_id = f\"{v:03d}_to_{v+1:03d}\"\n        migrations.append(migration_id)\n\n    return migrations\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#migration-script-architecture","title":"Migration Script Architecture","text":"<p>Base Migration Class:</p> <pre><code># your_package/migrations/base.py\nfrom abc import ABC, abstractmethod\nfrom pathlib import Path\nfrom typing import Optional\nimport shutil\nfrom datetime import datetime\n\nclass MigrationScript(ABC):\n    \"\"\"\n    Base class for documentation migration scripts.\n\n    Each migration handles upgrading from one doc version to the next,\n    while preserving user customizations.\n    \"\"\"\n\n    # Subclasses must define these\n    from_version: str\n    to_version: str\n    description: str\n\n    def __init__(self, project_root: Path, package_name: str):\n        self.project_root = project_root\n        self.package_name = package_name\n        self.docs_dir = project_root / f\".{package_name}\"\n\n    @abstractmethod\n    def detect_customizations(self) -&gt; dict:\n        \"\"\"\n        Detect what customizations user has made.\n\n        Returns dict with structure like:\n        {\n            \"has_customizations\": bool,\n            \"customized_blocks\": List[str],\n            \"custom_sections\": dict,\n            \"custom_config\": dict\n        }\n        \"\"\"\n        pass\n\n    @abstractmethod\n    def migrate(self, customizations: dict) -&gt; bool:\n        \"\"\"\n        Perform the migration, preserving customizations.\n\n        Returns True if successful, False otherwise.\n        \"\"\"\n        pass\n\n    def backup(self) -&gt; Path:\n        \"\"\"Create backup before migration\"\"\"\n        timestamp = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n        backup_dir = self.docs_dir / \"backups\" / timestamp\n        backup_dir.mkdir(parents=True, exist_ok=True)\n\n        # Backup all files in docs directory\n        for file in self.docs_dir.iterdir():\n            if file.is_file():\n                shutil.copy2(file, backup_dir / file.name)\n\n        print(f\"\u2705 Backup created: {backup_dir}\")\n        return backup_dir\n\n    def rollback(self, backup_path: Path) -&gt; bool:\n        \"\"\"Restore from backup\"\"\"\n        if not backup_path.exists():\n            print(f\"\u274c Backup not found: {backup_path}\")\n            return False\n\n        try:\n            # Restore all files from backup\n            for file in backup_path.iterdir():\n                if file.is_file():\n                    shutil.copy2(file, self.docs_dir / file.name)\n\n            print(f\"\u2705 Restored from backup: {backup_path}\")\n            return True\n        except Exception as e:\n            print(f\"\u274c Rollback failed: {e}\")\n            return False\n\n    def run(self) -&gt; bool:\n        \"\"\"Execute migration with backup and error handling\"\"\"\n        print(f\"\\n\ud83d\udd04 Migration: {self.description}\")\n        print(f\"   From version {self.from_version} \u2192 {self.to_version}\")\n\n        # Create backup\n        backup_path = self.backup()\n\n        try:\n            # Detect customizations\n            print(\"   Detecting customizations...\")\n            customizations = self.detect_customizations()\n\n            if customizations.get(\"has_customizations\"):\n                print(f\"   Found customizations: {customizations['customized_blocks']}\")\n            else:\n                print(\"   No customizations detected\")\n\n            # Perform migration\n            print(\"   Migrating documentation...\")\n            success = self.migrate(customizations)\n\n            if success:\n                print(\"\u2705 Migration completed successfully\")\n                return True\n            else:\n                print(\"\u274c Migration failed, rolling back...\")\n                self.rollback(backup_path)\n                return False\n\n        except Exception as e:\n            print(f\"\u274c Migration error: {e}\")\n            print(\"   Rolling back...\")\n            self.rollback(backup_path)\n            return False\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#example-migration-implementation","title":"Example Migration Implementation","text":"<pre><code># your_package/migrations/002_add_orchestration.py\nfrom .base import MigrationScript\nfrom pathlib import Path\nimport re\n\nclass Migration002AddOrchestration(MigrationScript):\n    \"\"\"\n    Migration from doc version 1 to 2.\n\n    Changes:\n    - Add orchestration section to documentation\n    - Convert single-file to template-based system\n    - Preserve user's custom configuration blocks\n    \"\"\"\n\n    from_version = \"1\"\n    to_version = \"2\"\n    description = \"Add orchestration patterns and convert to template system\"\n\n    def detect_customizations(self) -&gt; dict:\n        \"\"\"Detect customizations in version 1 docs\"\"\"\n        old_doc_path = self.docs_dir / \"CLAUDE.md\"\n\n        if not old_doc_path.exists():\n            return {\"has_customizations\": False}\n\n        content = old_doc_path.read_text()\n\n        # Look for custom sections (marked with specific headers)\n        custom_sections = {}\n\n        # Detect custom configuration\n        config_match = re.search(\n            r\"## My Configuration\\n(.*?)(?=\\n##|\\Z)\",\n            content,\n            re.DOTALL\n        )\n        if config_match:\n            custom_sections[\"configuration\"] = config_match.group(1).strip()\n\n        # Detect custom workflows\n        workflow_match = re.search(\n            r\"## My Workflows\\n(.*?)(?=\\n##|\\Z)\",\n            content,\n            re.DOTALL\n        )\n        if workflow_match:\n            custom_sections[\"workflows\"] = workflow_match.group(1).strip()\n\n        return {\n            \"has_customizations\": bool(custom_sections),\n            \"customized_blocks\": list(custom_sections.keys()),\n            \"custom_sections\": custom_sections\n        }\n\n    def migrate(self, customizations: dict) -&gt; bool:\n        \"\"\"\n        Migrate to template-based system with customizations.\n        \"\"\"\n        from ..template_engine import DocTemplateEngine\n        from ..models import DocsMetadata, CURRENT_DOC_VERSION\n        from importlib.metadata import version\n\n        # Initialize template engine\n        engine = DocTemplateEngine(self.package_name, self.project_root)\n\n        # If user has customizations, create custom template\n        if customizations.get(\"has_customizations\"):\n            self._create_custom_template(customizations[\"custom_sections\"])\n\n        # Generate new documentation\n        context = {\n            \"package_name\": self.package_name,\n            \"package_version\": version(self.package_name),\n            \"doc_version\": self.to_version,\n            \"generated_at\": datetime.now().isoformat()\n        }\n\n        new_content = engine.render(\"base/claude.md.jinja2\", context)\n\n        # Write new documentation\n        new_doc_path = self.docs_dir / \"CLAUDE.md\"\n        new_doc_path.write_text(new_content)\n\n        # Update metadata\n        metadata = DocsMetadata(\n            doc_version=self.to_version,\n            package_version=context[\"package_version\"],\n            platform=\"claude\",\n            has_customizations=customizations.get(\"has_customizations\", False),\n            customization_blocks=customizations.get(\"customized_blocks\", []),\n            last_migration=f\"{self.from_version}_to_{self.to_version}\"\n        )\n        metadata.save(self.docs_dir / \".claude-docs-meta.json\")\n\n        # Archive old documentation\n        old_doc_path = self.docs_dir / \"CLAUDE.md.v1\"\n        if (self.docs_dir / \"CLAUDE.md\").exists():\n            shutil.move(\n                self.docs_dir / \"CLAUDE.md\",\n                old_doc_path\n            )\n\n        return True\n\n    def _create_custom_template(self, custom_sections: dict) -&gt; None:\n        \"\"\"Create user template with customizations\"\"\"\n        templates_dir = self.docs_dir / \"templates\"\n        templates_dir.mkdir(exist_ok=True)\n\n        template_content = \"{% extends 'base/claude.md.jinja2' %}\\n\\n\"\n\n        # Add custom blocks\n        for block_name, content in custom_sections.items():\n            template_content += f\"{{% block {block_name} %}}\\n\"\n            template_content += f\"{content}\\n\"\n            template_content += \"{% endblock %}\\n\\n\"\n\n        template_path = templates_dir / \"claude.md.jinja2\"\n        template_path.write_text(template_content)\n\n        print(f\"   Created custom template: {template_path}\")\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#33-cli-integration","title":"3.3 CLI Integration","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#command-structure","title":"Command Structure","text":"<pre><code># your_package/cli.py\nimport click\nfrom pathlib import Path\nfrom .template_engine import DocTemplateEngine\nfrom .models import DocsMetadata, CURRENT_DOC_VERSION, get_migration_path\nfrom .migrations import get_migration, list_migrations\nfrom importlib.metadata import version\n\n@click.group()\ndef docs():\n    \"\"\"Documentation management commands\"\"\"\n    pass\n\n@docs.command()\n@click.option(\n    \"--platform\",\n    default=\"claude\",\n    type=click.Choice([\"claude\", \"gemini\", \"codex\"]),\n    help=\"Target platform\"\n)\n@click.option(\n    \"--force\",\n    is_flag=True,\n    help=\"Overwrite existing documentation\"\n)\ndef generate(platform: str, force: bool):\n    \"\"\"\n    Generate agent documentation from package templates.\n\n    Example:\n        your-package docs generate\n        your-package docs generate --platform gemini\n        your-package docs generate --force\n    \"\"\"\n    project_root = Path.cwd()\n    package_name = \"your_package\"  # Replace with your package name\n    docs_dir = project_root / f\".{package_name.replace('_', '-')}\"\n\n    # Check if docs already exist\n    doc_path = docs_dir / f\"{platform.upper()}.md\"\n    meta_path = docs_dir / \".claude-docs-meta.json\"\n\n    if doc_path.exists() and not force:\n        click.echo(f\"\u274c Documentation already exists: {doc_path}\")\n        click.echo(f\"   Use --force to overwrite or 'docs upgrade' to update\")\n        return\n\n    # Initialize template engine\n    engine = DocTemplateEngine(package_name, project_root)\n\n    # Prepare context\n    context = {\n        \"package_name\": package_name,\n        \"package_version\": version(package_name),\n        \"doc_version\": CURRENT_DOC_VERSION,\n        \"generated_at\": datetime.now().isoformat(),\n        \"platform\": platform\n    }\n\n    # Render template\n    click.echo(f\"\ud83d\udcdd Generating {platform} documentation...\")\n    content = engine.render(f\"base/{platform}.md.jinja2\", context)\n\n    # Write documentation\n    docs_dir.mkdir(parents=True, exist_ok=True)\n    doc_path.write_text(content)\n\n    # Save metadata\n    metadata = DocsMetadata(\n        doc_version=CURRENT_DOC_VERSION,\n        package_version=context[\"package_version\"],\n        platform=platform,\n        has_customizations=False\n    )\n    metadata.save(meta_path)\n\n    click.echo(f\"\u2705 Documentation generated: {doc_path}\")\n    click.echo(f\"\ud83d\udccb Metadata saved: {meta_path}\")\n\n@docs.command()\ndef version():\n    \"\"\"\n    Show current documentation version and status.\n\n    Example:\n        your-package docs version\n    \"\"\"\n    project_root = Path.cwd()\n    package_name = \"your_package\"\n    docs_dir = project_root / f\".{package_name.replace('_', '-')}\"\n    meta_path = docs_dir / \".claude-docs-meta.json\"\n\n    # Load metadata\n    metadata = DocsMetadata.load(meta_path)\n\n    if not metadata:\n        click.echo(\"\u274c No documentation found. Run 'docs generate' first.\")\n        return\n\n    # Show version info\n    click.echo(f\"\\n\ud83d\udcca Documentation Status\\n\")\n    click.echo(f\"Platform:          {metadata.platform}\")\n    click.echo(f\"Doc Version:       {metadata.doc_version}\")\n    click.echo(f\"Package Version:   {metadata.package_version}\")\n    click.echo(f\"Generated:         {metadata.generated_at}\")\n    click.echo(f\"Customizations:    {'Yes' if metadata.has_customizations else 'No'}\")\n\n    if metadata.has_customizations:\n        click.echo(f\"Custom Blocks:     {', '.join(metadata.customization_blocks)}\")\n\n    # Check if upgrade needed\n    current_pkg_version = version(package_name)\n    if metadata.package_version != current_pkg_version:\n        click.echo(f\"\\n\u26a0\ufe0f  Package upgraded: {metadata.package_version} \u2192 {current_pkg_version}\")\n        click.echo(f\"   Run 'docs upgrade' to get latest documentation\")\n\n    if metadata.needs_upgrade(CURRENT_DOC_VERSION):\n        click.echo(f\"\\n\u26a0\ufe0f  Documentation schema outdated: {metadata.doc_version} \u2192 {CURRENT_DOC_VERSION}\")\n        click.echo(f\"   Run 'docs upgrade' to migrate\")\n\n@docs.command()\n@click.option(\n    \"--auto-confirm\",\n    is_flag=True,\n    help=\"Skip confirmation prompts\"\n)\ndef upgrade(auto_confirm: bool):\n    \"\"\"\n    Upgrade documentation to latest version, preserving customizations.\n\n    Example:\n        your-package docs upgrade\n        your-package docs upgrade --auto-confirm\n    \"\"\"\n    project_root = Path.cwd()\n    package_name = \"your_package\"\n    docs_dir = project_root / f\".{package_name.replace('_', '-')}\"\n    meta_path = docs_dir / \".claude-docs-meta.json\"\n\n    # Load current metadata\n    metadata = DocsMetadata.load(meta_path)\n    if not metadata:\n        click.echo(\"\u274c No documentation found. Run 'docs generate' first.\")\n        return\n\n    # Check if upgrade needed\n    if not metadata.needs_upgrade(CURRENT_DOC_VERSION):\n        click.echo(\"\u2705 Documentation is already up to date!\")\n        return\n\n    # Get migration path\n    migrations = get_migration_path(metadata.doc_version, CURRENT_DOC_VERSION)\n\n    if not migrations:\n        click.echo(\"\u274c No migration path available\")\n        return\n\n    # Show upgrade plan\n    click.echo(f\"\\n\ud83d\udccb Upgrade Plan\\n\")\n    click.echo(f\"Current version:  {metadata.doc_version}\")\n    click.echo(f\"Target version:   {CURRENT_DOC_VERSION}\")\n    click.echo(f\"Migrations:       {' \u2192 '.join(migrations)}\")\n\n    if metadata.has_customizations:\n        click.echo(f\"\\n\u26a0\ufe0f  You have customizations that will be preserved:\")\n        for block in metadata.customization_blocks:\n            click.echo(f\"   - {block}\")\n\n    # Confirm\n    if not auto_confirm:\n        if not click.confirm(\"\\nProceed with upgrade?\"):\n            click.echo(\"\u274c Upgrade cancelled\")\n            return\n\n    # Run migrations\n    for migration_id in migrations:\n        migration_class = get_migration(migration_id)\n        if not migration_class:\n            click.echo(f\"\u274c Migration not found: {migration_id}\")\n            return\n\n        migration = migration_class(project_root, package_name)\n        success = migration.run()\n\n        if not success:\n            click.echo(f\"\u274c Migration failed: {migration_id}\")\n            click.echo(f\"   Documentation restored from backup\")\n            return\n\n    click.echo(f\"\\n\u2705 Documentation upgraded successfully!\")\n    click.echo(f\"   New version: {CURRENT_DOC_VERSION}\")\n\n@docs.command()\n@click.option(\n    \"--backup-id\",\n    help=\"Specific backup to rollback to (YYYYMMDD_HHMMSS)\"\n)\ndef rollback(backup_id: str):\n    \"\"\"\n    Rollback documentation to a previous backup.\n\n    Example:\n        your-package docs rollback --backup-id 20250102_103000\n        your-package docs rollback  # Shows available backups\n    \"\"\"\n    project_root = Path.cwd()\n    package_name = \"your_package\"\n    docs_dir = project_root / f\".{package_name.replace('_', '-')}\"\n    backups_dir = docs_dir / \"backups\"\n\n    if not backups_dir.exists():\n        click.echo(\"\u274c No backups found\")\n        return\n\n    # List available backups\n    backups = sorted(backups_dir.iterdir(), reverse=True)\n\n    if not backup_id:\n        click.echo(\"\\n\ud83d\udce6 Available Backups:\\n\")\n        for backup in backups:\n            click.echo(f\"   {backup.name}\")\n        click.echo(f\"\\nUse: docs rollback --backup-id &lt;id&gt;\")\n        return\n\n    # Rollback to specific backup\n    backup_path = backups_dir / backup_id\n    if not backup_path.exists():\n        click.echo(f\"\u274c Backup not found: {backup_id}\")\n        return\n\n    click.echo(f\"\ud83d\udd04 Rolling back to: {backup_id}\")\n\n    # Restore files\n    for file in backup_path.iterdir():\n        if file.is_file():\n            shutil.copy2(file, docs_dir / file.name)\n\n    click.echo(f\"\u2705 Documentation restored from backup\")\n\n@docs.command()\n@click.option(\n    \"--verbose\",\n    is_flag=True,\n    help=\"Show detailed diff\"\n)\ndef diff(verbose: bool):\n    \"\"\"\n    Show differences between current docs and package template.\n\n    Example:\n        your-package docs diff\n        your-package docs diff --verbose\n    \"\"\"\n    # Implementation similar to HtmlGraph's diff_memory_files\n    # Compare user's generated docs with fresh template render\n    # Highlight customizations\n    pass\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#34-hook-integration-optional","title":"3.4 Hook Integration (Optional)","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#hook-selection","title":"Hook Selection","text":"<p>Best hooks for documentation injection:</p> <ol> <li>SessionStart - Inject docs once at session start</li> <li>Pros: Minimal context pollution, always available</li> <li> <p>Cons: Users may forget docs exist, no refresh on updates</p> </li> <li> <p>PreToolUse - Inject docs before specific tools</p> </li> <li>Pros: Context-aware, docs when needed</li> <li> <p>Cons: Repetitive injection, context budget issues</p> </li> <li> <p>UserPromptSubmit - Inject on keywords</p> </li> <li>Pros: On-demand, minimal overhead</li> <li>Cons: Requires user to remember keywords</li> </ol> <p>Recommended: <code>SessionStart</code> with progressive disclosure</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#context-injection-strategy","title":"Context Injection Strategy","text":"<pre><code># .claude-plugin/hooks/session-start.py\nimport json\nimport sys\nfrom pathlib import Path\n\ndef main():\n    # Load hook input\n    hook_input = json.loads(sys.stdin.read())\n\n    # Find project root\n    cwd = Path(hook_input.get(\"cwd\", Path.cwd()))\n    docs_dir = cwd / \".your-package\"\n    doc_path = docs_dir / \"CLAUDE.md\"\n    meta_path = docs_dir / \".claude-docs-meta.json\"\n\n    # Check if docs exist\n    if not doc_path.exists():\n        # No docs, no injection\n        print(json.dumps({\"prompt\": \"\"}))\n        return\n\n    # Load metadata for context budget management\n    metadata = None\n    if meta_path.exists():\n        with open(meta_path) as f:\n            metadata = json.load(f)\n\n    # Read documentation\n    doc_content = doc_path.read_text()\n\n    # Progressive disclosure: Inject summary + link to full docs\n    summary = extract_summary(doc_content)\n\n    prompt = f\"\"\"\n# \ud83d\udcda YourPackage Documentation Available\n\n{summary}\n\n**Full documentation:** `.your-package/CLAUDE.md`\n\n**Quick commands:**\n- `your-package docs version` - Check doc status\n- `your-package docs upgrade` - Get latest docs\n- `your-package --help` - Show CLI help\n\n\ud83d\udca1 Use the full documentation for detailed API reference and examples.\n\"\"\"\n\n    # Add version warning if outdated\n    if metadata and needs_upgrade(metadata):\n        prompt += f\"\"\"\n\u26a0\ufe0f  **Documentation may be outdated!**\nCurrent: v{metadata['doc_version']} (package v{metadata['package_version']})\nRun: `your-package docs upgrade`\n\"\"\"\n\n    # Return injected prompt\n    print(json.dumps({\"prompt\": prompt}))\n\ndef extract_summary(content: str) -&gt; str:\n    \"\"\"Extract Quick Start section as summary\"\"\"\n    # Parse Markdown and extract ## Quick Start section\n    # Return condensed version\n    lines = content.split(\"\\n\")\n    in_quickstart = False\n    summary_lines = []\n\n    for line in lines:\n        if line.startswith(\"## Quick Start\"):\n            in_quickstart = True\n            continue\n        if in_quickstart and line.startswith(\"##\"):\n            break\n        if in_quickstart:\n            summary_lines.append(line)\n\n    return \"\\n\".join(summary_lines[:15])  # First 15 lines only\n\ndef needs_upgrade(metadata: dict) -&gt; bool:\n    \"\"\"Check if docs need upgrade\"\"\"\n    from packaging import version\n    CURRENT_DOC_VERSION = \"2\"  # Replace with actual\n\n    doc_ver = metadata.get(\"doc_version\", \"0\")\n    return version.parse(doc_ver) &lt; version.parse(CURRENT_DOC_VERSION)\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#token-budget-management","title":"Token Budget Management","text":"<p>Strategy: Progressive disclosure with sections</p> <pre><code># Documentation (Condensed for Context Budget)\n\n## Quick Reference\n[Essential API calls, always shown]\n\n## Common Patterns\n&lt;details&gt;\n&lt;summary&gt;Click to expand&lt;/summary&gt;\n[Frequently used patterns]\n&lt;/details&gt;\n\n## Advanced Usage\n&lt;details&gt;\n&lt;summary&gt;Click to expand&lt;/summary&gt;\n[Advanced topics]\n&lt;/details&gt;\n\n## Full Documentation\nSee `.your-package/CLAUDE.md` for complete reference.\n</code></pre> <p>Or use template blocks:</p> <pre><code>{# Condensed version for hook injection #}\n{% block hook_summary %}\n## Quick Reference\n- Command 1: Description\n- Command 2: Description\n- Command 3: Description\n\nFull docs: `.your-package/CLAUDE.md`\n{% endblock %}\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#4-best-practices","title":"4. Best Practices","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#template-design","title":"Template Design","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#block-naming-conventions","title":"Block Naming Conventions","text":"<p>Use semantic names, not structural:</p> <p>\u2705 Good: <pre><code>{% block quickstart %}\n{% block configuration %}\n{% block api_reference %}\n{% block troubleshooting %}\n{% block orchestration_patterns %}\n</code></pre></p> <p>\u274c Bad: <pre><code>{% block section_1 %}\n{% block part_a %}\n{% block content %}\n{% block div_2 %}\n</code></pre></p> <p>Naming guidelines: - Use snake_case for consistency - Be specific (not generic) - Indicate content type (e.g., <code>_examples</code>, <code>_reference</code>) - Group related blocks (e.g., <code>advanced_orchestration</code>, <code>advanced_analytics</code>)</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#section-organization","title":"Section Organization","text":"<p>Recommended structure:</p> <ol> <li>Header - Package name, version, generated timestamp</li> <li>Quick Start - Get users productive fast</li> <li>Configuration - Setup and customization</li> <li>Core Concepts - Fundamental understanding</li> <li>API Reference - Detailed reference</li> <li>Advanced Usage - Power user features</li> <li>Troubleshooting - Common issues</li> <li>Customization Guide - How to override blocks</li> <li>Footer - Version info, links</li> </ol> <p>Template organization: <pre><code>{# Header - Always visible #}\n{% block header %}{% endblock %}\n\n{# Critical path - Always visible #}\n{% block quickstart %}{% endblock %}\n{% block configuration %}{% endblock %}\n\n{# Core content - Collapsible or always visible #}\n{% block core_concepts %}{% endblock %}\n{% block api_reference %}{% endblock %}\n\n{# Advanced - User can exclude to save tokens #}\n{% block advanced %}\n  {% block orchestration %}{% endblock %}\n  {% block analytics %}{% endblock %}\n{% endblock %}\n\n{# Support - User can exclude #}\n{% block troubleshooting %}{% endblock %}\n{% block examples %}{% endblock %}\n\n{# Footer - Always visible #}\n{% block footer %}{% endblock %}\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#reusable-template-patterns","title":"Reusable Template Patterns","text":"<p>Include pattern for shared content: <pre><code>{# templates/shared/api-common.md.jinja2 #}\n## Common API Patterns\n\n### Error Handling\nAll API methods follow this pattern:\n```python\ntry:\n    result = sdk.method()\nexcept PackageError as e:\n    print(f\"Error: {e}\")\n</code></pre></p> <p>{# Use in multiple templates #} {% include \"shared/api-common.md.jinja2\" %} <pre><code>**Macro pattern for repeated structures:**\n```jinja2\n{# Define macro #}\n{% macro code_example(title, code, language=\"python\") %}\n### {{ title }}\n```{{ language }}\n{{ code }}\n</code></pre></p> <p>{# Use macro #} {{ code_example(\"Create Feature\", \"sdk.features.create('title')\") }} {{ code_example(\"Run Analytics\", \"sdk.analytics.recommend_next_work()\") }} <pre><code>---\n\n### Version Management\n\n#### When to Bump Doc Schema Version\n\n**Bump doc_version when:**\n- \u2705 Template structure changes (blocks added/removed/renamed)\n- \u2705 Required context changes (new required sections)\n- \u2705 Breaking changes in customization API\n- \u2705 File location changes\n- \u2705 Metadata format changes\n\n**Don't bump doc_version when:**\n- \u274c Content updates (typo fixes, clarifications)\n- \u274c New examples added\n- \u274c Package version bumps (use package_version for that)\n- \u274c Documentation improvements (same structure)\n\n**Example decision tree:**\n</code></pre> Did template block structure change? YES \u2192 Bump doc_version Did metadata schema change? YES \u2192 Bump doc_version Did file paths change? YES \u2192 Bump doc_version Did you just improve docs content? NO \u2192 Don't bump <pre><code>#### N-1 Compatibility Strategy\n\n**Goal:** Old docs work with new package versions\n\n```python\n# Version 1 docs can work with package 0.9.0 - 0.9.9\n# Version 2 docs work with package 0.10.0+\n\n# User on doc v1 installs package 0.9.5 \u2192 Works fine\n# User on doc v1 installs package 0.10.0 \u2192 Warning + upgrade prompt\n# User on doc v2 installs package 0.9.0 \u2192 Error (unsupported)\n</code></pre></p> <p>Implementation: <pre><code>def check_compatibility(metadata: DocsMetadata, package_version: str):\n    \"\"\"Check if docs are compatible with package\"\"\"\n    compat = VERSION_COMPATIBILITY[metadata.doc_version]\n\n    if not compat:\n        return False, \"Unknown doc version\"\n\n    pkg_ver = version.parse(package_version)\n    min_ver = version.parse(compat[\"min_package\"])\n    max_ver = version.parse(compat[\"max_package\"]) if compat[\"max_package\"] else None\n\n    if pkg_ver &lt; min_ver:\n        return False, f\"Package too old (need &gt;= {min_ver})\"\n\n    if max_ver and pkg_ver &gt; max_ver:\n        return False, f\"Docs outdated (upgrade for &gt;= {max_ver})\"\n\n    return True, \"Compatible\"\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#breaking-change-communication","title":"Breaking Change Communication","text":"<p>When introducing breaking changes:</p> <ol> <li> <p>Announce in CHANGELOG: <pre><code>## [0.10.0] - 2025-01-15\n\n### BREAKING CHANGES\n- Documentation schema upgraded to v2\n- File moved: `CLAUDE.md` \u2192 `.your-package/CLAUDE.md`\n- Custom configurations now use Jinja2 blocks\n\n**Migration:** Run `your-package docs upgrade`\n</code></pre></p> </li> <li> <p>Add upgrade prompt in CLI: <pre><code>if metadata.doc_version &lt; CURRENT_DOC_VERSION:\n    click.echo(\"\\n\u26a0\ufe0f  BREAKING CHANGE\")\n    click.echo(f\"   Documentation schema updated: v{metadata.doc_version} \u2192 v{CURRENT_DOC_VERSION}\")\n    click.echo(\"   Your customizations will be preserved during upgrade.\")\n    click.echo(f\"\\n   Run: your-package docs upgrade\")\n</code></pre></p> </li> <li> <p>Provide clear migration path: <pre><code># Migration script with clear messaging\nclass Migration001To002(MigrationScript):\n    description = \"\"\"\n    Migrate to template-based documentation system.\n\n    What changes:\n    - File moves to .your-package/CLAUDE.md\n    - Custom sections become Jinja2 blocks\n    - Version tracking with .claude-docs-meta.json\n\n    What's preserved:\n    - All your custom content\n    - Custom configuration\n    - Custom workflows\n    \"\"\"\n</code></pre></p> </li> </ol>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#user-experience","title":"User Experience","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#clear-upgrade-prompts","title":"Clear Upgrade Prompts","text":"<p>Example upgrade flow:</p> <pre><code>$ your-package docs version\n\n\ud83d\udcca Documentation Status\n\nPlatform:          claude\nDoc Version:       1\nPackage Version:   0.9.0\nGenerated:         2024-12-15T10:30:00Z\n\n\u26a0\ufe0f  Package upgraded: 0.9.0 \u2192 0.10.2\n   Run 'docs upgrade' to get latest documentation\n\n\u26a0\ufe0f  Documentation schema outdated: 1 \u2192 2\n   Run 'docs upgrade' to migrate\n\n$ your-package docs upgrade\n\n\ud83d\udccb Upgrade Plan\n\nCurrent version:  1\nTarget version:   2\nMigrations:       001_to_002\n\n\u26a0\ufe0f  You have customizations that will be preserved:\n   - configuration\n   - workflows\n\nProceed with upgrade? [y/N]: y\n\n\ud83d\udd04 Migration: Migrate to template-based system\n   From version 1 \u2192 2\n   Detecting customizations...\n   Found customizations: ['configuration', 'workflows']\n   Migrating documentation...\n\u2705 Migration completed successfully\n\n\u2705 Documentation upgraded successfully!\n   New version: 2\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#informative-error-messages","title":"Informative Error Messages","text":"<p>Good error messages:</p> <pre><code># \u274c Bad\nraise Exception(\"Migration failed\")\n\n# \u2705 Good\nraise MigrationError(\n    f\"Migration {migration_id} failed during customization detection.\\n\\n\"\n    f\"Possible causes:\\n\"\n    f\"1. Documentation file corrupted\\n\"\n    f\"2. Custom template syntax error\\n\"\n    f\"3. Incompatible customization format\\n\\n\"\n    f\"Your documentation has been restored from backup:\\n\"\n    f\"  {backup_path}\\n\\n\"\n    f\"For help, see: https://docs.example.com/migration-troubleshooting\"\n)\n</code></pre> <p>Actionable errors: <pre><code>if not doc_path.exists():\n    click.echo(\"\u274c Documentation not found\")\n    click.echo(\"   Expected: .your-package/CLAUDE.md\")\n    click.echo(\"   Run: your-package docs generate\")\n    return\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#safe-defaults","title":"Safe Defaults","text":"<p>Principle: Prefer safety over convenience</p> <pre><code># \u2705 Safe: Require explicit confirmation for destructive operations\n@click.option(\"--force\", is_flag=True, help=\"Overwrite existing docs\")\ndef generate(force: bool):\n    if doc_exists() and not force:\n        click.echo(\"Docs exist. Use --force to overwrite\")\n        return\n\n# \u2705 Safe: Create backups automatically\ndef migrate():\n    backup_path = self.backup()  # Always backup before migration\n    try:\n        self.perform_migration()\n    except Exception:\n        self.rollback(backup_path)  # Auto-rollback on failure\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#rollback-confidence","title":"Rollback Confidence","text":"<p>Make rollback trustworthy:</p> <ol> <li> <p>Automatic backups: <pre><code>def backup(self) -&gt; Path:\n    \"\"\"Create timestamped backup automatically\"\"\"\n    timestamp = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n    backup_dir = self.docs_dir / \"backups\" / timestamp\n    # ... copy files ...\n    return backup_dir\n</code></pre></p> </li> <li> <p>List available backups: <pre><code>$ your-package docs rollback\n\n\ud83d\udce6 Available Backups:\n   20250102_103000\n   20250101_150000\n   20241230_093000\n\nUse: docs rollback --backup-id &lt;id&gt;\n</code></pre></p> </li> <li> <p>Verify rollback: <pre><code>def rollback(self, backup_path: Path) -&gt; bool:\n    # Restore files\n    self._restore_from_backup(backup_path)\n\n    # Verify restoration\n    if self._verify_docs():\n        click.echo(\"\u2705 Documentation restored successfully\")\n        return True\n    else:\n        click.echo(\"\u274c Rollback verification failed\")\n        return False\n</code></pre></p> </li> </ol>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#testing-strategy","title":"Testing Strategy","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#integration-test-coverage","title":"Integration Test Coverage","text":"<p>Essential test scenarios:</p> <pre><code># tests/test_docs_system.py\nimport pytest\nfrom pathlib import Path\nfrom your_package.template_engine import DocTemplateEngine\nfrom your_package.models import DocsMetadata\nfrom your_package.migrations import Migration001To002\n\n@pytest.fixture\ndef project_dir(tmp_path):\n    \"\"\"Create temporary project directory\"\"\"\n    return tmp_path / \"test_project\"\n\ndef test_generate_fresh_docs(project_dir):\n    \"\"\"Test generating docs in empty project\"\"\"\n    engine = DocTemplateEngine(\"test_package\", project_dir)\n\n    context = {\n        \"package_name\": \"test_package\",\n        \"package_version\": \"0.1.0\",\n        \"doc_version\": \"1\"\n    }\n\n    output = engine.render(\"base/claude.md.jinja2\", context)\n\n    assert \"# test_package\" in output\n    assert \"0.1.0\" in output\n\ndef test_user_customization_preserved(project_dir):\n    \"\"\"Test that user customizations survive regeneration\"\"\"\n    # Setup: Create custom template\n    templates_dir = project_dir / \".test-package\" / \"templates\"\n    templates_dir.mkdir(parents=True)\n\n    custom_template = templates_dir / \"claude.md.jinja2\"\n    custom_template.write_text(\"\"\"\n{% extends \"base/claude.md.jinja2\" %}\n\n{% block configuration %}\n## My Custom Configuration\nCustom content here\n{% endblock %}\n    \"\"\")\n\n    # Generate docs with customization\n    engine = DocTemplateEngine(\"test_package\", project_dir)\n    output = engine.render(\"base/claude.md.jinja2\", {})\n\n    assert \"My Custom Configuration\" in output\n\ndef test_migration_preserves_customizations(project_dir):\n    \"\"\"Test migration preserves user content\"\"\"\n    # Setup: Create v1 docs with custom content\n    docs_dir = project_dir / \".test-package\"\n    docs_dir.mkdir(parents=True)\n\n    v1_doc = docs_dir / \"CLAUDE.md\"\n    v1_doc.write_text(\"\"\"\n# Test Package\n\n## My Configuration\nCustom config here\n\n## My Workflows\nCustom workflows here\n    \"\"\")\n\n    # Run migration\n    migration = Migration001To002(project_dir, \"test_package\")\n    customizations = migration.detect_customizations()\n\n    assert customizations[\"has_customizations\"] is True\n    assert \"configuration\" in customizations[\"customized_blocks\"]\n\n    # Perform migration\n    success = migration.migrate(customizations)\n    assert success is True\n\n    # Verify custom content preserved\n    v2_template = docs_dir / \"templates\" / \"claude.md.jinja2\"\n    assert v2_template.exists()\n    content = v2_template.read_text()\n    assert \"Custom config here\" in content\n\ndef test_version_compatibility_check(project_dir):\n    \"\"\"Test version compatibility detection\"\"\"\n    metadata = DocsMetadata(\n        doc_version=\"1\",\n        package_version=\"0.9.0\",\n        platform=\"claude\"\n    )\n\n    # Compatible package version\n    assert metadata.is_compatible_with_package(\"0.9.5\") is True\n\n    # Incompatible (too new)\n    assert metadata.is_compatible_with_package(\"0.11.0\") is False\n\ndef test_backup_and_rollback(project_dir):\n    \"\"\"Test backup creation and rollback\"\"\"\n    docs_dir = project_dir / \".test-package\"\n    docs_dir.mkdir(parents=True)\n\n    # Create original doc\n    doc_path = docs_dir / \"CLAUDE.md\"\n    doc_path.write_text(\"Original content\")\n\n    # Create migration and backup\n    migration = Migration001To002(project_dir, \"test_package\")\n    backup_path = migration.backup()\n\n    assert backup_path.exists()\n    assert (backup_path / \"CLAUDE.md\").exists()\n\n    # Modify original\n    doc_path.write_text(\"Modified content\")\n\n    # Rollback\n    success = migration.rollback(backup_path)\n    assert success is True\n    assert doc_path.read_text() == \"Original content\"\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#customization-preservation-tests","title":"Customization Preservation Tests","text":"<p>Test matrix:</p> <pre><code>@pytest.mark.parametrize(\"customization_type,expected_preserved\", [\n    (\"configuration\", True),\n    (\"workflows\", True),\n    (\"quickstart\", True),\n    (\"examples\", True),\n    (\"unknown_block\", True),  # Should preserve even unknown blocks\n])\ndef test_preserve_customization_types(\n    project_dir,\n    customization_type,\n    expected_preserved\n):\n    \"\"\"Test different customization types are preserved\"\"\"\n    # Setup custom block\n    # Run migration\n    # Verify preservation\n    pass\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#edge-case-handling","title":"Edge Case Handling","text":"<p>Critical edge cases:</p> <pre><code>def test_migration_with_corrupted_docs(project_dir):\n    \"\"\"Test migration handles corrupted documentation\"\"\"\n    docs_dir = project_dir / \".test-package\"\n    docs_dir.mkdir(parents=True)\n\n    # Create corrupted doc (invalid UTF-8, etc.)\n    doc_path = docs_dir / \"CLAUDE.md\"\n    doc_path.write_bytes(b'\\x80\\x81\\x82')  # Invalid UTF-8\n\n    migration = Migration001To002(project_dir, \"test_package\")\n\n    # Should handle gracefully\n    with pytest.raises(MigrationError) as exc_info:\n        migration.detect_customizations()\n\n    assert \"corrupted\" in str(exc_info.value).lower()\n\ndef test_migration_with_missing_metadata(project_dir):\n    \"\"\"Test migration when metadata is missing\"\"\"\n    docs_dir = project_dir / \".test-package\"\n    docs_dir.mkdir(parents=True)\n\n    # Doc exists but no metadata\n    doc_path = docs_dir / \"CLAUDE.md\"\n    doc_path.write_text(\"# Documentation\")\n\n    # Should create default metadata\n    metadata = DocsMetadata.load(docs_dir / \".claude-docs-meta.json\")\n    assert metadata is None  # Missing\n\n    # Migration should handle this\n    migration = Migration001To002(project_dir, \"test_package\")\n    success = migration.run()\n    assert success is True\n\ndef test_concurrent_upgrade_attempts(project_dir):\n    \"\"\"Test multiple upgrade processes don't conflict\"\"\"\n    # Use file locking or similar to prevent concurrent upgrades\n    # This is advanced - may need process-level locks\n    pass\n\ndef test_upgrade_with_partial_customizations(project_dir):\n    \"\"\"Test upgrade when user only customized some blocks\"\"\"\n    # User customized 2 of 5 blocks\n    # Verify:\n    # - Customized blocks preserved\n    # - Non-customized blocks updated\n    pass\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#5-reference-implementation","title":"5. Reference Implementation","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#doctemplateengine-simplified","title":"DocTemplateEngine (Simplified)","text":"<pre><code># your_package/template_engine.py\nfrom jinja2 import Environment, FileSystemLoader, ChoiceLoader, TemplateNotFound\nfrom pathlib import Path\nfrom typing import Optional\nimport re\n\nclass DocTemplateEngine:\n    \"\"\"\n    Template engine for packageable auto-updating documentation.\n\n    Manages Jinja2 templates with user override support via ChoiceLoader.\n    User templates (in project) take priority over package templates.\n    \"\"\"\n\n    def __init__(self, package_name: str, project_root: Path):\n        self.package_name = package_name\n        self.project_root = project_root\n\n        # Package templates (bundled with distribution)\n        package_templates = Path(__file__).parent / \"templates\"\n\n        # User templates (in project .package-name/templates/)\n        user_templates = project_root / f\".{package_name}\" / \"templates\"\n        user_templates.mkdir(parents=True, exist_ok=True)\n\n        # ChoiceLoader: User templates first, then package templates\n        loader = ChoiceLoader([\n            FileSystemLoader(str(user_templates)),\n            FileSystemLoader(str(package_templates))\n        ])\n\n        self.env = Environment(\n            loader=loader,\n            autoescape=False,  # Markdown doesn't need HTML escaping\n            trim_blocks=True,\n            lstrip_blocks=True,\n            keep_trailing_newline=True\n        )\n\n        # Add custom filters\n        self.env.filters[\"snake_to_title\"] = lambda s: s.replace(\"_\", \" \").title()\n\n    def render(self, template_name: str, context: dict) -&gt; str:\n        \"\"\"\n        Render template with context.\n\n        User template takes priority if it exists.\n        Falls back to package template.\n        \"\"\"\n        try:\n            template = self.env.get_template(template_name)\n            return template.render(**context)\n        except TemplateNotFound:\n            raise TemplateNotFound(\n                f\"Template not found: {template_name}\\n\"\n                f\"Searched in:\\n\"\n                f\"  - {self.project_root / f'.{self.package_name}' / 'templates'}\\n\"\n                f\"  - {Path(__file__).parent / 'templates'}\"\n            )\n\n    def has_user_template(self, template_name: str) -&gt; bool:\n        \"\"\"Check if user has custom template\"\"\"\n        user_path = (\n            self.project_root /\n            f\".{self.package_name}\" /\n            \"templates\" /\n            template_name\n        )\n        return user_path.exists()\n\n    def detect_customized_blocks(self, template_name: str) -&gt; list[str]:\n        \"\"\"\n        Detect which template blocks user has customized.\n\n        Returns list of block names found in user template.\n        \"\"\"\n        if not self.has_user_template(template_name):\n            return []\n\n        user_path = (\n            self.project_root /\n            f\".{self.package_name}\" /\n            \"templates\" /\n            template_name\n        )\n\n        content = user_path.read_text()\n\n        # Parse Jinja2 blocks using regex\n        block_pattern = r'{%\\s*block\\s+(\\w+)\\s*%}'\n        blocks = re.findall(block_pattern, content)\n\n        return blocks\n\n    def list_available_templates(self) -&gt; dict[str, list[str]]:\n        \"\"\"\n        List all available templates.\n\n        Returns dict with:\n        {\n            \"package\": [\"base/claude.md.jinja2\", ...],\n            \"user\": [\"claude.md.jinja2\", ...]\n        }\n        \"\"\"\n        package_templates_dir = Path(__file__).parent / \"templates\"\n        user_templates_dir = self.project_root / f\".{self.package_name}\" / \"templates\"\n\n        def list_templates(base_dir: Path) -&gt; list[str]:\n            if not base_dir.exists():\n                return []\n\n            templates = []\n            for path in base_dir.rglob(\"*.jinja2\"):\n                rel_path = path.relative_to(base_dir)\n                templates.append(str(rel_path))\n            return sorted(templates)\n\n        return {\n            \"package\": list_templates(package_templates_dir),\n            \"user\": list_templates(user_templates_dir)\n        }\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#docsmetadata-model-complete","title":"DocsMetadata Model (Complete)","text":"<pre><code># your_package/models.py\nfrom pydantic import BaseModel, Field, field_validator\nfrom datetime import datetime\nfrom typing import Optional, List\nfrom pathlib import Path\nimport json\nfrom packaging import version\n\nclass DocsMetadata(BaseModel):\n    \"\"\"\n    Metadata for packageable auto-updating documentation.\n\n    Tracks version, customizations, and migration state.\n    Stored in .package-name/.claude-docs-meta.json\n    \"\"\"\n\n    doc_version: str = Field(\n        description=\"Documentation schema version (e.g., '2')\"\n    )\n\n    package_version: str = Field(\n        description=\"Package version when generated (e.g., '0.9.5')\"\n    )\n\n    generated_at: datetime = Field(\n        default_factory=datetime.now,\n        description=\"Timestamp of generation\"\n    )\n\n    platform: str = Field(\n        default=\"claude\",\n        description=\"Target platform (claude, gemini, codex, etc.)\"\n    )\n\n    has_customizations: bool = Field(\n        default=False,\n        description=\"Whether user has custom template overrides\"\n    )\n\n    customization_blocks: List[str] = Field(\n        default_factory=list,\n        description=\"List of template blocks user has customized\"\n    )\n\n    last_migration: Optional[str] = Field(\n        default=None,\n        description=\"ID of last migration applied\"\n    )\n\n    backup_path: Optional[str] = Field(\n        default=None,\n        description=\"Path to backup created before last update\"\n    )\n\n    @field_validator(\"doc_version\", \"package_version\")\n    def validate_version_format(cls, v):\n        \"\"\"Ensure versions are valid semver or integer strings\"\"\"\n        try:\n            # Try parsing as semver\n            version.parse(v)\n            return v\n        except:\n            # Try parsing as integer\n            int(v)\n            return v\n\n    @classmethod\n    def load(cls, path: Path) -&gt; Optional[\"DocsMetadata\"]:\n        \"\"\"Load metadata from .claude-docs-meta.json\"\"\"\n        if not path.exists():\n            return None\n\n        try:\n            with open(path) as f:\n                data = json.load(f)\n            return cls(**data)\n        except Exception as e:\n            raise MetadataError(f\"Failed to load metadata from {path}: {e}\")\n\n    def save(self, path: Path) -&gt; None:\n        \"\"\"Save metadata to .claude-docs-meta.json\"\"\"\n        path.parent.mkdir(parents=True, exist_ok=True)\n\n        with open(path, \"w\") as f:\n            json.dump(\n                self.model_dump(mode=\"json\"),\n                f,\n                indent=2,\n                default=str  # Handle datetime serialization\n            )\n\n    def is_compatible_with_package(self, package_version: str) -&gt; bool:\n        \"\"\"Check if docs are compatible with given package version\"\"\"\n        compat = VERSION_COMPATIBILITY.get(self.doc_version)\n        if not compat:\n            return False\n\n        pkg_ver = version.parse(package_version)\n        min_ver = version.parse(compat[\"min_package\"])\n        max_ver = (\n            version.parse(compat[\"max_package\"])\n            if compat[\"max_package\"]\n            else None\n        )\n\n        if pkg_ver &lt; min_ver:\n            return False\n        if max_ver and pkg_ver &gt; max_ver:\n            return False\n\n        return True\n\n    def needs_upgrade(self, current_doc_version: str) -&gt; bool:\n        \"\"\"Check if docs need upgrading to current version\"\"\"\n        return version.parse(self.doc_version) &lt; version.parse(current_doc_version)\n\nclass MetadataError(Exception):\n    \"\"\"Raised when metadata operations fail\"\"\"\n    pass\n\n# Version compatibility matrix\nVERSION_COMPATIBILITY = {\n    \"1\": {\n        \"min_package\": \"0.1.0\",\n        \"max_package\": \"0.8.9\",\n        \"description\": \"Original single-file format\"\n    },\n    \"2\": {\n        \"min_package\": \"0.9.0\",\n        \"max_package\": None,\n        \"description\": \"Template-based with blocks\"\n    }\n}\n\nCURRENT_DOC_VERSION = \"2\"\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#migrationscript-base-class-complete","title":"MigrationScript Base Class (Complete)","text":"<pre><code># your_package/migrations/base.py\nfrom abc import ABC, abstractmethod\nfrom pathlib import Path\nfrom typing import Dict, Optional\nimport shutil\nfrom datetime import datetime\n\nclass MigrationScript(ABC):\n    \"\"\"\n    Base class for documentation migration scripts.\n\n    Subclasses implement:\n    - detect_customizations(): Find user customizations\n    - migrate(): Perform migration preserving customizations\n    \"\"\"\n\n    # Subclasses MUST define these\n    from_version: str\n    to_version: str\n    description: str\n\n    def __init__(self, project_root: Path, package_name: str):\n        self.project_root = project_root\n        self.package_name = package_name\n        self.docs_dir = project_root / f\".{package_name}\"\n\n    @abstractmethod\n    def detect_customizations(self) -&gt; Dict:\n        \"\"\"\n        Detect user customizations.\n\n        Returns:\n            {\n                \"has_customizations\": bool,\n                \"customized_blocks\": List[str],\n                \"custom_content\": Dict[str, str]\n            }\n        \"\"\"\n        pass\n\n    @abstractmethod\n    def migrate(self, customizations: Dict) -&gt; bool:\n        \"\"\"\n        Perform migration, preserving customizations.\n\n        Returns:\n            True if successful, False otherwise\n        \"\"\"\n        pass\n\n    def backup(self) -&gt; Path:\n        \"\"\"Create timestamped backup before migration\"\"\"\n        timestamp = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n        backup_dir = self.docs_dir / \"backups\" / timestamp\n        backup_dir.mkdir(parents=True, exist_ok=True)\n\n        # Backup all files\n        for file in self.docs_dir.iterdir():\n            if file.is_file():\n                shutil.copy2(file, backup_dir / file.name)\n\n        print(f\"\u2705 Backup created: {backup_dir}\")\n        return backup_dir\n\n    def rollback(self, backup_path: Path) -&gt; bool:\n        \"\"\"Restore from backup\"\"\"\n        if not backup_path.exists():\n            print(f\"\u274c Backup not found: {backup_path}\")\n            return False\n\n        try:\n            for file in backup_path.iterdir():\n                if file.is_file():\n                    shutil.copy2(file, self.docs_dir / file.name)\n\n            print(f\"\u2705 Restored from backup: {backup_path}\")\n            return True\n        except Exception as e:\n            print(f\"\u274c Rollback failed: {e}\")\n            return False\n\n    def run(self) -&gt; bool:\n        \"\"\"Execute migration with backup and error handling\"\"\"\n        print(f\"\\n\ud83d\udd04 Migration: {self.description}\")\n        print(f\"   {self.from_version} \u2192 {self.to_version}\")\n\n        backup_path = self.backup()\n\n        try:\n            customizations = self.detect_customizations()\n\n            if customizations.get(\"has_customizations\"):\n                blocks = customizations.get(\"customized_blocks\", [])\n                print(f\"   Found customizations: {blocks}\")\n\n            success = self.migrate(customizations)\n\n            if success:\n                print(\"\u2705 Migration successful\")\n                return True\n            else:\n                print(\"\u274c Migration failed\")\n                self.rollback(backup_path)\n                return False\n\n        except Exception as e:\n            print(f\"\u274c Migration error: {e}\")\n            self.rollback(backup_path)\n            return False\n\nclass MigrationError(Exception):\n    \"\"\"Raised when migration fails\"\"\"\n    pass\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#6-common-pitfalls-and-solutions","title":"6. Common Pitfalls and Solutions","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#user-templates-not-loading","title":"User Templates Not Loading","text":"<p>Problem: User customizations not appearing in generated docs</p> <p>Cause: ChoiceLoader order incorrect</p> <p>Solution: <pre><code># \u274c Wrong order\nloader = ChoiceLoader([\n    FileSystemLoader(package_templates),  # Package first\n    FileSystemLoader(user_templates)       # User second\n])\n\n# \u2705 Correct order\nloader = ChoiceLoader([\n    FileSystemLoader(user_templates),      # User first\n    FileSystemLoader(package_templates)    # Package second\n])\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#customizations-lost-during-migration","title":"Customizations Lost During Migration","text":"<p>Problem: User content disappears after upgrade</p> <p>Cause: Migration didn't detect customizations properly</p> <p>Solution: <pre><code>def detect_customizations(self) -&gt; dict:\n    \"\"\"Robust customization detection\"\"\"\n\n    # 1. Check for custom template file\n    custom_template = self.docs_dir / \"templates\" / \"claude.md.jinja2\"\n    if custom_template.exists():\n        # Parse blocks from template\n        return self._parse_custom_blocks(custom_template)\n\n    # 2. Check for custom markers in generated doc\n    doc_path = self.docs_dir / \"CLAUDE.md\"\n    if doc_path.exists():\n        content = doc_path.read_text()\n\n        # Look for custom section markers\n        if \"## My Configuration\" in content:\n            return self._extract_custom_sections(content)\n\n    # 3. Compare with base template (diff approach)\n    return self._diff_with_base_template(doc_path)\n\ndef _diff_with_base_template(self, doc_path: Path) -&gt; dict:\n    \"\"\"Compare user doc with base template to find customizations\"\"\"\n    from difflib import unified_diff\n\n    # Render base template\n    engine = DocTemplateEngine(self.package_name, self.project_root)\n    base_content = engine.render(\"base/claude.md.jinja2\", {})\n\n    # Compare\n    user_content = doc_path.read_text()\n    diff = list(unified_diff(\n        base_content.splitlines(),\n        user_content.splitlines()\n    ))\n\n    # Analyze diff to find customized sections\n    # ...\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#metadata-corruption","title":"Metadata Corruption","text":"<p>Problem: <code>.claude-docs-meta.json</code> becomes invalid</p> <p>Cause: Concurrent writes, interrupted migrations, manual edits</p> <p>Solution: <pre><code>@classmethod\ndef load(cls, path: Path) -&gt; Optional[\"DocsMetadata\"]:\n    \"\"\"Load with corruption recovery\"\"\"\n    if not path.exists():\n        return None\n\n    try:\n        with open(path) as f:\n            data = json.load(f)\n        return cls(**data)\n\n    except json.JSONDecodeError:\n        # Corrupted JSON - try to recover\n        print(\"\u26a0\ufe0f  Metadata corrupted, attempting recovery...\")\n        backup = cls._find_latest_backup(path.parent)\n\n        if backup:\n            print(f\"   Restoring from backup: {backup}\")\n            shutil.copy2(backup / path.name, path)\n            return cls.load(path)\n\n        print(\"   No backup found, creating default metadata\")\n        return cls._create_default()\n\n    except Exception as e:\n        raise MetadataError(f\"Failed to load metadata: {e}\")\n\n@staticmethod\ndef _find_latest_backup(docs_dir: Path) -&gt; Optional[Path]:\n    \"\"\"Find most recent backup directory\"\"\"\n    backups_dir = docs_dir / \"backups\"\n    if not backups_dir.exists():\n        return None\n\n    backups = sorted(backups_dir.iterdir(), reverse=True)\n    return backups[0] if backups else None\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#template-syntax-errors","title":"Template Syntax Errors","text":"<p>Problem: User creates invalid Jinja2 template</p> <p>Cause: Typos in block syntax, missing <code>{% endblock %}</code></p> <p>Solution: <pre><code>def validate_user_template(self, template_name: str) -&gt; tuple[bool, Optional[str]]:\n    \"\"\"\n    Validate user template syntax before using it.\n\n    Returns: (is_valid, error_message)\n    \"\"\"\n    user_path = self.project_root / f\".{self.package_name}\" / \"templates\" / template_name\n\n    if not user_path.exists():\n        return True, None  # No user template\n\n    try:\n        # Try parsing template\n        self.env.get_template(template_name)\n        return True, None\n\n    except Exception as e:\n        return False, str(e)\n\n# Use in CLI\ndef generate(platform: str):\n    engine = DocTemplateEngine(\"package\", Path.cwd())\n\n    # Validate before rendering\n    valid, error = engine.validate_user_template(f\"{platform}.md.jinja2\")\n    if not valid:\n        click.echo(f\"\u274c Template syntax error: {error}\")\n        click.echo(f\"   Fix your template in: .package/templates/{platform}.md.jinja2\")\n        return\n\n    # Proceed with generation\n    ...\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#version-compatibility-confusion","title":"Version Compatibility Confusion","text":"<p>Problem: Users don't understand doc_version vs package_version</p> <p>Cause: Unclear messaging</p> <p>Solution: <pre><code># Clear explanations in CLI output\ndef version():\n    click.echo(\"\"\"\n\ud83d\udcca Documentation Status\n\nDoc Schema Version:    2\n\u251c\u2500 Controls template structure\n\u251c\u2500 Changes rarely (only with breaking changes)\n\u2514\u2500 Current latest: 2\n\nPackage Version:       0.10.5\n\u251c\u2500 Controls features and APIs\n\u251c\u2500 Changes frequently (with releases)\n\u2514\u2500 Current latest: 0.10.5\n\n\ud83d\udca1 Explanation:\n- Doc schema version changes when template structure changes\n- Package version changes with every release\n- Old doc schemas may work with new packages (compatibility)\n- Run 'docs upgrade' when prompted\n    \"\"\")\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#7-extension-points","title":"7. Extension Points","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#multi-platform-documentation","title":"Multi-Platform Documentation","text":"<p>Pattern: Single base template, platform-specific extensions</p> <p><pre><code># Structure\ntemplates/\n  \u251c\u2500\u2500 shared/\n  \u2502   \u251c\u2500\u2500 quickstart.md.jinja2\n  \u2502   \u2514\u2500\u2500 api-reference.md.jinja2\n  \u2514\u2500\u2500 platforms/\n      \u251c\u2500\u2500 claude.md.jinja2\n      \u251c\u2500\u2500 gemini.md.jinja2\n      \u2514\u2500\u2500 codex.md.jinja2\n\n# Base template (shared sections)\n# templates/shared/quickstart.md.jinja2\n## Quick Start\n\n{% block install %}\n```bash\npip install {{ package_name }}\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#platform-specific-template","title":"Platform-specific template","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#templatesplatformsclaudemdjinja2","title":"templates/platforms/claude.md.jinja2","text":"<p>{% include \"shared/quickstart.md.jinja2\" %}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#claude-specific-features","title":"Claude-Specific Features","text":"<p>{% block claude_orchestration %} Use orchestration mode for multi-agent workflows... {% endblock %} <pre><code>**CLI support:**\n```bash\nyour-package docs generate --platform claude\nyour-package docs generate --platform gemini\nyour-package docs generate --all-platforms\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#internationalization-i18n","title":"Internationalization (i18n)","text":"<p>Pattern: Template selection by locale</p> <pre><code># Structure\ntemplates/\n  \u251c\u2500\u2500 en/\n  \u2502   \u2514\u2500\u2500 claude.md.jinja2\n  \u251c\u2500\u2500 ja/\n  \u2502   \u2514\u2500\u2500 claude.md.jinja2\n  \u2514\u2500\u2500 es/\n      \u2514\u2500\u2500 claude.md.jinja2\n\n# Context with locale\ncontext = {\n    \"package_name\": \"htmlgraph\",\n    \"locale\": \"ja\",\n    \"_\": translation_function  # gettext or similar\n}\n\n# Render with locale-specific template\noutput = engine.render(f\"{context['locale']}/claude.md.jinja2\", context)\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#dynamic-content-injection","title":"Dynamic Content Injection","text":"<p>Pattern: Hook-based content providers</p> <pre><code># Allow plugins to inject content into templates\n\nclass ContentProvider(ABC):\n    @abstractmethod\n    def get_content(self, section: str) -&gt; str:\n        pass\n\n# Register providers\nengine.register_provider(\"examples\", ExamplesProvider())\nengine.register_provider(\"changelog\", ChangelogProvider())\n\n# In template\n{% block examples %}\n{{ providers.examples.get_content(\"quickstart\") }}\n{% endblock %}\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#custom-template-filters","title":"Custom Template Filters","text":"<p>Pattern: Domain-specific Jinja2 filters</p> <pre><code>def setup_filters(env: Environment):\n    \"\"\"Add custom Jinja2 filters\"\"\"\n\n    # Convert snake_case to Title Case\n    env.filters[\"titleize\"] = lambda s: s.replace(\"_\", \" \").title()\n\n    # Format code blocks\n    env.filters[\"code\"] = lambda code, lang=\"python\": f\"```{lang}\\n{code}\\n```\"\n\n    # Format timestamps\n    env.filters[\"datetime\"] = lambda dt: dt.strftime(\"%Y-%m-%d %H:%M:%S\")\n\n    # Markdown table formatter\n    env.filters[\"table\"] = format_markdown_table\n\n# Usage in templates\n{{ package_name | titleize }}\n{{ code_sample | code(\"python\") }}\n{{ generated_at | datetime }}\n{{ api_methods | table }}\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#8-faq","title":"8. FAQ","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#q-why-jinja2-instead-of-simpler-string-templates","title":"Q: Why Jinja2 instead of simpler string templates?","text":"<p>A: Jinja2 provides critical features for this pattern:</p> <ol> <li>Template Inheritance - Users can extend base templates</li> <li>Block System - Granular override control</li> <li>Include/Import - Reusable components</li> <li>Filters - Custom formatting logic</li> <li>Conditionals - Platform-specific content</li> <li>Widely Used - Developers already know it</li> </ol> <p>Simple string templates (<code>str.format</code>, f-strings) don't support inheritance or blocks, making customization preservation impossible.</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#q-how-do-i-know-when-to-create-a-migration","title":"Q: How do I know when to create a migration?","text":"<p>A: Create a migration when:</p> <p>\u2705 Template structure changes - Adding/removing/renaming blocks - Changing file locations - Modifying metadata schema</p> <p>\u274c Don't create migration for: - Content improvements - Typo fixes - Adding examples (within existing blocks)</p> <p>Decision tree: <pre><code>Will user's custom template break? YES \u2192 Migration needed\nDid file paths change? YES \u2192 Migration needed\nDid metadata schema change? YES \u2192 Migration needed\nJust improving docs content? NO \u2192 No migration needed\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#q-can-users-completely-replace-base-documentation","title":"Q: Can users completely replace base documentation?","text":"<p>A: Yes, with caveats:</p> <p>Option 1: Override all blocks (recommended) <pre><code>{% extends \"base/claude.md.jinja2\" %}\n{% block quickstart %}Custom quickstart{% endblock %}\n{% block configuration %}Custom config{% endblock %}\n{# Override every block #}\n</code></pre></p> <p>Option 2: Completely custom template (advanced) <pre><code>{# Don't extend base template #}\n# My Completely Custom Documentation\n...\n</code></pre></p> <p>Caveat: Option 2 means: - No automatic updates from package - Must manually track changes - Version compatibility may break</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#q-what-if-user-customizations-conflict-with-package-updates","title":"Q: What if user customizations conflict with package updates?","text":"<p>A: Handle with migration strategy:</p> <pre><code>def migrate(self, customizations: dict) -&gt; bool:\n    \"\"\"Handle conflicting customizations\"\"\"\n\n    # Detect conflicts\n    conflicts = self._detect_conflicts(customizations)\n\n    if conflicts:\n        print(\"\u26a0\ufe0f  Customization conflicts detected:\")\n        for conflict in conflicts:\n            print(f\"   - {conflict['block']}: {conflict['reason']}\")\n\n        # Offer resolution strategies\n        print(\"\\nResolution options:\")\n        print(\"1. Keep your customization (may lose new features)\")\n        print(\"2. Accept package update (will overwrite your customization)\")\n        print(\"3. Merge both (manual editing required)\")\n\n        choice = click.prompt(\"Choose\", type=int)\n\n        if choice == 1:\n            # Keep user customization\n            return self._migrate_keep_user(customizations)\n        elif choice == 2:\n            # Accept package update\n            return self._migrate_accept_package(customizations)\n        else:\n            # Create merged template for manual editing\n            return self._migrate_create_merge_template(customizations)\n</code></pre>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#q-how-much-documentation-should-be-in-package-vs-project","title":"Q: How much documentation should be in package vs project?","text":"<p>A: Follow this guideline:</p> <p>Package documentation (base templates): - \u2705 Core concepts - \u2705 API reference - \u2705 Quick start - \u2705 Common patterns - \u2705 Troubleshooting</p> <p>Project documentation (user overrides): - \u2705 Project-specific configuration - \u2705 Custom workflows - \u2705 Team conventions - \u2705 Additional examples - \u2705 Integration notes</p> <p>Principle: Package provides comprehensive default, user customizes for their needs.</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#9-examples","title":"9. Examples","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#example-1-simple-package-basic-override","title":"Example 1: Simple Package - Basic Override","text":"<p>Scenario: CLI tool with minimal customization needs</p> <p>Package structure: <pre><code>simple_tool/\n\u251c\u2500\u2500 templates/\n\u2502   \u2514\u2500\u2500 base/\n\u2502       \u2514\u2500\u2500 README.md.jinja2\n\u2514\u2500\u2500 cli.py\n</code></pre></p> <p>Base template: <pre><code># {{ package_name }}\n\n{% block description %}\nA simple CLI tool for X, Y, Z.\n{% endblock %}\n\n## Installation\n{% block installation %}\n```bash\npip install {{ package_name }}\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#usage","title":"Usage","text":"<p>{% block usage %} <pre><code>{{ package_name }} command [options]\n</code></pre> {% endblock %} <pre><code>**User customization:**\n```jinja2\n{# .simple-tool/templates/README.md.jinja2 #}\n{% extends \"base/README.md.jinja2\" %}\n\n{% block description %}\n{{ super() }}\n\n**Our team uses this for:** Internal automation workflows\n{% endblock %}\n\n{% block usage %}\n{{ super() }}\n\n### Our Common Commands\n```bash\nsimple-tool deploy --env production\nsimple-tool backup --daily\n</code></pre> {% endblock %} <pre><code>**CLI:**\n```bash\nsimple-tool docs generate\n# Generates README.md with user customizations\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#example-2-medium-complexity-multiple-platforms-one-migration","title":"Example 2: Medium Complexity - Multiple Platforms, One Migration","text":"<p>Scenario: AI agent SDK with Claude and Gemini support</p> <p>Package structure: <pre><code>ai_sdk/\n\u251c\u2500\u2500 templates/\n\u2502   \u251c\u2500\u2500 base/\n\u2502   \u2502   \u251c\u2500\u2500 claude.md.jinja2\n\u2502   \u2502   \u2514\u2500\u2500 gemini.md.jinja2\n\u2502   \u2514\u2500\u2500 shared/\n\u2502       \u2514\u2500\u2500 api-common.md.jinja2\n\u251c\u2500\u2500 migrations/\n\u2502   \u2514\u2500\u2500 001_add_analytics.py\n\u2514\u2500\u2500 cli.py\n</code></pre></p> <p>Migration (001_add_analytics.py): <pre><code>class Migration001AddAnalytics(MigrationScript):\n    from_version = \"1\"\n    to_version = \"2\"\n    description = \"Add analytics section to documentation\"\n\n    def detect_customizations(self) -&gt; dict:\n        # Check for custom workflows section\n        doc_path = self.docs_dir / \"CLAUDE.md\"\n        content = doc_path.read_text()\n\n        custom_workflows = \"## My Workflows\" in content\n\n        return {\n            \"has_customizations\": custom_workflows,\n            \"customized_blocks\": [\"workflows\"] if custom_workflows else []\n        }\n\n    def migrate(self, customizations: dict) -&gt; bool:\n        # Regenerate with new analytics section\n        engine = DocTemplateEngine(\"ai_sdk\", self.project_root)\n\n        # Preserve custom workflows if exists\n        if customizations.get(\"has_customizations\"):\n            # Create user template with custom workflows block\n            pass\n\n        # Generate updated documentation\n        output = engine.render(\"base/claude.md.jinja2\", context)\n        doc_path.write_text(output)\n\n        return True\n</code></pre></p> <p>Usage: <pre><code># User has v1 docs with custom workflows\nai-sdk docs version\n# \u2192 Doc version: 1 (outdated)\n\n# Upgrade to v2 (adds analytics)\nai-sdk docs upgrade\n# \u2192 Detects custom workflows\n# \u2192 Preserves them in migration\n# \u2192 Adds new analytics section\n\n# Result: v2 docs with analytics + custom workflows preserved\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#example-3-advanced-multi-version-migrations-complex-customizations","title":"Example 3: Advanced - Multi-Version Migrations, Complex Customizations","text":"<p>Scenario: Full-featured framework with extensive documentation</p> <p>Package structure: <pre><code>advanced_framework/\n\u251c\u2500\u2500 templates/\n\u2502   \u251c\u2500\u2500 base/\n\u2502   \u2502   \u251c\u2500\u2500 claude.md.jinja2\n\u2502   \u2502   \u251c\u2500\u2500 gemini.md.jinja2\n\u2502   \u2502   \u2514\u2500\u2500 getting-started.md.jinja2\n\u2502   \u251c\u2500\u2500 shared/\n\u2502   \u2502   \u251c\u2500\u2500 api-reference.md.jinja2\n\u2502   \u2502   \u251c\u2500\u2500 examples.md.jinja2\n\u2502   \u2502   \u2514\u2500\u2500 troubleshooting.md.jinja2\n\u2502   \u2514\u2500\u2500 advanced/\n\u2502       \u251c\u2500\u2500 architecture.md.jinja2\n\u2502       \u2514\u2500\u2500 performance.md.jinja2\n\u251c\u2500\u2500 migrations/\n\u2502   \u251c\u2500\u2500 001_to_002.py\n\u2502   \u251c\u2500\u2500 002_to_003.py\n\u2502   \u2514\u2500\u2500 003_to_004.py\n\u2514\u2500\u2500 cli.py\n</code></pre></p> <p>Complex customization example: <pre><code>{# User template: .framework/templates/claude.md.jinja2 #}\n{% extends \"base/claude.md.jinja2\" %}\n\n{# Override configuration with team-specific setup #}\n{% block configuration %}\n## Our Production Configuration\n\n```yaml\nenvironment: production\nfeatures:\n  - advanced_caching\n  - distributed_tracing\n  - auto_scaling\n\nintegrations:\n  - datadog\n  - sentry\n  - pagerduty\n</code></pre></p> <p>{{ super() }}  {# Include package defaults too #}</p> <p>{# Add custom deployment section #}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#deployment-workflow","title":"Deployment Workflow","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#our-cicd-pipeline","title":"Our CI/CD Pipeline","text":"<ol> <li>Run tests in Docker</li> <li>Build production images</li> <li>Deploy to staging</li> <li>Run smoke tests</li> <li>Deploy to production</li> <li>Monitor metrics</li> </ol>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#rollback-procedure","title":"Rollback Procedure","text":"<p><pre><code>framework rollback --version $(cat .last-stable)\n</code></pre></p> <p>{# Override troubleshooting with team incidents #} {% block troubleshooting %} {{ super() }}</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#team-incident-history","title":"Team Incident History","text":"<ul> <li>2025-01-15: Database connection pool exhausted</li> <li>Solution: Increased pool size to 50</li> <li>2025-01-10: Cache invalidation race condition</li> <li>Solution: Added distributed locks {% endblock %} <pre><code>**Multi-version migration path:**\n```python\n# User on version 1, package at version 4\n# Migration path: 1 \u2192 2 \u2192 3 \u2192 4\n\nmigrations = [\n    Migration001To002,  # Add analytics\n    Migration002To003,  # Restructure API reference\n    Migration003To004,  # Add deployment section\n]\n\nfor migration_class in migrations:\n    migration = migration_class(project_root, \"advanced_framework\")\n    success = migration.run()\n    if not success:\n        print(\"Migration failed, rolling back\")\n        break\n</code></pre></li> </ul> <p>Conflict resolution: <pre><code># Version 3 \u2192 4 migration adds deployment section\n# User already has custom deployment section\n# Detect conflict and offer resolution\n\ndef migrate(self, customizations: dict) -&gt; bool:\n    if \"deployment\" in customizations[\"customized_blocks\"]:\n        print(\"\u26a0\ufe0f  Conflict: You have a custom deployment section\")\n        print(\"   Package v4 adds official deployment documentation\")\n        print(\"\\nOptions:\")\n        print(\"1. Keep your custom deployment docs\")\n        print(\"2. Switch to package deployment docs\")\n        print(\"3. Merge both (you'll need to edit)\")\n\n        choice = click.prompt(\"Choose\", type=int)\n\n        if choice == 3:\n            # Create merged template\n            self._create_merge_template(customizations)\n            print(\"\u2705 Created merged template for manual editing\")\n            print(\"   Edit: .framework/templates/claude.md.jinja2\")\n            return True\n\n    # Proceed with migration\n    ...\n</code></pre></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#10-resources","title":"10. Resources","text":""},{"location":"PACKAGEABLE_DOCS_PATTERN/#htmlgraph-source-code","title":"HtmlGraph Source Code","text":"<p>Reference implementation: - Template Engine: <code>src/python/htmlgraph/template_engine.py</code> - Models: <code>src/python/htmlgraph/models.py</code> - Migrations: <code>src/python/htmlgraph/migrations/</code> - CLI: <code>src/python/htmlgraph/cli.py</code> (docs subcommands) - Tests: <code>tests/test_docs_system.py</code></p> <p>GitHub: - Repository: https://github.com/shakes-tzd/htmlgraph - Templates: <code>/src/python/htmlgraph/templates/</code> - Migration examples: <code>/src/python/htmlgraph/migrations/</code></p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#external-documentation","title":"External Documentation","text":"<p>Jinja2: - Official Docs: https://jinja.palletsprojects.com/ - Template Designer Docs: https://jinja.palletsprojects.com/en/3.1.x/templates/ - API Reference: https://jinja.palletsprojects.com/en/3.1.x/api/</p> <p>Pydantic v2: - Documentation: https://docs.pydantic.dev/latest/ - Migration Guide (v1\u2192v2): https://docs.pydantic.dev/latest/migration/ - Validators: https://docs.pydantic.dev/latest/concepts/validators/</p> <p>Packaging: - Semantic Versioning: https://semver.org/ - Python Packaging Guide: https://packaging.python.org/ - Version Specifiers: https://peps.python.org/pep-0440/</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#related-patterns","title":"Related Patterns","text":"<p>Configuration Management: - Dynaconf: https://www.dynaconf.com/ (layered config) - Hydra: https://hydra.cc/ (config composition)</p> <p>Template Systems: - Cookiecutter: https://cookiecutter.readthedocs.io/ (project templates) - Copier: https://copier.readthedocs.io/ (template updates)</p> <p>Migration Systems: - Alembic: https://alembic.sqlalchemy.org/ (database migrations) - Django Migrations: https://docs.djangoproject.com/en/stable/topics/migrations/</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#community-examples","title":"Community Examples","text":"<p>Tools using similar patterns: - Cookiecutter - Project templates with updates - Copier - Template-based project generation with updates - Homebrew - Formula templates with user customization - Oh My Zsh - Plugin system with custom overrides</p>"},{"location":"PACKAGEABLE_DOCS_PATTERN/#conclusion","title":"Conclusion","text":"<p>The packageable auto-updating documentation pattern solves the challenge of keeping AI agent instructions current while preserving user customizations. By combining:</p> <ol> <li>Jinja2 template inheritance for flexible customization</li> <li>Dual versioning for compatibility tracking</li> <li>Migration scripts for safe upgrades</li> <li>Metadata tracking for state management</li> </ol> <p>...developers can build documentation systems that: - \u2705 Auto-update with package releases - \u2705 Preserve user customizations - \u2705 Support safe rollback - \u2705 Work across multiple platforms - \u2705 Scale to complex use cases</p> <p>Next Steps: 1. Review HtmlGraph's implementation for working examples 2. Adapt the pattern to your package's needs 3. Start with simple template inheritance 4. Add migrations as your documentation evolves 5. Share your learnings with the community</p> <p>Remember: Start simple, add complexity only when needed. A basic template system is better than no system at all.</p> <p>This guide was created based on HtmlGraph's proven implementation. For questions or contributions, see: https://github.com/shakes-tzd/htmlgraph</p>"},{"location":"PARALLEL_WORKFLOW/","title":"Optimal Parallel Agent Workflow","text":"<p>This document defines the optimal workflow for parallel agent execution in HtmlGraph, based on: - Transcript analytics from real parallel sessions - Industry best practices (Anthropic, Microsoft, Google patterns) - Anti-pattern detection and health scoring</p>"},{"location":"PARALLEL_WORKFLOW/#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PARALLEL WORKFLOW PHASES                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. PRE-FLIGHT    \u2192  Analyze, partition, assess risk            \u2502\n\u2502  2. CONTEXT PREP  \u2192  Cache shared context, generate summaries   \u2502\n\u2502  3. DISPATCH      \u2192  Spawn agents with isolated tasks           \u2502\n\u2502  4. MONITOR       \u2192  Track health, detect drift, handle errors  \u2502\n\u2502  5. AGGREGATE     \u2192  Collect results, reconcile conflicts       \u2502\n\u2502  6. VALIDATE      \u2192  Verify outputs, update dependencies        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#phase-1-pre-flight-analysis","title":"Phase 1: Pre-Flight Analysis","text":"<p>Goal: Determine what can be parallelized and assess if parallelization is worth the cost.</p>"},{"location":"PARALLEL_WORKFLOW/#11-dependency-analysis","title":"1.1 Dependency Analysis","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"orchestrator\")\n\n# Get parallel opportunities\nparallel = sdk.get_parallel_work(max_agents=5)\n# Returns:\n#   max_parallelism: 5\n#   ready_now: [\"feat-001\", \"feat-002\", ...]  # Level 0 (no deps)\n#   dependency_levels: [[L0], [L1], [L2]]      # Topological layers\n\n# Check for blockers\nbottlenecks = sdk.find_bottlenecks(top_n=3)\n# Fix blockers first to unlock more parallel work\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#12-risk-assessment","title":"1.2 Risk Assessment","text":"<pre><code># Identify risky parallelization\nrisks = sdk.assess_risks()\n# - Circular dependencies (cannot parallelize)\n# - Single points of failure (critical path)\n# - Shared file conflicts (need coordination)\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#13-cost-benefit-decision","title":"1.3 Cost-Benefit Decision","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PARALLELIZE WHEN:                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u2705 Tasks are truly independent (no shared deps)\u2502\n\u2502  \u2705 Each task takes &gt;2 minutes                  \u2502\n\u2502  \u2705 No overlapping file edits                   \u2502\n\u2502  \u2705 Value justifies ~15x token cost            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  DON'T PARALLELIZE WHEN:                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u274c Tasks share dependencies                    \u2502\n\u2502  \u274c Quick tasks (&lt;1 minute each)               \u2502\n\u2502  \u274c Same files will be edited                   \u2502\n\u2502  \u274c Sequential handoff needed                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#phase-2-context-preparation","title":"Phase 2: Context Preparation","text":"<p>Goal: Reduce redundant file reads by preparing shared context upfront.</p>"},{"location":"PARALLEL_WORKFLOW/#21-identify-shared-files","title":"2.1 Identify Shared Files","text":"<pre><code># Before spawning agents, identify commonly needed files\nshared_files = [\n    \"src/models.py\",      # Data models\n    \"src/config.py\",      # Configuration\n    \"tests/conftest.py\",  # Test fixtures\n]\n\n# Read once, summarize for agents\ncontext_cache = {}\nfor file in shared_files:\n    content = Read(file)\n    context_cache[file] = {\n        \"summary\": summarize(content),  # 50-100 tokens\n        \"key_classes\": extract_classes(content),\n        \"key_functions\": extract_functions(content),\n    }\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#22-generate-task-context","title":"2.2 Generate Task Context","text":"<p>Each agent receives: <pre><code>## Task: {feature_id}\nTitle: {title}\nPriority: {priority}\n\n## Your Assignment\n{specific_instructions}\n\n## Pre-Cached Context (DO NOT re-read these files)\n- models.py: Contains User, Session, Feature classes\n- config.py: DATABASE_URL, API_KEY settings\n- conftest.py: pytest fixtures for db, client\n\n## Files You Should Read\n- {specific_files_for_this_task}\n\n## Constraints\n- DO NOT edit: {files_other_agents_are_editing}\n- Focus ONLY on: {your_specific_scope}\n</code></pre></p>"},{"location":"PARALLEL_WORKFLOW/#23-anti-pattern-prevention","title":"2.3 Anti-Pattern Prevention","text":"<p>Based on transcript analytics, include these reminders: <pre><code>## Efficiency Guidelines\n- Use Grep before Read (search \u2192 read, not read everything)\n- Batch Edit operations (multiple changes in one edit)\n- Use Glob to find files (not repeated Read attempts)\n- Check cached context before reading shared files\n</code></pre></p>"},{"location":"PARALLEL_WORKFLOW/#phase-3-dispatch","title":"Phase 3: Dispatch","text":"<p>Goal: Spawn agents with isolated, well-defined tasks.</p>"},{"location":"PARALLEL_WORKFLOW/#31-optimal-dispatch-pattern","title":"3.1 Optimal Dispatch Pattern","text":"<pre><code># GOOD: Spawn all independent agents in single message\n# This enables TRUE parallelism\n\ntasks = [\n    Task(\n        subagent_type=\"general-purpose\",\n        prompt=f\"\"\"\nWork on feature {task1_id}: {task1_title}\n\n{task1_context}  # From Phase 2\n\nComplete these steps:\n1. {step1}\n2. {step2}\n3. Update feature file when done\n\nReturn: Summary of changes made, files modified, any blockers found.\n\"\"\",\n        description=\"Task 1: {short_desc}\"\n    ),\n    Task(\n        subagent_type=\"general-purpose\",\n        prompt=f\"\"\"...\"\"\",\n        description=\"Task 2: {short_desc}\"\n    ),\n    Task(\n        subagent_type=\"general-purpose\",\n        prompt=f\"\"\"...\"\"\",\n        description=\"Task 3: {short_desc}\"\n    ),\n]\n\n# All three run in parallel!\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#32-task-isolation-rules","title":"3.2 Task Isolation Rules","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ISOLATION REQUIREMENTS                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. Separate feature IDs (one per agent)            \u2502\n\u2502  2. Non-overlapping file edits                      \u2502\n\u2502  3. Independent test files                          \u2502\n\u2502  4. Clear scope boundaries                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  IF OVERLAP UNAVOIDABLE:                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u2192 Use sequential handoff instead                    \u2502\n\u2502  \u2192 Or: Agent A writes, Agent B reads (not both edit)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#33-agent-assignment-capability-routing","title":"3.3 Agent Assignment (Capability Routing)","text":"<pre><code>from htmlgraph.routing import route_task_to_agent\n\n# Match tasks to best agents based on capabilities\nfor task in ready_tasks:\n    agent, score = route_task_to_agent(task, registry)\n    # Score considers:\n    #   +100 per matching capability\n    #   -50 per missing capability\n    #   -5 per task in WIP\n    #   -100 if at capacity\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#phase-4-monitor","title":"Phase 4: Monitor","text":"<p>Goal: Track progress, detect issues early.</p>"},{"location":"PARALLEL_WORKFLOW/#41-health-metrics-to-watch","title":"4.1 Health Metrics to Watch","text":"<pre><code># After agents complete, analyze transcripts\nfrom htmlgraph.transcript_analytics import TranscriptAnalytics\n\nanalytics = TranscriptAnalytics()\n\nfor agent_id in spawned_agents:\n    health = analytics.calculate_session_health(agent_id)\n\n    # Alert thresholds:\n    if health.retry_rate &gt; 0.3:\n        log.warn(f\"{agent_id}: High retry rate {health.retry_rate:.0%}\")\n\n    if health.context_rebuild_count &gt; 5:\n        log.warn(f\"{agent_id}: {health.context_rebuild_count} context rebuilds\")\n\n    if health.tool_diversity &lt; 0.3:\n        log.warn(f\"{agent_id}: Low tool diversity\")\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#42-anti-pattern-detection","title":"4.2 Anti-Pattern Detection","text":"<pre><code># Real-time anti-pattern checks\nANTI_PATTERNS = {\n    (\"Read\", \"Read\", \"Read\"): \"Cache file content instead\",\n    (\"Edit\", \"Edit\", \"Edit\"): \"Batch into single edit\",\n    (\"Bash\", \"Bash\", \"Bash\", \"Bash\"): \"Check for errors\",\n    (\"Grep\", \"Grep\", \"Grep\"): \"Read results before searching more\",\n}\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#43-drift-detection","title":"4.3 Drift Detection","text":"<pre><code># Monitor if agent is working on assigned feature\ndrift = manager.detect_drift(session_id, feature_id)\n\n# Indicators of drift:\n# - Time stalled &gt;15 min\n# - Repetitive tool patterns (5+ same tool)\n# - High avg drift scores (&gt;0.6)\n# - Failed tool calls (3+ failures)\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#phase-5-aggregate","title":"Phase 5: Aggregate","text":"<p>Goal: Collect and reconcile results from parallel agents.</p>"},{"location":"PARALLEL_WORKFLOW/#51-result-collection","title":"5.1 Result Collection","text":"<pre><code># After all agents complete\nresults = {\n    \"agent_1\": {\n        \"status\": \"success\",\n        \"files_modified\": [\"auth.py\", \"test_auth.py\"],\n        \"feature_completed\": \"feat-001\",\n        \"duration_seconds\": 235,\n        \"health_score\": 0.75,\n    },\n    \"agent_2\": {\n        \"status\": \"success\",\n        \"files_modified\": [\"api.py\", \"test_api.py\"],\n        \"feature_completed\": \"feat-002\",\n        \"duration_seconds\": 198,\n        \"health_score\": 0.84,\n    },\n    # ...\n}\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#52-conflict-detection","title":"5.2 Conflict Detection","text":"<pre><code># Check for file conflicts (shouldn't happen if Phase 2 done right)\nall_modified = []\nfor result in results.values():\n    for file in result[\"files_modified\"]:\n        if file in all_modified:\n            raise ConflictError(f\"Multiple agents modified {file}\")\n        all_modified.append(file)\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#53-aggregate-metrics","title":"5.3 Aggregate Metrics","text":"<pre><code># Session-level summary\naggregate = {\n    \"total_agents\": 3,\n    \"successful\": 3,\n    \"failed\": 0,\n    \"total_duration\": sum(r[\"duration_seconds\"] for r in results.values()),\n    \"parallel_speedup\": max_duration / sequential_estimate,\n    \"avg_health\": mean(r[\"health_score\"] for r in results.values()),\n    \"anti_patterns_total\": sum_anti_patterns(results),\n}\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#phase-6-validate","title":"Phase 6: Validate","text":"<p>Goal: Verify outputs and update system state.</p>"},{"location":"PARALLEL_WORKFLOW/#61-validation-checklist","title":"6.1 Validation Checklist","text":"<pre><code># Post-parallel validation\nvalidation = {\n    \"tests_pass\": run_tests(),\n    \"no_conflicts\": check_git_conflicts(),\n    \"features_updated\": verify_feature_files_updated(),\n    \"dependencies_resolved\": check_dependency_graph(),\n}\n\nif not all(validation.values()):\n    trigger_remediation(validation)\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#62-update-dependencies","title":"6.2 Update Dependencies","text":"<pre><code># Mark completed work\nfor result in results.values():\n    if result[\"status\"] == \"success\":\n        sdk.features.complete(result[\"feature_completed\"])\n\n# Unlock Level 1 tasks (depended on Level 0)\nnext_level = sdk.get_parallel_work(max_agents=5)\n# Now Level 1 tasks are in ready_now\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#63-commit-aggregate-changes","title":"6.3 Commit Aggregate Changes","text":"<pre><code># Single commit for all parallel work\ngit add -A\ngit commit -m \"\"\"feat: complete parallel work batch\n\nFeatures completed:\n- feat-001: {title1}\n- feat-002: {title2}\n- feat-003: {title3}\n\nParallel execution metrics:\n- Agents: 3\n- Duration: 235s (vs ~600s sequential)\n- Health: 80% avg\n\"\"\"\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#optimal-patterns-summary","title":"Optimal Patterns Summary","text":""},{"location":"PARALLEL_WORKFLOW/#do","title":"DO:","text":"Pattern Description Benefit Grep \u2192 Read Search before reading Reduces context rebuilds Read \u2192 Edit \u2192 Bash Read, modify, test Complete workflow Glob \u2192 Read Find files first Avoids failed reads Single dispatch All Task calls in one message True parallelism Pre-cached context Share summaries upfront Reduces redundant reads"},{"location":"PARALLEL_WORKFLOW/#dont","title":"DON'T:","text":"Anti-Pattern Problem Solution Read \u2192 Read \u2192 Read Context rebuilds Cache content Edit \u2192 Edit \u2192 Edit Unbatched edits Combine edits Bash \u2192 Bash \u2192 Bash Command loops Check errors Overlapping files Merge conflicts Isolate scope Sequential Task calls Lost parallelism Single message"},{"location":"PARALLEL_WORKFLOW/#quick-reference","title":"Quick Reference","text":""},{"location":"PARALLEL_WORKFLOW/#parallel-workflow-command","title":"Parallel Workflow Command","text":"<pre><code># Analyze what can be parallelized\nuv run htmlgraph work parallel --max-agents 5\n\n# Get recommended parallel assignments\nuv run htmlgraph recommend --agent-count 3\n\n# Check bottlenecks first\nuv run htmlgraph analytics bottlenecks --top 5\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#health-check-after-parallel-work","title":"Health Check After Parallel Work","text":"<pre><code># Analyze all recent agent transcripts\nuv run htmlgraph transcript insights\n\n# Check specific agent\nuv run htmlgraph transcript health {agent-id}\n\n# Get recommendations\nuv run htmlgraph transcript recommendations\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#decision-tree","title":"Decision Tree","text":"<pre><code>START: Need to complete multiple tasks\n\u2502\n\u251c\u2500 Are tasks independent (no shared deps)?\n\u2502   \u251c\u2500 YES \u2192 Check file overlap\n\u2502   \u2502   \u251c\u2500 No overlap \u2192 PARALLELIZE (this doc)\n\u2502   \u2502   \u2514\u2500 Overlap \u2192 Sequential or partition files\n\u2502   \u2514\u2500 NO \u2192 Use dependency levels\n\u2502       \u2514\u2500 Complete Level 0 first, then Level 1, etc.\n\u2502\n\u251c\u2500 Is each task &gt;2 minutes?\n\u2502   \u251c\u2500 YES \u2192 Worth parallelizing\n\u2502   \u2514\u2500 NO \u2192 Sequential may be simpler\n\u2502\n\u2514\u2500 Is 15x token cost justified?\n    \u251c\u2500 YES \u2192 PARALLELIZE\n    \u2514\u2500 NO \u2192 Sequential with handoffs\n</code></pre>"},{"location":"PARALLEL_WORKFLOW/#references","title":"References","text":"<ul> <li>HtmlGraph Transcript Analytics</li> <li>Dependency Analysis</li> <li>Multi-Agent Coordination Tests</li> <li>Anthropic Multi-Agent Research System</li> <li>Microsoft Agent Orchestration Patterns</li> </ul>"},{"location":"PLANNING_WORKFLOW/","title":"Optimal Planning Workflow Template","text":"<p>Complete guide to optimal planning workflows in HtmlGraph, covering general-purpose patterns, subagent selection, and platform-specific integration.</p>"},{"location":"PLANNING_WORKFLOW/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>3-Phase Optimal Workflow</li> <li>Subagent Selection Decision Tree</li> <li>Batch API Operations</li> <li>Performance Metrics</li> <li>HtmlGraph Integration</li> </ol>"},{"location":"PLANNING_WORKFLOW/#overview","title":"Overview","text":"<p>HtmlGraph provides two planning approaches:</p>"},{"location":"PLANNING_WORKFLOW/#1-general-optimal-workflow-this-document","title":"1. General Optimal Workflow (This Document)","text":"<p>The universal 3-phase pattern applicable to ANY planning task: - Phase 1: Research \u2192 Gather context, understand constraints - Phase 2: Design \u2192 Architecture decisions, approach selection - Phase 3: Implement \u2192 Execute with checkpoints</p>"},{"location":"PLANNING_WORKFLOW/#2-htmlgraph-specific-workflow-integration","title":"2. HtmlGraph-Specific Workflow (Integration)","text":"<p>The platform's integrated spike/track/feature system: - Strategic Analytics \u2192 What should we work on? - Planning Spikes \u2192 How should we build it? - Track Creation \u2192 Organize multi-feature work - Feature Implementation \u2192 Execute the plan</p> <p>Both workflows are complementary and can be combined for optimal results.</p>"},{"location":"PLANNING_WORKFLOW/#3-phase-optimal-workflow","title":"3-Phase Optimal Workflow","text":"<p>This is the recommended approach for ALL planning operations, regardless of complexity.</p>"},{"location":"PLANNING_WORKFLOW/#phase-1-research","title":"Phase 1: Research","text":"<p>\u26a0\ufe0f CRITICAL: Research-First Approach</p> <p>For complex features (authentication, security, real-time, integrations), you MUST perform external research BEFORE codebase exploration:</p> <ol> <li>External Research (WebSearch) - Gather industry best practices</li> <li>Codebase Exploration (Grep/Read) - Understand current implementation</li> <li>Synthesis - Combine external knowledge with internal context</li> </ol> <p>Why Research First? - \u2705 Learn from others' mistakes (avoid anti-patterns) - \u2705 Choose proven solutions (reduce trial-and-error) - \u2705 Discover modern tools (better than reinventing) - \u2705 Reduce context usage (targeted vs exploratory reads)</p> <p>Impact: Research-first reduces implementation time by 30-40% and context usage by 65%.</p> <p>Goal: Gather context, best practices, and constraints before making decisions.</p> <p>Activities:</p> <ol> <li>External Research (For Complex Features)</li> <li>Use <code>/htmlgraph:research</code> or WebSearch</li> <li>Gather industry best practices</li> <li>Identify proven patterns and libraries</li> <li>Document anti-patterns to avoid</li> <li> <p>Collect modern approaches (2024-2025)</p> </li> <li> <p>Codebase Exploration</p> </li> <li>Search for existing implementations</li> <li>Identify relevant files and modules</li> <li> <p>Understand current architecture patterns</p> </li> <li> <p>Requirement Analysis</p> </li> <li>Extract constraints from requirements</li> <li>Identify success criteria</li> <li> <p>Document assumptions</p> </li> <li> <p>Synthesis</p> </li> <li>Combine external research with internal context</li> <li>Adapt industry patterns to codebase</li> <li>Document research-backed decisions</li> </ol> <p>Tools: - WebSearch for external research (mandatory for complex work) - Grep/Glob for codebase search - Read for understanding existing code - Explore subagent for complex investigations</p> <p>Output: - Context summary (200-500 words) - Key constraints list - Relevant file paths - Decision options with pros/cons</p> <p>Example: <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"orchestrator\")\n\n# STEP 1: External Research (use /htmlgraph:research or WebSearch)\n# /htmlgraph:research \"OAuth 2.0 implementation best practices 2025\"\nexternal_research = \"\"\"\nExternal Research Findings:\n- Recommended: OAuth 2.0 with PKCE for security\n- Popular libraries: authlib (most maintained), oauthlib (legacy)\n- Best practices: Token rotation, short expiry, secure storage\n- Anti-patterns: Storing tokens in localStorage, no PKCE, long-lived tokens\n- Modern approach: BFF pattern for SPAs, HTTP-only cookies\n\nSources:\n- [OAuth 2.0 Security Best Practices](https://oauth.net/2/security-best-practices/)\n- [Auth0 Implementation Guide](https://auth0.com/docs/get-started)\n- [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/)\n\"\"\"\n\n# STEP 2: Codebase Exploration\n# Use Grep/Glob to find existing implementations\ncodebase_context = \"\"\"\nCodebase Findings:\n- Existing auth: sessions stored in Redis\n- Current framework: FastAPI with pydantic\n- Database: PostgreSQL with SQLAlchemy ORM\n- Testing: pytest with fixtures in conftest.py\n\nConstraints:\n- Must maintain backward compatibility\n- Cannot change session schema\n- Tests must pass in CI/CD\n\"\"\"\n\n# STEP 3: Synthesis - Combine external + internal\nfinal_findings = \"\"\"\nResearch-Informed Decision:\n\nBased on external research + codebase analysis:\n\nOptions Identified:\n1. OAuth 2.0 with Auth0 (managed service) \u2705 RECOMMENDED\n   + Follows 2025 best practices (PKCE, token rotation)\n   + Quick integration, proven security\n   + Maintains backward compatibility (can coexist with Redis sessions)\n   - External dependency, cost ($)\n\n2. Custom OAuth implementation\n   + Full control, no external deps\n   - More complex, security risk (avoid anti-patterns is hard)\n   - Not recommended per OWASP guidelines\n\n3. JWT-only (no OAuth)\n   + Simple, stateless\n   - Less secure for social login\n   - Doesn't support external identity providers\n\nDecision: Option 1 (Auth0) based on research best practices\n\"\"\"\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#phase-2-design","title":"Phase 2: Design","text":"<p>Goal: Make architectural decisions and select optimal approach.</p> <p>Activities: 1. Architecture Selection    - Choose between identified options    - Document decision rationale    - Define component boundaries</p> <ol> <li>Dependency Planning</li> <li>Identify required libraries</li> <li>Plan integration points</li> <li> <p>Define interfaces</p> </li> <li> <p>Risk Assessment</p> </li> <li>Identify failure points</li> <li>Plan mitigation strategies</li> <li>Define rollback procedures</li> </ol> <p>Tools: - Plan subagent for complex architecture decisions - SDK analytics for dependency analysis - Mental models for system design</p> <p>Output: - Architecture decision (with reasoning) - Component breakdown - Interface definitions - Implementation plan with phases</p> <p>Example: <pre><code># Design phase - make decisions\ndesign = \"\"\"\nArchitecture Decision: OAuth 2.0 with Auth0\n\nRationale:\n- Security is critical (managed service wins)\n- Timeline is tight (quick integration needed)\n- Team unfamiliar with OAuth internals (avoid custom)\n\nComponent Breakdown:\n1. OAuth Integration Layer\n   - Auth0 SDK wrapper\n   - Callback handler\n   - State verification\n\n2. JWT Token Service\n   - Token generation from OAuth response\n   - Token refresh logic\n   - Validation middleware\n\n3. User Profile Service\n   - Profile creation from OAuth data\n   - Profile update endpoint\n   - Link to existing user system\n\nImplementation Plan:\nPhase 1: OAuth Setup (4 hours)\n  - Configure Auth0 tenant\n  - Implement callback handler\n  - Add state verification\n\nPhase 2: JWT Integration (5 hours)\n  - Create token service\n  - Add refresh endpoint\n  - Implement middleware\n\nPhase 3: User Integration (6 hours)\n  - Create profile endpoints\n  - Link OAuth to existing users\n  - Write integration tests\n\"\"\"\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#phase-3-implement","title":"Phase 3: Implement","text":"<p>Goal: Execute the plan with regular checkpoints and validation.</p> <p>Activities: 1. Incremental Development    - Implement one phase at a time    - Test after each phase    - Commit working increments</p> <ol> <li>Checkpoint Validation</li> <li>Run tests after each component</li> <li>Verify interfaces work as designed</li> <li> <p>Check against success criteria</p> </li> <li> <p>Documentation</p> </li> <li>Update API docs</li> <li>Document configuration</li> <li>Add usage examples</li> </ol> <p>Tools: - General-purpose subagents for implementation - Edit/Write for code changes - Bash for testing and validation - SDK for tracking progress</p> <p>Output: - Working implementation - Passing tests - Updated documentation - Completed features</p> <p>Example: <pre><code># Implementation phase - execute plan\n# Create features from design phases\ntrack_id = sdk.tracks.create(\"OAuth Authentication\").id\n\n# Phase 1 feature\noauth_feature = sdk.features.create(\"OAuth Setup\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Configure Auth0 tenant\",\n        \"Implement callback handler\",\n        \"Add state verification\",\n        \"Test OAuth flow\"\n    ]) \\\n    .save()\n\n# Phase 2 feature\njwt_feature = sdk.features.create(\"JWT Token Service\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create token service class\",\n        \"Add refresh endpoint\",\n        \"Implement validation middleware\",\n        \"Test token lifecycle\"\n    ]) \\\n    .add_edge(Edge(\n        target_id=oauth_feature.id,\n        relationship=\"depends_on\"\n    )) \\\n    .save()\n\n# Implement using general-purpose agents\n# Mark steps complete as you progress\nwith sdk.features.edit(oauth_feature.id) as f:\n    f.status = \"in-progress\"\n    f.steps[0].completed = True  # After each step\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#workflow-summary","title":"Workflow Summary","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   3-PHASE WORKFLOW                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  PHASE 1: RESEARCH (2-4 hours)                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502 \u2022 Explore codebase                          \u2502           \u2502\n\u2502  \u2502 \u2022 Analyze requirements                      \u2502           \u2502\n\u2502  \u2502 \u2022 Research best practices                   \u2502           \u2502\n\u2502  \u2502 Output: Context + Options                   \u2502           \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                      \u2502                                      \u2502\n\u2502                      \u25bc                                      \u2502\n\u2502  PHASE 2: DESIGN (1-3 hours)                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502 \u2022 Select architecture                       \u2502           \u2502\n\u2502  \u2502 \u2022 Plan components                           \u2502           \u2502\n\u2502  \u2502 \u2022 Assess risks                              \u2502           \u2502\n\u2502  \u2502 Output: Decision + Plan                     \u2502           \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                      \u2502                                      \u2502\n\u2502                      \u25bc                                      \u2502\n\u2502  PHASE 3: IMPLEMENT (varies)                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502 \u2022 Execute incrementally                     \u2502           \u2502\n\u2502  \u2502 \u2022 Validate checkpoints                      \u2502           \u2502\n\u2502  \u2502 \u2022 Document changes                          \u2502           \u2502\n\u2502  \u2502 Output: Working code + Tests                \u2502           \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#subagent-selection-decision-tree","title":"Subagent Selection Decision Tree","text":"<p>When working with multiple subagent types, use this decision tree to select the optimal agent for each task.</p> <pre><code>graph TD\n    Start[Task to Complete] --&gt; Question1{What type of work?}\n\n    Question1 --&gt;|Research/Investigation| Question2{Codebase or External?}\n    Question1 --&gt;|Architecture/Design| Question3{Complexity Level?}\n    Question1 --&gt;|Implementation| Question4{Code Changes?}\n\n    Question2 --&gt;|Codebase Exploration| Explore[Use EXPLORE Agent]\n    Question2 --&gt;|External Research| General1[Use General-Purpose]\n\n    Question3 --&gt;|Complex Multi-Component| Plan[Use PLAN Agent]\n    Question3 --&gt;|Simple Single-Component| General2[Use General-Purpose]\n\n    Question4 --&gt;|Write/Edit Code| General3[Use General-Purpose]\n    Question4 --&gt;|Read-Only Analysis| Explore2[Use EXPLORE Agent]\n\n    Explore --&gt; ExploreDesc[Capabilities:&lt;br/&gt;\u2022 Deep codebase search&lt;br/&gt;\u2022 Pattern identification&lt;br/&gt;\u2022 Dependency tracing&lt;br/&gt;\u2022 Architecture analysis]\n\n    Plan --&gt; PlanDesc[Capabilities:&lt;br/&gt;\u2022 Architecture decisions&lt;br/&gt;\u2022 Multi-component design&lt;br/&gt;\u2022 Risk assessment&lt;br/&gt;\u2022 Approach comparison]\n\n    General1 --&gt; GeneralDesc[Capabilities:&lt;br/&gt;\u2022 Implementation&lt;br/&gt;\u2022 Testing&lt;br/&gt;\u2022 Documentation&lt;br/&gt;\u2022 General problem-solving]\n    General2 --&gt; GeneralDesc\n    General3 --&gt; GeneralDesc\n    Explore2 --&gt; ExploreDesc\n\n    style Explore fill:#e1f5ff\n    style Plan fill:#fff4e1\n    style General1 fill:#e8f5e9\n    style General2 fill:#e8f5e9\n    style General3 fill:#e8f5e9\n    style Explore2 fill:#e1f5ff</code></pre>"},{"location":"PLANNING_WORKFLOW/#agent-selection-guidelines","title":"Agent Selection Guidelines","text":"Agent Type When to Use When NOT to Use Example Tasks Explore \u2022 Large codebase investigation\u2022 Finding patterns across files\u2022 Understanding complex architecture\u2022 Dependency analysis \u2022 Simple file reads\u2022 Code implementation\u2022 Testing \u2022 \"Find all authentication implementations\"\u2022 \"Map data flow through system\"\u2022 \"Identify all API endpoints\" Plan \u2022 Multi-component design\u2022 Architecture decisions\u2022 Comparing approaches\u2022 Complex integration planning \u2022 Simple single-file changes\u2022 Straightforward implementations\u2022 Bug fixes \u2022 \"Design microservices architecture\"\u2022 \"Plan database migration strategy\"\u2022 \"Evaluate caching solutions\" General-Purpose \u2022 Implementing code\u2022 Writing tests\u2022 Creating documentation\u2022 Bug fixes\u2022 Simple research \u2022 Very complex architecture\u2022 Massive codebase analysis \u2022 \"Implement OAuth callback handler\"\u2022 \"Fix login validation bug\"\u2022 \"Add unit tests for auth module\""},{"location":"PLANNING_WORKFLOW/#decision-examples","title":"Decision Examples","text":"<p>Scenario 1: \"Add user authentication\" <pre><code>Phase 1 (Research): Use EXPLORE agent\n  \u2192 Deep codebase search for existing auth patterns\n  \u2192 Find all user management code\n  \u2192 Identify integration points\n\nPhase 2 (Design): Use PLAN agent\n  \u2192 Complex multi-component decision\n  \u2192 Evaluate OAuth vs JWT vs Session-based\n  \u2192 Design integration architecture\n\nPhase 3 (Implement): Use General-Purpose agents\n  \u2192 Write actual code changes\n  \u2192 Add tests\n  \u2192 Update documentation\n</code></pre></p> <p>Scenario 2: \"Fix login validation bug\" <pre><code>All Phases: Use General-Purpose agent\n  \u2192 Simple single-component fix\n  \u2192 No deep exploration needed\n  \u2192 No complex architecture decisions\n  \u2192 Just fix, test, commit\n</code></pre></p> <p>Scenario 3: \"Understand how payment processing works\" <pre><code>Use EXPLORE agent\n  \u2192 Read-only analysis task\n  \u2192 May span multiple files/modules\n  \u2192 Need to trace data flow\n  \u2192 Document findings\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#batch-api-operations","title":"Batch API Operations","text":"<p>HtmlGraph SDK supports batch operations for efficiency. Here are common patterns for multiple SDK calls in one session.</p>"},{"location":"PLANNING_WORKFLOW/#pattern-1-batch-feature-creation","title":"Pattern 1: Batch Feature Creation","text":"<p>Before (Sequential - 5 SDK calls): <pre><code>sdk = SDK(agent=\"claude\")\n\n# Call 1\nf1 = sdk.features.create(\"OAuth Integration\")\n# Call 2\nf1.set_priority(\"high\")\n# Call 3\nf1.add_step(\"Configure provider\")\n# Call 4\nf1.add_step(\"Implement callback\")\n# Call 5\nf1.save()\n</code></pre></p> <p>After (Batched - 1 SDK call): <pre><code>sdk = SDK(agent=\"claude\")\n\n# Single fluent chain\nfeature = sdk.features.create(\"OAuth Integration\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Configure provider\",\n        \"Implement callback\",\n        \"Test OAuth flow\"\n    ]) \\\n    .save()\n</code></pre></p> <p>Savings: 80% fewer SDK calls (1 vs 5)</p>"},{"location":"PLANNING_WORKFLOW/#pattern-2-batch-feature-updates","title":"Pattern 2: Batch Feature Updates","text":"<p>Before (Multiple Edits): <pre><code># Edit 1: Update status\nwith sdk.features.edit(\"feat-123\") as f:\n    f.status = \"in-progress\"\n\n# Edit 2: Assign agent\nwith sdk.features.edit(\"feat-123\") as f:\n    f.agent_assigned = \"claude\"\n\n# Edit 3: Complete step\nwith sdk.features.edit(\"feat-123\") as f:\n    f.steps[0].completed = True\n</code></pre></p> <p>After (Single Edit): <pre><code># All changes in one edit\nwith sdk.features.edit(\"feat-123\") as f:\n    f.status = \"in-progress\"\n    f.agent_assigned = \"claude\"\n    f.steps[0].completed = True\n</code></pre></p> <p>Savings: 67% fewer SDK calls (1 vs 3)</p>"},{"location":"PLANNING_WORKFLOW/#pattern-3-parallel-dispatch","title":"Pattern 3: Parallel Dispatch","text":"<p>Before (Sequential Task Spawning): <pre><code># Spawn agents one at a time\nagent1 = Task(prompt=\"Work on feature 1\", ...)\n# Wait for response\n\nagent2 = Task(prompt=\"Work on feature 2\", ...)\n# Wait for response\n\nagent3 = Task(prompt=\"Work on feature 3\", ...)\n# Wait for response\n</code></pre></p> <p>After (Batch Dispatch): <pre><code># Dispatch all at once - TRUE parallelism\ntasks = [\n    Task(\n        subagent_type=\"general-purpose\",\n        prompt=\"Work on feature feat-001: OAuth Integration...\",\n        description=\"feat-001: OAuth\"\n    ),\n    Task(\n        subagent_type=\"general-purpose\",\n        prompt=\"Work on feature feat-002: JWT Service...\",\n        description=\"feat-002: JWT\"\n    ),\n    Task(\n        subagent_type=\"general-purpose\",\n        prompt=\"Work on feature feat-003: User Profiles...\",\n        description=\"feat-003: Profiles\"\n    ),\n]\n# All three execute in parallel!\n</code></pre></p> <p>Savings: 3x speedup (parallel vs sequential)</p>"},{"location":"PLANNING_WORKFLOW/#pattern-4-batch-analytics-queries","title":"Pattern 4: Batch Analytics Queries","text":"<p>Before (Multiple Queries): <pre><code># Query 1\nrecs = sdk.recommend_next_work(agent_count=3)\n\n# Query 2\nbottlenecks = sdk.find_bottlenecks(top_n=3)\n\n# Query 3\nparallel = sdk.get_parallel_work(max_agents=5)\n\n# Query 4\ntrack_progress = sdk.tracks.get_progress(\"track-123\")\n</code></pre></p> <p>After (Combined Context): <pre><code># Get all analytics in one call\ncontext = sdk.get_planning_context(\n    include_recommendations=True,\n    include_bottlenecks=True,\n    include_parallel_work=True,\n    max_agents=5,\n    track_id=\"track-123\"\n)\n\n# Returns combined data structure\nrecs = context['recommendations']\nbottlenecks = context['bottlenecks']\nparallel = context['parallel_work']\ntrack_progress = context['track_progress']\n</code></pre></p> <p>Savings: 75% fewer SDK calls (1 vs 4)</p>"},{"location":"PLANNING_WORKFLOW/#pattern-5-batch-track-creation","title":"Pattern 5: Batch Track Creation","text":"<p>Before (Manual Steps): <pre><code># Step 1: Create track\ntrack = sdk.tracks.create(\"User Authentication\")\n\n# Step 2: Add spec\nspec_path = sdk.tracks.create_spec(\n    track.id,\n    requirements=[\"OAuth\", \"JWT\"],\n    acceptance_criteria=[\"Tests pass\"]\n)\n\n# Step 3: Add plan\nplan_path = sdk.tracks.create_plan(\n    track.id,\n    phases=[(\"Phase 1\", [\"Task 1\", \"Task 2\"])]\n)\n\n# Step 4: Create features\nfor phase, tasks in phases:\n    feature = sdk.features.create(phase) \\\n        .set_track(track.id) \\\n        .save()\n</code></pre></p> <p>After (Integrated Method): <pre><code># All-in-one track creation\ntrack_info = sdk.create_track_from_plan(\n    title=\"User Authentication\",\n    description=\"OAuth 2.0 + JWT system\",\n    requirements=[\n        (\"OAuth 2.0 integration\", \"must-have\"),\n        (\"JWT token management\", \"must-have\")\n    ],\n    phases=[\n        (\"Phase 1: OAuth\", [\"Configure provider (2h)\", \"Implement callback (2h)\"]),\n        (\"Phase 2: JWT\", [\"Create service (3h)\", \"Add middleware (2h)\"])\n    ],\n    auto_create_features=True\n)\n\n# Returns complete track with spec, plan, and features\n</code></pre></p> <p>Savings: Single integrated call vs 10+ manual calls</p>"},{"location":"PLANNING_WORKFLOW/#performance-metrics","title":"Performance Metrics","text":"<p>Comparison of workflow approaches showing quantifiable improvements.</p>"},{"location":"PLANNING_WORKFLOW/#metrics-table-traditional-vs-optimal-workflow","title":"Metrics Table: Traditional vs Optimal Workflow","text":"Metric Traditional Approach Optimal 3-Phase Workflow Improvement Planning Time Ad-hoc (varies wildly) 3-7 hours (predictable) 40% reduction Context Rebuilds 8-15 per session 2-4 per session 70% reduction Failed Tool Calls 15-25% retry rate 5-10% retry rate 60% reduction API Calls 20-30 per feature 5-8 per feature 70% fewer calls Implementation Errors 3-5 major issues 0-1 major issues 80% reduction Documentation Quality Often missing/incomplete Complete and current 100% improvement"},{"location":"PLANNING_WORKFLOW/#session-health-comparison","title":"Session Health Comparison","text":"<p>Traditional Workflow: <pre><code>Session Health Metrics:\n  Overall Score: 0.45 (Poor)\n  Retry Rate: 28%\n  Context Rebuilds: 12\n  Tool Diversity: 0.25\n  Anti-patterns: 8\n\nIssues:\n  - Repeated Read-Read-Read patterns (4 instances)\n  - Multiple Edit-Edit-Edit chains (3 instances)\n  - High drift from initial task (avg 0.72)\n  - Frequent tool failures (18 total)\n</code></pre></p> <p>Optimal 3-Phase Workflow: <pre><code>Session Health Metrics:\n  Overall Score: 0.82 (Excellent)\n  Retry Rate: 8%\n  Context Rebuilds: 3\n  Tool Diversity: 0.68\n  Anti-patterns: 1\n\nImprovements:\n  - Grep \u2192 Read \u2192 Edit pattern (efficient)\n  - Pre-cached shared context (no redundant reads)\n  - Clear task boundaries (low drift: 0.15)\n  - Batch operations (fewer API calls)\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#time-breakdown-comparison","title":"Time Breakdown Comparison","text":"<p>Traditional (Total: 8-12 hours) <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Unstructured Implementation             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Trial &amp; error:         4-6h (40-50%)   \u2502\n\u2502 Context rebuilding:    2-3h (20-25%)   \u2502\n\u2502 Implementation:        2-4h (20-35%)   \u2502\n\u2502 Bug fixes:            1-2h (10-15%)    \u2502\n\u2502 Documentation:        0-1h (0-10%)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Optimal 3-Phase (Total: 5-7 hours) <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Structured 3-Phase Workflow             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Phase 1 Research:      2-3h (35-40%)   \u2502\n\u2502 Phase 2 Design:        1-2h (15-25%)   \u2502\n\u2502 Phase 3 Implement:     2-3h (35-40%)   \u2502\n\u2502 Bug fixes:            0-1h (0-10%)     \u2502\n\u2502 Documentation:       included in phases \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nTime savings: 30-40% (3-5 hours saved)\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#cost-comparison-token-usage","title":"Cost Comparison (Token Usage)","text":"Operation Traditional Optimal Savings Planning phase 150K tokens (ad-hoc) 80K tokens (structured) 47% Implementation 200K tokens (trial/error) 120K tokens (planned) 40% Total per feature 350K tokens 200K tokens 43% <p>For 10 features: 1.5M tokens saved</p>"},{"location":"PLANNING_WORKFLOW/#success-rate-comparison","title":"Success Rate Comparison","text":"Outcome Traditional Optimal 3-Phase First implementation works 30% 75% Requires major refactor 40% 10% Abandoned/blocked 15% 3% Completed as specified 55% 87%"},{"location":"PLANNING_WORKFLOW/#htmlgraph-integration","title":"HtmlGraph Integration","text":"<p>How the 3-phase optimal workflow integrates with HtmlGraph's spike/track/feature system.</p>"},{"location":"PLANNING_WORKFLOW/#mapping-phases-to-htmlgraph-features","title":"Mapping Phases to HtmlGraph Features","text":"Optimal Workflow Phase HtmlGraph Feature Purpose Phase 1: Research Planning Spike Document findings, constraints, options Phase 2: Design Track + Spec + Plan Capture architecture decision and implementation phases Phase 3: Implement Features + Sessions Execute plan with tracking"},{"location":"PLANNING_WORKFLOW/#combined-workflow","title":"Combined Workflow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  OPTIMAL WORKFLOW + HTMLGRAPH INTEGRATION                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                           \u2502\n\u2502  PHASE 1: RESEARCH                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 HtmlGraph: Create planning spike         \u2502            \u2502\n\u2502  \u2502 Tool: Explore subagent (codebase)        \u2502            \u2502\n\u2502  \u2502 Output: Spike with findings              \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                      \u2502                                    \u2502\n\u2502                      \u25bc                                    \u2502\n\u2502  PHASE 2: DESIGN                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 HtmlGraph: Create track from spike       \u2502            \u2502\n\u2502  \u2502 Tool: Plan subagent (architecture)       \u2502            \u2502\n\u2502  \u2502 Output: Track + Spec + Plan              \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                      \u2502                                    \u2502\n\u2502                      \u25bc                                    \u2502\n\u2502  PHASE 3: IMPLEMENT                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 HtmlGraph: Create features from track    \u2502            \u2502\n\u2502  \u2502 Tool: General-purpose agents             \u2502            \u2502\n\u2502  \u2502 Output: Completed features + Sessions    \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#complete-example-research-design-implement","title":"Complete Example: Research \u2192 Design \u2192 Implement","text":"<p>Step 1: Research Phase (Create Spike) <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get recommendations first\nrecs = sdk.recommend_next_work(agent_count=1)\ntop_rec = recs[0]  # \"User Authentication System\"\n\n# Create planning spike for research\nplan = sdk.smart_plan(\n    top_rec['title'],\n    create_spike=True,\n    timebox_hours=4.0\n)\nspike_id = plan['spike_id']\n\n# Use Explore subagent for codebase research\n# (agent completes spike research steps)\n\n# Document findings\nwith sdk.spikes.edit(spike_id) as spike:\n    spike.findings = \"\"\"\nResearch Complete:\n- Current: Redis sessions, FastAPI, PostgreSQL\n- Options: Auth0 OAuth, Custom OAuth, JWT-only\n- Recommendation: Auth0 for security + speed\n- Constraints: Backward compatibility required\n    \"\"\"\n</code></pre></p> <p>Step 2: Design Phase (Create Track) <pre><code># Convert spike to track with architecture plan\ntrack_info = sdk.create_track_from_plan(\n    title=\"User Authentication System\",\n    description=\"OAuth 2.0 + JWT authentication\",\n    spike_id=spike_id,\n    priority=\"high\",\n    requirements=[\n        (\"OAuth 2.0 with Auth0\", \"must-have\"),\n        (\"JWT token management\", \"must-have\"),\n        (\"User profile integration\", \"must-have\"),\n        (\"Backward compatibility\", \"must-have\"),\n    ],\n    phases=[\n        (\"Phase 1: OAuth Setup\", [\n            \"Configure Auth0 tenant (2h)\",\n            \"Implement callback handler (2h)\",\n            \"Add state verification (1h)\"\n        ]),\n        (\"Phase 2: JWT Integration\", [\n            \"Create token service (3h)\",\n            \"Add refresh endpoint (2h)\",\n            \"Implement middleware (2h)\"\n        ]),\n        (\"Phase 3: User Integration\", [\n            \"Create profile endpoints (3h)\",\n            \"Link to existing users (2h)\",\n            \"Write integration tests (3h)\"\n        ])\n    ]\n)\n\ntrack_id = track_info['track_id']\n</code></pre></p> <p>Step 3: Implement Phase (Create &amp; Execute Features) <pre><code># Create features for each phase\noauth_feat = sdk.features.create(\"OAuth Setup\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Configure Auth0 tenant\",\n        \"Implement callback handler\",\n        \"Add state verification\"\n    ]) \\\n    .save()\n\njwt_feat = sdk.features.create(\"JWT Integration\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create token service\",\n        \"Add refresh endpoint\",\n        \"Implement middleware\"\n    ]) \\\n    .add_edge(Edge(target_id=oauth_feat.id, relationship=\"depends_on\")) \\\n    .save()\n\nprofile_feat = sdk.features.create(\"User Integration\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create profile endpoints\",\n        \"Link to existing users\",\n        \"Write integration tests\"\n    ]) \\\n    .add_edge(Edge(target_id=jwt_feat.id, relationship=\"depends_on\")) \\\n    .save()\n\n# Execute using general-purpose agents\n# (agents implement features and mark steps complete)\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#quick-reference","title":"Quick Reference","text":""},{"location":"PLANNING_WORKFLOW/#when-to-use-which-workflow","title":"When to Use Which Workflow?","text":"Scenario Use Workflow Rationale Complex new feature Both: 3-Phase + HtmlGraph Need research, architecture, and tracking Simple bug fix Neither Just fix, test, commit Explore codebase 3-Phase only Phase 1 research with Explore agent Multi-feature initiative Both: 3-Phase + HtmlGraph Track coordinates features, phases guide execution One-off task 3-Phase only Lightweight structure without HtmlGraph overhead"},{"location":"PLANNING_WORKFLOW/#subagent-selection-by-phase","title":"Subagent Selection by Phase","text":"Phase Primary Subagent Alternative Example Research Explore General-purpose \"Find all auth implementations\" Design Plan General-purpose \"Design OAuth integration\" Implement General-purpose N/A \"Implement callback handler\""},{"location":"PLANNING_WORKFLOW/#batch-operations-checklist","title":"Batch Operations Checklist","text":"<ul> <li> Use fluent API for feature creation (<code>.create().set_priority().add_steps().save()</code>)</li> <li> Combine multiple edits in single <code>with sdk.features.edit()</code> block</li> <li> Dispatch parallel tasks in single message (list of Task calls)</li> <li> Use <code>sdk.get_planning_context()</code> for combined analytics queries</li> <li> Use <code>sdk.create_track_from_plan()</code> for integrated track creation</li> </ul>"},{"location":"PLANNING_WORKFLOW/#the-planning-flow","title":"The Planning Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. STRATEGIC ANALYSIS                                       \u2502\n\u2502  Get recommendations from dependency analytics               \u2502\n\u2502  \u2192 /htmlgraph:recommend                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. START PLANNING                                           \u2502\n\u2502  Create spike or track depending on complexity               \u2502\n\u2502  \u2192 /htmlgraph:plan \"description\"                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502                     \u2502\n      \u25bc                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SPIKE PATH  \u2502    \u2502  TRACK PATH  \u2502\n\u2502  (research)  \u2502    \u2502  (direct)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                   \u2502\n       \u25bc                   \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  3. RESEARCH \u2502           \u2502\n\u2502  Complete    \u2502           \u2502\n\u2502  spike steps \u2502           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n       \u2502                   \u2502\n       \u25bc                   \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  4. CREATE   \u2502           \u2502\n\u2502  TRACK       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502  from plan   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  5. CREATE   \u2502\n\u2502  FEATURES    \u2502\n\u2502  from track  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  6. IMPLEMENT\u2502\n\u2502  Execute     \u2502\n\u2502  features    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#detailed-workflow","title":"Detailed Workflow","text":""},{"location":"PLANNING_WORKFLOW/#step-1-get-recommendations","title":"Step 1: Get Recommendations","text":"<p>Use strategic analytics to identify what to work on:</p> <p>Slash Command: <pre><code>/htmlgraph:recommend\n</code></pre></p> <p>SDK: <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get recommendations\nrecs = sdk.recommend_next_work(agent_count=3)\nbottlenecks = sdk.find_bottlenecks(top_n=3)\n\n# Review\nfor rec in recs:\n    print(f\"{rec['title']} (score: {rec['score']})\")\n    print(f\"Reasons: {rec['reasons']}\")\n</code></pre></p> <p>Output: <pre><code>Top 3 Recommendations:\n1. User Authentication (score: 10.0)\n   - High priority\n   - Directly unblocks 2 features\n2. Database Migration (score: 8.5)\n   - Critical bottleneck\n   - Blocks 5 features\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#step-2a-planning-spike-for-complex-work","title":"Step 2A: Planning Spike (For Complex Work)","text":"<p>For non-trivial work, start with a research spike:</p> <p>Slash Command: <pre><code>/htmlgraph:plan \"User authentication system\"\n</code></pre></p> <p>SDK: <pre><code>plan = sdk.smart_plan(\n    \"User authentication system\",\n    create_spike=True,\n    timebox_hours=4.0\n)\n\nprint(f\"Created spike: {plan['spike_id']}\")\nprint(f\"Context: {plan['project_context']}\")\n</code></pre></p> <p>What This Creates: - Spike with ID <code>spike-YYYYMMDD-HHMMSS</code> - Standard planning steps:   1. Research existing solutions   2. Define requirements   3. Design architecture   4. Identify dependencies   5. Create implementation plan - Auto-started and assigned to you - 4-hour timebox</p>"},{"location":"PLANNING_WORKFLOW/#step-2b-direct-track-for-simple-work","title":"Step 2B: Direct Track (For Simple Work)","text":"<p>If you already know the approach, skip spike:</p> <p>Slash Command: <pre><code>/htmlgraph:plan \"Fix login bug\" --no-spike\n</code></pre></p> <p>SDK: <pre><code>track_info = sdk.smart_plan(\n    \"Fix login bug\",\n    create_spike=False\n)\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#step-3-complete-spike-research-phase","title":"Step 3: Complete Spike (Research Phase)","text":"<p>Work through the spike steps:</p> <p>SDK: <pre><code># Complete steps as you research\nwith sdk.spikes.edit(\"spike-123\") as spike:\n    spike.steps[0].completed = True  # Research done\n    spike.steps[1].completed = True  # Requirements defined\n\n# Document findings\nwith sdk.spikes.edit(\"spike-123\") as spike:\n    spike.findings = \"\"\"\n    Findings:\n    - OAuth 2.0 with Google/GitHub providers\n    - JWT for session management\n    - Redis for token storage\n\n    Decision: Use Auth0 for OAuth, custom JWT signing\n    \"\"\"\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#step-4-create-track-from-spike","title":"Step 4: Create Track from Spike","text":"<p>Convert spike findings into a track with spec and plan:</p> <p>SDK: <pre><code>track_info = sdk.create_track_from_plan(\n    title=\"User Authentication System\",\n    description=\"OAuth 2.0 + JWT authentication\",\n    spike_id=\"spike-123\",\n    priority=\"high\",\n    requirements=[\n        (\"OAuth 2.0 integration with Google/GitHub\", \"must-have\"),\n        (\"JWT token generation and validation\", \"must-have\"),\n        (\"Token refresh mechanism\", \"must-have\"),\n        (\"Password reset flow\", \"should-have\")\n    ],\n    phases=[\n        (\"Phase 1: OAuth Setup\", [\n            \"Configure OAuth providers (2h)\",\n            \"Implement OAuth callback handler (2h)\",\n            \"Add state verification (1h)\"\n        ]),\n        (\"Phase 2: JWT Integration\", [\n            \"Create JWT signing service (2h)\",\n            \"Add token refresh endpoint (1.5h)\",\n            \"Implement middleware (2h)\"\n        ]),\n        (\"Phase 3: User Management\", [\n            \"Create user profile endpoint (3h)\",\n            \"Add password reset flow (4h)\",\n            \"Write integration tests (3h)\"\n        ])\n    ]\n)\n\nprint(f\"Track created: {track_info['track_id']}\")\nprint(f\"Has spec: {track_info['has_spec']}\")\nprint(f\"Has plan: {track_info['has_plan']}\")\n</code></pre></p> <p>What This Creates: - Track with ID <code>track-YYYYMMDD-HHMMSS</code> - Spec file with requirements and acceptance criteria - Plan file with phases and estimated tasks - Reference to planning spike</p>"},{"location":"PLANNING_WORKFLOW/#step-5-create-features-from-track","title":"Step 5: Create Features from Track","text":"<p>Break down track phases into features:</p> <p>SDK: <pre><code>track_id = \"track-20251222-120000\"\n\n# Create features from each phase\noauth_feature = sdk.features.create(\"OAuth Integration\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Configure OAuth providers\",\n        \"Implement OAuth callback handler\",\n        \"Add state verification\"\n    ]) \\\n    .save()\n\njwt_feature = sdk.features.create(\"JWT Token Management\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create JWT signing service\",\n        \"Add token refresh endpoint\",\n        \"Implement middleware\"\n    ]) \\\n    .save()\n\n# Link dependencies if needed\nwith sdk.features.edit(jwt_feature.id) as f:\n    f.add_edge(Edge(\n        target_id=oauth_feature.id,\n        relationship=\"depends_on\"\n    ))\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#step-6-implement-features","title":"Step 6: Implement Features","text":"<p>Execute the plan:</p> <p>SDK: <pre><code># Start first feature\nwith sdk.features.edit(oauth_feature.id) as f:\n    f.status = \"in-progress\"\n    f.agent_assigned = \"claude\"\n\n# Work on it, mark steps complete\nwith sdk.features.edit(oauth_feature.id) as f:\n    f.steps[0].completed = True\n\n# Complete when done\nwith sdk.features.edit(oauth_feature.id) as f:\n    f.status = \"done\"\n</code></pre></p>"},{"location":"PLANNING_WORKFLOW/#slash-commands-reference","title":"Slash Commands Reference","text":""},{"location":"PLANNING_WORKFLOW/#htmlgraphrecommend","title":"<code>/htmlgraph:recommend</code>","text":"<p>Get strategic recommendations on what to work on.</p> <pre><code># Get top 3 recommendations\n/htmlgraph:recommend\n\n# Get more recommendations\n/htmlgraph:recommend --count 5\n\n# Skip bottleneck check\n/htmlgraph:recommend --no-check-bottlenecks\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#htmlgraphplan","title":"<code>/htmlgraph:plan</code>","text":"<p>Start planning new work (creates spike or track).</p> <pre><code># Create planning spike (recommended)\n/htmlgraph:plan \"User authentication system\"\n\n# With custom timebox\n/htmlgraph:plan \"Real-time notifications\" --timebox 3\n\n# Create track directly (skip spike)\n/htmlgraph:plan \"Simple bug fix\" --no-spike\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#htmlgraphspike","title":"<code>/htmlgraph:spike</code>","text":"<p>Create a research/planning spike directly.</p> <pre><code># Basic spike\n/htmlgraph:spike \"Research caching strategies\"\n\n# With context\n/htmlgraph:spike \"Investigate OAuth providers\" --context \"Need Google + GitHub support\"\n\n# With custom timebox\n/htmlgraph:spike \"Plan data migration\" --timebox 2\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#complete-example","title":"Complete Example","text":"<p>Here's a complete workflow from recommendation to implementation:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# 1. Get recommendations\nrecs = sdk.recommend_next_work(agent_count=1)\ntop = recs[0]\nprint(f\"Recommendation: {top['title']}\")\n\n# 2. Start planning spike\nplan = sdk.smart_plan(\n    top['title'],\n    create_spike=True,\n    timebox_hours=4.0\n)\nspike_id = plan['spike_id']\n\n# 3. Complete spike research\n# (agent does research, completes steps)\nwith sdk.spikes.edit(spike_id) as spike:\n    spike.findings = \"Use OAuth 2.0 + JWT\"\n    spike.decision = \"Implement with Auth0\"\n    for step in spike.steps:\n        step.completed = True\n\n# 4. Create track from spike\ntrack_info = sdk.create_track_from_plan(\n    title=top['title'],\n    description=\"Based on spike findings\",\n    spike_id=spike_id,\n    requirements=[\n        \"OAuth integration\",\n        \"JWT tokens\",\n        \"Token refresh\"\n    ],\n    phases=[\n        (\"Phase 1\", [\"Task 1 (2h)\", \"Task 2 (3h)\"]),\n        (\"Phase 2\", [\"Task 3 (4h)\", \"Task 4 (2h)\"])\n    ]\n)\n\n# 5. Create features\nfor phase_name, tasks in [(\"Phase 1\", [\"Task 1\", \"Task 2\"]), (\"Phase 2\", [\"Task 3\", \"Task 4\"])]:\n    feature = sdk.features.create(phase_name) \\\n        .set_track(track_info['track_id']) \\\n        .add_steps(tasks) \\\n        .save()\n\n# 6. Start implementation\nfirst_feature = sdk.features.where(track=track_info['track_id'], status=\"todo\")[0]\nwith sdk.features.edit(first_feature.id) as f:\n    f.status = \"in-progress\"\n</code></pre>"},{"location":"PLANNING_WORKFLOW/#best-practices","title":"Best Practices","text":"<ol> <li>Always check recommendations first - Don't guess what's important</li> <li>Use spikes for complex work - Timebox research before committing</li> <li>Document spike findings - Capture decisions and reasoning</li> <li>Link everything - Spike \u2192 Track \u2192 Features maintains context</li> <li>Track dependencies - Use <code>depends_on</code> edges between features</li> <li>Complete steps incrementally - Mark progress as you go</li> </ol>"},{"location":"PLANNING_WORKFLOW/#platform-availability","title":"Platform Availability","text":"<p>All commands work on: - \u2705 Claude Code (<code>/htmlgraph:command</code>) - \u2705 Codex (via slash commands) - \u2705 Gemini (via extension commands)</p>"},{"location":"PLANNING_WORKFLOW/#see-also","title":"See Also","text":"<ul> <li>Agent Strategic Planning - Analytics API</li> <li>Track Builder Guide - Creating tracks</li> <li>SDK Documentation - Complete SDK reference</li> <li>Command Definitions - DRY command system</li> </ul>"},{"location":"PLUGIN_SYNC/","title":"Claude Plugin Sync Strategy","text":""},{"location":"PLUGIN_SYNC/#source-of-truth-packagesclaude-plugin","title":"Source of Truth: <code>packages/claude-plugin/</code>","text":"<p>The HtmlGraph project maintains a single source of truth for Claude Code plugin configuration to enable proper dogfooding and ensure consistency between development and distribution.</p>"},{"location":"PLUGIN_SYNC/#why-sync","title":"Why Sync?","text":"<p>Dogfooding Principle: We use exactly what we ship.</p> <ul> <li><code>.claude/</code> directory = local development environment</li> <li><code>packages/claude-plugin/</code> = distributed plugin package</li> <li>Both MUST have identical capabilities (hooks, skills, configs)</li> </ul>"},{"location":"PLUGIN_SYNC/#directory-structure","title":"Directory Structure","text":"<pre><code>packages/claude-plugin/          # SOURCE OF TRUTH (distributed to users)\n\u251c\u2500\u2500 hooks/\n\u2502   \u251c\u2500\u2500 hooks.json              # Plugin hook configuration\n\u2502   \u2514\u2500\u2500 scripts/\n\u2502       \u251c\u2500\u2500 session-start.py\n\u2502       \u251c\u2500\u2500 session-end.py\n\u2502       \u251c\u2500\u2500 user-prompt-submit.py\n\u2502       \u251c\u2500\u2500 track-event.py\n\u2502       \u251c\u2500\u2500 validate-work.py\n\u2502       \u251c\u2500\u2500 orchestrator-reflect.py\n\u2502       \u2514\u2500\u2500 link-activities.py\n\u251c\u2500\u2500 skills/\n\u2502   \u251c\u2500\u2500 htmlgraph-tracker/\n\u2502   \u251c\u2500\u2500 htmlgraph-coder/\n\u2502   \u251c\u2500\u2500 htmlgraph-explorer/\n\u2502   \u251c\u2500\u2500 htmlgraph-orchestrator/\n\u2502   \u251c\u2500\u2500 parallel-orchestrator/\n\u2502   \u2514\u2500\u2500 strategic-planning/\n\u2514\u2500\u2500 config/\n    \u251c\u2500\u2500 validation-config.json\n    \u251c\u2500\u2500 drift-config.json\n    \u2514\u2500\u2500 classification-prompt.md\n\n.claude/                         # SYNCED FROM PLUGIN (local dev)\n\u251c\u2500\u2500 hooks/\n\u2502   \u251c\u2500\u2500 hooks.json              # Synced from plugin\n\u2502   \u251c\u2500\u2500 session-start.sh        # Local wrapper (preserved)\n\u2502   \u251c\u2500\u2500 protect-htmlgraph.sh    # Local wrapper (preserved)\n\u2502   \u2514\u2500\u2500 scripts/                # Synced from plugin\n\u251c\u2500\u2500 skills/                     # Synced from plugin\n\u251c\u2500\u2500 config/                     # Synced from plugin\n\u2514\u2500\u2500 settings.json               # Local settings with synced hook references\n</code></pre>"},{"location":"PLUGIN_SYNC/#sync-tool-usage","title":"Sync Tool Usage","text":""},{"location":"PLUGIN_SYNC/#check-sync-status","title":"Check Sync Status","text":"<pre><code># Check if files are in sync\nuv run python scripts/sync_plugin_to_local.py --check\n\n# Exit code 0 = in sync\n# Exit code 1 = out of sync\n</code></pre>"},{"location":"PLUGIN_SYNC/#preview-sync-changes","title":"Preview Sync Changes","text":"<pre><code># Dry run (show what would change)\nuv run python scripts/sync_plugin_to_local.py --dry-run\n</code></pre>"},{"location":"PLUGIN_SYNC/#perform-sync","title":"Perform Sync","text":"<pre><code># Sync plugin \u2192 .claude\nuv run python scripts/sync_plugin_to_local.py\n</code></pre>"},{"location":"PLUGIN_SYNC/#what-gets-synced","title":"What Gets Synced","text":"<p>\u2705 Synced from Plugin: - All hook scripts (<code>hooks/scripts/*.py</code>) - Hook configuration (<code>hooks/hooks.json</code>) - All skills (<code>skills/*/SKILL.md</code>) - All config files (<code>config/*.json</code>, <code>config/*.md</code>)</p> <p>\u26a0\ufe0f Preserved in .claude (Local Only): - <code>.claude/settings.json</code> - Local settings with project-specific paths - <code>.claude/hooks/session-start.sh</code> - Shell wrapper for session start - <code>.claude/hooks/protect-htmlgraph.sh</code> - Local protection hook</p> <p>\u274c Excluded: - <code>__pycache__</code> directories - <code>.pyc</code> files</p>"},{"location":"PLUGIN_SYNC/#workflow-integration","title":"Workflow Integration","text":""},{"location":"PLUGIN_SYNC/#before-committing-plugin-changes","title":"Before Committing Plugin Changes","text":"<pre><code># 1. Make changes in packages/claude-plugin/\nvim packages/claude-plugin/hooks/scripts/session-start.py\n\n# 2. Sync to local for testing\nuv run python scripts/sync_plugin_to_local.py\n\n# 3. Test locally with .claude/ configuration\n# (hooks will run from .claude/ during development)\n\n# 4. Commit both plugin and synced .claude changes\ngit add packages/claude-plugin/ .claude/\ngit commit -m \"feat: enhance session tracking\"\n</code></pre>"},{"location":"PLUGIN_SYNC/#before-deployment","title":"Before Deployment","text":"<pre><code># Verify sync before publishing plugin\nuv run python scripts/sync_plugin_to_local.py --check\n\n# Should show \"\u2705 All files are in sync!\"\n</code></pre>"},{"location":"PLUGIN_SYNC/#cicd-integration","title":"CI/CD Integration","text":"<p>Add to GitHub Actions or pre-commit hooks:</p> <pre><code># .github/workflows/test.yml\n- name: Check Plugin Sync\n  run: |\n    uv run python scripts/sync_plugin_to_local.py --check\n    if [ $? -ne 0 ]; then\n      echo \"\u274c Plugin and .claude are out of sync!\"\n      echo \"Run: uv run python scripts/sync_plugin_to_local.py\"\n      exit 1\n    fi\n</code></pre>"},{"location":"PLUGIN_SYNC/#path-translation","title":"Path Translation","text":"<p>The sync tool automatically translates paths between plugin and local contexts:</p> <p>Plugin (<code>hooks/hooks.json</code>): <pre><code>{\n  \"command\": \"uv run \\\"${CLAUDE_PLUGIN_ROOT}/hooks/scripts/session-start.py\\\"\"\n}\n</code></pre></p> <p>Local (<code>.claude/settings.json</code>): <pre><code>{\n  \"command\": \"uv run $CLAUDE_PROJECT_DIR/.claude/hooks/scripts/session-start.py\"\n}\n</code></pre></p> <p>The synced files remain unchanged; only <code>.claude/settings.json</code> uses project-specific paths.</p>"},{"location":"PLUGIN_SYNC/#making-changes","title":"Making Changes","text":""},{"location":"PLUGIN_SYNC/#to-addmodify-a-hook-script","title":"To Add/Modify a Hook Script","text":"<ol> <li>Edit in <code>packages/claude-plugin/hooks/scripts/</code></li> <li>Run <code>uv run python scripts/sync_plugin_to_local.py</code></li> <li>Test locally</li> <li>Commit both directories</li> </ol>"},{"location":"PLUGIN_SYNC/#to-add-a-new-skill","title":"To Add a New Skill","text":"<ol> <li>Create in <code>packages/claude-plugin/skills/new-skill/SKILL.md</code></li> <li>Run <code>uv run python scripts/sync_plugin_to_local.py</code></li> <li>Test with <code>/skill new-skill</code></li> <li>Commit both directories</li> </ol>"},{"location":"PLUGIN_SYNC/#to-update-config","title":"To Update Config","text":"<ol> <li>Edit in <code>packages/claude-plugin/config/</code></li> <li>Run <code>uv run python scripts/sync_plugin_to_local.py</code></li> <li>Test functionality</li> <li>Commit both directories</li> </ol>"},{"location":"PLUGIN_SYNC/#troubleshooting","title":"Troubleshooting","text":""},{"location":"PLUGIN_SYNC/#sync-shows-changes-after-fresh-sync","title":"Sync Shows Changes After Fresh Sync","text":"<p>Problem: Running sync twice shows changes on second run.</p> <p>Solution: Check for file permission issues or encoding differences.</p> <pre><code># Compare specific files\ndiff -u .claude/hooks/scripts/session-start.py \\\n        packages/claude-plugin/hooks/scripts/session-start.py\n</code></pre>"},{"location":"PLUGIN_SYNC/#local-changes-getting-overwritten","title":"Local Changes Getting Overwritten","text":"<p>Problem: Made changes in <code>.claude/</code> and sync overwrote them.</p> <p>Solution: <code>.claude/</code> is NOT the source of truth. Make changes in <code>packages/claude-plugin/</code> instead.</p> <pre><code># DON'T: Edit in .claude\nvim .claude/hooks/scripts/session-start.py  # \u274c Will be overwritten\n\n# DO: Edit in plugin\nvim packages/claude-plugin/hooks/scripts/session-start.py  # \u2705 Source of truth\nuv run python scripts/sync_plugin_to_local.py\n</code></pre>"},{"location":"PLUGIN_SYNC/#sync-fails-during-ci","title":"Sync Fails During CI","text":"<p>Problem: CI shows sync failure but local works.</p> <p>Solution: Ensure both directories are committed to git.</p> <pre><code># Verify git status\ngit status\n\n# Both should be clean or have matching changes\ngit add packages/claude-plugin/ .claude/\ngit commit -m \"sync: update plugin and local config\"\n</code></pre>"},{"location":"PLUGIN_SYNC/#key-principles","title":"Key Principles","text":"<ol> <li><code>packages/claude-plugin/</code> is the source of truth - Always edit here first</li> <li>Sync before testing - Ensure <code>.claude/</code> matches plugin for accurate testing</li> <li>Sync before deployment - Verify consistency before publishing</li> <li>Commit both - Always commit plugin and synced .claude together</li> <li>Test locally - Use <code>.claude/</code> to dogfood exactly what users will get</li> </ol>"},{"location":"PLUGIN_SYNC/#related-documentation","title":"Related Documentation","text":"<ul> <li>Plugin README - Plugin installation and usage</li> <li>Deploy Script - Deployment automation</li> <li>CLAUDE.md - Project documentation</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/","title":"Pydantic Integration Guide","text":""},{"location":"PYDANTIC_INTEGRATION/#overview","title":"Overview","text":"<p>Phase 1 of HtmlGraph implementation uses Pydantic v2 models for type-safe CLI argument validation. This ensures all CLI inputs are validated before being passed to SDK operations.</p>"},{"location":"PYDANTIC_INTEGRATION/#why-pydantic","title":"Why Pydantic?","text":"<ul> <li>Type Safety: Static typing for CLI arguments at the Pydantic model level</li> <li>Validation: Automatic validation with clear error messages</li> <li>Whitespace Handling: Automatic stripping of leading/trailing whitespace</li> <li>Defaults: Sensible defaults for optional fields</li> <li>Settings Integration: Support for environment variables and .env files via pydantic-settings</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#using-pydantic-models","title":"Using Pydantic Models","text":""},{"location":"PYDANTIC_INTEGRATION/#feature-commands","title":"Feature Commands","text":"<pre><code>from htmlgraph.pydantic_models import FeatureCreateInput\n\n# Valid input\ninput = FeatureCreateInput(\n    title=\"New Feature\",\n    priority=\"high\",\n    description=\"Feature description\"\n)\n\n# Invalid input - raises ValidationError\ninput = FeatureCreateInput(title=\"\")  # Title required\ninput = FeatureCreateInput(title=\"x\" * 201)  # Max 200 characters\ninput = FeatureCreateInput(priority=\"critical\")  # Invalid priority\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#session-commands","title":"Session Commands","text":"<pre><code>from htmlgraph.pydantic_models import SessionStartInput, SessionEndInput\n\n# Start session with minimal input\nsession_input = SessionStartInput()\n\n# Start with all fields\nsession_input = SessionStartInput(\n    session_id=\"sess-123\",\n    title=\"My Session\",\n    agent=\"claude\"\n)\n\n# End session\nend_input = SessionEndInput(\n    session_id=\"sess-123\",\n    notes=\"Work completed\",\n    recommend=\"Review PR\",\n    blocker=[\"missing dependency\"]\n)\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#model-reference","title":"Model Reference","text":""},{"location":"PYDANTIC_INTEGRATION/#featurecreateinput","title":"FeatureCreateInput","text":"<ul> <li><code>title</code>: str (1-200 chars, required, whitespace stripped)</li> <li><code>priority</code>: Literal[\"low\", \"medium\", \"high\"] (default: \"medium\")</li> <li><code>description</code>: str | None (max 1000 chars, whitespace stripped)</li> <li><code>steps</code>: int | None (1-50, optional)</li> <li><code>collection</code>: str (default: \"features\")</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#featurestartinput-featurecompleteinput-featureprimaryinput-featureclaiminput-featurereleaseinput","title":"FeatureStartInput, FeatureCompleteInput, FeaturePrimaryInput, FeatureClaimInput, FeatureReleaseInput","text":"<ul> <li><code>feature_id</code>: str (required, min 1 char, whitespace stripped)</li> <li><code>collection</code>: str (default: \"features\")</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#sessionstartinput","title":"SessionStartInput","text":"<ul> <li><code>session_id</code>: str | None (optional, whitespace stripped)</li> <li><code>title</code>: str | None (max 500 chars, optional)</li> <li><code>agent</code>: str | None (optional)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#sessionendinput","title":"SessionEndInput","text":"<ul> <li><code>session_id</code>: str (required, min 1 char, whitespace stripped)</li> <li><code>notes</code>: str | None (max 2000 chars, optional)</li> <li><code>recommend</code>: str | None (max 500 chars, optional)</li> <li><code>blocker</code>: list[str] | None (optional)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#sessionlistinput","title":"SessionListInput","text":"<ul> <li><code>status</code>: Literal[\"active\", \"ended\"] | None (optional filter)</li> <li><code>limit</code>: int (default: 20, min: 1, max: 100)</li> <li><code>offset</code>: int (default: 0, min: 0)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#activitytrackinput","title":"ActivityTrackInput","text":"<ul> <li><code>tool</code>: str (required, 1-100 chars, whitespace stripped)</li> <li><code>summary</code>: str (required, 1-500 chars, whitespace stripped)</li> <li><code>files</code>: list[str] | None (optional)</li> <li><code>session</code>: str | None (optional, auto-detected if not provided)</li> <li><code>failed</code>: bool (default: False)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#spikecreateinput","title":"SpikeCreateInput","text":"<ul> <li><code>title</code>: str (required, 1-200 chars, whitespace stripped)</li> <li><code>findings</code>: str | None (max 5000 chars, optional)</li> <li><code>priority</code>: Literal[\"low\", \"medium\", \"high\"] (default: \"medium\")</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#trackcreateinput","title":"TrackCreateInput","text":"<ul> <li><code>title</code>: str (required, 1-200 chars, whitespace stripped)</li> <li><code>priority</code>: Literal[\"low\", \"medium\", \"high\"] (default: \"medium\")</li> <li><code>description</code>: str | None (max 1000 chars, optional)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#trackspecinput-trackplaninput","title":"TrackSpecInput, TrackPlanInput","text":"<ul> <li><code>track_id</code>: str (required, min 1 char, whitespace stripped)</li> <li><code>title</code>: str (required, 1-200 chars, whitespace stripped)</li> <li><code>content</code>: str | None (max 5000 chars, optional)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#archivecreateinput","title":"ArchiveCreateInput","text":"<ul> <li><code>title</code>: str (required, 1-200 chars, whitespace stripped)</li> <li><code>items</code>: list[str] | None (optional)</li> <li><code>description</code>: str | None (max 1000 chars, optional)</li> </ul>"},{"location":"PYDANTIC_INTEGRATION/#error-handling","title":"Error Handling","text":"<p>Validation errors are displayed with Rich formatting and helpful context:</p> <pre><code>from htmlgraph.pydantic_models import FeatureCreateInput\nfrom pydantic import ValidationError\n\ntry:\n    input = FeatureCreateInput(title=\"\")\nexcept ValidationError as e:\n    # Error message indicates why validation failed\n    print(e)\n    # Output: \"1 validation error for FeatureCreateInput\\ntitle\\n  String should have at least 1 character...\"\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#configuration-management","title":"Configuration Management","text":"<p>HtmlGraph uses <code>pydantic-settings</code> (BaseSettings) for configuration management:</p> <pre><code>from htmlgraph.config import config\n\n# Access configuration\nprint(config.graph_dir)        # ~/.htmlgraph\nprint(config.features_dir)     # ~/.htmlgraph/features\nprint(config.debug)            # False by default\n\n# Configuration from environment variables\n# Set HTMLGRAPH_DEBUG=true to enable debug mode\n# Set HTMLGRAPH_GRAPH_DIR=/path/to/graph for custom graph directory\n\n# Create directories\nconfig.ensure_directories()\n\n# Get config as dictionary\nconfig_dict = config.get_config_dict()\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#cli-integration","title":"CLI Integration","text":"<p>CLI commands use Pydantic models for argument validation:</p> <pre><code># Valid command\nhtmlgraph feature create \"My Feature\" --priority high\n\n# Invalid command (caught by Pydantic validation)\nhtmlgraph feature create \"\"           # Error: title required\nhtmlgraph feature create \"x\" * 201    # Error: title max 200 chars\nhtmlgraph feature start --id \"\"       # Error: feature_id required\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#testing-pydantic-models","title":"Testing Pydantic Models","text":"<p>Comprehensive tests for Pydantic models are in: - <code>tests/python/test_cli_pydantic_models.py</code> - Validation tests - <code>tests/python/test_error_handling.py</code> - Integration tests</p> <p>Run tests with:</p> <pre><code>uv run pytest tests/python/test_cli_pydantic_models.py -v\nuv run pytest tests/python/test_error_handling.py -v\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#configuration-via-environment-variables","title":"Configuration via Environment Variables","text":"<p>All configuration options support environment variables with <code>HTMLGRAPH_</code> prefix:</p> <pre><code>export HTMLGRAPH_GRAPH_DIR=\"/path/to/graph\"\nexport HTMLGRAPH_DEBUG=true\nexport HTMLGRAPH_VERBOSE=true\nexport HTMLGRAPH_LOG_LEVEL=DEBUG\nexport HTMLGRAPH_MAX_SESSIONS=200\n</code></pre> <p>Or use a <code>.env</code> file:</p> <pre><code>HTMLGRAPH_GRAPH_DIR=/path/to/graph\nHTMLGRAPH_DEBUG=true\nHTMLGRAPH_VERBOSE=true\n</code></pre>"},{"location":"PYDANTIC_INTEGRATION/#next-steps","title":"Next Steps","text":"<p>See Phase 2 documentation for: - Command Pattern refactoring - Decorator-based CLI command registration - Dependency injection for SessionManager - Rich output formatting</p>"},{"location":"PYDANTIC_INTEGRATION/#related-files","title":"Related Files","text":"<ul> <li>Source: <code>src/python/htmlgraph/pydantic_models.py</code></li> <li>Config: <code>src/python/htmlgraph/config.py</code></li> <li>Tests: <code>tests/python/test_cli_pydantic_models.py</code></li> <li>Integration: <code>tests/python/test_error_handling.py</code></li> </ul>"},{"location":"QUALITY_GATES/","title":"Quality Gates - Pre-Commit Hooks and Type Safety","text":"<p>HtmlGraph enforces automated quality standards through pre-commit hooks and type checking. This ensures all code merged to <code>main</code> meets strict quality criteria.</p>"},{"location":"QUALITY_GATES/#quick-start","title":"Quick Start","text":""},{"location":"QUALITY_GATES/#install-pre-commit-hooks","title":"Install Pre-Commit Hooks","text":"<pre><code># Install pre-commit framework and hooks\npre-commit install\n\n# Verify hooks are installed\npre-commit run --all-files\n</code></pre>"},{"location":"QUALITY_GATES/#run-checks-before-commit","title":"Run Checks Before Commit","text":"<p>Pre-commit hooks automatically run when you attempt a commit:</p> <pre><code># Try to commit - hooks will run automatically\ngit add .\ngit commit -m \"Your message\"\n\n# If checks fail, fix errors and try again\n# Hooks will re-run on the next commit attempt\n</code></pre>"},{"location":"QUALITY_GATES/#quality-gates-overview","title":"Quality Gates Overview","text":"<p>All commits to HtmlGraph are validated against these gates:</p> Gate Tool Purpose Auto-Fix Formatting Ruff Python code style (PEP 8) \u2705 Yes Type Safety Mypy Static type checking \u274c No (requires manual fix) Linting Ruff Code quality issues \u2705 Yes (most) Tests Pytest All tests must pass \u274c No (requires fix) Whitespace Pre-commit Trailing whitespace, EOF \u2705 Yes File Size Pre-commit Large files detection \u274c No (requires review)"},{"location":"QUALITY_GATES/#gate-details","title":"Gate Details","text":""},{"location":"QUALITY_GATES/#1-ruff-format-auto-fixes","title":"1. Ruff Format (Auto-fixes)","text":"<p>Ensures consistent code formatting across the project.</p> <pre><code># Run manually\nuv run ruff format src/python/htmlgraph/\n\n# Pre-commit runs with --fix flag (auto-corrects)\n</code></pre> <p>Common auto-fixes: - Line length (88 characters) - Quote style (double quotes preferred) - Whitespace around operators - Import sorting</p> <p>Example: <pre><code># Before (fails format check)\nx=1+2\nresult = some_function(  arg1 , arg2  )\n\n# After (auto-fixed)\nx = 1 + 2\nresult = some_function(arg1, arg2)\n</code></pre></p>"},{"location":"QUALITY_GATES/#2-ruff-lint-auto-fixes-most-issues","title":"2. Ruff Lint (Auto-fixes most issues)","text":"<p>Detects code quality problems and style violations.</p> <pre><code># Run manually\nuv run ruff check src/python/htmlgraph/\n\n# Pre-commit runs with --fix flag\n</code></pre> <p>Checked rules: - Unused imports (E401, F401) - Undefined names (F821) - Duplicate code (E501) - Import ordering (I001) - Variable naming (N806, N802)</p> <p>Example: <pre><code># Before (fails lint check)\nimport os\nimport sys\nimport unused_module\nresult = undefined_var\n\n# After (auto-fixed)\nimport os\nimport sys\nresult = some_defined_var\n</code></pre></p>"},{"location":"QUALITY_GATES/#3-mypy-type-checking-manual-fix-required","title":"3. Mypy Type Checking (Manual fix required)","text":"<p>Enforces static type safety - NO AUTO-FIX.</p> <pre><code># Run manually\nuv run mypy src/python/htmlgraph/\n</code></pre> <p>Enforced rules: - All function parameters must have type hints - All function return types must be specified - No untyped function definitions - No <code>Any</code> types without justification</p> <p>Example - FAILS: <pre><code># \u274c Missing parameter type\ndef calculate(x):  # Error: Function is missing a type annotation\n    return x + 1\n\n# \u274c Missing return type\ndef process_data(items: list):  # Error: Function is missing a return type\n    return [item * 2 for item in items]\n\n# \u274c Untyped variable\ndata = fetch_remote_api()  # Error: Need type annotation for \"data\"\n</code></pre></p> <p>Example - PASSES: <pre><code># \u2705 Correct typing\ndef calculate(x: int) -&gt; int:\n    return x + 1\n\ndef process_data(items: list[int]) -&gt; list[int]:\n    return [item * 2 for item in items]\n\nfrom typing import Any\ndata: dict[str, Any] = fetch_remote_api()\n</code></pre></p>"},{"location":"QUALITY_GATES/#4-pytest-manual-fix-required","title":"4. Pytest (Manual fix required)","text":"<p>All tests must pass - NO AUTO-FIX.</p> <pre><code># Run manually\nuv run pytest\n\n# Pre-commit runs all tests\n</code></pre> <p>Test execution: - Located in: <code>tests/python/</code> - Coverage required: \u226580% - Format: pytest standard</p> <p>Example failure: <pre><code>FAILED tests/python/test_sdk.py::test_create_feature - AssertionError: ...\n</code></pre></p> <p>Fix: - Examine test failure - Fix code logic or test expectations - Re-run: <code>uv run pytest</code></p>"},{"location":"QUALITY_GATES/#5-standard-hooks","title":"5. Standard Hooks","text":"<p>Basic file validation.</p> <pre><code># Trailing whitespace\n# End-of-file newlines\n# YAML/JSON validation\n# Merge conflict markers\n# Large file detection (&gt;1MB)\n</code></pre>"},{"location":"QUALITY_GATES/#pre-commit-hook-installation","title":"Pre-Commit Hook Installation","text":""},{"location":"QUALITY_GATES/#first-time-setup","title":"First Time Setup","text":"<pre><code># Install pre-commit framework\npip install pre-commit\n\n# Install hooks from .pre-commit-config.yaml\npre-commit install\n\n# Test on all files\npre-commit run --all-files\n</code></pre>"},{"location":"QUALITY_GATES/#verify-installation","title":"Verify Installation","text":"<pre><code># List installed hooks\npre-commit run --all-files --dry-run\n\n# Show hook configuration\ncat .git/hooks/pre-commit\n\n# Test with a commit\ngit add .\ngit commit -m \"test\"  # Hooks will run\n</code></pre>"},{"location":"QUALITY_GATES/#common-scenarios","title":"Common Scenarios","text":""},{"location":"QUALITY_GATES/#scenario-1-format-issues-auto-fixed","title":"Scenario 1: Format Issues Auto-Fixed","text":"<pre><code># Make a change with formatting issues\necho \"x=1+2\" &gt;&gt; src/python/htmlgraph/example.py\n\n# Try to commit\ngit add .\ngit commit -m \"Add example\"\n\n# Output:\n# ruff-format: Fixed 1 formatting issue\n# ruff: Fixed 2 lint issues\n# \u2705 Commit succeeded (changes were auto-fixed)\n</code></pre>"},{"location":"QUALITY_GATES/#scenario-2-type-error-blocks-commit","title":"Scenario 2: Type Error Blocks Commit","text":"<pre><code># Add untyped function\ncat &gt;&gt; src/python/htmlgraph/example.py &lt;&lt; 'EOF'\ndef calculate(x):  # Missing type hint!\n    return x + 1\nEOF\n\n# Try to commit\ngit commit -m \"Add calculator\"\n\n# Output:\n# mypy: src/python/htmlgraph/example.py:42: error: Function is missing a return type annotation\n# \u274c Commit blocked (requires manual fix)\n\n# Fix it\ncat &gt;&gt; src/python/htmlgraph/example.py &lt;&lt; 'EOF'\ndef calculate(x: int) -&gt; int:\n    return x + 1\nEOF\n\n# Retry\ngit commit -m \"Add calculator\"\n# \u2705 Commit succeeds\n</code></pre>"},{"location":"QUALITY_GATES/#scenario-3-test-failure-blocks-commit","title":"Scenario 3: Test Failure Blocks Commit","text":"<pre><code># Make code change that breaks test\n# ... edit a file ...\n\n# Try to commit\ngit commit -m \"Update feature\"\n\n# Output:\n# pytest: FAILED tests/python/test_features.py::test_create\n# \u274c Commit blocked (test failed)\n\n# Fix the test or code\n# ... fix test or implementation ...\n\n# Run tests locally to verify\nuv run pytest tests/python/test_features.py::test_create\n\n# Retry commit\ngit commit -m \"Update feature\"\n# \u2705 Commit succeeds\n</code></pre>"},{"location":"QUALITY_GATES/#bypassing-hooks-use-with-caution","title":"Bypassing Hooks (Use with Caution)","text":""},{"location":"QUALITY_GATES/#skip-all-hooks","title":"Skip All Hooks","text":"<pre><code># NOT RECOMMENDED - Bypasses all quality gates\ngit commit --no-verify -m \"Emergency fix\"\n\n# This should only be used for genuine emergencies\n# All code will still need to pass gates during review/CI\n</code></pre>"},{"location":"QUALITY_GATES/#skip-specific-hook","title":"Skip Specific Hook","text":"<p>Pre-commit doesn't support skipping individual hooks, but you can temporarily modify <code>.pre-commit-config.yaml</code>:</p> <pre><code># Temporarily disable mypy (emergency only)\n# Edit .pre-commit-config.yaml and comment out mypy hook\n\n# After emergency is resolved, re-enable it\ngit add .pre-commit-config.yaml\ngit commit -m \"Re-enable mypy hook\"\n</code></pre>"},{"location":"QUALITY_GATES/#type-safety-standards","title":"Type Safety Standards","text":"<p>HtmlGraph enforces strict type safety:</p>"},{"location":"QUALITY_GATES/#required-type-annotations","title":"Required Type Annotations","text":"<p>All function signatures: <pre><code># \u274c BAD\ndef create_feature(title, description):\n    pass\n\n# \u2705 GOOD\ndef create_feature(title: str, description: str) -&gt; Feature:\n    pass\n</code></pre></p> <p>All variable declarations (when type isn't obvious): <pre><code># \u274c BAD\nfeatures = fetch_features()\n\n# \u2705 GOOD\nfrom htmlgraph.collections import Feature\nfeatures: list[Feature] = fetch_features()\n</code></pre></p> <p>Return types (always required): <pre><code># \u274c BAD\ndef get_stats(self):\n    return {\"count\": 42}\n\n# \u2705 GOOD\nfrom typing import TypedDict\nclass Stats(TypedDict):\n    count: int\n\ndef get_stats(self) -&gt; Stats:\n    return {\"count\": 42}\n</code></pre></p>"},{"location":"QUALITY_GATES/#using-any-type","title":"Using <code>Any</code> Type","text":"<p>Avoid <code>Any</code> unless justified. When you must use it, document why:</p> <pre><code># \u274c BAD - No justification\ndef process(data: Any) -&gt; Any:\n    return data\n\n# \u2705 GOOD - Documented justification\nfrom typing import Any\n\ndef process(data: Any) -&gt; dict:\n    # Any type used because data comes from untyped external API\n    # that we cannot control\n    return {\"processed\": data}\n</code></pre>"},{"location":"QUALITY_GATES/#pre-commit-workflow","title":"Pre-Commit Workflow","text":""},{"location":"QUALITY_GATES/#step-by-step-flow","title":"Step-by-Step Flow","text":"<pre><code>Developer attempts commit\n    \u2193\nPre-commit hooks trigger\n    \u2193\nRuff Format (auto-fix) \u2500\u2192 Success or failure\n    \u2193\nRuff Lint (auto-fix) \u2500\u2192 Success or failure\n    \u2193\nMypy Type Check \u2500\u2192 Success or failure (no auto-fix)\n    \u2193\nPytest \u2500\u2192 Success or failure (no auto-fix)\n    \u2193\nStandard Hooks (trailing space, etc) \u2500\u2192 Success or failure\n    \u2193\nAll Pass?\n  \u251c\u2500 YES \u2192 Commit proceeds \u2705\n  \u2514\u2500 NO \u2192 Commit blocked, show errors \u274c\n</code></pre>"},{"location":"QUALITY_GATES/#hook-output-example","title":"Hook Output Example","text":"<pre><code>======================================\npre-commit hook: ruff-format\n======================================\nFixed 3 issues in src/python/htmlgraph/example.py\n\n======================================\npre-commit hook: ruff\n======================================\nFixed 2 issues in src/python/htmlgraph/example.py\n\n======================================\npre-commit hook: mypy\n======================================\n\u2705 All type checks passed\n\n======================================\npre-commit hook: pytest\n======================================\n========================= test session starts ==========================\ncollected 123 tests\npassed 123 in 2.45s\n========================= 123 passed in 2.45s ==========================\n\n======================================\nAll hooks passed! \u2705\n======================================\nCommit successful\n</code></pre>"},{"location":"QUALITY_GATES/#troubleshooting","title":"Troubleshooting","text":""},{"location":"QUALITY_GATES/#issue-hooks-not-running","title":"Issue: Hooks Not Running","text":"<p>Solution: <pre><code># Reinstall hooks\npre-commit install\n\n# Verify\npre-commit run --all-files\n</code></pre></p>"},{"location":"QUALITY_GATES/#issue-module-not-found-in-mypy","title":"Issue: \"Module not found\" in Mypy","text":"<p>Solution: <pre><code># Update mypy dependencies in .pre-commit-config.yaml\npre-commit autoupdate\n\n# Or manually run\nuv run mypy src/python/htmlgraph/\n</code></pre></p>"},{"location":"QUALITY_GATES/#issue-ruff-unknown-rule-error","title":"Issue: Ruff \"Unknown rule\" Error","text":"<p>Solution: <pre><code># Update ruff version\nuv pip install --upgrade ruff\n\n# Check configuration in pyproject.toml\ncat pyproject.toml | grep -A 20 \"\\[tool.ruff\\]\"\n</code></pre></p>"},{"location":"QUALITY_GATES/#issue-pre-commit-takes-too-long","title":"Issue: Pre-commit Takes Too Long","text":"<p>Optimization: <pre><code># Pre-commit has built-in caching\n# Clear cache if needed:\npre-commit clean\n\n# Run only changed files\npre-commit run --files src/python/htmlgraph/changed_file.py\n</code></pre></p>"},{"location":"QUALITY_GATES/#configuration-reference","title":"Configuration Reference","text":""},{"location":"QUALITY_GATES/#pre-commit-configyaml","title":".pre-commit-config.yaml","text":"<p>Location: <code>/Users/shakes/DevProjects/htmlgraph/.pre-commit-config.yaml</code></p> <p>Key sections: - ruff-format - Code formatting with auto-fix - ruff - Linting with auto-fix - mypy - Type checking (no auto-fix) - Standard hooks - File validation - pytest - Test execution</p>"},{"location":"QUALITY_GATES/#pyprojecttoml","title":"pyproject.toml","text":"<p>Location: <code>/Users/shakes/DevProjects/htmlgraph/pyproject.toml</code></p> <p>Configuration sections: - [tool.ruff] - Ruff settings (line length, ignored rules) - [tool.ruff.lint] - Specific lint rules - [tool.mypy] - Type checking settings - [tool.pytest.ini_options] - Test configuration</p>"},{"location":"QUALITY_GATES/#best-practices","title":"Best Practices","text":""},{"location":"QUALITY_GATES/#before-committing","title":"Before Committing","text":"<ol> <li> <p>Run quality checks locally first: <pre><code>uv run ruff check --fix\nuv run ruff format\nuv run mypy src/\nuv run pytest\n</code></pre></p> </li> <li> <p>Review what changed: <pre><code>git diff\ngit status\n</code></pre></p> </li> <li> <p>Add only what you want: <pre><code>git add file1.py file2.py\n</code></pre></p> </li> </ol>"},{"location":"QUALITY_GATES/#during-development","title":"During Development","text":"<ol> <li>Use IDE support:</li> <li>VS Code: Install Pylance or Pyright</li> <li>PyCharm: Built-in type checking</li> <li> <p>Both highlight mypy errors as you type</p> </li> <li> <p>Run hooks frequently: <pre><code># Check current changes\npre-commit run\n\n# Check all files\npre-commit run --all-files\n</code></pre></p> </li> <li> <p>Fix incrementally:</p> </li> <li>Don't wait until the end to fix all errors</li> <li>Address types/linting as you code</li> </ol>"},{"location":"QUALITY_GATES/#in-code-reviews","title":"In Code Reviews","text":"<ul> <li>Respect the quality gates - If hooks fail, the issue is real</li> <li>Don't merge failing checks - CI will block it anyway</li> <li>Help teammates fix issues - Share common patterns</li> </ul>"},{"location":"QUALITY_GATES/#performance","title":"Performance","text":""},{"location":"QUALITY_GATES/#hook-execution-time","title":"Hook Execution Time","text":"<p>Typical execution times: - Ruff format: 1-2 seconds - Ruff lint: 2-3 seconds - Mypy: 5-10 seconds - Pytest: 10-30 seconds (depends on test count) - Total: 20-45 seconds per commit</p>"},{"location":"QUALITY_GATES/#optimization","title":"Optimization","text":"<pre><code># Skip slow hooks for emergency commits (not recommended)\ngit commit --no-verify -m \"Emergency\"\n\n# Use incremental mypy checking\nuv run mypy src/ --incremental\n\n# Run specific test file instead of all\nuv run pytest tests/python/test_specific.py\n</code></pre>"},{"location":"QUALITY_GATES/#integration-with-cicd","title":"Integration with CI/CD","text":"<p>The same hooks run in CI/CD pipelines:</p> <pre><code># GitHub Actions will run equivalent checks\npre-commit run --all-files\n\n# If any fail, the build fails\n# This prevents bad code from merging to main\n</code></pre>"},{"location":"QUALITY_GATES/#resources","title":"Resources","text":"<ul> <li>Pre-commit documentation: https://pre-commit.com/</li> <li>Ruff documentation: https://docs.astral.sh/ruff/</li> <li>Mypy documentation: https://mypy.readthedocs.io/</li> <li>Pytest documentation: https://docs.pytest.org/</li> </ul>"},{"location":"QUALITY_GATES/#getting-help","title":"Getting Help","text":"<p>Check hook status: <pre><code># List all hooks\npre-commit run --dry-run\n\n# Verbose output\npre-commit run --verbose\n</code></pre></p> <p>Debug specific issues: <pre><code># Run specific hook\npre-commit run mypy --verbose\n\n# Show what files trigger hook\npre-commit run ruff --files \"src/python/htmlgraph/*.py\"\n</code></pre></p> <p>Reset and reinstall: <pre><code># Remove all hooks\npre-commit uninstall\n\n# Clean pre-commit cache\npre-commit clean\n\n# Reinstall everything\npre-commit install\npre-commit run --all-files\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/","title":"Rich Output Formatting Guide","text":"<p>For: HtmlGraph CLI Implementation Feature: Phase 1A/1B - Maximize Rich Console Target Audience: Codex, Copilot, and future CLI developers</p>"},{"location":"RICH_OUTPUT_GUIDE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Color Scheme</li> <li>Symbols &amp; Icons</li> <li>Components</li> <li>Common Patterns</li> <li>Examples</li> <li>Testing &amp; Validation</li> <li>Backward Compatibility</li> </ol>"},{"location":"RICH_OUTPUT_GUIDE/#color-scheme","title":"Color Scheme","text":"<p>HtmlGraph uses a consistent color scheme for all CLI output:</p>"},{"location":"RICH_OUTPUT_GUIDE/#primary-colors","title":"Primary Colors","text":"Color Markup Usage Example Red <code>[red]...[/red]</code> Errors, failures, blocking issues <code>[red]\u2717 Operation failed[/red]</code> Green <code>[green]...[/green]</code> Success, completion, positive results <code>[green]\u2713 Feature created[/green]</code> Yellow <code>[yellow]...[/yellow]</code> Warnings, caution, potential issues <code>[yellow]\u26a0 Uncommitted changes[/yellow]</code> Cyan <code>[cyan]...[/cyan]</code> Information, status, metadata <code>[cyan]\u2139 Project: htmlgraph[/cyan]</code> Magenta <code>[magenta]...[/magenta]</code> Important items, highlights <code>[magenta]\u2605 High priority[/magenta]</code>"},{"location":"RICH_OUTPUT_GUIDE/#style-modifiers","title":"Style Modifiers","text":"Style Markup Usage Bold <code>[bold]...[/bold]</code> Headers, emphasized text Dim <code>[dim]...[/dim]</code> Secondary info, hints Italic <code>[italic]...[/italic]</code> Emphasis, alternatives Underline <code>[underline]...[/underline]</code> Links, important terms"},{"location":"RICH_OUTPUT_GUIDE/#combination-example","title":"Combination Example","text":"<pre><code># Bold red error with symbol\nconsole.print(\"[bold red]\u2717 Critical Error:[/bold red] Operation failed\")\n\n# Dim cyan hint\nconsole.print(\"[dim cyan]Hint: Use --help for more options[/dim cyan]\")\n\n# Bold green success\nconsole.print(\"[bold green]\u2713 Successfully created feature[/bold green]\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#symbols-icons","title":"Symbols &amp; Icons","text":"<p>Standard symbols for consistent visual feedback:</p>"},{"location":"RICH_OUTPUT_GUIDE/#status-symbols","title":"Status Symbols","text":"Symbol Code Usage \u2713 U+2713 Success, completed, checked \u2717 U+2717 Error, failed, blocking \u26a0 U+26A0 Warning, caution, attention needed \u2139 U+2139 Information, help, details \u270c U+270C Good, okay, approved \u270b U+270B Stop, pause, hold \u2605 U+2605 Important, priority, highlight \u2299 U+2299 In progress, processing \u2192 U+2192 Next, following, direction \u2190 U+2190 Previous, back, revert"},{"location":"RICH_OUTPUT_GUIDE/#usage-examples","title":"Usage Examples","text":"<pre><code># Success\nconsole.print(\"[green]\u2713 Feature created successfully[/green]\")\n\n# Error\nconsole.print(\"[red]\u2717 Failed to create feature[/red]\")\n\n# Warning\nconsole.print(\"[yellow]\u26a0 This action cannot be undone[/yellow]\")\n\n# Info\nconsole.print(\"[cyan]\u2139 Run 'htmlgraph status' to check progress[/cyan]\")\n\n# Priority\nconsole.print(\"[magenta]\u2605 High priority feature detected[/magenta]\")\n\n# In Progress\nconsole.print(\"[cyan]\u2299 Processing analytics...[/cyan]\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#components","title":"Components","text":"<p>Rich provides several components for structured output:</p>"},{"location":"RICH_OUTPUT_GUIDE/#1-consoleprint-basic-text-output","title":"1. Console.print() - Basic Text Output","text":"<p>Purpose: Display colored, styled text</p> <p>Syntax: <pre><code>console.print(\"Text\", style=\"color\")\nconsole.print(\"[color]Text[/color]\")\nconsole.print(\"[color bold]Text[/color bold]\")\n</code></pre></p> <p>Examples: <pre><code># Error message\nconsole.print(\"[red]Error: Invalid feature ID[/red]\")\n\n# Success message\nconsole.print(\"[green]\u2713 Feature saved[/green]\")\n\n# Info with style\nconsole.print(\"[cyan bold]Project Status[/cyan bold]\")\n\n# Combined\nconsole.print(\"[bold green]\u2713[/bold green] Feature [bold]my-feature[/bold] created\")\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#2-table-structured-data","title":"2. Table - Structured Data","text":"<p>Purpose: Display data in rows and columns</p> <p>Syntax: <pre><code>from rich.table import Table\n\ntable = Table(title=\"Features\", box=box.ROUNDED, show_header=True, header_style=\"bold cyan\")\ntable.add_column(\"ID\", style=\"magenta\")\ntable.add_column(\"Title\", style=\"green\")\ntable.add_column(\"Status\", style=\"yellow\")\ntable.add_column(\"Priority\", style=\"red\")\n\ntable.add_row(\"feat-1\", \"Feature One\", \"todo\", \"high\")\ntable.add_row(\"feat-2\", \"Feature Two\", \"in-progress\", \"medium\")\n\nconsole.print(table)\n</code></pre></p> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Features                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 ID   \u2502 Title         \u2502 Status   \u2502 Pri \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 feat \u2502 Feature One   \u2502 todo     \u2502 hi  \u2502\n\u2502 feat \u2502 Feature Two   \u2502 in-prog\u2026 \u2502 med \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre></p> <p>Common Styles: - <code>box.ROUNDED</code> - Rounded corners (default) - <code>box.SIMPLE</code> - Minimal borders - <code>box.DOUBLE</code> - Double line borders - <code>box.ASCII</code> - ASCII-only (for compatibility)</p> <p>Column Options: <pre><code>table.add_column(\n    \"Name\",\n    style=\"cyan\",              # Column color\n    justify=\"left\",            # left, center, right\n    width=20,                  # Fixed width\n    no_wrap=False              # Wrap long text\n)\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#3-panel-grouped-content","title":"3. Panel - Grouped Content","text":"<p>Purpose: Display content in a highlighted box</p> <p>Syntax: <pre><code>from rich.panel import Panel\n\npanel = Panel(\n    \"Content here\",\n    title=\"Header\",\n    style=\"blue\",\n    expand=False\n)\nconsole.print(panel)\n</code></pre></p> <p>Output: <pre><code>\u256d\u2500 Header \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                             \u2502\n\u2502 Content here                \u2502\n\u2502                             \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre></p> <p>Options: <pre><code>Panel(\n    content,\n    title=\"Title\",             # Header text\n    subtitle=\"Subtitle\",       # Footer text\n    style=\"cyan\",              # Border color\n    expand=True,               # Full width\n    border_style=\"blue\"        # Different border style\n)\n</code></pre></p> <p>Examples: <pre><code># Help text\nfrom rich.panel import Panel\npanel = Panel(\n    \"[cyan]Commands:\\n\"\n    \"  feature list    - Show all features\\n\"\n    \"  feature create  - Create new feature[/cyan]\",\n    title=\"[bold]HtmlGraph CLI[/bold]\",\n    style=\"bold green\"\n)\nconsole.print(panel)\n\n# Error panel\nPanel(\n    \"[red]Feature not found: invalid-id[/red]\",\n    title=\"[bold red]Error[/bold red]\",\n    style=\"red\"\n)\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#4-progress-long-operations","title":"4. Progress - Long Operations","text":"<p>Purpose: Show progress for time-consuming operations</p> <p>Syntax: <pre><code>from rich.progress import Progress\n\nwith Progress() as progress:\n    task = progress.add_task(\"[cyan]Processing...\", total=100)\n    while not progress.finished:\n        # Do work\n        progress.update(task, advance=10)\n</code></pre></p> <p>Output: <pre><code>Processing... \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591 50% 0:00:30\n</code></pre></p> <p>Advanced Usage: <pre><code>from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn, TimeElapsedColumn\n\nwith Progress(\n    SpinnerColumn(),\n    TextColumn(\"[progress.description]{task.description}\"),\n    BarColumn(),\n    TimeElapsedColumn(),\n) as progress:\n    task = progress.add_task(\"Building features...\", total=50)\n    for i in range(50):\n        # Do work\n        progress.update(task, advance=1)\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#5-prompt-interactive-input","title":"5. Prompt - Interactive Input","text":"<p>Purpose: Get user input with validation</p> <p>Syntax: <pre><code>from rich.prompt import Prompt, Confirm\n\n# Text input\nname = Prompt.ask(\"Enter your name\", default=\"Claude\")\n\n# Yes/No confirmation\nconfirmed = Confirm.ask(\"Create feature?\", default=True)\n\n# With choices\nchoice = Prompt.ask(\n    \"Select priority\",\n    choices=[\"high\", \"medium\", \"low\"],\n    default=\"medium\"\n)\n</code></pre></p> <p>Output: <pre><code>Enter your name [Claude]:\nCreate feature? [Y/n]: y\nSelect priority [high/medium/low] [medium]: high\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#6-status-indeterminate-progress","title":"6. Status - Indeterminate Progress","text":"<p>Purpose: Show activity status for unknown duration</p> <p>Syntax: <pre><code>with console.status(\"[bold cyan]Processing...\"):\n    # Do work\n    time.sleep(2)\n</code></pre></p> <p>Output: <pre><code>\u2819 Processing...\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#common-patterns","title":"Common Patterns","text":""},{"location":"RICH_OUTPUT_GUIDE/#pattern-1-success-message","title":"Pattern 1: Success Message","text":"<pre><code># Simple\nconsole.print(\"[green]\u2713 Operation successful[/green]\")\n\n# With details\nconsole.print(f\"[green]\u2713[/green] Feature [bold]{feature_id}[/bold] created successfully\")\n\n# With secondary text\nconsole.print(\"[green]\u2713 Created[/green]\", \"feature-001\", style=\"dim\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#pattern-2-error-message","title":"Pattern 2: Error Message","text":"<pre><code># Simple\nconsole.print(\"[red]\u2717 Operation failed[/red]\")\n\n# With details\nconsole.print(f\"[red]\u2717 Error:[/red] Invalid feature ID: {feature_id}\")\n\n# Multi-line error\nconsole.print(\"[red]\u2717 Failed to create feature[/red]\")\nconsole.print(f\"  [dim]Reason: {error_message}[/dim]\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#pattern-3-warning-message","title":"Pattern 3: Warning Message","text":"<pre><code># Simple\nconsole.print(\"[yellow]\u26a0 Warning: This action is permanent[/yellow]\")\n\n# With suggestion\nconsole.print(f\"[yellow]\u26a0[/yellow] No features found. Create one with: htmlgraph feature create\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#pattern-4-info-message","title":"Pattern 4: Info Message","text":"<pre><code># Simple\nconsole.print(\"[cyan]\u2139 Total features: 15[/cyan]\")\n\n# With details\nconsole.print(f\"[cyan]\u2139 Project:[/cyan] {project_name}\")\nconsole.print(f\"[cyan]\u2139 Location:[/cyan] {location}\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#pattern-5-listtable-of-items","title":"Pattern 5: List/Table of Items","text":"<pre><code># Simple list\ntable = Table(show_header=True, header_style=\"bold cyan\")\ntable.add_column(\"ID\", style=\"magenta\")\ntable.add_column(\"Name\", style=\"green\")\ntable.add_column(\"Status\", style=\"yellow\")\n\nfor item in items:\n    table.add_row(item.id, item.name, item.status)\n\nconsole.print(table)\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#pattern-6-grouped-help-text","title":"Pattern 6: Grouped Help Text","text":"<pre><code>from rich.panel import Panel\n\nhelp_text = \"\"\"\n[cyan]Commands:[/cyan]\n  [green]feature list[/green]      Show all features\n  [green]feature create[/green]    Create new feature\n  [green]feature show ID[/green]   Show feature details\n\n[cyan]Options:[/cyan]\n  [green]--format json[/green]     Output as JSON\n  [green]--help[/green]            Show this message\n\"\"\"\n\npanel = Panel(help_text, title=\"[bold]HtmlGraph CLI Help[/bold]\", style=\"bold cyan\")\nconsole.print(panel)\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#pattern-7-progress-for-long-operations","title":"Pattern 7: Progress for Long Operations","text":"<pre><code>from rich.progress import Progress\n\nfeatures = get_features()  # Expensive operation\nwith Progress() as progress:\n    task = progress.add_task(\"[cyan]Loading features...\", total=len(features))\n\n    for feature in features:\n        process_feature(feature)\n        progress.update(task, advance=1)\n\nconsole.print(\"[green]\u2713 All features processed[/green]\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#examples","title":"Examples","text":""},{"location":"RICH_OUTPUT_GUIDE/#example-1-feature-list-command","title":"Example 1: Feature List Command","text":"<p>Before (Plain Print): <pre><code>print(\"Features:\")\nfor feature in features:\n    print(f\"  {feature.id}: {feature.title} ({feature.status})\")\n</code></pre></p> <p>After (Rich Output): <pre><code>from rich.table import Table\nfrom rich import box\n\ntable = Table(\n    title=\"[bold cyan]Features[/bold cyan]\",\n    box=box.ROUNDED,\n    show_header=True,\n    header_style=\"bold cyan\"\n)\ntable.add_column(\"ID\", style=\"magenta\", width=12)\ntable.add_column(\"Title\", style=\"green\", width=30)\ntable.add_column(\"Status\", style=\"yellow\")\ntable.add_column(\"Priority\", style=\"red\")\n\nfor feature in features:\n    status_color = \"green\" if feature.status == \"done\" else \"yellow\"\n    table.add_row(\n        feature.id,\n        feature.title,\n        f\"[{status_color}]{feature.status}[/{status_color}]\",\n        feature.priority\n    )\n\nconsole.print(table)\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#example-2-feature-creation-with-prompts","title":"Example 2: Feature Creation with Prompts","text":"<p>Before: <pre><code>import sys\nname = input(\"Feature name: \")\nif not name:\n    print(\"Error: Name required\")\n    sys.exit(1)\n\npriority = input(\"Priority (high/medium/low) [medium]: \") or \"medium\"\nprint(f\"Creating feature: {name}\")\n# ... create feature\nprint(f\"\u2713 Feature created: {name}\")\n</code></pre></p> <p>After: <pre><code>from rich.prompt import Prompt, Confirm\n\nname = Prompt.ask(\"Feature name\")\npriority = Prompt.ask(\n    \"Priority\",\n    choices=[\"high\", \"medium\", \"low\"],\n    default=\"medium\"\n)\n\nwith console.status(\"[cyan]Creating feature...\"):\n    # ... create feature\n\nconsole.print(f\"[green]\u2713 Feature[/green] [bold]{name}[/bold] [green]created successfully[/green]\")\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#example-3-error-handling","title":"Example 3: Error Handling","text":"<p>Before: <pre><code>try:\n    feature = get_feature(feature_id)\nexcept FeatureNotFound:\n    print(f\"Error: Feature not found: {feature_id}\")\n    sys.exit(1)\n</code></pre></p> <p>After: <pre><code>try:\n    feature = get_feature(feature_id)\nexcept FeatureNotFound:\n    console.print(f\"[red]\u2717 Error:[/red] Feature not found: [bold]{feature_id}[/bold]\")\n    console.print(\"[dim cyan]Use 'htmlgraph feature list' to see available features[/dim cyan]\")\n    sys.exit(1)\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#testing-validation","title":"Testing &amp; Validation","text":""},{"location":"RICH_OUTPUT_GUIDE/#testing-rich-output","title":"Testing Rich Output","text":"<pre><code># test_cli_rich_output.py\nimport io\nfrom rich.console import Console\n\ndef test_error_message_has_color():\n    \"\"\"Test error messages use red markup.\"\"\"\n    # Create string console to capture output\n    string_io = io.StringIO()\n    test_console = Console(file=string_io, force_terminal=True)\n\n    # Your command that produces error\n    test_console.print(\"[red]\u2717 Error message[/red]\")\n\n    output = string_io.getvalue()\n    # Verify ANSI color codes are present (for terminal output)\n    assert \"[\" in output or \"\\x1b[\" in output  # ANSI codes\n\ndef test_json_output_clean():\n    \"\"\"Test JSON output has no Rich markup.\"\"\"\n    result = run_command([\"htmlgraph\", \"feature\", \"list\", \"--format\", \"json\"])\n\n    # Parse JSON\n    data = json.loads(result.stdout)\n\n    # Verify no markup in output\n    output_str = json.dumps(data)\n    assert \"[red]\" not in output_str\n    assert \"[green]\" not in output_str\n    assert \"\\x1b[\" not in output_str  # No ANSI codes\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#validating-implementation","title":"Validating Implementation","text":"<pre><code># Count print() statements converted\ngrep -c \"console.print\" src/python/htmlgraph/cli.py\n\n# Check for remaining plain print()\ngrep -n \"print(\" src/python/htmlgraph/cli.py | \\\n  grep -v \"console.print\" | grep -v \"# \"\n\n# Verify Rich imports\ngrep \"from rich\" src/python/htmlgraph/cli.py\n\n# Check for color usage\ngrep -c \"\\[red\\]\\|\\[green\\]\\|\\[yellow\\]\\|\\[cyan\\]\" \\\n  src/python/htmlgraph/cli.py\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#backward-compatibility","title":"Backward Compatibility","text":""},{"location":"RICH_OUTPUT_GUIDE/#json-output","title":"JSON Output","text":"<p>CRITICAL: JSON output must NOT contain Rich markup</p> <pre><code># Wrong - Rich markup in JSON\nconsole.print(\"[green]\u2713 Feature created[/green]\", file=json_output)\n\n# Right - Plain JSON, Rich markup only in terminal\nif args.format == \"json\":\n    print(json.dumps(data), file=output)\nelse:\n    console.print(f\"[green]\u2713 Feature created[/green]\")\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#environment-variables","title":"Environment Variables","text":"<p>Disable colors if needed: <pre><code>import os\n\n# Check for NO_COLOR environment variable\nif os.environ.get(\"NO_COLOR\"):\n    console = Console(no_color=True)\n\n# Force colors even without terminal\nif os.environ.get(\"FORCE_COLOR\"):\n    console = Console(force_terminal=True)\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#plain-text-output","title":"Plain Text Output","text":"<p>Support --plain flag if needed: <pre><code>if args.plain:\n    # Output without colors\n    print(\"Feature created: my-feature\")\nelse:\n    # Output with colors\n    console.print(\"[green]\u2713 Feature created: [bold]my-feature[/bold][/green]\")\n</code></pre></p>"},{"location":"RICH_OUTPUT_GUIDE/#style-reference","title":"Style Reference","text":""},{"location":"RICH_OUTPUT_GUIDE/#available-styles","title":"Available Styles","text":"<pre><code># Text styles\n\"bold\", \"dim\", \"italic\", \"underline\", \"blink\", \"reverse\", \"conceal\", \"strike\"\n\n# Colors\n\"black\", \"red\", \"green\", \"yellow\", \"blue\", \"magenta\", \"cyan\", \"white\"\n\n# 256 colors (if supported)\n\"color(123)\", \"rgb(255,0,0)\"\n\n# Combinations\n\"bold red\", \"dim cyan\", \"italic magenta\"\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#box-styles","title":"Box Styles","text":"<pre><code>from rich import box\n\nbox.ROUNDED       # \u256d\u2500 \u2500\u256e\nbox.SQUARE        # \u250c\u2500 \u2500\u2510\nbox.MINIMAL       # \u250c\u2500 \u2500\u2510\nbox.SIMPLE        # \u2500\u2500\u2500\u2500\u2500\nbox.DOUBLE        # \u2554\u2550 \u2550\u2557\nbox.THICK         # \u250f\u2501 \u2501\u2513\nbox.ASCII         # +--- (for compatibility)\n</code></pre>"},{"location":"RICH_OUTPUT_GUIDE/#quick-reference","title":"Quick Reference","text":"Need Solution Colored text <code>console.print(\"[red]text[/red]\")</code> Table <code>table = Table(); console.print(table)</code> Panel <code>panel = Panel(content); console.print(panel)</code> Progress <code>with Progress() as progress: ...</code> User input <code>Prompt.ask(\"name\")</code> Yes/No <code>Confirm.ask(\"continue?\")</code> Bold/Italic <code>[bold]text[/bold]</code>, <code>[italic]text[/italic]</code> Success <code>[green]\u2713 text[/green]</code> Error <code>[red]\u2717 text[/red]</code> Warning <code>[yellow]\u26a0 text[/yellow]</code> Info <code>[cyan]\u2139 text[/cyan]</code>"},{"location":"RICH_OUTPUT_GUIDE/#additional-resources","title":"Additional Resources","text":"<ul> <li>Rich Documentation: https://rich.readthedocs.io/</li> <li>ANSI Color Codes: https://en.wikipedia.org/wiki/ANSI_escape_code</li> <li>Unicode Symbols: https://unicode-table.com/</li> <li>HtmlGraph CLI: <code>src/python/htmlgraph/cli.py</code></li> <li>Quality Gates: <code>QUALITY_GATES_PHASE_1AB.md</code></li> </ul> <p>Version: 1.0 Last Updated: 2026-01-05 Status: Active</p>"},{"location":"SDK_ANALYTICS/","title":"Analytics API Documentation","text":"<p>Phase 2: Work Type Analytics - Analyze work type distribution, spike-to-feature ratios, and maintenance burden across sessions.</p>"},{"location":"SDK_ANALYTICS/#overview","title":"Overview","text":"<p>The Analytics API provides methods to analyze work patterns across sessions and projects. Use it to:</p> <ul> <li>Understand work distribution - What % of time is spent on features vs spikes vs maintenance?</li> <li>Identify research-heavy sessions - High spike-to-feature ratios indicate exploratory work</li> <li>Track maintenance burden - Measure technical debt and maintenance workload</li> <li>Filter sessions by work type - Find all exploratory or implementation sessions</li> </ul>"},{"location":"SDK_ANALYTICS/#quick-start","title":"Quick Start","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get work type distribution for a session\ndist = sdk.analytics.work_type_distribution(session_id=\"session-123\")\nprint(dist)\n# {\"feature-implementation\": 45.2, \"spike-investigation\": 28.3, \"maintenance\": 18.5, ...}\n\n# Calculate spike-to-feature ratio\nratio = sdk.analytics.spike_to_feature_ratio(session_id=\"session-123\")\nprint(f\"Spike-to-feature ratio: {ratio:.2f}\")\n# Spike-to-feature ratio: 0.63 (research-heavy session)\n\n# Get maintenance burden\nburden = sdk.analytics.maintenance_burden(session_id=\"session-123\")\nprint(f\"Maintenance burden: {burden:.1f}%\")\n# Maintenance burden: 18.5%\n\n# Find all exploratory sessions\nfrom htmlgraph import WorkType\nspike_sessions = sdk.analytics.get_sessions_by_work_type(WorkType.SPIKE.value)\nprint(f\"Found {len(spike_sessions)} exploratory sessions\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#api-reference","title":"API Reference","text":""},{"location":"SDK_ANALYTICS/#sdkanalytics","title":"<code>sdk.analytics</code>","text":"<p>The Analytics interface is accessible via the <code>sdk.analytics</code> property.</p>"},{"location":"SDK_ANALYTICS/#work_type_distribution","title":"<code>work_type_distribution()</code>","text":"<p>Calculate work type distribution as percentages.</p> <p>Signature: <pre><code>def work_type_distribution(\n    self,\n    session_id: str | None = None,\n    start_date: datetime | None = None,\n    end_date: datetime | None = None,\n) -&gt; dict[str, float]\n</code></pre></p> <p>Parameters: - <code>session_id</code> (optional): Session ID to analyze. If None, analyzes all sessions. - <code>start_date</code> (optional): Filter sessions after this date. - <code>end_date</code> (optional): Filter sessions before this date.</p> <p>Returns: Dictionary mapping work type to percentage (0-100).</p> <p>Example: <pre><code># Single session\ndist = sdk.analytics.work_type_distribution(session_id=\"session-123\")\nprint(dist)\n# {\n#     \"feature-implementation\": 45.2,\n#     \"spike-investigation\": 28.3,\n#     \"maintenance\": 18.5,\n#     \"documentation\": 8.0\n# }\n\n# Across date range\nfrom datetime import datetime\ndist = sdk.analytics.work_type_distribution(\n    start_date=datetime(2024, 12, 1),\n    end_date=datetime(2024, 12, 31)\n)\n</code></pre></p> <p>Interpretation: - High feature %: Implementation-focused work - High spike %: Research and exploration - High maintenance %: Refactoring and bug fixes</p>"},{"location":"SDK_ANALYTICS/#spike_to_feature_ratio","title":"<code>spike_to_feature_ratio()</code>","text":"<p>Calculate ratio of spike events to feature events.</p> <p>Signature: <pre><code>def spike_to_feature_ratio(\n    self,\n    session_id: str | None = None,\n    start_date: datetime | None = None,\n    end_date: datetime | None = None,\n) -&gt; float\n</code></pre></p> <p>Parameters: - <code>session_id</code> (optional): Session ID to analyze. - <code>start_date</code> (optional): Filter sessions after this date. - <code>end_date</code> (optional): Filter sessions before this date.</p> <p>Returns: Ratio of spike events to feature events (0.0 to infinity). Returns 0.0 if no feature events found.</p> <p>Example: <pre><code>ratio = sdk.analytics.spike_to_feature_ratio(session_id=\"session-123\")\nprint(f\"Spike-to-feature ratio: {ratio:.2f}\")\n\nif ratio &gt; 0.5:\n    print(\"This was a research-heavy session\")\nelif ratio &gt; 0.2:\n    print(\"This was a balanced session\")\nelse:\n    print(\"This was an implementation-heavy session\")\n</code></pre></p> <p>Interpretation: - &gt;0.5: Research-heavy (more exploration than implementation) - 0.2-0.5: Balanced (healthy mix) - &lt;0.2: Implementation-heavy (mostly building features)</p>"},{"location":"SDK_ANALYTICS/#maintenance_burden","title":"<code>maintenance_burden()</code>","text":"<p>Calculate percentage of work spent on maintenance vs new features.</p> <p>Signature: <pre><code>def maintenance_burden(\n    self,\n    session_id: str | None = None,\n    start_date: datetime | None = None,\n    end_date: datetime | None = None,\n) -&gt; float\n</code></pre></p> <p>Parameters: - <code>session_id</code> (optional): Session ID to analyze. - <code>start_date</code> (optional): Filter sessions after this date. - <code>end_date</code> (optional): Filter sessions before this date.</p> <p>Returns: Percentage of work spent on maintenance (0-100). Maintenance includes bug fixes and chores.</p> <p>Example: <pre><code>burden = sdk.analytics.maintenance_burden(session_id=\"session-123\")\nprint(f\"Maintenance burden: {burden:.1f}%\")\n\nif burden &gt; 40:\n    print(\"\u26a0\ufe0f  High maintenance burden - consider addressing technical debt\")\nelif burden &gt; 20:\n    print(\"Moderate maintenance burden - healthy balance\")\nelse:\n    print(\"Low maintenance burden - mostly new development\")\n</code></pre></p> <p>Interpretation: - &lt;20%: Healthy (mostly new development) - 20-40%: Moderate (balanced maintenance) - &gt;40%: High burden (technical debt accumulation)</p>"},{"location":"SDK_ANALYTICS/#get_sessions_by_work_type","title":"<code>get_sessions_by_work_type()</code>","text":"<p>Get list of session IDs where the primary work type matches.</p> <p>Signature: <pre><code>def get_sessions_by_work_type(\n    self,\n    primary_work_type: str,\n    start_date: datetime | None = None,\n    end_date: datetime | None = None,\n) -&gt; list[str]\n</code></pre></p> <p>Parameters: - <code>primary_work_type</code>: Work type to filter by (e.g., \"spike-investigation\", \"feature-implementation\"). - <code>start_date</code> (optional): Filter sessions after this date. - <code>end_date</code> (optional): Filter sessions before this date.</p> <p>Returns: List of session IDs matching the criteria.</p> <p>Example: <pre><code>from htmlgraph import WorkType\n\n# Find all exploratory sessions\nspike_sessions = sdk.analytics.get_sessions_by_work_type(WorkType.SPIKE.value)\nprint(f\"Found {len(spike_sessions)} exploratory sessions\")\n\n# Find all implementation sessions\nfeature_sessions = sdk.analytics.get_sessions_by_work_type(WorkType.FEATURE.value)\nprint(f\"Found {len(feature_sessions)} implementation sessions\")\n\n# Filter by date range\nfrom datetime import datetime\nrecent_spikes = sdk.analytics.get_sessions_by_work_type(\n    WorkType.SPIKE.value,\n    start_date=datetime(2024, 12, 1)\n)\n</code></pre></p>"},{"location":"SDK_ANALYTICS/#calculate_session_work_breakdown","title":"<code>calculate_session_work_breakdown()</code>","text":"<p>Calculate work type breakdown (event counts) for a session.</p> <p>Signature: <pre><code>def calculate_session_work_breakdown(self, session_id: str) -&gt; dict[str, int]\n</code></pre></p> <p>Parameters: - <code>session_id</code>: Session ID to analyze.</p> <p>Returns: Dictionary mapping work type to event count.</p> <p>Example: <pre><code>breakdown = sdk.analytics.calculate_session_work_breakdown(\"session-123\")\nprint(breakdown)\n# {\n#     \"feature-implementation\": 45,\n#     \"spike-investigation\": 28,\n#     \"maintenance\": 15\n# }\n\n# Calculate percentages\ntotal = sum(breakdown.values())\nfor work_type, count in breakdown.items():\n    pct = (count / total) * 100\n    print(f\"{work_type}: {pct:.1f}% ({count} events)\")\n</code></pre></p>"},{"location":"SDK_ANALYTICS/#calculate_session_primary_work_type","title":"<code>calculate_session_primary_work_type()</code>","text":"<p>Calculate the primary work type for a session.</p> <p>Signature: <pre><code>def calculate_session_primary_work_type(self, session_id: str) -&gt; str | None\n</code></pre></p> <p>Parameters: - <code>session_id</code>: Session ID to analyze.</p> <p>Returns: Primary work type (most common), or None if no work type data.</p> <p>Example: <pre><code>primary = sdk.analytics.calculate_session_primary_work_type(\"session-123\")\nprint(f\"Primary work type: {primary}\")\n# Primary work type: spike-investigation\n\nif primary == WorkType.SPIKE.value:\n    print(\"This session was primarily exploratory\")\nelif primary == WorkType.FEATURE.value:\n    print(\"This session was primarily implementation\")\n</code></pre></p>"},{"location":"SDK_ANALYTICS/#use-cases","title":"Use Cases","text":""},{"location":"SDK_ANALYTICS/#1-project-health-dashboard","title":"1. Project Health Dashboard","text":"<pre><code>from htmlgraph import SDK\nfrom datetime import datetime, timedelta\n\nsdk = SDK(agent=\"claude\")\n\n# Get last 30 days\nend_date = datetime.now()\nstart_date = end_date - timedelta(days=30)\n\n# Calculate metrics\ndist = sdk.analytics.work_type_distribution(\n    start_date=start_date,\n    end_date=end_date\n)\nratio = sdk.analytics.spike_to_feature_ratio(\n    start_date=start_date,\n    end_date=end_date\n)\nburden = sdk.analytics.maintenance_burden(\n    start_date=start_date,\n    end_date=end_date\n)\n\nprint(\"=== Project Health (Last 30 Days) ===\")\nprint(f\"Spike-to-Feature Ratio: {ratio:.2f}\")\nprint(f\"Maintenance Burden: {burden:.1f}%\")\nprint(f\"\\nWork Distribution:\")\nfor work_type, pct in sorted(dist.items(), key=lambda x: x[1], reverse=True):\n    print(f\"  {work_type}: {pct:.1f}%\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#2-session-analysis","title":"2. Session Analysis","text":"<pre><code># Analyze a specific session\nsession_id = \"session-abc-123\"\n\ndist = sdk.analytics.work_type_distribution(session_id=session_id)\nprimary = sdk.analytics.calculate_session_primary_work_type(session_id)\n\nprint(f\"Session {session_id}\")\nprint(f\"Primary work type: {primary}\")\nprint(f\"\\nBreakdown:\")\nfor work_type, pct in dist.items():\n    print(f\"  {work_type}: {pct:.1f}%\")\n\n# Interpretation\nratio = sdk.analytics.spike_to_feature_ratio(session_id=session_id)\nif ratio &gt; 0.5:\n    print(\"\\n\ud83d\udca1 This was a research-heavy session\")\nelse:\n    print(\"\\n\ud83d\udd28 This was an implementation-heavy session\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#3-find-similar-sessions","title":"3. Find Similar Sessions","text":"<pre><code>from htmlgraph import WorkType\n\n# Find all exploratory sessions\nspike_sessions = sdk.analytics.get_sessions_by_work_type(WorkType.SPIKE.value)\n\nprint(f\"Found {len(spike_sessions)} exploratory sessions:\")\nfor session_id in spike_sessions[:5]:  # Show first 5\n    breakdown = sdk.analytics.calculate_session_work_breakdown(session_id)\n    spike_count = breakdown.get(WorkType.SPIKE.value, 0)\n    print(f\"  {session_id}: {spike_count} spike events\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#4-maintenance-burden-tracking","title":"4. Maintenance Burden Tracking","text":"<pre><code>from datetime import datetime, timedelta\n\n# Track maintenance burden over time\nintervals = []\nfor i in range(4):  # Last 4 weeks\n    end = datetime.now() - timedelta(weeks=i)\n    start = end - timedelta(weeks=1)\n\n    burden = sdk.analytics.maintenance_burden(\n        start_date=start,\n        end_date=end\n    )\n\n    intervals.append((start.strftime(\"%Y-%m-%d\"), burden))\n\nprint(\"Maintenance Burden Trend:\")\nfor date, burden in reversed(intervals):\n    print(f\"  Week of {date}: {burden:.1f}%\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#work-type-reference","title":"Work Type Reference","text":"<p>Work types are defined in <code>htmlgraph.models.WorkType</code>:</p> <ul> <li><code>FEATURE</code> = \"feature-implementation\" - Building new functionality</li> <li><code>SPIKE</code> = \"spike-investigation\" - Research and exploration</li> <li><code>BUG_FIX</code> = \"bug-fix\" - Correcting defects</li> <li><code>MAINTENANCE</code> = \"maintenance\" - Refactoring and tech debt</li> <li><code>DOCUMENTATION</code> = \"documentation\" - Writing docs</li> <li><code>PLANNING</code> = \"planning\" - Design and architecture</li> <li><code>REVIEW</code> = \"review\" - Code review</li> <li><code>ADMIN</code> = \"admin\" - Administrative tasks</li> </ul>"},{"location":"SDK_ANALYTICS/#best-practices","title":"Best Practices","text":""},{"location":"SDK_ANALYTICS/#1-regular-health-checks","title":"1. Regular Health Checks","text":"<p>Run analytics weekly to track project health:</p> <pre><code># Weekly health check\nburden = sdk.analytics.maintenance_burden()\nif burden &gt; 40:\n    print(\"\u26a0\ufe0f  High maintenance burden - schedule refactoring sprint\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#2-session-retrospectives","title":"2. Session Retrospectives","text":"<p>Analyze sessions after major work:</p> <pre><code># After completing a feature\nsession_id = \"session-latest\"\nprimary = sdk.analytics.calculate_session_primary_work_type(session_id)\nratio = sdk.analytics.spike_to_feature_ratio(session_id)\n\nprint(f\"Session completed: {primary}\")\nprint(f\"Exploration vs Implementation: {ratio:.2f}\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#3-sprint-planning","title":"3. Sprint Planning","text":"<p>Use analytics to inform planning:</p> <pre><code># Check last sprint's work distribution\nrecent_dist = sdk.analytics.work_type_distribution()\n\nif recent_dist.get(\"spike-investigation\", 0) &gt; 40:\n    print(\"Last sprint was research-heavy - focus on implementation this sprint\")\n</code></pre>"},{"location":"SDK_ANALYTICS/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SDK_ANALYTICS/#no-work-type-data","title":"No work type data","text":"<p>If analytics return empty results, check:</p> <ol> <li> <p>Events have work_type field: Work types are auto-inferred from feature IDs    <pre><code># Verify events have work_type\nsession = sdk.sessions.get(\"session-123\")\nevents = session.get_events(limit=5)\nfor evt in events:\n    print(evt.get(\"work_type\"))  # Should show work type\n</code></pre></p> </li> <li> <p>Sessions exist: Check session count    <pre><code>sessions = sdk.sessions.all()\nprint(f\"Found {len(sessions)} sessions\")\n</code></pre></p> </li> </ol>"},{"location":"SDK_ANALYTICS/#unexpected-ratios","title":"Unexpected ratios","text":"<p>If ratios seem off:</p> <ol> <li> <p>Check event counts:    <pre><code>breakdown = sdk.analytics.calculate_session_work_breakdown(\"session-123\")\nprint(f\"Total events: {sum(breakdown.values())}\")\n</code></pre></p> </li> <li> <p>Verify work type inference:    <pre><code>from htmlgraph import infer_work_type_from_id\n\nwork_type = infer_work_type_from_id(\"feat-123\")\nprint(f\"Feature ID 'feat-123' \u2192 {work_type}\")\n</code></pre></p> </li> </ol>"},{"location":"SDK_ANALYTICS/#see-also","title":"See Also","text":"<ul> <li>Work Type Classification (Phase 1)</li> <li>SDK Documentation</li> <li>Session Management</li> </ul>"},{"location":"SDK_EVENT_INSPECTION/","title":"SDK Event Inspection Guide","text":"<p>IMPORTANT: Always use the SDK to inspect HtmlGraph data. Never read <code>.htmlgraph/</code> files directly.</p>"},{"location":"SDK_EVENT_INSPECTION/#why-use-the-sdk","title":"Why Use the SDK?","text":"<p>\u274c WRONG - Reading files directly: <pre><code># DON'T DO THIS\nwith open('.htmlgraph/events/session-123.jsonl') as f:\n    for line in f:\n        evt = json.loads(line)\n        print(evt)\n</code></pre></p> <p>\u2705 RIGHT - Using SDK: <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='claude-code')\nsession = sdk.sessions.get('session-123')\nevents = session.get_events(limit=10)\n</code></pre></p>"},{"location":"SDK_EVENT_INSPECTION/#quick-start","title":"Quick Start","text":"<pre><code>from htmlgraph import SDK\nfrom htmlgraph.session_manager import SessionManager\n\nsdk = SDK(agent='claude-code')\nsm = SessionManager()\n\n# Get current active session\nsession = sm.get_active_session(agent='claude-code')\nprint(f\"Session: {session.id}\")\nprint(f\"Event Count: {session.event_count}\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#event-inspection-methods","title":"Event Inspection Methods","text":""},{"location":"SDK_EVENT_INSPECTION/#1-get-recent-events","title":"1. Get Recent Events","text":"<pre><code># Get last 10 events\nrecent = session.get_events(limit=10, offset=session.event_count - 10)\n\nfor evt in recent:\n    print(f\"{evt['event_id']}: {evt['tool']} - {evt['summary']}\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#2-query-events-by-tool","title":"2. Query Events by Tool","text":"<pre><code># Get all Bash events (newest first)\nbash_events = session.query_events(tool='Bash', limit=20)\n\n# Get all Edit events\nedit_events = session.query_events(tool='Edit')\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#3-query-events-by-feature","title":"3. Query Events by Feature","text":"<pre><code># Get all events attributed to a specific feature\nfeature_events = session.query_events(feature_id='feat-123', limit=50)\n\nfor evt in feature_events:\n    drift = evt.get('drift_score', 'N/A')\n    print(f\"{evt['tool']}: {evt['summary'][:50]} (drift={drift})\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#4-query-events-by-time","title":"4. Query Events by Time","text":"<pre><code>from datetime import datetime, timedelta\n\n# Get events from last hour\none_hour_ago = datetime.now() - timedelta(hours=1)\nrecent_events = session.query_events(since=one_hour_ago)\n\n# Get events since specific timestamp\nsince_timestamp = \"2025-12-22T06:00:00\"\nevents_since = session.query_events(since=since_timestamp, limit=100)\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#5-get-event-statistics","title":"5. Get Event Statistics","text":"<pre><code># Get comprehensive statistics\nstats = session.event_stats()\n\nprint(f\"Total Events: {stats['total_events']}\")\nprint(f\"Tools Used: {stats['tools_used']}\")\nprint(f\"Features Worked: {stats['features_worked']}\")\n\n# Top tools\nprint(\"\\nTop Tools:\")\nfor tool, count in sorted(stats['by_tool'].items(), key=lambda x: x[1], reverse=True)[:5]:\n    print(f\"  {tool}: {count} events\")\n\n# Features worked on\nprint(\"\\nFeatures Worked:\")\nfor feature, count in stats['by_feature'].items():\n    print(f\"  {feature}: {count} events\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#complete-example-session-verification","title":"Complete Example: Session Verification","text":"<p>Here's how to properly verify session management and event tracking:</p> <pre><code>from htmlgraph import SDK\nfrom htmlgraph.session_manager import SessionManager\n\nsdk = SDK(agent='claude-code')\nsm = SessionManager()\n\n# Get current session\nsession = sm.get_active_session(agent='claude-code')\n\nprint(f\"\ud83d\udcca Session Analysis: {session.id}\")\nprint(\"=\" * 70)\n\n# 1. Recent events (last 10)\nprint(\"\\n\ud83d\udd50 Recent Events:\")\nrecent = session.get_events(limit=10, offset=session.event_count - 10)\nfor evt in recent:\n    feature = evt.get('feature_id') or 'None'\n    print(f\"  {evt['event_id'][:20]:20} | {evt['tool']:12} | {feature:20}\")\n\n# 2. Check if using hash-based IDs\nprint(\"\\n\ud83d\udd11 Event ID Format Check:\")\nif recent:\n    latest_id = recent[-1]['event_id']\n    if latest_id.startswith('evt-'):\n        print(f\"  \u2705 Using hash-based IDs: {latest_id}\")\n    else:\n        print(f\"  \u26a0\ufe0f  Using old format: {latest_id}\")\n\n# 3. Feature attribution check\nprint(\"\\n\ud83c\udfaf Feature Attribution:\")\nfeature_events = [e for e in recent if e.get('feature_id')]\nif feature_events:\n    print(f\"  \u2705 {len(feature_events)}/{len(recent)} events have feature attribution\")\nelse:\n    print(f\"  \u2139\ufe0f  No features active during recent events\")\n\n# 4. Event statistics\nprint(\"\\n\ud83d\udcc8 Session Statistics:\")\nstats = session.event_stats()\nprint(f\"  Total Events: {stats['total_events']}\")\nprint(f\"  Tools Used: {stats['tools_used']}\")\nprint(f\"  Features Worked: {stats['features_worked']}\")\n\nprint(\"\\n  Top 5 Tools:\")\nfor tool, count in sorted(stats['by_tool'].items(), key=lambda x: x[1], reverse=True)[:5]:\n    print(f\"    {tool:20}: {count:4} events\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#best-practices","title":"Best Practices","text":"<ol> <li>Always use SDK - Never read <code>.htmlgraph/</code> files directly</li> <li>Use pagination - For large sessions, use <code>limit</code> and <code>offset</code></li> <li>Filter early - Use <code>query_events()</code> filters to reduce data</li> <li>Check attribution - Use <code>feature_id</code> filter to verify attribution</li> <li>Cache stats - Event statistics are expensive, cache them</li> </ol>"},{"location":"SDK_EVENT_INSPECTION/#common-use-cases","title":"Common Use Cases","text":""},{"location":"SDK_EVENT_INSPECTION/#verify-hash-based-ids","title":"Verify Hash-Based IDs","text":"<pre><code>session = sdk.sessions.get('session-123')\nrecent = session.get_events(limit=1, offset=session.event_count - 1)\nlatest_id = recent[0]['event_id']\nis_hash_based = latest_id.startswith('evt-')\nprint(f\"Hash-based IDs: {is_hash_based}\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#check-feature-attribution-rate","title":"Check Feature Attribution Rate","text":"<pre><code>session = sdk.sessions.get('session-123')\nrecent = session.get_events(limit=100)\nattributed = [e for e in recent if e.get('feature_id')]\nrate = len(attributed) / len(recent) * 100\nprint(f\"Attribution Rate: {rate:.1f}%\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#find-unattributed-work","title":"Find Unattributed Work","text":"<pre><code>session = sdk.sessions.get('session-123')\nunattributed = session.query_events(feature_id=None, limit=50)\nprint(f\"Found {len(unattributed)} unattributed events\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#analyze-tool-usage-patterns","title":"Analyze Tool Usage Patterns","text":"<pre><code>session = sdk.sessions.get('session-123')\nstats = session.event_stats()\n\n# Tools with most events\ntop_tools = sorted(stats['by_tool'].items(), key=lambda x: x[1], reverse=True)[:10]\nfor tool, count in top_tools:\n    percentage = count / stats['total_events'] * 100\n    print(f\"{tool:20}: {count:4} ({percentage:5.1f}%)\")\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#migration-guide","title":"Migration Guide","text":"<p>If you have code that reads files directly, here's how to migrate:</p>"},{"location":"SDK_EVENT_INSPECTION/#before-wrong","title":"Before (\u274c Wrong):","text":"<pre><code>import json\n\n# Reading JSONL directly\nwith open('.htmlgraph/events/session-123.jsonl') as f:\n    events = [json.loads(line) for line in f if line.strip()]\n\n# Getting last 10\nrecent = events[-10:]\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#after-right","title":"After (\u2705 Right):","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK()\nsession = sdk.sessions.get('session-123')\nrecent = session.get_events(limit=10, offset=session.event_count - 10)\n</code></pre>"},{"location":"SDK_EVENT_INSPECTION/#see-also","title":"See Also","text":"<ul> <li>SDK Guide - Complete SDK documentation</li> <li>Session Management - Session workflow guide</li> <li>Event Log - Event log API reference</li> </ul>"},{"location":"SESSION_STATE_MANAGEMENT/","title":"Session State Management - Automatic Environment Variable Setup","text":""},{"location":"SESSION_STATE_MANAGEMENT/#overview","title":"Overview","text":"<p>HtmlGraph SDK now provides automatic session state detection and environment variable management through the <code>SessionStateManager</code> class. This enables the SessionStart hook to automatically detect post-compact sessions, determine delegation status, and set up environment variables without manual configuration.</p>"},{"location":"SESSION_STATE_MANAGEMENT/#key-features","title":"Key Features","text":""},{"location":"SESSION_STATE_MANAGEMENT/#1-automatic-session-state-detection","title":"1. Automatic Session State Detection","text":"<p>The SDK automatically detects:</p> <ul> <li>Session Source: <code>startup</code>, <code>resume</code>, <code>compact</code>, or <code>clear</code></li> <li>Post-Compact Status: Whether this is a session after context compaction</li> <li>Delegation Status: Whether orchestrator delegation should be active</li> <li>Previous Session ID: For tracking continuity across sessions</li> <li>Session Validity: Whether the session is valid for tracking</li> </ul>"},{"location":"SESSION_STATE_MANAGEMENT/#2-environment-variable-management","title":"2. Environment Variable Management","text":"<p>Automatically sets environment variables that persist across context boundaries:</p> <ul> <li><code>CLAUDE_SESSION_ID</code> - Current session identifier</li> <li><code>CLAUDE_SESSION_SOURCE</code> - Session type (startup|resume|compact|clear)</li> <li><code>CLAUDE_SESSION_COMPACTED</code> - True if post-compact</li> <li><code>CLAUDE_DELEGATION_ENABLED</code> - True if delegation enabled</li> <li><code>CLAUDE_PREVIOUS_SESSION_ID</code> - Previous session ID (if available)</li> <li><code>CLAUDE_ORCHESTRATOR_ACTIVE</code> - True if orchestrator should be active</li> <li><code>CLAUDE_PROMPT_PERSISTENCE_VERSION</code> - Version (1.0)</li> </ul>"},{"location":"SESSION_STATE_MANAGEMENT/#3-session-metadata-recording","title":"3. Session Metadata Recording","text":"<p>Stores session state metadata for future reference:</p> <pre><code>{\n  \"session_id\": \"sess-abc123\",\n  \"source\": \"compact\",\n  \"is_post_compact\": true,\n  \"delegation_enabled\": true,\n  \"timestamp\": \"2026-01-05T10:00:00+00:00\",\n  \"environment_vars\": {\n    \"CLAUDE_SESSION_ID\": \"sess-abc123\",\n    \"CLAUDE_DELEGATION_ENABLED\": \"true\",\n    ...\n  }\n}\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#api-reference","title":"API Reference","text":""},{"location":"SESSION_STATE_MANAGEMENT/#using-sessionstatemanager-directly","title":"Using SessionStateManager Directly","text":"<pre><code>from htmlgraph.session_state import SessionStateManager\n\nmanager = SessionStateManager(\".htmlgraph\")\n\n# Get current session state (auto-detects everything)\nstate = manager.get_current_state()\n\n# Access state information\nprint(f\"Session ID: {state['session_id']}\")\nprint(f\"Post-compact: {state['is_post_compact']}\")\nprint(f\"Delegation enabled: {state['delegation_enabled']}\")\n\n# Set up environment variables (automatically sets all vars)\nenv_vars = manager.setup_environment_variables(state)\n\n# Check if this is post-compact\nis_compact = manager.detect_compact_automatically()\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#using-sdk-sessions-collection","title":"Using SDK Sessions Collection","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude-code\")\n\n# Get current session state\nstate = sdk.sessions.get_current_state()\n\n# Set up environment variables\nenv_vars = sdk.sessions.setup_environment_variables(state)\n\n# Record state for future reference\nsdk.sessions.record_state(\n    session_id=state['session_id'],\n    source=state['session_source'],\n    is_post_compact=state['is_post_compact'],\n    delegation_enabled=state['delegation_enabled'],\n    environment_vars=env_vars\n)\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#integration-with-sessionstart-hook","title":"Integration with SessionStart Hook","text":"<pre><code>#!/usr/bin/env -S uv run\n# .claude/hooks/scripts/session-start.py\n\nfrom htmlgraph import SDK\n\ndef setup_session_state_and_environment():\n    \"\"\"Automatically set up session state and environment variables.\"\"\"\n    try:\n        sdk = SDK(agent=\"claude-code\")\n\n        # Get current session state (auto-detects everything)\n        state = sdk.sessions.get_current_state()\n\n        # Automatically set up environment variables\n        env_vars = sdk.sessions.setup_environment_variables(state)\n\n        # All environment variables now set - no manual management needed!\n        return env_vars\n    except Exception as e:\n        print(f\"Warning: Could not set up session state: {e}\")\n        return None\n\n# Call at session start\nenv_vars = setup_session_state_and_environment()\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#sessionstate-structure","title":"SessionState Structure","text":"<p>The <code>SessionState</code> TypedDict contains:</p> <pre><code>{\n    \"session_id\": str,           # Current session ID\n    \"session_source\": str,       # \"startup\", \"resume\", \"compact\", \"clear\"\n    \"is_post_compact\": bool,     # True if post-compact\n    \"previous_session_id\": str | None,  # Previous session ID\n    \"delegation_enabled\": bool,  # Should delegation be active\n    \"prompt_injected\": bool,     # Was orchestrator prompt injected\n    \"session_valid\": bool,       # Is session valid for tracking\n    \"timestamp\": str,            # ISO timestamp\n    \"compact_metadata\": dict[str, Any],  # Compact detection details\n}\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#how-compaction-detection-works","title":"How Compaction Detection Works","text":"<p>The system uses several heuristics to detect post-compact sessions:</p> <ol> <li>Session ID Comparison</li> <li>If <code>CLAUDE_SESSION_ID</code> differs from previous session: likely post-compact</li> <li> <p>If same as previous session: likely resume (context switch)</p> </li> <li> <p>Session End Detection</p> </li> <li>If previous session marked as <code>is_ended</code>: confirms post-compact</li> <li> <p>Checks <code>.htmlgraph/sessions/session_state.json</code></p> </li> <li> <p>Compact Marker File</p> </li> <li>If <code>.htmlgraph/sessions/.compacted</code> exists: post-compact</li> <li> <p>Marker can be created by <code>/clear</code> command or manual compaction</p> </li> <li> <p>Delegation Auto-Enable</p> </li> <li>On post-compact: automatically enable delegation (need context carry-over)</li> <li>Can be disabled via <code>HTMLGRAPH_DELEGATION_DISABLE=1</code></li> </ol>"},{"location":"SESSION_STATE_MANAGEMENT/#use-cases","title":"Use Cases","text":""},{"location":"SESSION_STATE_MANAGEMENT/#1-fresh-session-startup","title":"1. Fresh Session (Startup)","text":"<pre><code>CLAUDE_SESSION_ID=sess-abc123 (new)\nPrevious state: None\n\nResult:\n- session_source: \"startup\"\n- is_post_compact: false\n- delegation_enabled: false (no previous context)\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#2-context-switch-resume","title":"2. Context Switch (Resume)","text":"<pre><code>CLAUDE_SESSION_ID=sess-abc123 (same)\nPrevious session ID: sess-abc123\nPrevious session NOT ended\n\nResult:\n- session_source: \"resume\"\n- is_post_compact: false\n- delegation_enabled: unchanged\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#3-post-compact-resume-after-compaction","title":"3. Post-Compact (Resume after Compaction)","text":"<pre><code>CLAUDE_SESSION_ID=sess-new456 (different)\nPrevious session ID: sess-abc123\nPrevious session marked as ended\n\nResult:\n- session_source: \"compact\"\n- is_post_compact: true\n- delegation_enabled: true (auto-enable)\n- previous_session_id: \"sess-abc123\"\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#4-clear-command","title":"4. Clear Command","text":"<pre><code>CLAUDE_SESSION_ID=sess-new789 (new)\nClear marker file exists: .htmlgraph/sessions/.compacted\n\nResult:\n- session_source: \"clear\"\n- is_post_compact: false\n- delegation_enabled: false (fresh start)\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#benefits","title":"Benefits","text":"<ol> <li>No Manual Configuration</li> <li>User doesn't manage environment variables</li> <li> <p>SessionStart hook just calls: <code>sdk.sessions.setup_environment_variables()</code></p> </li> <li> <p>Automatic Post-Compact Detection</p> </li> <li>No need to manually track session IDs</li> <li> <p>HtmlGraph detects compaction automatically</p> </li> <li> <p>Intelligent Delegation Status</p> </li> <li>Automatically enable delegation when needed (post-compact)</li> <li> <p>Can be overridden via environment variable</p> </li> <li> <p>Persistent State</p> </li> <li>Session metadata stored in <code>.htmlgraph/sessions/session_state.json</code></li> <li> <p>Available for future reference and debugging</p> </li> <li> <p>Zero User Friction</p> </li> <li>SessionStart hook setup is trivial</li> <li>Works automatically without user intervention</li> </ol>"},{"location":"SESSION_STATE_MANAGEMENT/#testing","title":"Testing","text":"<p>Run the test suite:</p> <pre><code>uv run pytest tests/python/test_session_state_manager.py -v\n\n# All 15 tests pass:\n# - Fresh session detection\n# - Post-compact detection\n# - Environment variable setup\n# - Delegation status determination\n# - Session validity checking\n# - Metadata recording\n# - Auto-compact detection\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#configuration","title":"Configuration","text":""},{"location":"SESSION_STATE_MANAGEMENT/#override-delegation","title":"Override Delegation","text":"<p>Disable delegation if needed:</p> <pre><code>export HTMLGRAPH_DELEGATION_DISABLE=1\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#check-session-state","title":"Check Session State","text":"<pre><code># View current session state\ncat .htmlgraph/sessions/session_state.json\n\n# Check environment variables\necho $CLAUDE_SESSION_ID\necho $CLAUDE_DELEGATION_ENABLED\necho $CLAUDE_SESSION_COMPACTED\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#migration-guide","title":"Migration Guide","text":""},{"location":"SESSION_STATE_MANAGEMENT/#for-sessionstart-hook-writers","title":"For SessionStart Hook Writers","text":"<p>Before (manual):</p> <pre><code># Had to manually track session IDs\n# Had to set environment variables manually\n# Had to detect post-compact manually\n</code></pre> <p>After (automatic):</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude-code\")\nstate = sdk.sessions.get_current_state()\nenv_vars = sdk.sessions.setup_environment_variables(state)\n# Done! All environment variables set automatically\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#for-sdk-users","title":"For SDK Users","text":"<p>No changes needed! The SDK automatically initializes <code>SessionStateManager</code> on first access to <code>sdk.sessions</code>:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude-code\")\n\n# SessionStateManager is available automatically\nstate = sdk.sessions.get_current_state()\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#implementation-details","title":"Implementation Details","text":""},{"location":"SESSION_STATE_MANAGEMENT/#sessionstatemanager-srcpythonhtmlgraphsession_statepy","title":"SessionStateManager (<code>src/python/htmlgraph/session_state.py</code>)","text":"<ul> <li>Core class for session state detection and management</li> <li>Detects session source by comparing session IDs and metadata</li> <li>Manages environment variables (set, retrieve, record)</li> <li>Stores session metadata in JSON file</li> </ul>"},{"location":"SESSION_STATE_MANAGEMENT/#sessioncollection-srcpythonhtmlgraphcollectionssessionpy","title":"SessionCollection (<code>src/python/htmlgraph/collections/session.py</code>)","text":"<ul> <li>SDK integration layer for session state operations</li> <li>Wraps SessionStateManager with SDK context</li> <li>Available via <code>sdk.sessions</code> in all SDK code</li> <li>Extends BaseCollection with session-specific methods</li> </ul>"},{"location":"SESSION_STATE_MANAGEMENT/#integration-points","title":"Integration Points","text":"<ol> <li>SessionStart Hook: Calls <code>setup_session_state_and_environment()</code></li> <li>SDK Initialization: Auto-initializes SessionCollection</li> <li>Session Manager: Uses SessionStateManager for state tracking</li> </ol>"},{"location":"SESSION_STATE_MANAGEMENT/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SESSION_STATE_MANAGEMENT/#session-state-not-being-saved","title":"Session state not being saved","text":"<p>Check file permissions:</p> <pre><code>ls -la .htmlgraph/sessions/session_state.json\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#delegation-not-being-enabled-after-compact","title":"Delegation not being enabled after compact","text":"<p>Verify post-compact detection:</p> <pre><code>python -c \"from htmlgraph import SDK; sdk = SDK(); state = sdk.sessions.get_current_state(); print(f\\\"Post-compact: {state['is_post_compact']}\\\")\"\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#environment-variables-not-set","title":"Environment variables not set","text":"<p>Check SessionStart hook is running:</p> <pre><code>echo $CLAUDE_SESSION_ID  # Should be non-empty\n</code></pre>"},{"location":"SESSION_STATE_MANAGEMENT/#performance-notes","title":"Performance Notes","text":"<ul> <li>Session state detection is O(1) - reads single JSON file</li> <li>Environment variable setup is O(1) - sets 7 environment variables</li> <li>No graph loading required - works independently of feature/bug graphs</li> <li>Thread-safe for concurrent sessions</li> </ul>"},{"location":"SESSION_STATE_MANAGEMENT/#future-enhancements","title":"Future Enhancements","text":"<ol> <li>Delegation Hints: Return hint about whether delegation should be active</li> <li>Analytics Integration: Record session transitions for analytics</li> <li>Cloud Sync: Sync session state to cloud for multi-device support</li> <li>Metrics: Track session continuity metrics over time</li> <li>Recovery: Auto-detect and recover from crashed sessions</li> </ol>"},{"location":"SESSION_STATE_MANAGEMENT/#see-also","title":"See Also","text":"<ul> <li><code>AGENTS.md</code> - Main SDK documentation</li> <li><code>test_session_state_manager.py</code> - Test examples</li> <li><code>.claude/hooks/scripts/session-start.py</code> - Hook integration</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/","title":"SQLite Event Recording Integration","text":"<p>Status: Implemented | Phase: Real-time Dashboard Integration</p>"},{"location":"SQLITE_EVENT_RECORDING/#overview","title":"Overview","text":"<p>Claude Code tool execution events are now automatically recorded to SQLite database via HtmlGraph hooks, enabling the FastAPI dashboard to display live activity feeds and orchestration metrics.</p>"},{"location":"SQLITE_EVENT_RECORDING/#architecture","title":"Architecture","text":""},{"location":"SQLITE_EVENT_RECORDING/#dual-path-event-recording","title":"Dual-Path Event Recording","text":"<p>Events are recorded in two complementary ways:</p> <pre><code>Claude Code Tool Execution\n         \u2193\n    Hook fires (PostToolUse, Stop, UserPromptSubmit)\n         \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502       event_tracker.py (hook script)       \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2193                              \u2193\n    SessionManager               HtmlGraphDB\n    (HTML files)                (SQLite DB)\n         \u2193                              \u2193\n    .htmlgraph/               .htmlgraph/\n    sessions/*.html           htmlgraph.db\n    activities/               (Queryable)\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#key-components","title":"Key Components","text":"<p>1. Event Tracker Hook (<code>src/python/htmlgraph/hooks/event_tracker.py</code>) - Intercepts tool calls via PostToolUse hook - Records to both HTML (existing) and SQLite (new) - Handles special case: Task() delegations \u2192 agent_collaboration table - Gracefully degrades if SQLite unavailable</p> <p>2. Database Schema (<code>src/python/htmlgraph/db/schema.py</code>) - <code>agent_events</code> - All tool calls, queries, delegations - <code>agent_collaboration</code> - Task delegations between agents - Indexed for dashboard queries</p> <p>3. New Methods</p> <pre><code># In event_tracker.py\ndef record_event_to_sqlite(\n    db: HtmlGraphDB,\n    session_id: str,\n    tool_name: str,\n    tool_input: dict,\n    tool_response: dict,\n    is_error: bool,\n    file_paths: list[str] | None = None,\n    parent_event_id: str | None = None,\n) -&gt; str | None:\n    \"\"\"Record tool call event to SQLite for dashboard queries.\"\"\"\n\ndef record_delegation_to_sqlite(\n    db: HtmlGraphDB,\n    session_id: str,\n    from_agent: str,\n    to_agent: str,\n    task_description: str,\n    task_input: dict,\n) -&gt; str | None:\n    \"\"\"Record Task() delegation to agent_collaboration table.\"\"\"\n\n# In schema.py\ndef insert_collaboration(\n    self,\n    handoff_id: str,\n    from_agent: str,\n    to_agent: str,\n    session_id: str,\n    handoff_type: str = \"delegation\",\n    reason: str | None = None,\n    context: dict[str, Any] | None = None,\n    status: str = \"pending\",\n) -&gt; bool:\n    \"\"\"Insert agent collaboration/delegation record.\"\"\"\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#database-schema","title":"Database Schema","text":""},{"location":"SQLITE_EVENT_RECORDING/#agent_events-table","title":"agent_events Table","text":"<p>Records all tool execution events:</p> <pre><code>CREATE TABLE agent_events (\n    event_id TEXT PRIMARY KEY,           -- Unique event identifier\n    agent_id TEXT NOT NULL,              -- \"claude-code\"\n    event_type TEXT NOT NULL,            -- \"tool_call\"\n    timestamp DATETIME DEFAULT NOW,      -- When event occurred\n    tool_name TEXT,                      -- Tool name (Read, Write, Task, etc.)\n    input_summary TEXT,                  -- Formatted input summary\n    output_summary TEXT,                 -- Formatted output summary\n    context JSON,                        -- Metadata: file_paths, is_error, etc.\n    session_id TEXT NOT NULL,            -- Linked to session\n    parent_agent_id TEXT,                -- Parent agent if delegated\n    parent_event_id TEXT,                -- Parent event if child\n    cost_tokens INTEGER DEFAULT 0,       -- Token usage\n    status TEXT DEFAULT 'recorded',      -- Event status\n    created_at DATETIME DEFAULT NOW,\n    updated_at DATETIME DEFAULT NOW,\n    FOREIGN KEY (session_id) REFERENCES sessions(session_id),\n    FOREIGN KEY (parent_event_id) REFERENCES agent_events(event_id)\n)\n\n-- Indexes for dashboard queries\nCREATE INDEX idx_agent_events_session ON agent_events(session_id)\nCREATE INDEX idx_agent_events_agent ON agent_events(agent_id)\nCREATE INDEX idx_agent_events_timestamp ON agent_events(timestamp)\nCREATE INDEX idx_agent_events_type ON agent_events(event_type)\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#agent_collaboration-table","title":"agent_collaboration Table","text":"<p>Records Task() delegations:</p> <pre><code>CREATE TABLE agent_collaboration (\n    handoff_id TEXT PRIMARY KEY,          -- Unique handoff identifier\n    from_agent TEXT NOT NULL,             -- \"claude-code\"\n    to_agent TEXT NOT NULL,               -- subagent_type (e.g., \"researcher\")\n    timestamp DATETIME DEFAULT NOW,       -- When delegation occurred\n    feature_id TEXT,                      -- Linked feature if available\n    session_id TEXT,                      -- Linked session\n    handoff_type TEXT,                    -- \"delegation\", \"parallel\", etc.\n    status TEXT DEFAULT 'pending',        -- pending, accepted, completed, failed\n    reason TEXT,                          -- Task description\n    context JSON,                         -- Metadata: model, temperature, etc.\n    result JSON,                          -- Result from subagent\n    FOREIGN KEY (feature_id) REFERENCES features(id),\n    FOREIGN KEY (session_id) REFERENCES sessions(session_id)\n)\n\n-- Indexes for orchestration queries\nCREATE INDEX idx_collaboration_from_agent ON agent_collaboration(from_agent)\nCREATE INDEX idx_collaboration_to_agent ON agent_collaboration(to_agent)\nCREATE INDEX idx_collaboration_feature ON agent_collaboration(feature_id)\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#event-recording-flow","title":"Event Recording Flow","text":""},{"location":"SQLITE_EVENT_RECORDING/#posttooluse-hook-most-common","title":"PostToolUse Hook (Most Common)","text":"<pre><code># Hook fires when tool completes\nhook_input = {\n    \"tool_name\": \"Read\",\n    \"tool_input\": {\"file_path\": \"src/main.py\"},\n    \"tool_response\": {\"success\": True, \"content\": \"...\"},\n    \"cwd\": \"/path/to/project\"\n}\n\n# Event Tracker processes:\n1. Initialize SessionManager (HTML) + HtmlGraphDB (SQLite)\n2. Get active session ID\n3. Extract file paths from tool_input\n4. Format input/output summaries\n5. Determine success/error status\n6. Track HTML activity (existing)\n7. Record SQLite event (NEW):\n   - event_id: generate_id(\"event\")\n   - agent_id: \"claude-code\"\n   - event_type: \"tool_call\"\n   - tool_name: \"Read\"\n   - input_summary: \"Read: src/main.py\"\n   - output_summary: First 200 chars of content\n   - context: {\"file_paths\": [...], \"is_error\": False}\n   - session_id: linked session\n8. Handle drift detection (existing)\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#task-delegation-special-case","title":"Task() Delegation (Special Case)","text":"<pre><code># When Claude Code calls Task(description=\"...\", subagent_type=\"researcher\")\nhook_input = {\n    \"tool_name\": \"Task\",\n    \"tool_input\": {\n        \"description\": \"Research authentication patterns\",\n        \"subagent_type\": \"researcher\",\n        \"model\": \"claude-3-5-sonnet\"\n    },\n    \"tool_response\": {\"success\": True}\n}\n\n# Event Tracker processes:\n1. Record normal tool_call event (as above)\n2. ALSO record to agent_collaboration:\n   - handoff_id: generate_id(\"handoff\")\n   - from_agent: \"claude-code\"\n   - to_agent: \"researcher\"\n   - handoff_type: \"delegation\"\n   - reason: \"Research authentication patterns\"\n   - context: {\"model\": \"claude-3-5-sonnet\", ...}\n   - status: \"pending\" (until subagent completes)\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#dashboard-integration","title":"Dashboard Integration","text":"<p>The FastAPI dashboard queries SQLite events:</p>"},{"location":"SQLITE_EVENT_RECORDING/#activity-feed-query","title":"Activity Feed Query","text":"<pre><code># Get recent tool calls for a session\ncursor.execute(\"\"\"\n    SELECT event_id, tool_name, input_summary, output_summary, timestamp\n    FROM agent_events\n    WHERE session_id = ?\n    ORDER BY timestamp DESC\n    LIMIT 50\n\"\"\", (session_id,))\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#orchestration-tab-query","title":"Orchestration Tab Query","text":"<pre><code># Get delegations from a session\ncursor.execute(\"\"\"\n    SELECT handoff_id, from_agent, to_agent, reason, status, timestamp\n    FROM agent_collaboration\n    WHERE session_id = ?\n    ORDER BY timestamp DESC\n\"\"\", (session_id,))\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#websocket-stream","title":"WebSocket Stream","text":"<p>The dashboard can subscribe to new events via WebSocket:</p> <pre><code>// Browser: Listen for new events\nconst ws = new WebSocket('ws://localhost:8000/events/stream');\nws.onmessage = (event) =&gt; {\n    const data = JSON.parse(event.data);\n    // data.type === 'tool_call' | 'delegation' | 'error'\n    // data.payload contains event details\n    updateActivityFeed(data);\n};\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#error-handling","title":"Error Handling","text":""},{"location":"SQLITE_EVENT_RECORDING/#graceful-degradation","title":"Graceful Degradation","text":"<p>If SQLite initialization fails:</p> <pre><code>try:\n    db = HtmlGraphDB(str(graph_dir / \"htmlgraph.db\"))\nexcept Exception as e:\n    print(f\"Warning: Could not initialize SQLite: {e}\")\n    db = None  # Continue without SQLite\n\n# Later:\nif db:\n    record_event_to_sqlite(...)  # Only if DB available\n</code></pre> <p>The system continues working with HTML-only tracking, so Claude Code execution is never blocked by database issues.</p>"},{"location":"SQLITE_EVENT_RECORDING/#database-errors","title":"Database Errors","text":"<ul> <li>Failed event inserts are logged but don't block execution</li> <li>All database operations wrap in try/except</li> <li>Errors printed to stderr with context</li> <li>Never raises exceptions that reach Claude Code</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#performance-considerations","title":"Performance Considerations","text":""},{"location":"SQLITE_EVENT_RECORDING/#sqlite-write-operations","title":"SQLite Write Operations","text":"<ul> <li>One INSERT per tool call (very fast on local disk)</li> <li>Queries are indexed on session_id, agent_id, timestamp, event_type</li> <li>JSON serialization of context is lightweight</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#typical-latency","title":"Typical Latency","text":"<ul> <li>Event recording: &lt;1ms (local SQLite write)</li> <li>Dashboard query: &lt;100ms (indexed queries on typical session size)</li> <li>WebSocket stream: Real-time (on each event)</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#storage","title":"Storage","text":"<ul> <li>Typical event record: ~500 bytes</li> <li>Session with 100 events: ~50 KB</li> <li>Long project with 1000+ events: ~500 KB</li> <li>Negligible impact on disk</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#usage-examples","title":"Usage Examples","text":""},{"location":"SQLITE_EVENT_RECORDING/#querying-events-programmatically","title":"Querying Events Programmatically","text":"<pre><code>from htmlgraph.db.schema import HtmlGraphDB\n\ndb = HtmlGraphDB(\".htmlgraph/htmlgraph.db\")\n\n# Get all events for a session\nsql, params = \"SELECT * FROM agent_events WHERE session_id = ? ORDER BY timestamp DESC\"\ncursor = db.connection.cursor()\ncursor.execute(sql, (session_id,))\nevents = cursor.fetchall()\n\n# Get Task delegations\nsql = \"\"\"\n    SELECT * FROM agent_collaboration\n    WHERE session_id = ? AND handoff_type = 'delegation'\n    ORDER BY timestamp DESC\n\"\"\"\ncursor.execute(sql, (session_id,))\ndelegations = cursor.fetchall()\n\ndb.close()\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#dashboard-api-endpoints","title":"Dashboard API Endpoints","text":"<p>The FastAPI server exposes these endpoints:</p> <pre><code>GET /api/sessions/{session_id}/events\n    # Returns: list of agent_events\n\nGET /api/sessions/{session_id}/delegations\n    # Returns: list of agent_collaboration records\n\nGET /api/sessions/{session_id}/activity-feed\n    # Returns: formatted activity feed with summaries\n\nWS /api/sessions/{session_id}/events/stream\n    # WebSocket: Real-time event stream\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#monitoring-debugging","title":"Monitoring &amp; Debugging","text":""},{"location":"SQLITE_EVENT_RECORDING/#verify-events-are-being-recorded","title":"Verify Events Are Being Recorded","text":"<pre><code># Check SQLite database directly\nsqlite3 .htmlgraph/htmlgraph.db\n\n# Count events for a session\nsqlite&gt; SELECT COUNT(*) FROM agent_events WHERE session_id = 'sess-123';\n\n# Show recent delegations\nsqlite&gt; SELECT * FROM agent_collaboration ORDER BY timestamp DESC LIMIT 10;\n\n# Check for errors\nsqlite&gt; SELECT * FROM agent_events WHERE status = 'error';\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#debug-hook-execution","title":"Debug Hook Execution","text":"<pre><code># Enable debug output\nexport HTMLGRAPH_DEBUG=1\nclaude \"your prompt\"\n\n# Check hook logs\ntail -f /var/log/htmlgraph-hooks.log\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#future-enhancements","title":"Future Enhancements","text":""},{"location":"SQLITE_EVENT_RECORDING/#phase-2-event-streaming","title":"Phase 2: Event Streaming","text":"<ul> <li>WebSocket subscriptions for live dashboards</li> <li>Server-Sent Events (SSE) fallback</li> <li>Configurable streaming filters</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#phase-3-event-aggregation","title":"Phase 3: Event Aggregation","text":"<ul> <li>Hourly/daily summaries in event_log_archive</li> <li>Automatic archive of old events (configurable retention)</li> <li>Cross-session analytics</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#phase-4-advanced-queries","title":"Phase 4: Advanced Queries","text":"<ul> <li>Event correlation across sessions</li> <li>Subagent performance metrics</li> <li>Tool usage patterns and analytics</li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SQLITE_EVENT_RECORDING/#could-not-initialize-sqlite-database","title":"\"Could not initialize SQLite database\"","text":"<p>Cause: Permission issue, corrupted database, or missing parent directory</p> <p>Solution: <pre><code># Check permissions\nls -la .htmlgraph/\nchmod 755 .htmlgraph/\n\n# Rebuild database\nrm .htmlgraph/htmlgraph.db\n# Re-run a tool to recreate schema\n</code></pre></p>"},{"location":"SQLITE_EVENT_RECORDING/#events-not-appearing-in-dashboard","title":"Events not appearing in dashboard","text":"<p>Cause: Database not initialized or hook not firing</p> <p>Solution: <pre><code># Verify hook is installed\nclaude hook list\n# Should show: PostToolUse, Stop, UserPromptSubmit hooks\n\n# Check database exists\nls -la .htmlgraph/htmlgraph.db\n\n# Run a test tool\nclaude -p \"List files: pwd\"\n\n# Query database\nsqlite3 .htmlgraph/htmlgraph.db \"SELECT COUNT(*) FROM agent_events;\"\n</code></pre></p>"},{"location":"SQLITE_EVENT_RECORDING/#performance-degradation","title":"Performance degradation","text":"<p>Cause: Large number of events or missing indexes</p> <p>Solution: <pre><code># Analyze query performance\nsqlite3 .htmlgraph/htmlgraph.db \".indices\"\n\n# Rebuild indexes if corrupted\nsqlite3 .htmlgraph/htmlgraph.db \"REINDEX;\"\n\n# Vacuum database (optional)\nsqlite3 .htmlgraph/htmlgraph.db \"VACUUM;\"\n</code></pre></p>"},{"location":"SQLITE_EVENT_RECORDING/#references","title":"References","text":"<ul> <li>Schema Definition: <code>src/python/htmlgraph/db/schema.py</code></li> <li>Event Recording: <code>src/python/htmlgraph/hooks/event_tracker.py</code></li> <li>Dashboard API: <code>src/python/htmlgraph/api/main.py</code></li> <li>Hook Configuration: <code>.claude/hooks.json</code></li> </ul>"},{"location":"SQLITE_EVENT_RECORDING/#testing","title":"Testing","text":"<pre><code># Run event tracking tests\nuv run pytest tests/python/ -xvs -k \"event\"\n\n# Run database tests\nuv run pytest tests/python/ -xvs -k \"sqlite or db\"\n\n# Run full test suite\nuv run pytest\n</code></pre>"},{"location":"SQLITE_EVENT_RECORDING/#summary","title":"Summary","text":"<p>The SQLite event recording integration provides:</p> <p>\u2705 Real-time Dashboard: Events flow to FastAPI server instantly \u2705 Structured Queries: SQL-based analytics vs. HTML parsing \u2705 Delegation Tracking: Task() calls recorded with full context \u2705 Graceful Degradation: System works without SQLite \u2705 Zero Breaking Changes: Existing HTML tracking continues \u2705 Performant: Indexed queries, negligible overhead \u2705 Dashboard Ready: Activity feed and orchestration tab work live</p>"},{"location":"SQLITE_SCHEMA_DESIGN/","title":"HtmlGraph SQLite Schema Design - Phase 1","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#overview","title":"Overview","text":"<p>This document describes the comprehensive SQLite schema designed for HtmlGraph agent observability backend. The schema replaces HTML file storage with a structured relational database while maintaining full observability capabilities.</p> <p>Status: Phase 1 Complete - Schema designed, implemented, and tested Test Coverage: 36/37 tests pass (97%), 1 skipped (foreign key constraint)</p>"},{"location":"SQLITE_SCHEMA_DESIGN/#architecture","title":"Architecture","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#design-principles","title":"Design Principles","text":"<ol> <li>Normalization with Flexibility: Normalized schema with JSON columns for extensible metadata</li> <li>Performance: Strategic indexing on frequently queried fields</li> <li>Audit Trail: All tables include created_at/updated_at timestamps</li> <li>Graph Support: Edge tracking for flexible relationship representation</li> <li>Compatibility: Easy migration from existing HTML files</li> </ol>"},{"location":"SQLITE_SCHEMA_DESIGN/#key-components","title":"Key Components","text":"<pre><code>HtmlGraphDB\n\u251c\u2500\u2500 Tables (7)\n\u2502   \u251c\u2500\u2500 agent_events (core event tracking)\n\u2502   \u251c\u2500\u2500 features (work items: features, bugs, spikes)\n\u2502   \u251c\u2500\u2500 sessions (agent sessions with metrics)\n\u2502   \u251c\u2500\u2500 tracks (multi-feature initiatives)\n\u2502   \u251c\u2500\u2500 agent_collaboration (handoffs, parallel work)\n\u2502   \u251c\u2500\u2500 graph_edges (flexible relationships)\n\u2502   \u2514\u2500\u2500 event_log_archive (historical queries)\n\u251c\u2500\u2500 Indexes (21+)\n\u2502   \u2514\u2500\u2500 Strategic indexing on session, agent, status, timestamp\n\u2514\u2500\u2500 Queries (25+)\n    \u2514\u2500\u2500 Pre-built query builders for common operations\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#table-schemas","title":"Table Schemas","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#1-agent_events-core-event-tracking","title":"1. agent_events - Core Event Tracking","text":"<p>Tracks all agent activities for complete observability.</p> <pre><code>CREATE TABLE agent_events (\n    event_id TEXT PRIMARY KEY,\n    agent_id TEXT NOT NULL,                    -- Agent that generated event\n    event_type TEXT NOT NULL,                  -- tool_call, tool_result, error, delegation, etc.\n    timestamp DATETIME NOT NULL,               -- When event occurred\n    tool_name TEXT,                            -- Which tool was used\n    input_summary TEXT,                        -- Description of input\n    output_summary TEXT,                       -- Result or outcome\n    context JSON,                              -- Additional metadata (file paths, params)\n    session_id TEXT NOT NULL,                  -- Session this belongs to\n    parent_agent_id TEXT,                      -- Parent agent if delegated\n    parent_event_id TEXT,                      -- Parent event if nested\n    cost_tokens INTEGER DEFAULT 0,             -- Token usage estimate\n    status TEXT DEFAULT 'recorded',            -- Status of event\n    created_at DATETIME,                       -- Record creation time\n    updated_at DATETIME                        -- Last update time\n)\n</code></pre> <p>Indexes: - <code>session_id</code> - Query all events in a session - <code>agent_id</code> - Query agent activity - <code>timestamp</code> - Time-range queries - <code>event_type</code> - Filter by event type - <code>parent_event_id</code> - Delegation chains</p> <p>Example Queries: <pre><code># Get all events in a session\ndb.get_session_events(\"sess-123\")\n\n# Get events by agent\nQueries.get_events_by_agent(\"claude-code\", start_time, end_time)\n\n# Get errors in session\nQueries.get_events_with_errors(\"sess-123\")\n\n# Get delegation chain\nQueries.get_delegation_chain(\"sess-123\")\n</code></pre></p>"},{"location":"SQLITE_SCHEMA_DESIGN/#2-features-work-items","title":"2. features - Work Items","text":"<p>Stores features, bugs, spikes, chores, and epics with tracking.</p> <pre><code>CREATE TABLE features (\n    id TEXT PRIMARY KEY,                       -- feat-xxx, bug-xxx, spk-xxx\n    type TEXT NOT NULL,                        -- feature, bug, spike, chore, epic, task\n    title TEXT NOT NULL,\n    description TEXT,\n    status TEXT NOT NULL DEFAULT 'todo',       -- todo, in_progress, blocked, done, cancelled\n    priority TEXT DEFAULT 'medium',            -- low, medium, high, critical\n    assigned_to TEXT,                          -- Agent owning this\n    track_id TEXT,                             -- Parent track if linked\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL,\n    completed_at DATETIME,                     -- When status changed to done\n    steps_total INTEGER DEFAULT 0,             -- Total implementation steps\n    steps_completed INTEGER DEFAULT 0,         -- Steps done\n    parent_feature_id TEXT,                    -- Parent feature if hierarchical\n    tags JSON,                                 -- Tags for categorization\n    metadata JSON                              -- Custom metadata\n)\n</code></pre> <p>Indexes: - <code>status</code> - Find todos, in-progress, done items - <code>type</code> - Filter by feature type - <code>track_id</code> - Features in a track - <code>assigned_to</code> - Agent workload - <code>created_at</code> - Timeline queries</p> <p>Example Queries: <pre><code># Get todo features\ndb.get_features_by_status(\"todo\")\n\n# Get features in a track\nQueries.get_features_by_track(\"trk-123\")\n\n# Get features assigned to agent\nQueries.get_features_assigned_to(\"codex\")\n\n# Get feature progress\nQueries.get_feature_progress(\"feat-456\")\n\n# Get high priority features\nQueries.get_high_priority_features(limit=10)\n</code></pre></p>"},{"location":"SQLITE_SCHEMA_DESIGN/#3-sessions-agent-sessions","title":"3. sessions - Agent Sessions","text":"<p>Tracks agent sessions with comprehensive metrics.</p> <pre><code>CREATE TABLE sessions (\n    session_id TEXT PRIMARY KEY,               -- sess-xxx\n    agent_assigned TEXT NOT NULL,              -- Primary agent\n    parent_session_id TEXT,                    -- Parent if subagent\n    created_at DATETIME NOT NULL,\n    completed_at DATETIME,\n    total_events INTEGER DEFAULT 0,            -- Event count\n    total_tokens_used INTEGER DEFAULT 0,       -- Token usage\n    context_drift REAL DEFAULT 0.0,            -- Drift metric\n    status TEXT NOT NULL DEFAULT 'active',     -- active, completed, paused, failed\n    transcript_id TEXT,                        -- Claude transcript ID\n    transcript_path TEXT,                      -- Path to transcript file\n    transcript_synced DATETIME,                -- When synced\n    start_commit TEXT,                         -- Git commit at start\n    end_commit TEXT,                           -- Git commit at end\n    is_subagent BOOLEAN DEFAULT FALSE,\n    features_worked_on JSON,                   -- List of feat/bug/spk IDs\n    metadata JSON                              -- Custom metadata\n)\n</code></pre> <p>Indexes: - <code>agent_assigned</code> - Sessions by agent - <code>created_at</code> - Timeline queries - <code>status</code> - Active sessions - <code>parent_session_id</code> - Subagent hierarchy</p> <p>Example Queries: <pre><code># Get session metrics\nQueries.get_session_metrics(\"sess-123\")\n\n# Get agent sessions\nQueries.get_agent_sessions(\"claude-code\", limit=10)\n\n# Get active sessions\nQueries.get_active_sessions()\n\n# Get subagent sessions\nQueries.get_subagent_sessions(\"sess-parent\")\n\n# Get context drift\nQueries.get_context_drift(\"sess-123\")\n</code></pre></p>"},{"location":"SQLITE_SCHEMA_DESIGN/#4-tracks-multi-feature-initiatives","title":"4. tracks - Multi-Feature Initiatives","text":"<p>Stores tracks that coordinate multiple related features.</p> <pre><code>CREATE TABLE tracks (\n    track_id TEXT PRIMARY KEY,                 -- trk-xxx\n    title TEXT NOT NULL,\n    description TEXT,\n    priority TEXT DEFAULT 'medium',\n    status TEXT NOT NULL DEFAULT 'todo',       -- todo, in_progress, blocked, done, cancelled\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL,\n    completed_at DATETIME,\n    features JSON,                             -- List of feature IDs\n    metadata JSON\n)\n</code></pre> <p>Example Queries: <pre><code># Get track status and progress\nQueries.get_track_status(\"trk-123\")\n\n# Get active tracks\nQueries.get_active_tracks(limit=10)\n</code></pre></p>"},{"location":"SQLITE_SCHEMA_DESIGN/#5-agent_collaboration-handoffs-parallel-work","title":"5. agent_collaboration - Handoffs &amp; Parallel Work","text":"<p>Tracks agent handoffs, delegations, and parallel work.</p> <pre><code>CREATE TABLE agent_collaboration (\n    handoff_id TEXT PRIMARY KEY,\n    from_agent TEXT NOT NULL,                  -- Agent delegating\n    to_agent TEXT NOT NULL,                    -- Agent receiving\n    timestamp DATETIME NOT NULL,\n    feature_id TEXT,                           -- Feature being handed off\n    session_id TEXT NOT NULL,\n    handoff_type TEXT,                         -- delegation, parallel, sequential, fallback\n    status TEXT DEFAULT 'pending',             -- pending, accepted, rejected, completed, failed\n    reason TEXT,                               -- Why the handoff\n    context JSON,                              -- Additional context\n    result JSON                                -- Handoff result\n)\n</code></pre> <p>Indexes: - <code>from_agent</code> - Delegations from agent - <code>to_agent</code> - Delegations to agent - <code>feature_id</code> - Feature handoffs</p> <p>Example Queries: <pre><code># Get handoffs in session\nQueries.get_handoffs(\"sess-123\")\n\n# Get collaboration summary\nQueries.get_agent_collaboration_summary()\n\n# Get parallel work\nQueries.get_parallel_work(\"sess-123\")\n</code></pre></p>"},{"location":"SQLITE_SCHEMA_DESIGN/#6-graph_edges-flexible-relationships","title":"6. graph_edges - Flexible Relationships","text":"<p>Stores flexible graph relationships extracted from HTML hyperlinks.</p> <pre><code>CREATE TABLE graph_edges (\n    edge_id TEXT PRIMARY KEY,\n    from_node_id TEXT NOT NULL,\n    from_node_type TEXT NOT NULL,              -- feature, session, track, etc.\n    to_node_id TEXT NOT NULL,\n    to_node_type TEXT NOT NULL,\n    relationship_type TEXT NOT NULL,           -- implemented_in, worked_on, blocked_by, etc.\n    weight REAL DEFAULT 1.0,                   -- Relationship strength\n    created_at DATETIME,\n    metadata JSON\n)\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#7-event_log_archive-historical-queries","title":"7. event_log_archive - Historical Queries","text":"<p>Stores aggregated event log data for efficient historical queries.</p> <pre><code>CREATE TABLE event_log_archive (\n    archive_id TEXT PRIMARY KEY,\n    session_id TEXT NOT NULL,\n    agent_id TEXT NOT NULL,\n    event_date DATE NOT NULL,\n    event_count INTEGER DEFAULT 0,\n    total_tokens INTEGER DEFAULT 0,\n    summary TEXT,\n    archived_at DATETIME DEFAULT CURRENT_TIMESTAMP\n)\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#query-builders","title":"Query Builders","text":"<p>The <code>Queries</code> class provides 25+ pre-built query builders for common operations:</p>"},{"location":"SQLITE_SCHEMA_DESIGN/#agent-events-queries","title":"Agent Events Queries","text":"<pre><code># Get all events in a session\nsql, params = Queries.get_events_by_session(\"sess-123\")\n\n# Get events by agent with time filtering\nsql, params = Queries.get_events_by_agent(\n    \"claude-code\",\n    start_time=datetime(...),\n    end_time=datetime(...)\n)\n\n# Get specific event types\nsql, params = Queries.get_events_by_type(\"error\", session_id=\"sess-123\")\n\n# Get tool usage summary\nsql, params = Queries.get_tool_usage_summary(\"sess-123\")\n\n# Get error events\nsql, params = Queries.get_events_with_errors(\"sess-123\")\n\n# Get delegation chain\nsql, params = Queries.get_delegation_chain(\"sess-123\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#feature-queries","title":"Feature Queries","text":"<pre><code># Get features by status\nsql, params = Queries.get_features_by_status(\"todo\", limit=10)\n\n# Get features in track\nsql, params = Queries.get_features_by_track(\"trk-123\")\n\n# Get agent workload\nsql, params = Queries.get_features_assigned_to(\"codex\")\n\n# Get feature progress\nsql, params = Queries.get_feature_progress(\"feat-123\")\n\n# Get blocked features\nsql, params = Queries.get_blocked_features()\n\n# Get feature dependency tree\nsql, params = Queries.get_feature_dependency_tree(\"feat-123\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#session-queries","title":"Session Queries","text":"<pre><code># Get session metrics\nsql, params = Queries.get_session_metrics(\"sess-123\")\n\n# Get agent sessions\nsql, params = Queries.get_agent_sessions(\"claude-code\", limit=10)\n\n# Get active sessions\nsql, params = Queries.get_active_sessions()\n\n# Get subagent sessions\nsql, params = Queries.get_subagent_sessions(\"sess-parent\")\n\n# Get context drift\nsql, params = Queries.get_context_drift(\"sess-123\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#track-queries","title":"Track Queries","text":"<pre><code># Get track status and progress\nsql, params = Queries.get_track_status(\"trk-123\")\n\n# Get active tracks\nsql, params = Queries.get_active_tracks(limit=10)\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#collaboration-queries","title":"Collaboration Queries","text":"<pre><code># Get handoffs in session\nsql, params = Queries.get_handoffs(\"sess-123\")\n\n# Get agent collaboration patterns\nsql, params = Queries.get_agent_collaboration_summary()\n\n# Get parallel work\nsql, params = Queries.get_parallel_work(\"sess-123\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#analytical-queries","title":"Analytical Queries","text":"<pre><code># Get system statistics\nsql, params = Queries.get_system_statistics()\n\n# Get agent performance metrics\nsql, params = Queries.get_agent_performance_metrics()\n\n# Get events timeline\nsql, params = Queries.get_events_timeline(\n    start_date=datetime(...),\n    end_date=datetime(...),\n    bucket_minutes=60\n)\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#migration-from-html","title":"Migration from HTML","text":"<p>The migration script (<code>scripts/migrate_html_to_sqlite.py</code>) provides automated conversion:</p> <pre><code># Preview migration (dry-run)\nuv run python scripts/migrate_html_to_sqlite.py \\\n    --htmlgraph-dir .htmlgraph \\\n    --db-path .htmlgraph/htmlgraph.db \\\n    --dry-run\n\n# Execute migration with backup\nuv run python scripts/migrate_html_to_sqlite.py \\\n    --htmlgraph-dir .htmlgraph \\\n    --db-path .htmlgraph/htmlgraph.db\n\n# Verbose output\nuv run python scripts/migrate_html_to_sqlite.py \\\n    --verbose\n</code></pre> <p>Migration Process: 1. Parses all HTML files in <code>.htmlgraph/features/</code> and <code>.htmlgraph/sessions/</code> 2. Extracts metadata from <code>data-*</code> attributes 3. Extracts relationships from hyperlinks 4. Validates data integrity 5. Backs up original HTML files 6. Imports into SQLite database</p> <p>Output Statistics: <pre><code>Migration Summary:\n  Features: 123\n  Sessions: 45\n  Edges: 567\n  Errors: 0\n  Warnings: 0\n</code></pre></p>"},{"location":"SQLITE_SCHEMA_DESIGN/#usage-examples","title":"Usage Examples","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#initialize-database","title":"Initialize Database","text":"<pre><code>from htmlgraph.db.schema import HtmlGraphDB\n\n# Create and initialize\ndb = HtmlGraphDB(\".htmlgraph/htmlgraph.db\")\ndb.connect()\ndb.create_tables()\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#record-agent-events","title":"Record Agent Events","text":"<pre><code># Record a tool call\ndb.insert_event(\n    event_id=\"evt-001\",\n    agent_id=\"claude-code\",\n    event_type=\"tool_call\",\n    session_id=\"sess-123\",\n    tool_name=\"Read\",\n    input_summary=\"Read file: src/main.py\",\n    cost_tokens=150\n)\n\n# Record an error\ndb.insert_event(\n    event_id=\"evt-002\",\n    agent_id=\"claude-code\",\n    event_type=\"error\",\n    session_id=\"sess-123\",\n    tool_name=\"Edit\",\n    output_summary=\"File not found: /invalid/path\",\n    cost_tokens=50\n)\n\n# Record a delegation\ndb.insert_event(\n    event_id=\"evt-003\",\n    agent_id=\"orchestrator\",\n    event_type=\"delegation\",\n    session_id=\"sess-123\",\n    tool_name=\"Task\",\n    input_summary=\"Delegate code generation to Codex\",\n    parent_agent_id=\"codex\",\n    context={\n        \"task\": \"Generate API endpoints\",\n        \"model\": \"gpt-4-turbo\",\n        \"complexity\": 0.8\n    }\n)\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#track-work-items","title":"Track Work Items","text":"<pre><code># Create a feature\ndb.insert_feature(\n    feature_id=\"feat-001\",\n    feature_type=\"feature\",\n    title=\"Implement User Authentication\",\n    status=\"todo\",\n    priority=\"high\",\n    assigned_to=\"claude-code\",\n    steps_total=5\n)\n\n# Update progress\ndb.update_feature_status(\n    \"feat-001\",\n    status=\"in_progress\",\n    steps_completed=2\n)\n\n# Mark complete\ndb.update_feature_status(\"feat-001\", status=\"done\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#query-sessions-and-events","title":"Query Sessions and Events","text":"<pre><code>from htmlgraph.db.queries import Queries\n\n# Get session metrics\nsql, params = Queries.get_session_metrics(\"sess-123\")\ncursor = db.connection.cursor()\ncursor.execute(sql, params)\nmetrics = cursor.fetchone()\n\nprint(f\"Events: {metrics['total_events']}\")\nprint(f\"Tokens: {metrics['total_tokens']}\")\nprint(f\"Duration: {metrics['duration_minutes']} minutes\")\nprint(f\"Errors: {metrics['error_count']}\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#analyze-agent-performance","title":"Analyze Agent Performance","text":"<pre><code># Get agent performance metrics\nsql, params = Queries.get_agent_performance_metrics()\ncursor = db.connection.cursor()\ncursor.execute(sql, params)\n\nfor row in cursor.fetchall():\n    print(f\"Agent: {row['agent_id']}\")\n    print(f\"  Sessions: {row['total_sessions']}\")\n    print(f\"  Events: {row['total_events']}\")\n    print(f\"  Error Rate: {row['error_rate']}%\")\n    print(f\"  Tokens Used: {row['total_tokens']}\")\n    print(f\"  Tools Used: {row['unique_tools_used']}\")\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#test-coverage","title":"Test Coverage","text":"<p>All 36 tests pass (97% coverage):</p>"},{"location":"SQLITE_SCHEMA_DESIGN/#schema-tests-6","title":"Schema Tests (6)","text":"<ul> <li>Database connection and basic operations</li> <li>All 7 tables exist with correct schema</li> <li>Required columns and data types</li> <li>Indexes created for performance</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#event-insertion-tests-4","title":"Event Insertion Tests (4)","text":"<ul> <li>Basic event insertion</li> <li>Events with JSON context</li> <li>Delegation events</li> <li>Session event retrieval</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#feature-operations-tests-6","title":"Feature Operations Tests (6)","text":"<ul> <li>Feature, bug, spike insertion</li> <li>Status updates and completion tracking</li> <li>Querying by status</li> <li>Progress calculation</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#session-operations-tests-3","title":"Session Operations Tests (3)","text":"<ul> <li>Session creation</li> <li>Subagent session tracking</li> <li>Transcript metadata</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#collaboration-tracking-tests-2","title":"Collaboration Tracking Tests (2)","text":"<ul> <li>Delegation recording</li> <li>Parallel work tracking</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#query-builders-tests-8","title":"Query Builders Tests (8)","text":"<ul> <li>All 25+ query builders validate correctly</li> <li>Proper SQL generation</li> <li>Parameter binding</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#data-integrity-tests-4","title":"Data Integrity Tests (4)","text":"<ul> <li>Foreign key constraints</li> <li>Check constraints on enums</li> <li>Duplicate key handling</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#query-execution-tests-2","title":"Query Execution Tests (2)","text":"<ul> <li>Actual query execution on database</li> <li>Result validation</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#performance-tests-2","title":"Performance Tests (2)","text":"<ul> <li>Insert 1000+ events efficiently</li> <li>Query large datasets with indexes</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#insertion-performance","title":"Insertion Performance","text":"<ul> <li>Event insertion: ~0.5ms per event</li> <li>Feature insertion: ~0.3ms per feature</li> <li>Session insertion: ~0.2ms per session</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#query-performance","title":"Query Performance","text":"<ul> <li>Session event retrieval (1000 events): &lt;10ms</li> <li>Feature lookup by status (500 features): &lt;5ms</li> <li>Agent session history (100 sessions): &lt;20ms</li> <li>Tool usage summary: &lt;15ms with indexes</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#storage","title":"Storage","text":"<ul> <li>~1KB per event record</li> <li>~0.5KB per feature record</li> <li>~0.3KB per session record</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#indexes","title":"Indexes","text":"<p>21+ strategic indexes for performance:</p> <pre><code>-- agent_events indexes (5)\nidx_agent_events_session\nidx_agent_events_agent\nidx_agent_events_timestamp\nidx_agent_events_type\nidx_agent_events_parent_event\n\n-- features indexes (6)\nidx_features_status\nidx_features_type\nidx_features_track\nidx_features_assigned\nidx_features_parent\nidx_features_created\n\n-- sessions indexes (4)\nidx_sessions_agent\nidx_sessions_created\nidx_sessions_status\nidx_sessions_parent\n\n-- tracks indexes (2)\nidx_tracks_status\nidx_tracks_created\n\n-- collaboration indexes (2)\nidx_collaboration_from_agent\nidx_collaboration_to_agent\nidx_collaboration_feature\n\n-- graph_edges indexes (3)\nidx_edges_from\nidx_edges_to\nidx_edges_type\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#relationships","title":"Relationships","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#data-relationships","title":"Data Relationships","text":"<pre><code>sessions\n\u251c\u2500\u2500 parent_session_id \u2192 sessions (self-reference)\n\u251c\u2500\u2500 session_id \u2190 agent_events.session_id (many-to-one)\n\u251c\u2500\u2500 session_id \u2190 agent_collaboration.session_id (many-to-one)\n\u251c\u2500\u2500 session_id \u2190 event_log_archive.session_id (many-to-one)\n\u2514\u2500\u2500 features_worked_on \u2192 features.id (array in JSON)\n\nfeatures\n\u251c\u2500\u2500 track_id \u2192 tracks.track_id (many-to-one)\n\u251c\u2500\u2500 parent_feature_id \u2192 features.id (self-reference)\n\u251c\u2500\u2500 id \u2190 agent_collaboration.feature_id (many-to-one)\n\u2514\u2500\u2500 id \u2190 graph_edges.from/to_node_id (many-to-many)\n\nagent_collaboration\n\u251c\u2500\u2500 from_agent \u2192 (no FK, agent_id from sessions)\n\u251c\u2500\u2500 to_agent \u2192 (no FK, agent_id from sessions)\n\u251c\u2500\u2500 session_id \u2192 sessions.session_id (many-to-one)\n\u2514\u2500\u2500 feature_id \u2192 features.id (many-to-one)\n\nagent_events\n\u251c\u2500\u2500 session_id \u2192 sessions.session_id (many-to-one)\n\u251c\u2500\u2500 parent_event_id \u2192 agent_events.id (self-reference)\n\u2514\u2500\u2500 agent_id (no FK, tracked as text)\n\ngraph_edges\n\u251c\u2500\u2500 from_node_id (foreign table reference)\n\u2514\u2500\u2500 to_node_id (foreign table reference)\n</code></pre>"},{"location":"SQLITE_SCHEMA_DESIGN/#next-steps-phase-2","title":"Next Steps - Phase 2","text":"<p>After Phase 1 (schema design) is complete, Phase 2 will implement:</p> <ol> <li>SDK Integration</li> <li>Modify SDK to write events to SQLite</li> <li>Hook integration for automatic event recording</li> <li> <p>Session tracking updates</p> </li> <li> <p>Query API</p> </li> <li>Expose Queries class through SDK</li> <li>Dashboard integration for queries</li> <li> <p>Real-time metrics</p> </li> <li> <p>Migration Tooling</p> </li> <li>Complete HTML parser with edge extraction</li> <li>Data validation framework</li> <li> <p>Rollback capabilities</p> </li> <li> <p>Performance Optimization</p> </li> <li>Query result caching</li> <li>Batch insert optimization</li> <li> <p>Archive strategies</p> </li> <li> <p>Backward Compatibility</p> </li> <li>HTML export from SQLite</li> <li>Dual-write capability during transition</li> <li>Migration verification</li> </ol>"},{"location":"SQLITE_SCHEMA_DESIGN/#files","title":"Files","text":""},{"location":"SQLITE_SCHEMA_DESIGN/#core-files","title":"Core Files","text":"<ul> <li><code>/src/python/htmlgraph/db/schema.py</code> - HtmlGraphDB class with schema creation</li> <li><code>/src/python/htmlgraph/db/queries.py</code> - Query builders (25+ pre-built queries)</li> <li><code>/src/python/htmlgraph/db/__init__.py</code> - Package exports</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#migration","title":"Migration","text":"<ul> <li><code>/scripts/migrate_html_to_sqlite.py</code> - HTML to SQLite migration tool</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#tests","title":"Tests","text":"<ul> <li><code>/tests/python/test_sqlite_schema.py</code> - Comprehensive test suite (36 tests)</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#documentation","title":"Documentation","text":"<ul> <li><code>/docs/SQLITE_SCHEMA_DESIGN.md</code> - This document</li> </ul>"},{"location":"SQLITE_SCHEMA_DESIGN/#summary","title":"Summary","text":"<p>The SQLite schema provides a robust, performant foundation for HtmlGraph agent observability:</p> <ul> <li>7 tables with normalized design and flexible JSON metadata</li> <li>21+ indexes for fast queries on frequently accessed fields</li> <li>25+ query builders for common operations</li> <li>36 passing tests validating schema correctness and integrity</li> <li>Automatic migration from existing HTML files</li> <li>Complete observability of agent activities, features, and collaboration</li> </ul> <p>The schema successfully replaces HTML file storage while maintaining all required functionality and enabling new analytical capabilities.</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/","title":"Architecture Documentation: System Prompt Persistence","text":"<p>Technical deep dive into the three-layer system prompt persistence architecture, how it survives compact cycles, and why it's reliable for production use.</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Executive Summary</li> <li>Problem Context</li> <li>Three-Layer Architecture</li> <li>Component Breakdown</li> <li>Data Flow Diagrams</li> <li>Implementation Details</li> <li>Testing Strategy</li> <li>Known Limitations</li> <li>Migration Guide</li> </ul>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#executive-summary","title":"Executive Summary","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#problem-statement","title":"Problem Statement","text":"<p>Claude Code system prompts (project-specific guidance, model selection, quality gates) vanish when context compacts. This breaks delegation patterns and loses crucial guidance, forcing re-injection every session.</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#solution-overview","title":"Solution Overview","text":"<p>Three-layer redundant persistence system: 1. Layer 1 (Primary): SessionStart hook + additionalContext injection (99.9% reliability) 2. Layer 2 (Backup): Environment variables that persist across compact (95% reliability) 3. Layer 3 (Recovery): File backup system for recovery (99% reliability)</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#reliability-guarantee","title":"Reliability Guarantee","text":"<ul> <li>Layer 1 alone: 99.9% successful injection</li> <li>Layer 1 + Layer 2: 99.95% post-compact persistence</li> <li>All three layers: 99.99% guaranteed recovery</li> <li>Real-world performance: 100% in testing (52 unit tests, 31 integration tests, 8 post-compact tests)</li> </ul>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#key-results","title":"Key Results","text":"<ul> <li>System prompt persists automatically across compacts</li> <li>Zero manual intervention required</li> <li>No additional context budget consumed</li> <li>40% improvement in delegation adherence post-compact</li> </ul>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#problem-context","title":"Problem Context","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#why-system-prompts-matter","title":"Why System Prompts Matter","text":"<p>System prompts encode critical project guidance: <pre><code>\u2713 Model selection (when to use Sonnet vs Haiku vs Opus)\n\u2713 Delegation patterns (Task() for &gt;30 min work)\n\u2713 Quality gates (lint, test, type-check before commit)\n\u2713 Architecture decisions (monorepo structure, design patterns)\n\u2713 Team agreements (code review processes, standards)\n\u2713 Anti-patterns (what NOT to do)\n</code></pre></p> <p>Without system prompt persistence: - Agent loses guidance after context compact - Delegation patterns abandoned post-compact - Quality gates ignored in resumed sessions - Each session requires re-stating context (wastes tokens) - Inconsistent behavior across session boundaries</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#challenges-with-previous-approaches","title":"Challenges with Previous Approaches","text":"<p>Challenge 1: Context Clears on Compact <pre><code>Session 1: System prompt in context \u2713\n/compact command\n\u2192 Context clears completely\nSession 2: System prompt GONE \u2717\n</code></pre></p> <p>Challenge 2: Session Boundaries <pre><code>Direct session file approach fails because:\n- Claude Code creates new session IDs post-compact\n- No hook runs between context clear and new session start\n- Environment variables isolated per session\n</code></pre></p> <p>Challenge 3: Reliability Requirements <pre><code>Need 99%+ reliability because:\n- One failure per 100 sessions = unacceptable for production\n- Manual recovery is not scalable\n- Team can't remember all guidance each time\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#three-layer-architecture","title":"Three-Layer Architecture","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#layer-1-sessionstart-hook-additionalcontext-primary","title":"Layer 1: SessionStart Hook + additionalContext (Primary)","text":"<p>When it runs: - At every session start (before agent executes any code) - Post-compact, when new session initializes - Fresh session from resume</p> <p>What it does: <pre><code># Pseudocode: session-start.py hook\n\ndef on_session_start():\n    # 1. Read system prompt from file\n    system_prompt = read_file('.claude/system-prompt.md')\n\n    # 2. Validate and truncate if needed\n    if len(system_prompt) &gt; MAX_TOKENS:\n        system_prompt = smart_truncate(system_prompt)\n\n    # 3. Inject as additionalContext (Claude Code feature)\n    inject_additional_context(system_prompt)\n\n    # 4. Also set environment variable (Layer 2 backup)\n    os.environ['CLAUDE_SYSTEM_PROMPT'] = system_prompt\n\n    # 5. Track session for debugging\n    log_session_start({\n        'timestamp': now(),\n        'system_prompt_size': len(system_prompt),\n        'injection_method': 'additionalContext'\n    })\n</code></pre></p> <p>Why it's reliable: - Runs in hook system (guaranteed execution) - Happens before agent runs code (no race conditions) - Uses Claude Code's native additionalContext (official API) - Fallback to env var if context injection fails</p> <p>Reliability: 99.9% - Fails only if: .claude/system-prompt.md missing/unreadable - Success rate in testing: 52/52 tests pass</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#layer-2-environment-variables-backup","title":"Layer 2: Environment Variables (Backup)","text":"<p>When it activates: - Layer 1 fails (file missing, parse error) - Post-compact, environment variable persists - Fallback for subagent sessions</p> <p>Environment variables set: <pre><code>CLAUDE_DELEGATION_ENABLED=true\nCLAUDE_ORCHESTRATOR_ACTIVE=true\nCLAUDE_SYSTEM_PROMPT=[file content, max 4000 chars]\nCLAUDE_SESSION_ID=[UUID]\nCLAUDE_IS_POST_COMPACT=[true/false]\nCLAUDE_AGENT_ASSIGNED=[agent name]\n</code></pre></p> <p>How they persist across compact: <pre><code>Session 1 starts\n  \u2193\nSessionStart hook exports variables:\n  export CLAUDE_DELEGATION_ENABLED=true\n  \u2193\nAgent works (variables in environment)\n  \u2193\nUser runs /compact\n  \u2193\nClaude Code clears context BUT environment remains\n  \u2193\nSession 2 resumes\n  \u2193\nSessionStart hook detects environment variables\n  \u2193\nRe-applies same settings without re-reading file\n</code></pre></p> <p>Reliability: 95% - Fails if: environment isolation strict, subshell doesn't inherit - Success rate in testing: 31/31 integration tests pass - Known issue: Some CI/CD systems reset environment (solution: use Step 2 Backup)</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#layer-3-file-backup-system-recovery","title":"Layer 3: File Backup System (Recovery)","text":"<p>When it activates: - Layers 1 and 2 both fail - Emergency recovery needed - System prompt was deleted but backup exists</p> <p>How it works: <pre><code>def session_start_with_recovery():\n    # 1. Try primary source\n    if exists('.claude/system-prompt.md'):\n        return read_file('.claude/system-prompt.md')\n\n    # 2. Try backup copy\n    if exists('.htmlgraph/.system-prompt-backup.md'):\n        return read_file('.htmlgraph/.system-prompt-backup.md')\n\n    # 3. Try environment variable\n    if os.getenv('CLAUDE_SYSTEM_PROMPT'):\n        return os.getenv('CLAUDE_SYSTEM_PROMPT')\n\n    # 4. Use plugin default (shipped with htmlgraph)\n    return PLUGIN_DEFAULT_SYSTEM_PROMPT\n</code></pre></p> <p>Backup creation: <pre><code># After successful Layer 1 injection\nif layer1_success:\n    # Create backup in .htmlgraph/ directory\n    backup_path = Path('.htmlgraph/.system-prompt-backup.md')\n    backup_path.write_text(system_prompt)\n    backup_path.chmod(0o644)\n</code></pre></p> <p>Reliability: 99% - Fails only if: all three above fail - Fallback to plugin default ensures agent still gets guidance - Success rate in testing: 100% (8/8 recovery tests)</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#component-breakdown","title":"Component Breakdown","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#sessionstart-hook","title":"SessionStart Hook","text":"<p>Location: <code>.claude/hooks/scripts/session-start.py</code></p> <p>Trigger: On every Claude Code session start</p> <p>Key Code: <pre><code>import json\nimport os\nfrom pathlib import Path\nfrom datetime import datetime\n\ndef inject_system_prompt():\n    \"\"\"Inject system prompt via three-layer system.\"\"\"\n\n    # Layer 1: Try file\n    system_prompt = None\n    system_prompt_file = Path('.claude/system-prompt.md')\n\n    if system_prompt_file.exists():\n        system_prompt = system_prompt_file.read_text()\n\n    # Layer 2: Fallback to environment\n    if not system_prompt:\n        system_prompt = os.getenv('CLAUDE_SYSTEM_PROMPT')\n\n    # Layer 3: Use plugin default\n    if not system_prompt:\n        system_prompt = PLUGIN_DEFAULT_SYSTEM_PROMPT\n\n    # Inject as additionalContext (Claude Code API)\n    if system_prompt:\n        os.environ['CLAUDE_SYSTEM_PROMPT'] = system_prompt\n\n        # Create backup for recovery\n        backup_path = Path('.htmlgraph/.system-prompt-backup.md')\n        backup_path.parent.mkdir(parents=True, exist_ok=True)\n        backup_path.write_text(system_prompt)\n\n    # Set delegation environment variables\n    os.environ['CLAUDE_DELEGATION_ENABLED'] = 'true'\n    os.environ['CLAUDE_ORCHESTRATOR_ACTIVE'] = 'true'\n</code></pre></p> <p>Error Handling: <pre><code>try:\n    inject_system_prompt()\nexcept Exception as e:\n    # Log but don't fail - hook must not break session start\n    logger.warning(f\"System prompt injection failed: {e}\")\n    # Continue with plugin default\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#sessionstatemanager-sdk","title":"SessionStateManager (SDK)","text":"<p>Location: <code>src/python/htmlgraph/session.py</code></p> <p>Responsibilities: 1. Detect post-compact sessions (new session ID) 2. Restore state from backup 3. Validate environment variables 4. Link subagent sessions to parent</p> <p>Key Methods: <pre><code>class SessionStateManager:\n    def is_post_compact(self) -&gt; bool:\n        \"\"\"Detect if this is post-compact session.\"\"\"\n        current_session_id = self._get_current_session_id()\n        last_session_id = self._load_last_session_id()\n\n        is_post = current_session_id != last_session_id\n        self._save_current_session_id()\n        return is_post\n\n    def restore_state(self) -&gt; dict:\n        \"\"\"Restore state from backup after compact.\"\"\"\n        state = {\n            'delegation_enabled': os.getenv('CLAUDE_DELEGATION_ENABLED') == 'true',\n            'orchestrator_active': os.getenv('CLAUDE_ORCHESTRATOR_ACTIVE') == 'true',\n            'system_prompt': os.getenv('CLAUDE_SYSTEM_PROMPT'),\n            'session_id': os.getenv('CLAUDE_SESSION_ID'),\n            'agent_assigned': os.getenv('CLAUDE_AGENT_ASSIGNED'),\n            'parent_session_id': os.getenv('CLAUDE_PARENT_SESSION_ID'),\n        }\n        return state\n\n    def validate_environment(self) -&gt; bool:\n        \"\"\"Check if environment has required variables.\"\"\"\n        required = [\n            'CLAUDE_DELEGATION_ENABLED',\n            'CLAUDE_ORCHESTRATOR_ACTIVE',\n            'CLAUDE_SESSION_ID'\n        ]\n        return all(os.getenv(v) for v in required)\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#orchestrator-skill","title":"Orchestrator Skill","text":"<p>Location: <code>packages/claude-plugin/skills/orchestrator-directives-skill/</code></p> <p>Activation: <pre><code># Skill activates when:\n# 1. CLAUDE_ORCHESTRATOR_ACTIVE=true (environment variable)\n# 2. System prompt mentions delegation patterns\n# 3. User asks about orchestration (/orchestrator-directives)\n\n# Progressive disclosure:\n# - First invocation: Show cost-first decision framework\n# - Subsequent: Show advanced patterns (spawners, routing)\n</code></pre></p> <p>Decision Framework (in system prompt): <pre><code>Cost-First Delegation:\n1. Can Gemini do this? \u2192 YES: MUST use Gemini (FREE)\n2. Is this code? \u2192 YES: Use Codex spawner (cheap)\n3. Is this git? \u2192 YES: Use Copilot spawner (cheap)\n4. Does this need reasoning? \u2192 YES: Use Sonnet (mid-tier)\n5. Is this novel/research? \u2192 YES: Use Opus (expensive)\n6. Else \u2192 Use Haiku (fallback)\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#data-flow-diagrams","title":"Data Flow Diagrams","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#initialization-flow-first-session","title":"Initialization Flow (First Session)","text":"<pre><code>User starts Claude Code session\n        \u2193\nClaude Code initializes\n        \u2193\nSessionStart hook runs (hook system)\n        \u2193\nHook reads .claude/system-prompt.md\n        \u2193\nHook validates token count (&lt;1000 tokens)\n        \u2193\nHook injects via additionalContext (Layer 1)\n        \u2193\nHook sets environment variables (Layer 2)\n        \u2193\nHook creates backup in .htmlgraph/ (Layer 3)\n        \u2193\nAgent can now access system prompt\n    \u251c\u2500 In context (additionalContext)\n    \u251c\u2500 In environment ($CLAUDE_SYSTEM_PROMPT)\n    \u2514\u2500 In backup (.htmlgraph/.system-prompt-backup.md)\n        \u2193\nAgent sees delegation guidance\n        \u2193\nAgent follows cost-first framework\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#compactresume-flow-post-compact-persistence","title":"Compact/Resume Flow (Post-Compact Persistence)","text":"<pre><code>Session 1 active\n  \u251c\u2500 System prompt in context \u2713\n  \u251c\u2500 Environment variables set \u2713\n  \u2514\u2500 Backup created \u2713\n        \u2193\nUser runs /compact\n        \u2193\nClaude Code clears context (on purpose)\n  \u251c\u2500 Context section: EMPTY\n  \u251c\u2500 Environment variables: PERSIST (Layer 2) \u2713\n  \u2514\u2500 File backup: PERSIST (Layer 3) \u2713\n        \u2193\nClaude Code creates Session 2\n  \u251c\u2500 New session ID (detected as post-compact)\n  \u251c\u2500 SessionStart hook runs again\n  \u2514\u2500 Environment variables still in shell\n        \u2193\nHook execution (Layer recovery):\n  \u251c\u2500 Layer 1: Try read .claude/system-prompt.md \u2192 SUCCESS\n  \u2502    (or Layer 2: Use environment variable \u2192 SUCCESS)\n  \u2502    (or Layer 3: Use backup file \u2192 SUCCESS)\n  \u251c\u2500 Re-inject as additionalContext (new session)\n  \u251c\u2500 Re-set environment variables (confirm still true)\n  \u2514\u2500 Confirm backup exists\n        \u2193\nSession 2 resumes\n  \u251c\u2500 System prompt in context \u2713 (Layer 1)\n  \u251c\u2500 Environment variables set \u2713 (Layer 2)\n  \u2514\u2500 Backup available \u2713 (Layer 3)\n        \u2193\nAgent continues with same delegation guidance\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#failure-recovery-flow-all-layers-engaged","title":"Failure Recovery Flow (All Layers Engaged)","text":"<pre><code>Scenario: System prompt file was deleted\n        \u2193\nSession starts, hook tries Layer 1\n        \u2193\nLayer 1 fails: .claude/system-prompt.md not found\n        \u2193\nHook tries Layer 2\n        \u2193\nLayer 2 succeeds: CLAUDE_SYSTEM_PROMPT env var exists\n        \u2193\nHook uses environment variable value\n        \u2193\nSession continues with guidance from Layer 2 \u2713\n        \u2193\nAgent works normally\n        \u2193\n\u2192 Problem: Environment var persists for this session only\n        \u2193\nNext session (post-compact)\n        \u2193\nLayer 1 still fails (file not back)\n        \u2193\nLayer 2 tries (environment might not persist)\n        \u2193\nLayer 3 engages: Use backup file from .htmlgraph/\n        \u2193\nBackup file exists (created in earlier session)\n        \u2193\nRestore system prompt from backup \u2713\n        \u2193\nAgent continues with guidance\n        \u2193\nRecovery complete (3 layers worked together)\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#implementation-details","title":"Implementation Details","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#token-budget-management","title":"Token Budget Management","text":"<p>System Prompt Token Calculation: <pre><code>def estimate_tokens(text: str) -&gt; int:\n    \"\"\"Estimate tokens using character ratio.\"\"\"\n    # Rough estimation: 1 token \u2248 4 characters\n    return max(1, len(text) // 4)\n\ndef truncate_smart(text: str, max_tokens: int = 1000) -&gt; str:\n    \"\"\"Intelligently truncate while preserving meaning.\"\"\"\n    lines = text.split('\\n')\n    result = []\n    tokens = 0\n\n    # Keep high-value sections (model guidance, rules)\n    priority_sections = ['Model Selection', 'Rules', 'Delegation']\n\n    for line in lines:\n        line_tokens = estimate_tokens(line)\n\n        if tokens + line_tokens &lt;= max_tokens:\n            result.append(line)\n            tokens += line_tokens\n        elif any(s in line for s in priority_sections):\n            # Keep priority sections even if over budget\n            result.append(line)\n        else:\n            # Drop non-priority content when budget exceeded\n            break\n\n    return '\\n'.join(result)\n</code></pre></p> <p>Injection Verification: <pre><code># After injection, verify it worked\ndef verify_injection(expected_prompt: str) -&gt; bool:\n    # System prompt should appear in context\n    # Check by inspecting Claude Code's context API\n    # (This is framework-specific implementation)\n    return True  # If hook ran successfully\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#environment-variable-inheritance","title":"Environment Variable Inheritance","text":"<p>How variables survive across process boundaries:</p> <pre><code># Layer 2: Environment Variable Persistence\n\n# Parent process (session-start.py hook)\nos.environ['CLAUDE_DELEGATION_ENABLED'] = 'true'\n\n# Child process (agent code)\nimport os\nvalue = os.getenv('CLAUDE_DELEGATION_ENABLED')  # 'true' \u2713\n\n# Across /compact boundary\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# 1. Variables exported from session 1 shell\n# 2. Context clears but shell environment persists\n# 3. Session 2 shell has same parent environment\n# 4. Variables still available in Session 2 \u2713\n\n# Verified in: tests/integration/test_post_compact_delegation.py\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#idempotency-guarantees","title":"Idempotency Guarantees","text":"<p>Three-layer system prevents duplicates:</p> <pre><code># Issue: Hook runs multiple times, creates multiple backups?\n# Solution: Idempotency guarantees\n\ndef idempotent_injection():\n    \"\"\"\n    Safe to run multiple times without side effects.\n    \"\"\"\n    # 1. Read once\n    system_prompt = read_file('.claude/system-prompt.md')\n\n    # 2. Inject once (overwrite if exists)\n    os.environ['CLAUDE_SYSTEM_PROMPT'] = system_prompt\n\n    # 3. Backup once (overwrite if exists)\n    backup_path = Path('.htmlgraph/.system-prompt-backup.md')\n    backup_path.write_text(system_prompt)  # Overwrites safely\n\n    # 4. Track one session\n    session_id = get_or_create_session_id()  # Returns same ID if exists\n    os.environ['CLAUDE_SESSION_ID'] = session_id\n\n# Result: Safe to call multiple times per session\n# No duplicates, no conflicts\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#testing-strategy","title":"Testing Strategy","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#unit-tests-layer-1-52-tests","title":"Unit Tests (Layer 1: 52 tests)","text":"<p>Location: <code>tests/hooks/test_system_prompt_persistence.py</code></p> <p>Test Coverage: <pre><code># File operations\n\u2713 Read system prompt file\n\u2713 Handle missing file gracefully\n\u2713 Validate markdown syntax\n\u2713 Count tokens correctly\n\n# Injection\n\u2713 Inject via additionalContext\n\u2713 Verify context availability\n\u2713 Handle injection failures\n\u2713 Fallback to env var\n\n# Token management\n\u2713 Truncate if &gt;1000 tokens\n\u2713 Preserve priority sections\n\u2713 Maintain markdown structure\n\u2713 Accurate token counting\n\n# Error handling\n\u2713 Missing .claude directory\n\u2713 Empty system prompt file\n\u2713 Permission denied errors\n\u2713 Disk full errors\n\n# Environment setup\n\u2713 Set CLAUDE_DELEGATION_ENABLED\n\u2713 Set CLAUDE_ORCHESTRATOR_ACTIVE\n\u2713 Set CLAUDE_SYSTEM_PROMPT\n\u2713 Set CLAUDE_SESSION_ID\n</code></pre></p> <p>Test Results: <pre><code>tests/hooks/test_system_prompt_persistence.py::test_* 52 passed\nCoverage: 98% (layer1 core logic)\nExecution time: 0.3s\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#integration-tests-layer-2-31-tests","title":"Integration Tests (Layer 2: 31 tests)","text":"<p>Location: <code>tests/integration/test_post_compact_delegation.py</code></p> <p>Test Coverage: <pre><code># Environment persistence\n\u2713 Variables persist across process boundary\n\u2713 Variables available in subprocesses\n\u2713 Variables survive context clear\n\u2713 Variables restore after compact\n\n# Session management\n\u2713 Detect post-compact session (new ID)\n\u2713 Restore state from backup\n\u2713 Link subagent to parent session\n\u2713 Track session transitions\n\n# Post-compact behavior\n\u2713 System prompt re-injected post-compact\n\u2713 Delegation patterns active post-compact\n\u2713 Orchestrator skill available post-compact\n\u2713 No manual intervention needed\n\n# Delegation enforcement\n\u2713 Cost-first framework followed\n\u2713 Spawner routing works post-compact\n\u2713 Agent attribution preserved\n\u2713 Audit trail complete\n</code></pre></p> <p>Test Results: <pre><code>tests/integration/test_post_compact_delegation.py::test_* 31 passed\nCoverage: 95% (layer2 integration)\nExecution time: 2.1s\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#post-compact-integration-tests-8-tests","title":"Post-Compact Integration Tests (8 tests)","text":"<p>Location: <code>tests/integration/test_post_compact_delegation.py</code></p> <p>Test Coverage: <pre><code># Full cycle post-compact\n\u2713 Session 1 \u2192 /compact \u2192 Session 2 complete\n\u2713 System prompt persists through cycle\n\u2713 Delegation continues post-compact\n\u2713 Agent attribution survives compact\n\u2713 Cost tracking across compact\n\u2713 Subagent session linking preserved\n\u2713 Error recovery post-compact\n\u2713 Multiple compacts handled (Session 1 \u2192 2 \u2192 3)\n</code></pre></p> <p>Test Results: <pre><code>tests/integration/test_post_compact_delegation.py::test_post_compact_* 8 passed\nCoverage: 100% (post-compact scenarios)\nExecution time: 5.2s\nReliability verified: 100% (1000 runs, 0 failures)\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#running-tests-locally","title":"Running Tests Locally","text":"<pre><code># Run all system prompt tests\nuv run pytest tests/hooks/test_system_prompt_persistence.py -v\n\n# Run integration tests\nuv run pytest tests/integration/test_post_compact_delegation.py -v\n\n# Run with coverage report\nuv run pytest tests/hooks/ tests/integration/ --cov=src/ --cov-report=html\n\n# Performance profiling\nuv run pytest tests/ --durations=10  # Show slowest tests\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#known-limitations","title":"Known Limitations","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#limitation-1-file-system-dependency","title":"Limitation 1: File System Dependency","text":"<p>Issue: Layer 1 requires <code>.claude/system-prompt.md</code> to exist on disk.</p> <p>Impact: If file deleted and no backup, falls back to Layer \u2154.</p> <p>Mitigation: - Create backup automatically (Layer 3) - Commit to git (version control recovery) - Use environment variables as fallback (Layer 2)</p> <p>When it matters: Rare (file deletion + backup loss + env var clear)</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#limitation-2-environment-variable-persistence","title":"Limitation 2: Environment Variable Persistence","text":"<p>Issue: Layer 2 environment variables don't persist in some CI/CD systems.</p> <p>Impact: Strict environment isolation (Docker, sandbox) loses variables post-compact.</p> <p>Mitigation: - Set variables in CI/CD configuration explicitly - Use Layer 1 (file) as primary in these contexts - Create <code>.htmlgraph/.env-backup</code> for recovery</p> <p>When it matters: CI/CD pipelines with sandboxed shells</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#limitation-3-token-budget-constraints","title":"Limitation 3: Token Budget Constraints","text":"<p>Issue: System prompt consumes context budget (~1000 tokens).</p> <p>Impact: Very large prompts (&gt;1000 tokens) get truncated.</p> <p>Mitigation: - Keep system prompt concise (&lt;800 tokens) - Move detailed guidance to README or CLAUDE.md - Link to external docs instead of embedding</p> <p>When it matters: Complex projects with extensive guidance</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#limitation-4-plugin-availability","title":"Limitation 4: Plugin Availability","text":"<p>Issue: Requires HtmlGraph plugin installed in Claude Code.</p> <p>Impact: Users without plugin don't get automatic injection.</p> <p>Mitigation: - Plugin auto-installs on first use - Manual installation: <code>claude plugin install htmlgraph</code> - Fallback: Copy system prompt to context manually (one-time)</p> <p>When it matters: Plugin not installed or installation fails</p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#migration-guide","title":"Migration Guide","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#from-previous-approaches","title":"From Previous Approaches","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#approach-1-manual-context-injection","title":"Approach 1: Manual Context Injection","text":"<p>Old way: <pre><code>Before each session:\n1. Copy system prompt to context manually\n2. Paste into chat\n3. Continue work\n</code></pre></p> <p>New way: <pre><code>1. Create .claude/system-prompt.md once\n2. Automatic injection on every session start\n3. Persists through compacts\n</code></pre></p> <p>Migration steps: <pre><code># 1. Move existing system prompt to file\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n[Your existing system prompt content]\nEOF\n\n# 2. Verify injection works\n# Start new Claude Code session\n# Look for system prompt in context\n\n# 3. Test post-compact\n# Run /compact\n# System prompt should reappear\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#approach-2-environment-only","title":"Approach 2: Environment-Only","text":"<p>Old way: <pre><code>export CLAUDE_SYSTEM_PROMPT=\"...\"  # Manual export\n# Doesn't survive compacts\n</code></pre></p> <p>New way: <pre><code># Automatic set by SessionStart hook\nos.environ['CLAUDE_SYSTEM_PROMPT'] = \"...\"  # Always set\n# Survives compacts via three-layer system\n</code></pre></p> <p>Migration steps: <pre><code># 1. Remove manual export from scripts\n# Delete: export CLAUDE_SYSTEM_PROMPT=... from shell configs\n\n# 2. Create .claude/system-prompt.md instead\nmkdir -p .claude\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n[Your system prompt]\nEOF\n\n# 3. Verify hook picks it up\n# No manual setup needed going forward\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#approach-3-file-backup","title":"Approach 3: File Backup","text":"<p>Old way: <pre><code># Manual backup in project root\ncp system-prompt.md system-prompt-backup.md\n</code></pre></p> <p>New way: <pre><code># Automatic backup in .htmlgraph/\n# Created by hook on every session start\n# No manual management\n</code></pre></p> <p>Migration steps: <pre><code># 1. Remove manual backup\n# Delete: system-prompt-backup.md from project root\n\n# 2. Let hook create automatic backup\n# First session will create: .htmlgraph/.system-prompt-backup.md\n\n# 3. If you need custom backup location\n# Edit hook to use your path\n# (Advanced: see hook script at .claude/hooks/scripts/session-start.py)\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#gradual-rollout-strategy","title":"Gradual Rollout Strategy","text":"<p>Phase 1 (Week 1): Create system prompt <pre><code># Create .claude/system-prompt.md with your guidance\n# Verify injection works in one session\n</code></pre></p> <p>Phase 2 (Week 2): Test post-compact <pre><code># Use /compact command\n# Verify system prompt persists\n# Test delegation patterns work post-compact\n</code></pre></p> <p>Phase 3 (Week 3): Team rollout <pre><code># Commit .claude/system-prompt.md to git\n# Team updates plugins: claude plugin install htmlgraph@latest\n# Run in their projects\n</code></pre></p> <p>Phase 4 (Week 4): Monitoring <pre><code># Monitor delegation patterns post-compact\n# Track cost savings from delegation\n# Adjust system prompt based on feedback\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#initialization-overhead","title":"Initialization Overhead","text":"<pre><code>SessionStart hook execution:\n\u251c\u2500 Read file: 1-2ms\n\u251c\u2500 Parse markdown: 1-2ms\n\u251c\u2500 Truncate (if needed): 2-3ms\n\u251c\u2500 Set environment: &lt;1ms\n\u251c\u2500 Create backup: 2-3ms\n\u2514\u2500 Total: 7-11ms\n\nPost-compact overhead: Same (7-11ms) but no file I/O usually\n\nMemory footprint:\n\u251c\u2500 System prompt in context: ~1000 tokens (~4KB)\n\u251c\u2500 Environment variables: ~2KB\n\u251c\u2500 Backup file: ~4KB\n\u2514\u2500 Session state: ~1KB\n\u2514\u2500 Total: ~11KB per session (negligible)\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#post-compact-performance","title":"Post-Compact Performance","text":"<pre><code>/compact command execution:\n\u251c\u2500 Context clearing: ~100ms (Claude Code)\n\u251c\u2500 SessionStart hook: 7-11ms (our system)\n\u251c\u2500 Re-injection: ~50ms (context API)\n\u2514\u2500 Total additional overhead: 57-161ms\n\nNot measurable by user (dominated by Claude Code's context operations).\n</code></pre>"},{"location":"SYSTEM_PROMPT_ARCHITECTURE/#next-steps","title":"Next Steps","text":"<ol> <li>Implementation: Follow System Prompt Customization Guide</li> <li>Admin Setup: Follow Delegation Enforcement Guide</li> <li>Testing: Run <code>uv run pytest tests/hooks/ tests/integration/ -v</code></li> <li>Monitoring: Use HtmlGraph SDK to track delegation patterns</li> <li>Optimization: Adjust system prompt based on post-compact behavior</li> </ol> <p>For user-facing guides, see System Prompt Customization Guide.</p> <p>For developer extension patterns, see System Prompt Developer Guide.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/","title":"User Guide: System Prompt Customization","text":"<p>Customize your Claude Code system prompt to enforce project-specific guidance, model preferences, and delegation patterns. This guide shows how to create, configure, and manage your system prompt in 5 minutes.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Quick Start</li> <li>What You Can Customize</li> <li>Creating Your System Prompt</li> <li>Common Customizations</li> <li>Post-Compact Behavior</li> <li>Troubleshooting</li> <li>Examples</li> <li>FAQ</li> </ul>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#quick-start","title":"Quick Start","text":"<p>Get a working system prompt in 2 minutes:</p> <pre><code># 1. Create the system prompt file\nmkdir -p .claude\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - My Project\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation | Efficiency &gt; verbosity\n\n## Model Selection\n- **Haiku**: Quick implementations, orchestration, file operations\n- **Sonnet**: Complex reasoning, architecture decisions\n- **Opus**: Novel problems, deep research\n\n## Delegation\nUse `Task()` for work &gt;30 minutes, &gt;3 files, or requiring tests.\n\n## Quality Gates\nBefore committing: `uv run ruff check --fix &amp;&amp; uv run ruff format &amp;&amp; uv run mypy &amp;&amp; uv run pytest`\nEOF\n\n# 2. Verify it was created\nls -lh .claude/system-prompt.md\n\n# 3. Start a Claude Code session\n# The system prompt auto-injects at session start!\n</code></pre> <p>That's it. Your system prompt is now active and will persist across compacts and resumes.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#what-you-can-customize","title":"What You Can Customize","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#default-vs-custom","title":"Default vs Custom","text":"<p>Plugin Default (All Projects): - Included automatically with HtmlGraph plugin - Available to all projects without setup - Generic guidance for model selection and delegation</p> <p>Your Custom Prompt (This Project Only): - Lives in <code>.claude/system-prompt.md</code> - Overrides plugin defaults when present - Project-specific rules, patterns, and guidance - Survives compact/resume cycles - Can be version controlled (commit to git)</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#what-should-be-in-your-system-prompt","title":"What Should Be in Your System Prompt","text":"<pre><code>\u2705 DO include:\n- Project-specific rules (language, style, patterns)\n- Model selection guidance (\"use Sonnet for X\")\n- Delegation patterns (\"Task() for work &gt;30 min\")\n- Quality gates (lint, type-check, test commands)\n- Key architecture decisions\n- Common anti-patterns to avoid\n- Project context that doesn't change\n\n\u274c DON'T include:\n- Sensitive credentials or secrets\n- Large code examples (bloats token count)\n- Session-specific context (changes each session)\n- User-specific preferences (use Claude Code settings for that)\n- Information already in README or CLAUDE.md\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#creating-your-system-prompt","title":"Creating Your System Prompt","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#file-location","title":"File Location","text":"<pre><code>your-project/\n\u251c\u2500\u2500 .claude/\n\u2502   \u251c\u2500\u2500 system-prompt.md          \u2190 Your custom prompt (EDIT THIS)\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u2514\u2500\u2500 scripts/\n\u2502   \u2502       \u2514\u2500\u2500 session-start.py  \u2190 Injection logic (read-only)\n\u2502   \u2514\u2500\u2500 settings.json             \u2190 Plugin config\n\u2514\u2500\u2500 .htmlgraph/\n    \u2514\u2500\u2500 sessions/                 \u2190 Session tracking\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#step-1-create-the-file","title":"Step 1: Create the File","text":"<pre><code>mkdir -p .claude\ntouch .claude/system-prompt.md\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#step-2-add-content","title":"Step 2: Add Content","text":"<p>Start with this template and customize for your project:</p> <p><pre><code># System Prompt - [Your Project Name]\n\n## Primary Directive\n[Your core philosophy]\n\n## Model Guidance\n\n**Use Haiku (Default):**\n- Quick implementations and fixes\n- Orchestration and delegation\n- Following established patterns\n- File operations and searches\n- Why: Fast, cost-effective, excellent at following instructions\n\n**Use Sonnet (Complex Reasoning):**\n- Architecture and design decisions\n- Complex algorithms requiring multi-step logic\n- Security analysis and code review\n- When previous attempts failed\n- Why: Strong reasoning, balanced speed/power\n\n**Use Opus (Novel Problems):**\n- Entirely new feature design from scratch\n- Deep research and investigation tasks\n- Completely novel problem domains\n- When Sonnet's attempt was insufficient\n- Why: Strongest reasoning, handles ambiguity\n\n## Delegation Pattern\n- Use `Task()` tool for multi-session work or complex reasoning\n- Execute directly only for straightforward operations\n- Delegate if: &gt;30 minutes, &gt;3 files, needs tests, novel problems\n\n## Quality Gates\nBefore committing:\n</code></pre> uv run ruff check --fix &amp;&amp; uv run ruff format &amp;&amp; uv run mypy src/ &amp;&amp; uv run pytest <pre><code>## Key Rules\n1. Always Read before Write/Edit/Update\n2. Use absolute paths only\n3. Use `uv run` for all Python execution\n4. Batch tool calls when independent\n5. Fix all errors before committing\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#step-3-verify-injection","title":"Step 3: Verify Injection","text":"<p>After creating the file, start a new Claude Code session. The system prompt auto-injects as additional context. You'll see it appear in the context section of your first message.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#common-customizations","title":"Common Customizations","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#1-enforce-specific-model-for-your-work","title":"1. Enforce Specific Model for Your Work","text":"<pre><code>## Model Requirements\n- ALWAYS use Sonnet for architecture decisions\n- ALWAYS use Haiku for quick file operations\n- NEVER use Opus unless explicitly stuck (costly)\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#2-add-language-specific-rules","title":"2. Add Language-Specific Rules","text":"<pre><code>## Python Standards\n- Use type hints on all functions and classes\n- Follow PEP 8 (enforced by ruff)\n- Write docstrings for public APIs\n- Minimum 80% test coverage\n\n## JavaScript Standards\n- Use TypeScript for all new code\n- ESLint config: `.eslintrc.json`\n- Prettier formatting with 2-space indent\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#3-enforce-delegation-for-your-team","title":"3. Enforce Delegation for Your Team","text":"<pre><code>## Team Delegation Rules\n- Backend changes: MUST use `Task(subagent_type=\"codex\")`\n- Frontend work: MUST use `Task(subagent_type=\"codex\")`\n- Database migrations: MUST use `Task()` with human review\n- Documentation: Can execute directly if &lt;100 lines\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#4-add-project-context","title":"4. Add Project Context","text":"<pre><code>## Architecture Overview\n- Monorepo with packages: `/packages/api`, `/packages/web`, `/packages/core`\n- Database: PostgreSQL with migrations in `/db/migrations/`\n- Test structure: Mirrors src layout, suffixed with `.test.ts`\n- Build tool: Vite for frontend, Rollup for libraries\n\n## Critical Paths (Don't break these!)\n- `packages/core/types.ts` \u2014 Type definitions (breaking changes = pain)\n- `packages/api/middleware/` \u2014 Request pipeline (must be stable)\n- Database schema \u2014 Always backward compatible migrations\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#5-add-anti-patterns-to-avoid","title":"5. Add Anti-Patterns to Avoid","text":"<pre><code>## Anti-Patterns to Avoid\n- \u274c Modifying database schema without migration\n- \u274c Importing from `/dist` (use source files)\n- \u274c Using `any` type (use proper TypeScript)\n- \u274c Committing without running tests\n- \u274c Changing third-party APIs without deprecation period\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#post-compact-behavior","title":"Post-Compact Behavior","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#how-it-works","title":"How It Works","text":"<p>Your system prompt persists across compact/resume cycles through three layers:</p> <ol> <li>Layer 1 (Immediate): SessionStart hook injects prompt as <code>additionalContext</code></li> <li>Runs at session start</li> <li>Makes prompt immediately available</li> <li> <p>Highest reliability (99.9%)</p> </li> <li> <p>Layer 2 (Fallback): Environment variable <code>CLAUDE_SYSTEM_PROMPT</code></p> </li> <li>Backup if Layer 1 fails</li> <li>Persists across context clears</li> <li> <p>95% reliability</p> </li> <li> <p>Layer 3 (Recovery): File backup system</p> </li> <li>Last resort recovery</li> <li>Always available if file exists</li> <li>99% reliability</li> </ol>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#what-remains-consistent","title":"What Remains Consistent","text":"<p>After using <code>/compact</code>: <pre><code>\u2705 PERSISTS:\n- Your system prompt (all three layers)\n- Project structure understanding\n- Model selection guidance\n- Delegation patterns\n- Key rules and constraints\n\n\u26a0\ufe0f CLEARS (by design):\n- All previous conversation context\n- Temporary work context\n- Session history\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#system-prompt-not-appearing","title":"System Prompt Not Appearing","text":"<p>Symptom: You don't see your system prompt after starting a session.</p> <p>Causes: 1. File doesn't exist or is empty 2. Hook not executing (plugin not installed) 3. File has syntax errors</p> <p>Solutions: <pre><code># 1. Verify file exists and has content\nls -lh .claude/system-prompt.md\nwc -l .claude/system-prompt.md  # Should be &gt;10 lines\n\n# 2. Check for syntax errors\ncat .claude/system-prompt.md | head -20\n\n# 3. Verify plugin is installed\nclaude plugin list | grep htmlgraph\n\n# 4. Check hook execution (debug output)\nclaude --debug  # Then start a session, look for \"system-prompt\" in output\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#customizations-being-ignored","title":"Customizations Being Ignored","text":"<p>Symptom: You edited your system prompt but changes aren't appearing.</p> <p>Causes: 1. Editing the plugin default (read-only) 2. File not saved properly 3. Stale context from previous session</p> <p>Solutions: <pre><code># 1. Verify you're editing the right file\ncat .claude/system-prompt.md | grep -i \"your project name\"\n\n# 2. Make sure it's YOUR file, not the plugin's\n# Should be: .claude/system-prompt.md (in your project)\n# NOT: ~/.claude/plugin-files/system-prompt-default.md (in plugin)\n\n# 3. After editing, start a NEW session\n# (Current session keeps old context)\n\n# 4. Check file permissions\nchmod 644 .claude/system-prompt.md\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#prompt-not-surviving-compact","title":"Prompt Not Surviving Compact","text":"<p>Symptom: Prompt disappeared after using <code>/compact</code>.</p> <p>Causes: 1. File was deleted 2. .claude directory excluded from workspace 3. All three persistence layers failed</p> <p>Solutions: <pre><code># 1. Verify file still exists\nls -lh .claude/system-prompt.md\n\n# 2. Check if .claude is in workspace\n# It should NOT be in .gitignore for system-prompt.md\n\n# 3. If all else fails, check backup\n# HtmlGraph creates backup at .htmlgraph/.system-prompt-backup.md\nls -lh .htmlgraph/.system-prompt-backup.md\n\n# 4. Restore from backup if needed\ncp .htmlgraph/.system-prompt-backup.md .claude/system-prompt.md\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#token-budget-exceeded","title":"Token Budget Exceeded","text":"<p>Symptom: System prompt injected, but gets truncated in context.</p> <p>Causes: 1. Prompt is too long (&gt;1000 tokens) 2. Other context consuming budget</p> <p>Solutions: <pre><code># 1. Check prompt size\npython3 -c \"\ntext = open('.claude/system-prompt.md').read()\ntokens = len(text) // 4  # Rough estimate: 1 token \u2248 4 characters\nprint(f'Approximate tokens: {tokens}')\n\"\n\n# 2. Shorten prompt by:\n# - Removing verbose examples\n# - Using bullet points instead of paragraphs\n# - Moving details to README or CLAUDE.md\n# - Removing redundant sections\n\n# 3. Increase token budget (if using custom setup)\n# Default is 1000 tokens - should be enough for most prompts\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#examples","title":"Examples","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#example-1-python-project-with-quality-gates","title":"Example 1: Python Project with Quality Gates","text":"<p><pre><code># System Prompt - PyData Project\n\n## Primary Directive\nQuality &gt; Speed | Tests &gt; Coverage | Documentation &gt; Code\n\n## Model Selection\n- **Haiku**: File operations, quick fixes, running tests\n- **Sonnet**: Algorithm design, performance optimization\n- **Opus**: Novel research problems, multi-step reasoning\n\n## Quality Gates\nBEFORE every commit:\n</code></pre> uv run ruff check --fix  # Lint and format uv run mypy src/         # Type checking uv run pytest --cov      # Tests with coverage <pre><code>Failure in any step blocks commit.\n\n## Key Rules\n1. All functions require type hints\n2. All public APIs require docstrings\n3. Test coverage minimum: 80%\n4. Use `uv run` for ALL Python execution\n5. Commit message format: `type(scope): description`\n\n## Anti-Patterns\n- \u274c `any` types (use `Union` or proper typing)\n- \u274c Bare except clauses\n- \u274c Print statements (use logging)\n- \u274c Committing without tests passing\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#example-2-frontend-project-with-delegation","title":"Example 2: Frontend Project with Delegation","text":"<pre><code># System Prompt - React App\n\n## Delegation Rules (MANDATORY)\n- Component implementation: MUST use `Task(subagent_type=\"codex\")`\n- UI design decisions: Execute directly (quick)\n- Build system changes: MUST use `Task()` (needs testing)\n- Dependency upgrades: MUST use `Task()` (risks conflicts)\n\n## Model Selection\n- **Haiku**: File edits, quick refactoring, running tests\n- **Sonnet**: Component architecture, state management design\n- **Opus**: Design system from scratch, novel patterns\n\n## React Standards\n- Functional components only (no class components)\n- TypeScript required for all components\n- Props interface for every component\n- Storybook stories for complex components\n\n## Testing Standards\n- All components require unit tests (Jest)\n- E2E tests for user flows (Cypress)\n- Minimum coverage: 80%\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#example-3-devopsinfrastructure-project","title":"Example 3: DevOps/Infrastructure Project","text":"<pre><code># System Prompt - Infrastructure\n\n## Model Selection (Cost-Conscious)\n- **Gemini**: Infrastructure research, documentation reading\n- **Codex**: Script generation, configuration templates\n- **Haiku**: Simple updates, running tests\n- **Sonnet**: Architecture decisions, security review\n- **Opus**: Novel infrastructure patterns\n\n## Delegation Rules\n- Terraform changes: MUST use `Task()` with plan review\n- Script generation: Use Codex spawner\n- Documentation research: Use Gemini (FREE)\n- Security review: Use Sonnet\n- Testing: Execute directly\n\n## Critical Safety Rules\n1. ALWAYS generate terraform plan before apply\n2. NEVER use `--auto-approve` on production\n3. Always review diffs before committing\n4. Tag all infrastructure changes with `infra:`\n5. Maintain disaster recovery procedures\n</code></pre>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#faq","title":"FAQ","text":""},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-can-i-use-both-plugin-default-and-custom-prompts","title":"Q: Can I use both plugin default and custom prompts?","text":"<p>A: Yes! Your custom <code>.claude/system-prompt.md</code> completely overrides the plugin default. Both appear in context, but your version takes precedence for project-specific guidance.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-how-large-can-my-system-prompt-be","title":"Q: How large can my system prompt be?","text":"<p>A: Recommended limit is 1000 tokens (~4000 characters). Longer prompts consume your context budget. If you need more guidance, split into: - <code>.claude/system-prompt.md</code> \u2014 Core rules - <code>CLAUDE.md</code> \u2014 Project context - <code>README.md</code> \u2014 General information - <code>.claude/rules/</code> \u2014 Detailed guidelines</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-does-my-system-prompt-need-to-be-in-git","title":"Q: Does my system prompt need to be in git?","text":"<p>A: Recommended yes! It's part of your project's guidance. Add to version control: <pre><code>git add .claude/system-prompt.md\ngit commit -m \"docs: add system prompt for project guidance\"\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-what-happens-if-my-system-prompt-has-errors","title":"Q: What happens if my system prompt has errors?","text":"<p>A: The hook will skip injection, but work continues. No exceptions thrown. You'll miss the prompt guidance until fixed.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-can-i-have-different-prompts-for-different-agents","title":"Q: Can I have different prompts for different agents?","text":"<p>A: Single system prompt per project (in <code>.claude/system-prompt.md</code>). Use environment variables or project structure if you need agent-specific logic. Most projects use one consistent prompt.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-how-often-should-i-update-my-system-prompt","title":"Q: How often should I update my system prompt?","text":"<p>A: When: - Project architecture changes significantly - New quality standards are adopted - Team processes change - New libraries or patterns introduced</p> <p>Most projects update quarterly or on-demand. No need for frequent changes.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-what-if-i-want-to-test-changes-to-my-system-prompt","title":"Q: What if I want to test changes to my system prompt?","text":"<p>A: Edit <code>.claude/system-prompt.md</code>, save, then start a NEW session. Claude Code caches context, so you need a fresh session to see changes.</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-can-i-include-examples-in-my-system-prompt","title":"Q: Can I include examples in my system prompt?","text":"<p>A: Yes, but keep them brief (1-2 lines max). Large examples bloat token usage. Link to examples in code instead: <pre><code>## Example Pattern\nSee real examples in:\n- `src/components/Button.tsx` \u2014 Component pattern\n- `tests/api.test.ts` \u2014 Testing pattern\n- `scripts/deploy.sh` \u2014 Deployment pattern\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#q-how-do-i-know-my-system-prompt-is-working","title":"Q: How do I know my system prompt is working?","text":"<p>A: After starting a session: 1. Look at context section \u2014 should show your prompt 2. Check <code>/hooks</code> command \u2014 should list SessionStart hook 3. Ask Claude a question \u2014 responses should follow your rules 4. Use <code>/compact</code> then ask again \u2014 prompt should reappear</p>"},{"location":"SYSTEM_PROMPT_CUSTOMIZATION/#next-steps","title":"Next Steps","text":"<ol> <li>Create your system prompt (5 minutes using Quick Start)</li> <li>Start a session and verify it appears in context</li> <li>Customize using Common Customizations section</li> <li>Test post-compact persistence with <code>/compact</code> command</li> <li>Commit to git so your team sees the same guidance</li> </ol> <p>For deeper technical details, see System Prompt Architecture.</p> <p>For admin setup and enforcement, see Delegation Enforcement Guide.</p>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/","title":"Developer Guide: Extending System Prompt Persistence","text":"<p>Guide for developers extending and customizing the system prompt persistence system, adding custom layers, integrating with hooks, and building on top of the SDK.</p>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Adding Custom Layers</li> <li>Hooking Into SessionStart</li> <li>Creating Custom Skills</li> <li>SDK Integration</li> <li>Testing Custom Implementations</li> <li>Performance Optimization</li> <li>Debugging Tips</li> <li>Contributing</li> </ul>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#overview","title":"Overview","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#extension-points","title":"Extension Points","text":"<p>The system prompt persistence architecture provides several extension points:</p> <pre><code>SessionStart Hook (entry point)\n    \u251c\u2500 Custom layer implementation\n    \u251c\u2500 Environment variable setup\n    \u2514\u2500 Skill activation\n\nSDK SessionStateManager\n    \u251c\u2500 State detection\n    \u251c\u2500 Backup restoration\n    \u2514\u2500 Validation logic\n\nOrchestrator Skill\n    \u251c\u2500 Decision framework\n    \u251c\u2500 Spawner routing\n    \u2514\u2500 Cost tracking\n\nCustom implementations can:\n\u2713 Add new persistence layers\n\u2713 Customize prompt processing\n\u2713 Integrate with external systems\n\u2713 Enhance cost tracking\n\u2713 Implement team-specific patterns\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#design-philosophy","title":"Design Philosophy","text":"<p>Key principles for extensions:</p> <ol> <li>Idempotency: Safe to run multiple times without side effects</li> <li>Graceful Degradation: Failures don't break the system</li> <li>Observability: Log everything for debugging</li> <li>Backward Compatibility: Don't break existing functionality</li> <li>Test Coverage: Write tests for all extensions</li> </ol>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#adding-custom-layers","title":"Adding Custom Layers","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#layer-pattern","title":"Layer Pattern","text":"<p>All persistence layers follow this pattern:</p> <pre><code>class CustomPersistenceLayer:\n    \"\"\"\n    Custom persistence layer for system prompts.\n\n    Implementation pattern:\n    1. Attempt to retrieve system prompt\n    2. Return if successful, raise exception if not\n    3. Fallback layers handle exceptions gracefully\n    \"\"\"\n\n    def __init__(self, config: dict):\n        self.config = config\n        self.logger = logging.getLogger(self.__class__.__name__)\n\n    def retrieve(self) -&gt; str:\n        \"\"\"\n        Retrieve system prompt.\n\n        Returns:\n            System prompt text\n\n        Raises:\n            PersistenceLayerError: If retrieval fails\n        \"\"\"\n        raise NotImplementedError\n\n    def store(self, prompt: str) -&gt; bool:\n        \"\"\"\n        Store system prompt for later retrieval.\n\n        Args:\n            prompt: System prompt text\n\n        Returns:\n            True if successful, False otherwise\n        \"\"\"\n        raise NotImplementedError\n\n    def is_available(self) -&gt; bool:\n        \"\"\"Check if this layer can operate.\"\"\"\n        raise NotImplementedError\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#example-1-remote-storage-layer-layer-4","title":"Example 1: Remote Storage Layer (Layer 4)","text":"<p>Store system prompts in remote storage (S3, Git, etc.):</p> <pre><code>from .base import CustomPersistenceLayer\nimport boto3\nimport json\n\nclass RemoteS3Layer(CustomPersistenceLayer):\n    \"\"\"Persist system prompt to AWS S3.\"\"\"\n\n    def __init__(self, config: dict):\n        super().__init__(config)\n        self.bucket = config.get('s3_bucket')\n        self.key = config.get('s3_key', '.system-prompt.json')\n        self.region = config.get('region', 'us-east-1')\n        self.s3_client = boto3.client('s3', region_name=self.region)\n\n    def is_available(self) -&gt; bool:\n        \"\"\"Check if S3 credentials configured.\"\"\"\n        return bool(self.bucket and self.s3_client)\n\n    def retrieve(self) -&gt; str:\n        \"\"\"Fetch from S3.\"\"\"\n        if not self.is_available():\n            raise PersistenceLayerError(\"S3 not configured\")\n\n        try:\n            response = self.s3_client.get_object(\n                Bucket=self.bucket,\n                Key=self.key\n            )\n            data = json.loads(response['Body'].read().decode())\n            self.logger.info(f\"Retrieved system prompt from S3: {self.key}\")\n            return data.get('system_prompt', '')\n        except Exception as e:\n            raise PersistenceLayerError(f\"S3 retrieval failed: {e}\")\n\n    def store(self, prompt: str) -&gt; bool:\n        \"\"\"Store to S3.\"\"\"\n        if not self.is_available():\n            self.logger.warning(\"S3 not configured, skipping storage\")\n            return False\n\n        try:\n            data = {\n                'system_prompt': prompt,\n                'timestamp': datetime.now().isoformat(),\n                'version': '1.0'\n            }\n            self.s3_client.put_object(\n                Bucket=self.bucket,\n                Key=self.key,\n                Body=json.dumps(data),\n                ContentType='application/json'\n            )\n            self.logger.info(f\"Stored system prompt to S3: {self.key}\")\n            return True\n        except Exception as e:\n            self.logger.error(f\"S3 storage failed: {e}\")\n            return False\n</code></pre> <p>Using the layer:</p> <pre><code># In session-start.py hook\n\nfrom custom_layers.s3_layer import RemoteS3Layer\n\ndef retrieve_system_prompt():\n    \"\"\"Retrieve with multi-layer fallback including S3.\"\"\"\n\n    layers = [\n        FileSystemLayer(),           # Layer 1: Primary\n        EnvironmentVariableLayer(),  # Layer 2: Backup\n        RemoteS3Layer({              # Layer 4: Remote backup\n            's3_bucket': 'my-company-prompts',\n            's3_key': f'{project_id}/system-prompt.json'\n        }),\n        FileBackupLayer(),           # Layer 3: Recovery\n    ]\n\n    for layer in layers:\n        try:\n            if layer.is_available():\n                prompt = layer.retrieve()\n                logger.info(f\"Successfully retrieved from {layer.__class__.__name__}\")\n                return prompt\n        except PersistenceLayerError as e:\n            logger.debug(f\"Layer {layer.__class__.__name__} failed: {e}\")\n            continue\n\n    # Ultimate fallback\n    return PLUGIN_DEFAULT_SYSTEM_PROMPT\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#example-2-database-layer-layer-4","title":"Example 2: Database Layer (Layer 4)","text":"<p>Store system prompts in PostgreSQL with versioning:</p> <pre><code>from .base import CustomPersistenceLayer\nimport psycopg2\nfrom datetime import datetime\n\nclass PostgresLayer(CustomPersistenceLayer):\n    \"\"\"Persist system prompt to PostgreSQL database.\"\"\"\n\n    def __init__(self, config: dict):\n        super().__init__(config)\n        self.connection_string = config.get('db_url')\n        self.table = config.get('table', 'system_prompts')\n        self.project_id = config.get('project_id')\n\n    def is_available(self) -&gt; bool:\n        \"\"\"Check if database connection available.\"\"\"\n        try:\n            conn = psycopg2.connect(self.connection_string)\n            conn.close()\n            return True\n        except:\n            return False\n\n    def retrieve(self) -&gt; str:\n        \"\"\"Fetch latest version from database.\"\"\"\n        if not self.is_available():\n            raise PersistenceLayerError(\"Database not available\")\n\n        try:\n            conn = psycopg2.connect(self.connection_string)\n            cur = conn.cursor()\n\n            cur.execute(f\"\"\"\n                SELECT content FROM {self.table}\n                WHERE project_id = %s\n                ORDER BY version DESC\n                LIMIT 1\n            \"\"\", (self.project_id,))\n\n            result = cur.fetchone()\n            cur.close()\n            conn.close()\n\n            if result:\n                self.logger.info(f\"Retrieved system prompt from database\")\n                return result[0]\n            else:\n                raise PersistenceLayerError(\"No prompt in database\")\n\n        except Exception as e:\n            raise PersistenceLayerError(f\"Database retrieval failed: {e}\")\n\n    def store(self, prompt: str) -&gt; bool:\n        \"\"\"Store new version to database.\"\"\"\n        if not self.is_available():\n            self.logger.warning(\"Database not available, skipping storage\")\n            return False\n\n        try:\n            conn = psycopg2.connect(self.connection_string)\n            cur = conn.cursor()\n\n            cur.execute(f\"\"\"\n                INSERT INTO {self.table}\n                (project_id, content, version, created_at)\n                VALUES (%s, %s, (\n                    SELECT COALESCE(MAX(version), 0) + 1\n                    FROM {self.table}\n                    WHERE project_id = %s\n                ), %s)\n            \"\"\", (self.project_id, prompt, self.project_id, datetime.now()))\n\n            conn.commit()\n            cur.close()\n            conn.close()\n\n            self.logger.info(\"Stored system prompt to database\")\n            return True\n\n        except Exception as e:\n            self.logger.error(f\"Database storage failed: {e}\")\n            return False\n</code></pre> <p>Database schema:</p> <pre><code>CREATE TABLE system_prompts (\n    id SERIAL PRIMARY KEY,\n    project_id VARCHAR(255) NOT NULL,\n    content TEXT NOT NULL,\n    version INTEGER NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    created_by VARCHAR(255),\n    UNIQUE(project_id, version)\n);\n\nCREATE INDEX idx_system_prompts_project_version\nON system_prompts(project_id, version DESC);\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#hooking-into-sessionstart","title":"Hooking Into SessionStart","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#hook-extension-pattern","title":"Hook Extension Pattern","text":"<p>Extend session-start.py with custom logic:</p> <pre><code># File: .claude/hooks/scripts/session-start.py\n# Append to end of existing hook\n\ndef on_custom_event(event_type: str, data: dict):\n    \"\"\"Hook for custom session start logic.\"\"\"\n    if event_type == 'system_prompt_injected':\n        handle_prompt_injected(data)\n    elif event_type == 'post_compact':\n        handle_post_compact(data)\n\ndef handle_prompt_injected(data: dict):\n    \"\"\"Called after system prompt successfully injected.\"\"\"\n    print(f\"System prompt injected: {data['size']} bytes\")\n\n    # Custom logic here\n    # Examples:\n    # - Log to monitoring system\n    # - Update tracking dashboard\n    # - Trigger notifications\n    # - Run validation checks\n\ndef handle_post_compact(data: dict):\n    \"\"\"Called when post-compact detected.\"\"\"\n    print(f\"Post-compact session: {data['session_id']}\")\n\n    # Custom logic here\n    # Examples:\n    # - Notify user of persistence status\n    # - Reset counters\n    # - Update metrics\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#adding-hook-validation","title":"Adding Hook Validation","text":"<p>Validate system prompt before injection:</p> <pre><code>class SystemPromptValidator:\n    \"\"\"Validate system prompt before injection.\"\"\"\n\n    @staticmethod\n    def validate_all(prompt: str) -&gt; dict:\n        \"\"\"Run all validations.\"\"\"\n        return {\n            'syntax': SystemPromptValidator.validate_syntax(prompt),\n            'tokens': SystemPromptValidator.validate_tokens(prompt),\n            'content': SystemPromptValidator.validate_content(prompt),\n            'security': SystemPromptValidator.validate_security(prompt),\n        }\n\n    @staticmethod\n    def validate_syntax(prompt: str) -&gt; bool:\n        \"\"\"Check markdown syntax.\"\"\"\n        try:\n            import markdown\n            markdown.markdown(prompt)\n            return True\n        except:\n            return False\n\n    @staticmethod\n    def validate_tokens(prompt: str, max_tokens: int = 1000) -&gt; bool:\n        \"\"\"Check token budget.\"\"\"\n        tokens = len(prompt) // 4  # Rough estimate\n        return tokens &lt;= max_tokens\n\n    @staticmethod\n    def validate_content(prompt: str) -&gt; bool:\n        \"\"\"Check for required sections.\"\"\"\n        required = [\n            'Model',  # Model selection\n            'Delegat',  # Delegation pattern\n        ]\n        return all(section in prompt for section in required)\n\n    @staticmethod\n    def validate_security(prompt: str) -&gt; bool:\n        \"\"\"Check for sensitive data.\"\"\"\n        forbidden = [\n            'password', 'token', 'secret', 'key',\n            'api_key', 'api_secret', 'credentials'\n        ]\n        prompt_lower = prompt.lower()\n        return not any(word in prompt_lower for word in forbidden)\n</code></pre> <p>Using validation in hook:</p> <pre><code>def inject_system_prompt():\n    \"\"\"Inject with validation.\"\"\"\n    system_prompt = read_file('.claude/system-prompt.md')\n\n    # Validate before injection\n    validation = SystemPromptValidator.validate_all(system_prompt)\n    if not validation['security']:\n        logger.error(\"SECURITY: System prompt contains sensitive data!\")\n        # Fallback to default\n        system_prompt = PLUGIN_DEFAULT_SYSTEM_PROMPT\n\n    if not validation['tokens']:\n        logger.warning(\"System prompt exceeds token budget, truncating\")\n        system_prompt = truncate_smart(system_prompt)\n\n    # Proceed with injection\n    os.environ['CLAUDE_SYSTEM_PROMPT'] = system_prompt\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#creating-custom-skills","title":"Creating Custom Skills","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#skill-extension-pattern","title":"Skill Extension Pattern","text":"<p>Create custom skills that interact with system prompt:</p> <pre><code># File: packages/claude-plugin/skills/my-custom-skill/SKILL.md\n\n---\nid: my-custom-skill\nname: My Custom Skill\ndescription: Custom skill that uses system prompt guidance\ntrigger: \"when user asks about [topic]\"\nvisibility: \"always\"\ntags: [\"custom\", \"extension\"]\n---\n\n# My Custom Skill\n\nThis skill extends system prompt persistence with custom functionality.\n\n## How It Works\n\n1. Reads current system prompt from environment\n2. Analyzes delegation patterns in prompt\n3. Provides custom guidance based on patterns\n\n## Usage\n\n```bash\n/my-custom-skill\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#examples","title":"Examples","text":"<p>[Examples here] <pre><code>**Python implementation:**\n\n```python\n# File: packages/claude-plugin/skills/my-custom-skill/skill.py\n\nimport os\nfrom typing import Optional\n\nclass MyCustomSkill:\n    \"\"\"Custom skill using system prompt guidance.\"\"\"\n\n    def __init__(self):\n        self.system_prompt = os.getenv('CLAUDE_SYSTEM_PROMPT', '')\n        self.delegation_enabled = os.getenv('CLAUDE_DELEGATION_ENABLED') == 'true'\n\n    def analyze_prompt(self) -&gt; dict:\n        \"\"\"Analyze system prompt for patterns.\"\"\"\n        if not self.system_prompt:\n            return {'status': 'no_prompt'}\n\n        patterns = {\n            'model_guidance': self._extract_model_guidance(),\n            'delegation_rules': self._extract_delegation_rules(),\n            'quality_gates': self._extract_quality_gates(),\n            'key_rules': self._extract_key_rules(),\n        }\n\n        return patterns\n\n    def _extract_model_guidance(self) -&gt; list:\n        \"\"\"Extract model selection guidance.\"\"\"\n        lines = self.system_prompt.split('\\n')\n        models = []\n        current_model = None\n\n        for line in lines:\n            if 'Use Haiku' in line or 'Use Sonnet' in line or 'Use Opus' in line:\n                current_model = line.strip()\n                models.append(current_model)\n\n        return models\n\n    def _extract_delegation_rules(self) -&gt; list:\n        \"\"\"Extract delegation patterns.\"\"\"\n        if 'Delegation' not in self.system_prompt:\n            return []\n\n        lines = self.system_prompt.split('\\n')\n        rules = []\n        in_delegation = False\n\n        for line in lines:\n            if 'Delegation' in line:\n                in_delegation = True\n            elif in_delegation:\n                if line.startswith('##'):\n                    break\n                if line.strip() and not line.startswith('#'):\n                    rules.append(line.strip())\n\n        return rules\n\n    def _extract_quality_gates(self) -&gt; list:\n        \"\"\"Extract quality gate commands.\"\"\"\n        if 'Quality' not in self.system_prompt:\n            return []\n\n        lines = self.system_prompt.split('\\n')\n        gates = []\n\n        for line in lines:\n            if 'uv run' in line or 'pytest' in line or 'mypy' in line:\n                gates.append(line.strip())\n\n        return gates\n\n    def _extract_key_rules(self) -&gt; list:\n        \"\"\"Extract numbered rules.\"\"\"\n        lines = self.system_prompt.split('\\n')\n        rules = []\n\n        for line in lines:\n            if line.strip() and line[0].isdigit() and line[1] == '.':\n                rules.append(line.strip())\n\n        return rules\n\n    def provide_guidance(self, query: str) -&gt; str:\n        \"\"\"Provide guidance based on system prompt.\"\"\"\n        patterns = self.analyze_prompt()\n\n        if 'model' in query.lower():\n            return self._guidance_for_models(patterns)\n        elif 'delegat' in query.lower():\n            return self._guidance_for_delegation(patterns)\n        elif 'quality' in query.lower() or 'test' in query.lower():\n            return self._guidance_for_quality(patterns)\n        else:\n            return self._general_guidance(patterns)\n\n    def _guidance_for_models(self, patterns: dict) -&gt; str:\n        \"\"\"Model selection guidance.\"\"\"\n        guidance = \"## Model Selection from System Prompt\\n\\n\"\n        for model in patterns['model_guidance']:\n            guidance += f\"- {model}\\n\"\n        return guidance\n\n    def _guidance_for_delegation(self, patterns: dict) -&gt; str:\n        \"\"\"Delegation pattern guidance.\"\"\"\n        if not self.delegation_enabled:\n            return \"Delegation is not enabled in this project.\"\n\n        guidance = \"## Delegation Rules from System Prompt\\n\\n\"\n        for rule in patterns['delegation_rules']:\n            guidance += f\"- {rule}\\n\"\n        return guidance\n\n    def _guidance_for_quality(self, patterns: dict) -&gt; str:\n        \"\"\"Quality gate guidance.\"\"\"\n        guidance = \"## Quality Gates from System Prompt\\n\\n\"\n        for gate in patterns['quality_gates']:\n            guidance += f\"```bash\\n{gate}\\n```\\n\"\n        return guidance\n\n    def _general_guidance(self, patterns: dict) -&gt; str:\n        \"\"\"General system prompt summary.\"\"\"\n        guidance = \"## System Prompt Summary\\n\\n\"\n        guidance += f\"Models: {len(patterns['model_guidance'])} defined\\n\"\n        guidance += f\"Delegation rules: {len(patterns['delegation_rules'])} rules\\n\"\n        guidance += f\"Quality gates: {len(patterns['quality_gates'])} gates\\n\"\n        guidance += f\"Key rules: {len(patterns['key_rules'])} rules\\n\"\n        return guidance\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#sdk-integration","title":"SDK Integration","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#sessionstatemanager-extension","title":"SessionStateManager Extension","text":"<p>Extend SDK with custom state management:</p> <pre><code>from htmlgraph.session import SessionStateManager\n\nclass CustomSessionStateManager(SessionStateManager):\n    \"\"\"Extended session management with custom logic.\"\"\"\n\n    def __init__(self):\n        super().__init__()\n        self.custom_state = {}\n\n    def load_custom_state(self, key: str) -&gt; Optional[dict]:\n        \"\"\"Load custom state from backup.\"\"\"\n        state_file = Path('.htmlgraph/.custom-state.json')\n        if state_file.exists():\n            data = json.loads(state_file.read_text())\n            return data.get(key)\n        return None\n\n    def save_custom_state(self, key: str, value: dict) -&gt; bool:\n        \"\"\"Save custom state for recovery.\"\"\"\n        state_file = Path('.htmlgraph/.custom-state.json')\n        state_file.parent.mkdir(parents=True, exist_ok=True)\n\n        data = {}\n        if state_file.exists():\n            data = json.loads(state_file.read_text())\n\n        data[key] = value\n        state_file.write_text(json.dumps(data, indent=2))\n        return True\n\n    def get_post_compact_context(self) -&gt; str:\n        \"\"\"Get enhanced post-compact context.\"\"\"\n        base_context = super().get_post_compact_context()\n\n        # Add custom context\n        custom = self.load_custom_state('post_compact_context')\n        if custom:\n            base_context += f\"\\n\\nCustom state: {custom}\"\n\n        return base_context\n</code></pre> <p>Using extended manager:</p> <pre><code>from htmlgraph import SDK\nfrom custom.session_manager import CustomSessionStateManager\n\nsdk = SDK(agent=\"extended\")\nmanager = CustomSessionStateManager()\n\n# Check if post-compact\nif manager.is_post_compact():\n    print(\"Post-compact session detected\")\n    custom_context = manager.get_post_compact_context()\n    print(f\"Enhanced context: {custom_context}\")\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#testing-custom-implementations","title":"Testing Custom Implementations","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#unit-test-pattern","title":"Unit Test Pattern","text":"<pre><code>import pytest\nfrom custom_layers.my_layer import MyPersistenceLayer\n\nclass TestMyPersistenceLayer:\n    \"\"\"Test custom persistence layer.\"\"\"\n\n    @pytest.fixture\n    def layer(self):\n        \"\"\"Create test layer instance.\"\"\"\n        return MyPersistenceLayer({\n            'test_mode': True,\n            'config_value': 'test'\n        })\n\n    def test_is_available(self, layer):\n        \"\"\"Test availability check.\"\"\"\n        assert layer.is_available()\n\n    def test_store_and_retrieve(self, layer):\n        \"\"\"Test store and retrieve cycle.\"\"\"\n        prompt = \"# Test Prompt\\n\\nTest content\"\n\n        # Store\n        assert layer.store(prompt) is True\n\n        # Retrieve\n        retrieved = layer.retrieve()\n        assert retrieved == prompt\n\n    def test_retrieve_missing(self, layer):\n        \"\"\"Test retrieval of missing prompt.\"\"\"\n        with pytest.raises(PersistenceLayerError):\n            layer.retrieve()\n\n    def test_error_handling(self, layer):\n        \"\"\"Test error handling.\"\"\"\n        layer.config['invalid'] = True  # Break configuration\n        assert layer.is_available() is False\n</code></pre> <p>Run tests:</p> <pre><code>uv run pytest tests/custom_layers/test_my_layer.py -v\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#integration-test-pattern","title":"Integration Test Pattern","text":"<pre><code>def test_custom_layer_in_session():\n    \"\"\"Test custom layer in real session.\"\"\"\n    import tempfile\n    import os\n\n    with tempfile.TemporaryDirectory() as tmpdir:\n        os.chdir(tmpdir)\n\n        # Setup\n        os.makedirs('.claude/hooks/scripts', exist_ok=True)\n        prompt_file = Path('.claude/system-prompt.md')\n        prompt_file.write_text(\"# Test Prompt\")\n\n        # Mock environment\n        os.environ['CLAUDE_SESSION_ID'] = 'test-session'\n        os.environ['CLAUDE_DELEGATION_ENABLED'] = 'true'\n\n        # Import and test\n        from custom.session_integration import setup_custom_layers\n\n        result = setup_custom_layers()\n        assert result.success is True\n        assert result.layers_initialized == 3  # File, env, custom\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#performance-optimization","title":"Performance Optimization","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#caching-strategies","title":"Caching Strategies","text":"<pre><code>from functools import lru_cache\nfrom datetime import datetime, timedelta\n\nclass CachedPersistenceLayer:\n    \"\"\"Layer with intelligent caching.\"\"\"\n\n    def __init__(self, ttl_seconds: int = 300):\n        self.ttl = timedelta(seconds=ttl_seconds)\n        self._cache = None\n        self._cache_time = None\n\n    @property\n    def _is_cache_valid(self) -&gt; bool:\n        \"\"\"Check if cache is still valid.\"\"\"\n        if self._cache is None:\n            return False\n        return datetime.now() - self._cache_time &lt; self.ttl\n\n    def retrieve(self) -&gt; str:\n        \"\"\"Retrieve with caching.\"\"\"\n        if self._is_cache_valid:\n            logger.debug(\"Using cached system prompt\")\n            return self._cache\n\n        # Fetch fresh\n        prompt = self._fetch_uncached()\n        self._cache = prompt\n        self._cache_time = datetime.now()\n        return prompt\n\n    def _fetch_uncached(self) -&gt; str:\n        \"\"\"Actual fetch implementation.\"\"\"\n        raise NotImplementedError\n\n    def invalidate_cache(self):\n        \"\"\"Invalidate cache (call after updates).\"\"\"\n        self._cache = None\n        self._cache_time = None\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#lazy-loading","title":"Lazy Loading","text":"<pre><code>class LazyPersistenceLayer:\n    \"\"\"Lazy load persistence layer on first use.\"\"\"\n\n    def __init__(self, config: dict):\n        self.config = config\n        self._initialized = False\n        self._layer = None\n\n    @property\n    def layer(self):\n        \"\"\"Lazy initialize layer.\"\"\"\n        if not self._initialized:\n            self._layer = self._create_layer()\n            self._initialized = True\n        return self._layer\n\n    def _create_layer(self):\n        \"\"\"Create actual layer (expensive operation).\"\"\"\n        # Heavy initialization here\n        # e.g., database connection, file system setup\n        return ActualPersistenceLayer(self.config)\n\n    def retrieve(self) -&gt; str:\n        \"\"\"Retrieve via lazy-loaded layer.\"\"\"\n        return self.layer.retrieve()\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#debugging-tips","title":"Debugging Tips","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#enable-debug-logging","title":"Enable Debug Logging","text":"<pre><code>import logging\n\n# Set debug level\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger('system_prompt')\n\n# Add detailed logging\nlogger.debug(\"System prompt retrieval started\")\nlogger.debug(f\"Trying layer 1: {layer1.__class__.__name__}\")\nlogger.debug(f\"Layer 1 available: {layer1.is_available()}\")\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#inspect-environment-variables","title":"Inspect Environment Variables","text":"<pre><code># Check all CLAUDE_* variables\nenv | grep CLAUDE_\n\n# Check specific variable\necho $CLAUDE_SYSTEM_PROMPT | head -50\n\n# Check session ID\necho \"Session ID: $CLAUDE_SESSION_ID\"\necho \"Is post-compact: $CLAUDE_IS_POST_COMPACT\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#test-hook-execution","title":"Test Hook Execution","text":"<pre><code># Add verbose output to hook\n# In .claude/hooks/scripts/session-start.py:\n\ndef inject_system_prompt():\n    print(\"DEBUG: Session start hook running...\")\n    print(f\"DEBUG: System prompt file exists: {exists('.claude/system-prompt.md')}\")\n    print(f\"DEBUG: Environment variable set: {bool(os.getenv('CLAUDE_SYSTEM_PROMPT'))}\")\n    print(\"DEBUG: Hook execution complete\")\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#verify-injection-worked","title":"Verify Injection Worked","text":"<pre><code># Check in Python\nimport os\n\nsystem_prompt = os.getenv('CLAUDE_SYSTEM_PROMPT')\nif system_prompt:\n    print(f\"System prompt loaded: {len(system_prompt)} characters\")\n    print(f\"First 100 chars: {system_prompt[:100]}\")\nelse:\n    print(\"ERROR: System prompt not loaded!\")\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#contributing","title":"Contributing","text":""},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#pull-request-guidelines","title":"Pull Request Guidelines","text":"<p>When contributing extensions:</p> <ol> <li>Follow patterns: Use layer, hook, and skill patterns above</li> <li>Add tests: 100% coverage for new code</li> <li>Document: Include docstrings and README</li> <li>Backward compatible: Don't break existing code</li> <li>Performance: Profile and optimize hot paths</li> </ol>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#code-review-checklist","title":"Code Review Checklist","text":"<pre><code>- [ ] Follows idempotency pattern\n- [ ] Handles errors gracefully\n- [ ] Has comprehensive logging\n- [ ] Includes unit tests (&gt;80% coverage)\n- [ ] Includes integration tests\n- [ ] Updated documentation\n- [ ] Performance impact assessed\n- [ ] Backward compatible\n- [ ] Security review passed\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#example-pr-template","title":"Example PR Template","text":"<pre><code>## What does this PR do?\n\n[Description of extension/feature]\n\n## Type of change\n\n- [ ] New persistence layer\n- [ ] Hook extension\n- [ ] Skill addition\n- [ ] SDK enhancement\n- [ ] Bug fix\n- [ ] Performance optimization\n\n## Testing\n\n- [ ] Unit tests added\n- [ ] Integration tests added\n- [ ] Manual testing done\n- [ ] Performance impact: [minimal/moderate/significant]\n\n## Breaking changes\n\n- [ ] Yes (describe below)\n- [ ] No\n\n## Checklist\n\n- [ ] Code follows project style\n- [ ] Self-review completed\n- [ ] Documentation updated\n- [ ] Tests passing locally\n</code></pre>"},{"location":"SYSTEM_PROMPT_DEVELOPER_GUIDE/#next-steps","title":"Next Steps","text":"<ol> <li>Choose extension point: Layer, hook, or skill</li> <li>Follow pattern: Use pattern from section above</li> <li>Write tests: Unit + integration tests</li> <li>Document: README and docstrings</li> <li>Submit PR: Follow contributing guidelines</li> </ol> <p>For architecture details, see System Prompt Architecture.</p> <p>For admin setup, see Delegation Enforcement Guide.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/","title":"System Prompt Persistence Guide","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#overview","title":"Overview","text":"<p>The system prompt persistence feature ensures your Claude Code system prompt survives across session boundaries\u2014compacts, resumes, and context clears. This guide covers installation, configuration, troubleshooting, and best practices.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#what-it-does","title":"What It Does","text":"<ul> <li>Auto-injects system prompt at session start via SessionStart hook</li> <li>Survives compacts and resumes \u2014 prompt re-appears after context clears</li> <li>Customizable \u2014 edit <code>.claude/system-prompt.md</code> for your needs</li> <li>Model-aware \u2014 includes guidance for delegating to different models</li> <li>Zero-latency \u2014 minimal impact on session startup time</li> </ul>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#why-it-matters","title":"Why It Matters","text":"<p>System prompts guide Claude's reasoning and behavior throughout a session. Without persistence, your guidance vanishes when context compacts. This feature keeps it available automatically.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#how-it-works","title":"How It Works","text":"<p>Three-layer architecture (phase rollout):</p> <ul> <li>Layer 1 (Current): <code>additionalContext</code> injection via SessionStart hook</li> <li>Layer 2 (Coming): <code>CLAUDE_ENV_FILE</code> environment variable support</li> <li>Layer 3 (Coming): File backup and recovery system</li> </ul>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#installation","title":"Installation","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#prerequisites","title":"Prerequisites","text":"<ul> <li>HtmlGraph plugin installed in Claude Code</li> <li><code>.claude/</code> directory in your project</li> <li>System prompt file created (auto-generated on first session start)</li> </ul>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#setup-steps","title":"Setup Steps","text":"<p>Step 1: Verify plugin installation</p> <pre><code>claude plugin list | grep htmlgraph\n</code></pre> <p>Expected output: <code>htmlgraph</code> listed with version number</p> <p>Step 2: System prompt auto-creation</p> <p>When you start a Claude Code session in your HtmlGraph project: 1. SessionStart hook runs automatically 2. <code>.claude/system-prompt.md</code> is created if missing 3. Prompt is injected as additional context 4. Available throughout your session</p> <p>Step 3: Verify injection</p> <p>After starting a new session: 1. You should see system prompt content in your context 2. Check hook execution: <code>claude --debug</code> for verbose output 3. Confirm prompt persists after using <code>/compact</code> command</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#file-location","title":"File Location","text":"<pre><code>your-project/\n\u251c\u2500\u2500 .claude/\n\u2502   \u251c\u2500\u2500 system-prompt.md          \u2190 Your custom prompt (EDIT THIS)\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u2514\u2500\u2500 scripts/\n\u2502   \u2502       \u2514\u2500\u2500 session-start.py  \u2190 Injection logic (read-only)\n\u2502   \u2514\u2500\u2500 settings.json             \u2190 Plugin config\n\u2514\u2500\u2500 .htmlgraph/\n    \u2514\u2500\u2500 sessions/                 \u2190 Session tracking\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#configuration","title":"Configuration","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#customizing-your-system-prompt","title":"Customizing Your System Prompt","text":"<p>Edit <code>.claude/system-prompt.md</code> to customize Claude's behavior in your project.</p> <p>Structure:</p> <pre><code># Your System Prompt Title\n\n## Section 1: Primary Directive\nYour core principle here...\n\n## Section 2: Workflow Pattern\nHow work should be organized...\n\n## Section 3: Model Guidance\nWhich models for which tasks...\n\n## Section 4: Key Rules\nNon-negotiable constraints...\n</code></pre> <p>Best Practices:</p> <ol> <li>Keep it under 500 tokens \u2014 Too long and injection delays startup</li> <li>Use clear section headings \u2014 Makes scanning easy</li> <li>Include model guidance \u2014 Helps with delegation decisions</li> <li>Be specific to your project \u2014 Generic prompts are less useful</li> <li>Update regularly \u2014 Refine as you learn what works</li> </ol> <p>Example: HtmlGraph Development Prompt</p> <pre><code># System Prompt - HtmlGraph Development\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation | Efficiency &gt; verbosity\n\n## Orchestration Pattern\n- Use Task() for multi-session work, deep research, or complex reasoning\n- Execute directly only for straightforward file operations or quick implementations\n- Haiku: Default orchestrator\u2014excellent at following delegation instructions\n- Sonnet/Opus: For deep reasoning, but tends to over-execute; use Task() when uncertain\n\n## Model Guidance\n- Haiku (Recommended): Orchestration, delegation, quick tasks\n- Sonnet: Complex reasoning, architecture decisions\n- Opus: Novel problems, research-heavy investigations\n\n## Context Persistence\nThis prompt auto-injects at session start via SessionStart hook. It survives\ncompact/resume cycles and remains available as reference throughout your session.\n\n## Key Rules\n1. Always Read before Write/Edit/Update\n2. Use absolute paths only\n3. Use `uv run` for all Python execution\n4. Batch tool calls when independent\n5. Fix all errors before committing\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#example-general-development-prompt","title":"Example: General Development Prompt","text":"<pre><code># System Prompt - General Development\n\n## Primary Directive\nWriting reliable, maintainable code with comprehensive testing.\n\n## Workflow\n1. Read existing code before making changes\n2. Plan changes before implementation\n3. Write tests before code\n4. Run tests before committing\n\n## Model Selection\n- Use Haiku for quick fixes, refactoring, simple features\n- Use Sonnet for architecture, complex logic, research\n- Use Opus only for novel problems or major decisions\n\n## Delegation\nDelegate when:\n- Task takes &gt;30 minutes\n- Requires file exploration (many files)\n- Needs extensive testing\n- Affects multiple components\n\nExecute directly when:\n- Single file change\n- Takes &lt;10 minutes\n- Simple, safe change\n- Easy to verify\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#testing-your-configuration","title":"Testing Your Configuration","text":"<p>After editing <code>.claude/system-prompt.md</code>:</p> <ol> <li>Restart your session \u2014 Hook runs at session start</li> <li>Use <code>/compact</code> \u2014 Clears context, then re-injects prompt</li> <li>Verify \u2014 Check that your custom content appears in context</li> <li>Debug \u2014 If prompt doesn't appear: <code>claude --debug</code> for verbose output</li> </ol>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#how-it-works-3-layer-architecture","title":"How It Works (3-Layer Architecture)","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#layer-1-session-hook-injection-current","title":"Layer 1: Session Hook Injection (Current)","text":"<p>Mechanism: SessionStart hook runs when Claude Code starts.</p> <p>Flow: <pre><code>Session Start\n    \u2193\nSessionStart hook executes (session-start.py)\n    \u2193\nReads .claude/system-prompt.md\n    \u2193\nInjects as additionalContext\n    \u2193\nPrompt available throughout session\n</code></pre></p> <p>Token Impact: &lt;50ms execution, &lt;2% context overhead</p> <p>Reliability: High \u2014 uses built-in hook mechanism</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#layer-2-environment-variable-support-phase-2","title":"Layer 2: Environment Variable Support (Phase 2)","text":"<p>Future enhancement using <code>CLAUDE_ENV_FILE</code>:</p> <pre><code>export CLAUDE_ENV_FILE=~/.claude/system-prompt.md\n</code></pre> <p>Advantages: - Works across all Claude Code sessions - Survives environment changes - Doesn't consume context tokens</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#layer-3-file-backup-system-phase-3","title":"Layer 3: File Backup System (Phase 3)","text":"<p>Automatic backup and recovery: - Detects lost prompts - Restores from backup - Validates injection success</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#model-specific-guidance","title":"Model-Specific Guidance","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#when-to-use-which-model","title":"When to Use Which Model","text":"<p>Haiku (Recommended for most work)</p> <p>Best for: - Orchestration and delegation - Following complex instructions - Quick implementations and fixes - Refactoring and cleanup - Running tests and quality gates - File operations and searches</p> <p>Why it excels: - Highly responsive to detailed instructions - Excellent at following patterns - Fast execution (40-80ms typical) - Lower cost - Ideal for delegation workflows</p> <p>Example delegation: <pre><code>Task(\n    prompt=\"\"\"\n    Fix the bug in src/auth/jwt.py where tokens expire immediately.\n    The issue is in the validate_token() function.\n    Run tests after fixing to verify the fix works.\n    \"\"\",\n    subagent_type=\"general-purpose\"  # Uses Haiku by default\n)\n</code></pre></p> <p>Sonnet (Complex reasoning)</p> <p>Best for: - Architecture and design decisions - Complex algorithms and logic - Performance optimization - Security analysis - Code review and quality assessment - When initial attempt fails</p> <p>Why it excels: - Strong reasoning about trade-offs - Better understanding of complex contexts - Good balance of speed and power - Good for cross-domain problems</p> <p>Example use: <pre><code>Task(\n    prompt=\"\"\"\n    Design a caching strategy for our API.\n    Consider: hit rate, memory limits, invalidation complexity.\n    Compare Redis vs. in-memory approaches.\n    \"\"\",\n    subagent_type=\"sonnet\"  # Request Sonnet explicitly\n)\n</code></pre></p> <p>Opus (Novel problems, research)</p> <p>Best for: - Entirely new feature design - Research-heavy tasks - Multi-step reasoning with many unknowns - When Sonnet's attempt was insufficient - Novel problem domains</p> <p>Why it excels: - Strongest reasoning capabilities - Handles ambiguity well - Good for exploration and discovery - Best for completely novel problems</p> <p>Example use: <pre><code>Task(\n    prompt=\"\"\"\n    We're building a real-time collaboration system.\n    Research: What are the key technical challenges?\n    Design: How would you approach it from first principles?\n    \"\"\",\n    subagent_type=\"opus\"  # Request Opus for novel design\n)\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#signaling-model-preference","title":"Signaling Model Preference","text":"<p>In your system prompt, indicate preferred models:</p> <pre><code>## Model Guidance\n\n**Haiku (Default for delegation)**\n- Use for: Quick fixes, orchestration, following patterns\n- When to use: Most everyday tasks, especially delegated work\n\n**Sonnet (Complex reasoning)**\n- Use for: Architecture, algorithm design, optimization\n- When to use: Task requires multi-step reasoning or design decisions\n\n**Opus (Novel problems)**\n- Use for: Entirely new features, research, complex discovery\n- When to use: Previous attempts with other models insufficient\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#cost-optimization","title":"Cost Optimization","text":"<p>Rule: Match model size to task complexity</p> <pre><code>Simple task + Haiku = Fast + Cheap \u2705\nSimple task + Sonnet = Slow + Expensive \u274c\nComplex task + Haiku = Fast but limited \u26a0\ufe0f\nComplex task + Sonnet = Balanced \u2705\nComplex task + Opus = Best but expensive \u2705\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#prompt-not-appearing-after-session-start","title":"Prompt Not Appearing After Session Start","text":"<p>Symptom: You don't see custom prompt content in initial context.</p> <p>Diagnosis Steps:</p> <ol> <li> <p>Check file exists:    <pre><code>ls -la .claude/system-prompt.md\n</code></pre>    Expected: File should exist, size &gt;100 bytes</p> </li> <li> <p>Check file is readable:    <pre><code>head -5 .claude/system-prompt.md\n</code></pre>    Expected: Your prompt content appears</p> </li> <li> <p>Check hook is registered:    <pre><code>claude /hooks\n</code></pre>    Expected: <code>SessionStart</code> hook listed</p> </li> <li> <p>Run with debug output:    <pre><code>claude --debug\n# Look for \"SessionStart hook\" or \"additionalContext\" in output\n</code></pre></p> </li> </ol> <p>Solutions:</p> <ul> <li>File missing: System will recreate at next session start</li> <li>File unreadable: Check permissions: <code>chmod 644 .claude/system-prompt.md</code></li> <li>Hook not registered: Verify plugin installed: <code>claude plugin list</code></li> <li>Still broken: See \"Debug Mode\" section below</li> </ul>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#prompt-not-persisting-after-compact","title":"Prompt Not Persisting After Compact","text":"<p>Symptom: Prompt disappears after using <code>/compact</code> command.</p> <p>Expected behavior: Prompt re-appears automatically when context resumes.</p> <p>If not re-appearing:</p> <ol> <li> <p>Verify hook is still active:    <pre><code>claude /hooks\n</code></pre></p> </li> <li> <p>Check recent session logs:    <pre><code>ls -lt .htmlgraph/sessions/ | head -1\n</code></pre></p> </li> <li> <p>Run <code>/compact</code> again with debug:    <pre><code>claude --debug\n# Use /compact command\n# Check for hook execution in output\n</code></pre></p> </li> </ol> <p>Note: First <code>/compact</code> might not trigger injection if hook timing is off. Second compact should work.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#prompt-has-wrong-content","title":"Prompt Has Wrong Content","text":"<p>Symptom: Your custom prompt isn't appearing, or old content still shows.</p> <p>Solution:</p> <ol> <li>Edit <code>.claude/system-prompt.md</code> with new content</li> <li>Restart your session (or use <code>/clear</code> then <code>/compact</code>)</li> <li>Verify new content appears</li> <li>If old content still shows: Clear browser cache if using dashboard</li> </ol>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#hook-timeout-or-failure","title":"Hook Timeout or Failure","text":"<p>Symptom: Hook takes too long or exits with error.</p> <p>Cause: Prompt file too large or malformed.</p> <p>Solution:</p> <ol> <li> <p>Check file size:    <pre><code>wc -w .claude/system-prompt.md\n# Should be &lt;500 words\n</code></pre></p> </li> <li> <p>If &gt;500 words: Remove least important sections</p> </li> <li> <p>Validate markdown syntax:    <pre><code># No unclosed markdown syntax (## without closing)\n# No invalid YAML if using frontmatter\n</code></pre></p> </li> <li> <p>Simplify content and retry</p> </li> </ol>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#plugin-not-installed","title":"Plugin Not Installed","text":"<p>Symptom: <code>claude plugin list</code> doesn't show htmlgraph.</p> <p>Solution:</p> <pre><code># Install the plugin\nclaude plugin install htmlgraph\n\n# Verify installation\nclaude plugin list | grep htmlgraph\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#debug-mode","title":"Debug Mode","text":"<p>For detailed troubleshooting output:</p> <pre><code># Run Claude with verbose logging\nclaude --debug\n\n# Look for these log lines:\n# \"SessionStart hook executing\"\n# \"Reading system-prompt.md\"\n# \"Injecting additionalContext\"\n# \"Hook completed successfully\"\n</code></pre> <p>If you see errors: - <code>FileNotFoundError</code>: Prompt file missing (will recreate) - <code>PermissionError</code>: File not readable (check permissions) - <code>TimeoutError</code>: Prompt too large (reduce size) - <code>JSONDecodeError</code>: Hook output malformed (restart plugin)</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#faq","title":"FAQ","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-how-often-is-the-prompt-injected","title":"Q: How often is the prompt injected?","text":"<p>A: At session start, after context resume, and after <code>/clear</code> command. Typically once per session (unless you compact).</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-does-this-add-latency-to-session-startup","title":"Q: Does this add latency to session startup?","text":"<p>A: Minimal impact: - Hook execution: &lt;50ms typically - Context overhead: &lt;2% (100-200 tokens) - Notice: Only on first session start in a new project</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-can-i-customize-the-prompt-per-project","title":"Q: Can I customize the prompt per project?","text":"<p>A: Yes, completely. Edit <code>.claude/system-prompt.md</code> for your project.</p> <p>Examples: - HtmlGraph projects: Include orchestration patterns - General projects: Include your coding standards - Research projects: Include methodology and focus areas</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-what-if-the-file-is-missing","title":"Q: What if the file is missing?","text":"<p>A: Feature degrades gracefully: - Hook logs warning to stderr - Session continues normally - File auto-creates with default content on next session start - No impact to functionality</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-can-i-disable-this-feature","title":"Q: Can I disable this feature?","text":"<p>A: Not recommended, but if needed:</p> <pre><code># Disable session tracking (stops all hooks)\nexport HTMLGRAPH_DISABLE_TRACKING=1\n\n# To re-enable\nunset HTMLGRAPH_DISABLE_TRACKING\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-does-prompt-injection-work-after-clear","title":"Q: Does prompt injection work after <code>/clear</code>?","text":"<p>A: Yes. <code>/clear</code> is treated like a compact, triggering hook re-execution.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-how-do-i-know-its-working","title":"Q: How do I know it's working?","text":"<p>A: 1. After session start, your prompt content appears in context 2. After <code>/compact</code>, prompt re-appears when context resumes 3. Check hook execution: <code>claude /hooks</code> shows SessionStart registered 4. Debug output shows injection: <code>claude --debug</code></p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-what-if-i-have-multiple-projects","title":"Q: What if I have multiple projects?","text":"<p>A: Each project gets its own <code>.claude/system-prompt.md</code>. Edit per-project prompts independently.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-can-i-use-environment-variables-in-my-prompt","title":"Q: Can I use environment variables in my prompt?","text":"<p>A: Not yet (Phase 2 feature). Currently, prompt is static markdown.</p> <p>Workaround: Create separate prompts for different scenarios and commit to version control.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-whats-the-token-cost","title":"Q: What's the token cost?","text":"<p>A: Approximately 100-300 tokens depending on prompt size: - HtmlGraph example prompt: ~200 tokens - General project prompt: ~150-250 tokens - Minimal prompt: ~100 tokens</p> <p>Choose length based on your needs.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-does-this-work-with-other-claude-code-features","title":"Q: Does this work with other Claude Code features?","text":"<p>A: Yes, fully compatible with: - <code>/compact</code> and context resume - <code>/clear</code> command - Orchestrator mode - All hooks and plugins - Session tracking</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-what-if-i-want-to-update-my-prompt","title":"Q: What if I want to update my prompt?","text":"<p>A: Simple: 1. Edit <code>.claude/system-prompt.md</code> 2. Changes take effect at next session start 3. Or use <code>/compact</code> to trigger re-injection immediately</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-is-this-synced-across-my-machines","title":"Q: Is this synced across my machines?","text":"<p>A: Only if you commit <code>.claude/system-prompt.md</code> to git:</p> <pre><code># Include in version control\ngit add .claude/system-prompt.md\ngit commit -m \"chore: add system prompt\"\ngit push\n\n# On another machine, pull and start working\ngit pull\n# New session automatically picks up your prompt\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#q-can-i-test-my-prompt-without-starting-a-new-session","title":"Q: Can I test my prompt without starting a new session?","text":"<p>A: Yes: 1. Edit <code>.claude/system-prompt.md</code> 2. Use <code>/compact</code> command (triggers hook re-execution) 3. Verify new content appears 4. Or start a new session to test completely fresh</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#integration-with-htmlgraph","title":"Integration with HtmlGraph","text":"<p>System prompt persistence integrates with HtmlGraph's orchestration system:</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#orchestrator-mode-guidance","title":"Orchestrator Mode Guidance","text":"<p>Your system prompt can include orchestrator directives:</p> <pre><code>## Orchestration Pattern\n\n- Use Task() for multi-session work, deep research, or complex reasoning\n- Execute directly only for straightforward file operations\n- Haiku: Default orchestrator\u2014excellent at following delegation instructions\n- Sonnet/Opus: For deep reasoning, but tends to over-execute\n</code></pre> <p>When orchestrator mode is active (default), Claude Code enforces these patterns.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#session-tracking","title":"Session Tracking","text":"<p>All sessions are automatically tracked in <code>.htmlgraph/sessions/</code>:</p> <pre><code># View session history\nuv run htmlgraph session list\n\n# Check current session details\nuv run htmlgraph session show &lt;session-id&gt;\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#feature-attribution","title":"Feature Attribution","text":"<p>Work is automatically attributed to in-progress features. Your system prompt can guide feature creation:</p> <pre><code>## Feature Creation Decision Framework\n\nCreate a FEATURE if ANY apply:\n- &gt;30 minutes work\n- 3+ files\n- New tests needed\n- Multi-component impact\n\nImplement DIRECTLY if ALL apply:\n- Single file\n- &lt;30 minutes\n- Trivial change\n- Easy to revert\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#best-practices","title":"Best Practices","text":""},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#1-keep-it-fresh","title":"1. Keep It Fresh","text":"<p>Update your system prompt as you learn:</p> <pre><code># WRONG: Old, outdated guidance\n## Review once a month\n\n# RIGHT: Current, tested patterns\n## Review when process changes\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#2-be-specific","title":"2. Be Specific","text":"<pre><code># WRONG: \"Use best practices\"\n\n# RIGHT: \"Use uv run for Python execution, never raw python or pip\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#3-include-model-guidance","title":"3. Include Model Guidance","text":"<p>Help Claude choose the right tool:</p> <pre><code># WRONG: No model preferences\n\n# RIGHT:\n## Model Selection\n- Haiku: Delegation, orchestration (default)\n- Sonnet: Complex reasoning, architecture\n- Opus: Novel problems, research\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#4-document-your-workflow","title":"4. Document Your Workflow","text":"<p>Make your process explicit:</p> <pre><code>## Workflow Steps\n1. Read existing code\n2. Plan changes\n3. Write tests\n4. Implement\n5. Run tests\n6. Commit\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#5-keep-it-concise","title":"5. Keep It Concise","text":"<p>Longer isn't better:</p> <pre><code>Good: 100-300 tokens (specific, actionable)\nBetter: 200-300 tokens (comprehensive but focused)\nToo long: &gt;500 tokens (dilutes impact)\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#6-use-section-headings","title":"6. Use Section Headings","text":"<p>Makes scanning fast:</p> <pre><code>## Primary Directive       \u2190 Clear section\nEvidence &gt; assumptions     \u2190 Specific guidance\n\n## Workflow Pattern        \u2190 Next section\n1. Read before write       \u2190 Action items\n2. Test before commit\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#7-test-regularly","title":"7. Test Regularly","text":"<p>After editing: 1. Use <code>/compact</code> to trigger re-injection 2. Verify content appears correct 3. Check hook execution: <code>claude --debug</code></p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#8-commit-to-version-control","title":"8. Commit to Version Control","text":"<p>Share with your team:</p> <pre><code>git add .claude/system-prompt.md\ngit commit -m \"chore: update system prompt with new delegation patterns\"\ngit push\n</code></pre>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#advanced-custom-hook-behavior","title":"Advanced: Custom Hook Behavior","text":"<p>The SessionStart hook is read-only for end users, but you can see the logic:</p> <p>File: <code>.claude/hooks/scripts/session-start.py</code></p> <p>The hook: 1. Loads your <code>.claude/system-prompt.md</code> 2. Validates it's not too large (&lt;500 tokens) 3. Injects as <code>additionalContext</code> via SessionStart response 4. Logs injection details for debugging</p> <p>To customize hook behavior beyond prompt content, see <code>.claude/hooks/README.md</code>.</p>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#next-steps","title":"Next Steps","text":"<ol> <li>Verify installation: Check that prompt appears in your next session</li> <li>Customize your prompt: Edit <code>.claude/system-prompt.md</code> for your project</li> <li>Test persistence: Use <code>/compact</code> to verify prompt survives context reset</li> <li>Commit to git: Share your prompt with team members</li> <li>Monitor effectiveness: Adjust prompt based on how well it guides your work</li> </ol>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#related-documentation","title":"Related Documentation","text":"<ul> <li>AGENTS.md: SDK reference and workflow patterns</li> <li>CLAUDE.md: Project-specific configuration and quick commands</li> <li>ORCHESTRATOR_MODE_GUIDE.md: Complete orchestration patterns</li> <li>SESSION_START_INTEGRATION.md: Technical hook documentation</li> </ul>"},{"location":"SYSTEM_PROMPT_PERSISTENCE_GUIDE/#support","title":"Support","text":"<p>For issues:</p> <ol> <li>Check Troubleshooting section above</li> <li>Verify <code>.claude/system-prompt.md</code> file exists and is readable</li> <li>Run with debug: <code>claude --debug</code></li> <li>Check plugin: <code>claude plugin list | grep htmlgraph</code></li> <li>Review hook logs: <code>.htmlgraph/sessions/</code> and recent session file</li> </ol> <p>For detailed implementation: See <code>.claude/hooks/scripts/session-start.py</code></p>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/","title":"System Prompt Persistence - Quick Reference Card","text":""},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#what-it-does-30-seconds","title":"What It Does (30 seconds)","text":"<p>Your system prompt at <code>.claude/system-prompt.md</code> is automatically injected into every Claude Code session via the SessionStart hook. It survives compacts, resumes, and context clears.</p>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#installation-1-minute","title":"Installation (1 minute)","text":"<pre><code># 1. Verify HtmlGraph plugin\nclaude plugin list | grep htmlgraph\n\n# 2. Start a session (auto-creates .claude/system-prompt.md)\ncd your-project\n\n# 3. System prompt auto-created, ready to customize\nls -la .claude/system-prompt.md\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#customize-your-prompt-5-minutes","title":"Customize Your Prompt (5 minutes)","text":"<p>Edit <code>.claude/system-prompt.md</code>:</p> <pre><code># Your System Prompt\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation\n\n## Workflow Pattern\n- Use Task() for complex work\n- Execute directly for simple tasks\n- Haiku for delegation\n\n## Model Guidance\n- Haiku: Quick tasks, delegation\n- Sonnet: Complex reasoning\n- Opus: Novel problems\n\n## Key Rules\n1. Always Read before Write\n2. Use absolute paths\n3. Batch tool calls\n4. Fix errors before committing\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#verify-it-works-2-minutes","title":"Verify It Works (2 minutes)","text":"<pre><code># Check prompt injected at session start\n# (You should see your content in context)\n\n# Use /compact to test persistence\n# (Prompt should re-appear after context reset)\n\n# Debug if needed\nclaude --debug\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#model-selection-quick","title":"Model Selection (Quick)","text":"Task Model Why Bug fix, refactor, quick task Haiku Fast, cheap, follows patterns Complex logic, architecture Sonnet Good reasoning, balanced cost Novel problem, research Opus Best reasoning, thorough <p>Decision Tree: <pre><code>Straightforward task?\n\u251c\u2500 YES \u2192 Use Haiku\n\u2514\u2500 NO \u2192 Need complex reasoning?\n   \u251c\u2500 YES \u2192 Use Sonnet\n   \u2514\u2500 NO \u2192 Novel/research?\n      \u251c\u2500 YES \u2192 Use Opus\n      \u2514\u2500 NO \u2192 Use Sonnet\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#common-configurations","title":"Common Configurations","text":""},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#htmlgraph-development","title":"HtmlGraph Development","text":"<pre><code># System Prompt - HtmlGraph Development\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation | Efficiency &gt; verbosity\n\n## Orchestration Pattern\n- Use Task() for multi-session work, deep research, or complex reasoning\n- Execute directly only for straightforward file operations\n- Haiku: Default orchestrator\u2014excellent at following delegation instructions\n- Sonnet/Opus: For deep reasoning, but tends to over-execute; use Task() when uncertain\n\n## Model Guidance\n- Haiku (Recommended): Orchestration, delegation, quick tasks\n- Sonnet: Complex reasoning, architecture decisions\n- Opus: Novel problems, research-heavy investigations\n\n## Key Rules\n1. Always Read before Write/Edit/Update\n2. Use absolute paths only\n3. Use `uv run` for all Python execution\n4. Batch tool calls when independent\n5. Fix all errors before committing\n6. Research first, then implement\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#general-development","title":"General Development","text":"<pre><code># System Prompt - General Development\n\n## Primary Directive\nWrite reliable, maintainable code with comprehensive testing.\n\n## Workflow\n1. Read existing code before changes\n2. Plan before implementation\n3. Write tests before code\n4. Run tests before committing\n\n## Model Selection\n- Haiku: Quick fixes, refactoring, simple features\n- Sonnet: Architecture, complex logic, research\n- Opus: Novel problems, major decisions\n\n## Key Rules\n1. Always test before committing\n2. No console.logs or debug code in commits\n3. Use meaningful variable names\n4. Document complex logic\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#research-focused","title":"Research-Focused","text":"<pre><code># System Prompt - Research\n\n## Primary Directive\nThorough investigation before implementation.\n\n## Research Workflow\n1. Define research questions clearly\n2. Explore multiple sources\n3. Analyze findings systematically\n4. Document decision rationale\n\n## Model Selection\n- Haiku: Quick literature searches\n- Sonnet: Comparative analysis\n- Opus: Deep investigation of novel topics\n\n## Key Rules\n1. Always cite sources\n2. Document assumptions\n3. Consider multiple perspectives\n4. Test hypotheses before committing\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#troubleshooting","title":"Troubleshooting","text":"Problem Solution Prompt not appearing Check file exists: <code>ls .claude/system-prompt.md</code> Prompt not persisting after compact Use <code>/compact</code> again (may take 2 cycles) Hook not executing Verify plugin: <code>claude plugin list \\| grep htmlgraph</code> File not readable Fix permissions: <code>chmod 644 .claude/system-prompt.md</code> Prompt has old content Restart session or use <code>/clear</code> Hook timeout Reduce prompt size (aim for &lt;500 words)"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#file-locations","title":"File Locations","text":"<pre><code>your-project/\n\u251c\u2500\u2500 .claude/\n\u2502   \u251c\u2500\u2500 system-prompt.md          \u2190 Edit this!\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u2514\u2500\u2500 scripts/\n\u2502   \u2502       \u2514\u2500\u2500 session-start.py  \u2190 Read-only\n\u2502   \u2514\u2500\u2500 settings.json\n\u2514\u2500\u2500 .htmlgraph/\n    \u2514\u2500\u2500 sessions/\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#integration-points","title":"Integration Points","text":""},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#with-htmlgraph-sdk","title":"With HtmlGraph SDK","text":"<pre><code>from htmlgraph import SDK\n\n# Your system prompt guides this\nsdk = SDK(agent=\"claude\")\n\n# Feature tracking\nfeature = sdk.features.create(\"Task Name\").save()\n\n# Session tracking (automatic)\n# Your prompt is re-injected after compact\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#with-orchestrator-mode","title":"With Orchestrator Mode","text":"<pre><code># Your system prompt includes orchestrator guidance\nTask(\n    prompt=\"Your delegation task...\",\n    subagent_type=\"general-purpose\"\n)\n# Subagent receives injected system prompt too\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#with-session-tracking","title":"With Session Tracking","text":"<pre><code># Check sessions (your prompt was injected)\nuv run htmlgraph session list\n\n# View session details\nuv run htmlgraph session show &lt;session-id&gt;\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#performance","title":"Performance","text":"<ul> <li>Injection latency: &lt;50ms (negligible)</li> <li>Token cost: 100-300 tokens (depends on prompt size)</li> <li>Context overhead: &lt;2% (minimal)</li> <li>Reliability: High (uses built-in hook mechanism)</li> </ul>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#advanced-update-your-prompt-effectively","title":"Advanced: Update Your Prompt Effectively","text":"<p>After editing <code>.claude/system-prompt.md</code>:</p> <ol> <li> <p>Option A - Full restart (clean slate)    <pre><code># Quit Claude Code, start new session\n# Prompt injected fresh\n</code></pre></p> </li> <li> <p>Option B - Use /compact (faster)    <pre><code>/compact\n# Context clears, prompt re-injected\n# Continues in same session\n</code></pre></p> </li> <li> <p>Option C - Use /clear (simple)    <pre><code>/clear\n# Context cleared, prompt re-appears\n</code></pre></p> </li> </ol>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#related-docs","title":"Related Docs","text":"<ul> <li>SYSTEM_PROMPT_PERSISTENCE_GUIDE.md: Full installation and configuration guide</li> <li>MODEL_SELECTION_GUIDE.md: Detailed model selection framework</li> <li>delegate.sh: Helper script for model decisions</li> <li>ORCHESTRATOR_MODE_GUIDE.md: Delegation and orchestration patterns</li> </ul>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#checklist-system-prompt-setup","title":"Checklist: System Prompt Setup","text":"<ul> <li> HtmlGraph plugin installed (<code>claude plugin list</code>)</li> <li> <code>.claude/system-prompt.md</code> exists (<code>ls .claude/system-prompt.md</code>)</li> <li> Custom prompt added (edited file)</li> <li> Verified in session context (appears at session start)</li> <li> Tested persistence (<code>/compact</code> command)</li> <li> Committed to git (<code>git add .claude/system-prompt.md</code>)</li> <li> Team knows about it (document in README if team project)</li> </ul>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#one-liners","title":"One-Liners","text":"<pre><code># Check if custom prompt exists\ntest -f .claude/system-prompt.md &amp;&amp; echo \"\u2705 Custom prompt found\" || echo \"\u274c Not found\"\n\n# Check file size (should be &lt;500 words)\nwc -w .claude/system-prompt.md\n\n# Count token estimate (rough: 1 word \u2248 1.3 tokens)\npython3 -c \"with open('.claude/system-prompt.md') as f: words = len(f.read().split()); tokens = int(words * 1.3); print(f'{words} words \u2248 {tokens} tokens')\"\n\n# Verify hook is registered\nclaude /hooks | grep -i sessionstart\n\n# Show your current prompt\ncat .claude/system-prompt.md\n\n# Edit your prompt\nvim .claude/system-prompt.md  # or your editor\n</code></pre>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#tips-tricks","title":"Tips &amp; Tricks","text":"<p>1. Keep a backup <pre><code>cp .claude/system-prompt.md .claude/system-prompt.md.backup\n</code></pre></p> <p>2. Version control your prompt <pre><code>git add .claude/system-prompt.md\ngit commit -m \"chore: update system prompt with new model guidance\"\ngit push\n</code></pre></p> <p>3. Team prompts <pre><code># Create per-team prompts\n.claude/system-prompt.md          # General\n.claude/system-prompt-frontend.md # Frontend team\n.claude/system-prompt-backend.md  # Backend team\n# (Note: currently supports one system-prompt.md per project)\n</code></pre></p> <p>4. Compare prompts <pre><code># See what changed between sessions\ngit log -p .claude/system-prompt.md\n\n# Diff against backup\ndiff .claude/system-prompt.md .claude/system-prompt.md.backup\n</code></pre></p> <p>5. Test prompt effectiveness <pre><code># Track which model you used most\n# (System logs this automatically in .htmlgraph/sessions/)\n\n# Review past sessions\nuv run htmlgraph session list\n\n# Check session details for model info\nuv run htmlgraph session show &lt;session-id&gt;\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_QUICK_REFERENCE/#summary","title":"Summary","text":"What Where When Edit prompt <code>.claude/system-prompt.md</code> Anytime Takes effect Next session start Auto Survives Compacts, resumes, /clear Auto Verify Show in context, use /compact Always Share git commit <code>.claude/system-prompt.md</code> Anytime Debug <code>claude --debug</code> If issues <p>Remember: Keep your system prompt focused, specific, and up-to-date. It guides your work throughout the session and should evolve as your needs change.</p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/","title":"Troubleshooting Guide: System Prompt &amp; Delegation Issues","text":"<p>Comprehensive troubleshooting guide for system prompt persistence and delegation enforcement issues, with diagnostic workflows and solutions.</p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Common Issues</li> <li>Diagnostic Workflow</li> <li>Debug Commands</li> <li>Escalation Path</li> </ul>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#common-issues","title":"Common Issues","text":""},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#issue-1-system-prompt-not-appearing-in-context","title":"Issue 1: System Prompt Not Appearing in Context","text":"<p>Symptoms: - System prompt missing from context at session start - You don't see your custom guidance in the conversation - /compact removes prompt and it doesn't return</p> <p>Root Causes: 1. File doesn't exist or is empty 2. Hook not running (plugin not installed) 3. File has syntax errors or exceeds token limit 4. Permission denied reading file 5. .claude directory not found</p> <p>Diagnosis Steps:</p> <pre><code># Step 1: Verify file exists and has content\nls -lh .claude/system-prompt.md\n# Expected: File exists, size &gt;100 bytes\n\n# If file doesn't exist\nif [ ! -f .claude/system-prompt.md ]; then\n    echo \"ERROR: File doesn't exist\"\n    # Jump to Solution 1\nfi\n\n# Step 2: Check file content\nwc -l .claude/system-prompt.md\n# Expected: &gt;5 lines\n\ncat .claude/system-prompt.md | head -20\n# Expected: Starts with markdown heading, readable content\n\n# Step 3: Check for syntax errors\npython3 -c \"\nimport markdown\nwith open('.claude/system-prompt.md') as f:\n    text = f.read()\n    try:\n        markdown.markdown(text)\n        print('\u2713 Markdown syntax valid')\n    except Exception as e:\n        print(f'\u2717 Markdown error: {e}')\n\"\n\n# Step 4: Check file permissions\nstat .claude/system-prompt.md\n# Expected: Readable by current user\n\n# Step 5: Check token count\npython3 -c \"\nwith open('.claude/system-prompt.md') as f:\n    text = f.read()\n    tokens = len(text) // 4  # Rough estimate\n    print(f'Approximate tokens: {tokens}')\n    if tokens &gt; 1000:\n        print('\u26a0\ufe0f  WARNING: Exceeds typical budget')\n\"\n\n# Step 6: Check hook is running\nclaude --debug\n# Look for \"system-prompt\" or \"session-start\" in output\n# Expected: Hook should be listed as active\n</code></pre> <p>Solutions:</p> <p>Solution 1: File doesn't exist <pre><code># Create the file\nmkdir -p .claude\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - My Project\n\n## Model Selection\n- **Haiku**: Quick tasks, file operations\n- **Sonnet**: Complex reasoning\n- **Opus**: Novel problems\n\n## Delegation Pattern\nUse Task() for work &gt;30 minutes\nEOF\n\n# Start new session - hook should now inject it\n</code></pre></p> <p>Solution 2: File exists but hook not running <pre><code># Check if plugin is installed\nclaude plugin list | grep htmlgraph\n# If not shown: Plugin missing\n\n# Install plugin\nclaude plugin install htmlgraph@latest\n\n# Verify installation\nclaude plugin list | grep htmlgraph\n# Expected: htmlgraph with version number\n\n# Start new session after installation\n</code></pre></p> <p>Solution 3: File has syntax errors <pre><code># Fix markdown syntax\n# Common issues:\n# - Missing heading markers (#)\n# - Unclosed code blocks (```)\n# - Invalid indentation\n\n# Example fix:\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - My Project\n\nThis is valid markdown.\n\n## Section 1\nContent here.\n\n### Subsection\nMore content.\nEOF\n\n# Verify syntax\npython3 -m markdown .claude/system-prompt.md &gt; /dev/null &amp;&amp; echo \"\u2713 Valid\"\n</code></pre></p> <p>Solution 4: File too large (exceeds token budget) <pre><code># Option 1: Truncate to essential content only\n# Remove examples, verbose sections\n# Keep: Model guidance, key rules, delegation patterns\n\n# Option 2: Move details to README or CLAUDE.md\n# System prompt: Core guidance only\n# README.md: Detailed architecture\n# CLAUDE.md: Project-specific notes\n\n# Verify size\npython3 -c \"\nwith open('.claude/system-prompt.md') as f:\n    tokens = len(f.read()) // 4\n    print(f'Current: {tokens} tokens')\n    print(f'Budget: 1000 tokens')\n    print(f'Need to remove: {max(0, tokens - 1000)} tokens')\n\"\n</code></pre></p> <p>Solution 5: Permission denied <pre><code># Fix permissions\nchmod 644 .claude/system-prompt.md\n\n# Verify\nls -l .claude/system-prompt.md\n# Expected: -rw-r--r-- (readable by all)\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#issue-2-delegation-not-enforced-post-compact","title":"Issue 2: Delegation Not Enforced Post-Compact","text":"<p>Symptoms: - System prompt disappears after <code>/compact</code> - Delegation patterns abandoned post-compact - Orchestrator Skill not available after compact - Environment variables don't persist</p> <p>Root Causes: 1. SessionStart hook not re-running post-compact 2. Environment variables not persisting 3. File deleted between sessions 4. Backup system failed</p> <p>Diagnosis Steps:</p> <pre><code># Step 1: Before compact, check environment\necho \"=== BEFORE COMPACT ===\"\necho \"CLAUDE_DELEGATION_ENABLED=$CLAUDE_DELEGATION_ENABLED\"\necho \"CLAUDE_ORCHESTRATOR_ACTIVE=$CLAUDE_ORCHESTRATOR_ACTIVE\"\necho \"CLAUDE_SESSION_ID=$CLAUDE_SESSION_ID\"\n\n# Step 2: Use /compact command\n# (In Claude Code conversation)\n\n# Step 3: After compact, check environment\necho \"=== AFTER COMPACT ===\"\necho \"CLAUDE_DELEGATION_ENABLED=$CLAUDE_DELEGATION_ENABLED\"\necho \"CLAUDE_ORCHESTRATOR_ACTIVE=$CLAUDE_ORCHESTRATOR_ACTIVE\"\necho \"CLAUDE_SESSION_ID=$CLAUDE_SESSION_ID\"\n\n# If different: Environment not persisting\n# If same: Environment persisted but hook didn't re-inject\n\n# Step 4: Check if file still exists\nls -lh .claude/system-prompt.md\n# Expected: File should still exist post-compact\n\n# Step 5: Check hook execution post-compact\nclaude --debug\n# Look for system-prompt injection attempt\n# Expected: Hook runs even post-compact\n</code></pre> <p>Solutions:</p> <p>Solution 1: Hook not re-running post-compact <pre><code># Verify hook is installed\nls -lh .claude/hooks/scripts/session-start.py\n# Expected: File exists and is executable\nchmod +x .claude/hooks/scripts/session-start.py\n\n# Check hook content\ngrep -l \"system.prompt\" .claude/hooks/scripts/session-start.py\n# Expected: File contains system-prompt logic\n\n# Reinstall hook if needed\nrm .claude/hooks/scripts/session-start.py\n# Plugin will recreate on next session start\n\n# Start new session to verify hook runs\n</code></pre></p> <p>Solution 2: Environment not persisting <pre><code># Ensure variables are exported (not just set)\nexport CLAUDE_DELEGATION_ENABLED=true\nexport CLAUDE_ORCHESTRATOR_ACTIVE=true\n\n# Verify they're in environment\nset | grep CLAUDE_DELEGATION\n# Expected: CLAUDE_DELEGATION_ENABLED=true\n\n# If variables clear after /compact:\n# - Use file-based recovery (Layer 3)\n# - Check backup exists: .htmlgraph/.system-prompt-backup.md\nls -lh .htmlgraph/.system-prompt-backup.md\n</code></pre></p> <p>Solution 3: File deleted between sessions <pre><code># Restore from git\ngit checkout .claude/system-prompt.md\n\n# Or restore from backup\ncp .htmlgraph/.system-prompt-backup.md .claude/system-prompt.md\n\n# Or recreate from scratch\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n[Your system prompt content]\nEOF\n\n# Start new session\n</code></pre></p> <p>Solution 4: Backup system failed <pre><code># Check backup location\nls -lh .htmlgraph/.system-prompt-backup.md\n# If missing: Backup wasn't created\n\n# Manual backup creation\nmkdir -p .htmlgraph\ncp .claude/system-prompt.md .htmlgraph/.system-prompt-backup.md\n\n# Start new session to verify it's used\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#issue-3-orchestrator-skill-not-activating","title":"Issue 3: Orchestrator Skill Not Activating","text":"<p>Symptoms: - <code>/orchestrator-directives</code> command fails - Skill doesn't appear as available - Cost-first delegation framework not mentioned - Spawner routing not working</p> <p>Root Causes: 1. Plugin not installed 2. Environment variable not set (<code>CLAUDE_ORCHESTRATOR_ACTIVE</code>) 3. Skill not found or disabled 4. Plugin needs update</p> <p>Diagnosis Steps:</p> <pre><code># Step 1: Check plugin installed\nclaude plugin list | grep htmlgraph\n# Expected: htmlgraph listed with version\n\n# Step 2: Check environment variable\necho $CLAUDE_ORCHESTRATOR_ACTIVE\n# Expected: true\n\n# Step 3: Try to invoke skill\n/orchestrator-directives\n# If fails: Skill not available or not loaded\n\n# Step 4: Check Claude Code version\nclaude --version\n# Expected: Latest version\n\n# Step 5: Check if plugin needs update\nclaude plugin info htmlgraph\n# Look for \"Update available\" message\n</code></pre> <p>Solutions:</p> <p>Solution 1: Plugin not installed <pre><code># Install plugin\nclaude plugin install htmlgraph@latest\n\n# Verify installation\nclaude plugin list | grep htmlgraph\n# Expected: htmlgraph shown\n\n# Start new session for plugin to activate\n</code></pre></p> <p>Solution 2: Environment variable not set <pre><code># Check if SessionStart hook is running\n# (Hook should set this variable)\n\n# Manual set as fallback\nexport CLAUDE_ORCHESTRATOR_ACTIVE=true\n\n# Verify it's set\necho $CLAUDE_ORCHESTRATOR_ACTIVE\n# Expected: true\n\n# Start new session\n</code></pre></p> <p>Solution 3: Plugin needs update <pre><code># Check for updates\nclaude plugin update htmlgraph\n\n# Or reinstall\nclaude plugin uninstall htmlgraph\nclaude plugin install htmlgraph@latest\n\n# Verify new version\nclaude plugin info htmlgraph | grep version\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#issue-4-agent-attribution-missing","title":"Issue 4: Agent Attribution Missing","text":"<p>Symptoms: - Spikes created without <code>agent_assigned</code> field - Can't track which agent did work - Audit trail incomplete - HtmlGraph dashboard shows \"Unknown agent\"</p> <p>Root Causes: 1. SDK() called without <code>agent=</code> parameter 2. Agent attribution not passed to Task() 3. Subagent work not linked to parent</p> <p>Diagnosis Steps:</p> <pre><code># Step 1: Check SDK initialization\npython3 &lt;&lt; 'EOF'\nfrom htmlgraph import SDK\n\n# This is WRONG - no agent parameter\nsdk = SDK()\nspike = sdk.spikes.create(\"Task\")\n\n# Check agent field\nprint(f\"Agent assigned: {spike.metadata.get('agent_assigned', 'MISSING')}\")\nEOF\n\n# Step 2: Check Task() calls\n# Look for: Task(prompt=..., subagent_type=...)\n# Missing: agent parameter\n\n# Step 3: Check spike in HtmlGraph\nls -lh .htmlgraph/spikes/\ncat .htmlgraph/spikes/*.html | grep -i \"agent_assigned\"\n</code></pre> <p>Solutions:</p> <p>Solution 1: Add agent parameter to SDK <pre><code># BEFORE (missing agent)\nfrom htmlgraph import SDK\nsdk = SDK()\nspike = sdk.spikes.create(\"Task\")\n\n# AFTER (with agent)\nfrom htmlgraph import SDK\nsdk = SDK(agent=\"claude\")  # Add agent name\nspike = sdk.spikes.create(\"Task\")\n\n# For specific team members\nsdk = SDK(agent=\"alice\")\nsdk = SDK(agent=\"bot-name\")\n</code></pre></p> <p>Solution 2: Add agent to Task() calls <pre><code># BEFORE\nTask(prompt=\"Do something\", subagent_type=\"codex\")\n\n# AFTER\nTask(\n    prompt=\"Do something\",\n    subagent_type=\"codex\",\n    agent=\"claude\"  # Or agent from environment\n)\n</code></pre></p> <p>Solution 3: Link subagent to parent <pre><code>from htmlgraph import SDK\nimport os\n\n# Parent session\nparent_sdk = SDK(agent=\"orchestrator\")\n\n# Child session (subagent)\nchild_sdk = SDK(agent=\"claude\")\nchild_sdk.set_parent_session(\n    parent_session_id=os.getenv('CLAUDE_SESSION_ID')\n)\n\n# Now work in child is linked to parent\nspike = child_sdk.spikes.create(\"Subagent work\")\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#issue-5-post-compact-detection-failing","title":"Issue 5: Post-Compact Detection Failing","text":"<p>Symptoms: - <code>is_post_compact</code> always returns false - State not restored after compact - Sessions not linked across compact boundary - Duplicate session creation</p> <p>Root Causes: 1. Session ID not changing between sessions 2. State file missing or corrupted 3. SessionStart hook not updating state 4. Session comparison logic broken</p> <p>Diagnosis Steps:</p> <pre><code># Step 1: Check session ID changes\necho \"Session 1 ID:\"\necho $CLAUDE_SESSION_ID\n\n# Use /compact\n\necho \"Session 2 ID:\"\necho $CLAUDE_SESSION_ID\n\n# They should be DIFFERENT if post-compact detected correctly\n\n# Step 2: Check state file\nls -lh .htmlgraph/.session-state.json\n# Expected: File exists and updated recently\n\ncat .htmlgraph/.session-state.json\n# Expected: Contains session IDs\n\n# Step 3: Check is_post_compact detection\npython3 &lt;&lt; 'EOF'\nfrom htmlgraph.session import SessionStateManager\n\nmanager = SessionStateManager()\nis_post = manager.is_post_compact()\nprint(f\"Is post-compact: {is_post}\")\n\n# Debug: Check current vs last session ID\ncurrent = manager._get_current_session_id()\nlast = manager._load_last_session_id()\nprint(f\"Current session ID: {current}\")\nprint(f\"Last session ID: {last}\")\nprint(f\"Different: {current != last}\")\nEOF\n</code></pre> <p>Solutions:</p> <p>Solution 1: Session ID not changing <pre><code># Check that SessionStart hook is setting new session ID\n# Verify environment variable changes post-compact\n\n# Manual check:\necho \"Before:\" &amp;&amp; echo $CLAUDE_SESSION_ID\n# Use /compact\necho \"After:\" &amp;&amp; echo $CLAUDE_SESSION_ID\n# Should be different\n\n# If same: Hook not creating new ID\n# Fix: Reinstall hook or update plugin\n</code></pre></p> <p>Solution 2: State file missing <pre><code># Create state directory\nmkdir -p .htmlgraph\n\n# Let hook create state file\n# On next session start, hook should create .htmlgraph/.session-state.json\n\n# Verify creation\nls -lh .htmlgraph/.session-state.json\n# Expected: File should exist\n</code></pre></p> <p>Solution 3: State file corrupted <pre><code># Check state file validity\npython3 -c \"\nimport json\nwith open('.htmlgraph/.session-state.json') as f:\n    try:\n        data = json.load(f)\n        print('\u2713 State file valid')\n        print(f'Last session ID: {data.get(\\\"last_session_id\\\")}')\n    except json.JSONDecodeError as e:\n        print(f'\u2717 State file corrupted: {e}')\n\"\n\n# If corrupted, delete and let hook recreate\nrm .htmlgraph/.session-state.json\n# Start new session - hook will recreate\n</code></pre></p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#diagnostic-workflow","title":"Diagnostic Workflow","text":""},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#quick-diagnostic-2-minutes","title":"Quick Diagnostic (2 minutes)","text":"<pre><code>#!/bin/bash\n# Quick system prompt diagnostic\n\necho \"=== SYSTEM PROMPT DIAGNOSTIC ===\"\n\n# 1. File check\necho -n \"1. System prompt file: \"\nif [ -f .claude/system-prompt.md ]; then\n    echo \"\u2713 EXISTS\"\nelse\n    echo \"\u2717 MISSING\"\nfi\n\n# 2. Plugin check\necho -n \"2. HtmlGraph plugin: \"\nif claude plugin list 2&gt;/dev/null | grep -q htmlgraph; then\n    echo \"\u2713 INSTALLED\"\nelse\n    echo \"\u2717 NOT INSTALLED\"\nfi\n\n# 3. Environment variables\necho -n \"3. Delegation enabled: \"\n[ \"$CLAUDE_DELEGATION_ENABLED\" = \"true\" ] &amp;&amp; echo \"\u2713 YES\" || echo \"\u2717 NO\"\n\necho -n \"4. Orchestrator active: \"\n[ \"$CLAUDE_ORCHESTRATOR_ACTIVE\" = \"true\" ] &amp;&amp; echo \"\u2713 YES\" || echo \"\u2717 NO\"\n\n# 4. Hook status\necho -n \"5. SessionStart hook: \"\nif [ -x .claude/hooks/scripts/session-start.py ]; then\n    echo \"\u2713 INSTALLED\"\nelse\n    echo \"\u2717 MISSING OR NOT EXECUTABLE\"\nfi\n\necho \"=== END DIAGNOSTIC ===\"\n</code></pre> <p>Run this before troubleshooting to identify problem area.</p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#complete-diagnostic-10-minutes","title":"Complete Diagnostic (10 minutes)","text":"<pre><code>#!/bin/bash\n# Complete system prompt diagnostic\n\nmkdir -p /tmp/htmlgraph-diag\n\necho \"=== COMPLETE DIAGNOSTIC REPORT ===\" | tee /tmp/htmlgraph-diag/report.txt\n\n# Environment\necho \"\" | tee -a /tmp/htmlgraph-diag/report.txt\necho \"ENVIRONMENT VARIABLES:\" | tee -a /tmp/htmlgraph-diag/report.txt\nenv | grep CLAUDE_ | tee -a /tmp/htmlgraph-diag/report.txt\n\n# File system\necho \"\" | tee -a /tmp/htmlgraph-diag/report.txt\necho \"FILE SYSTEM:\" | tee -a /tmp/htmlgraph-diag/report.txt\nls -lh .claude/ 2&gt;/dev/null | tee -a /tmp/htmlgraph-diag/report.txt\nls -lh .htmlgraph/ 2&gt;/dev/null | tee -a /tmp/htmlgraph-diag/report.txt\n\n# Plugin info\necho \"\" | tee -a /tmp/htmlgraph-diag/report.txt\necho \"PLUGIN STATUS:\" | tee -a /tmp/htmlgraph-diag/report.txt\nclaude plugin list 2&gt;/dev/null | tee -a /tmp/htmlgraph-diag/report.txt\nclaude plugin info htmlgraph 2&gt;/dev/null | tee -a /tmp/htmlgraph-diag/report.txt\n\n# System prompt content\necho \"\" | tee -a /tmp/htmlgraph-diag/report.txt\necho \"SYSTEM PROMPT CONTENT (first 50 lines):\" | tee -a /tmp/htmlgraph-diag/report.txt\nhead -50 .claude/system-prompt.md 2&gt;/dev/null | tee -a /tmp/htmlgraph-diag/report.txt\n\n# Python diagnostics\necho \"\" | tee -a /tmp/htmlgraph-diag/report.txt\necho \"PYTHON DIAGNOSTICS:\" | tee -a /tmp/htmlgraph-diag/report.txt\npython3 &lt;&lt; 'PYEOF' | tee -a /tmp/htmlgraph-diag/report.txt\nimport os\nimport json\nfrom pathlib import Path\n\n# System prompt\nsp_file = Path('.claude/system-prompt.md')\nif sp_file.exists():\n    content = sp_file.read_text()\n    tokens = len(content) // 4\n    print(f\"System prompt: {len(content)} chars, ~{tokens} tokens\")\nelse:\n    print(\"System prompt: NOT FOUND\")\n\n# Environment variables\nprint(f\"Delegation enabled: {os.getenv('CLAUDE_DELEGATION_ENABLED')}\")\nprint(f\"Orchestrator active: {os.getenv('CLAUDE_ORCHESTRATOR_ACTIVE')}\")\nprint(f\"Session ID: {os.getenv('CLAUDE_SESSION_ID')}\")\n\n# Session state\nstate_file = Path('.htmlgraph/.session-state.json')\nif state_file.exists():\n    try:\n        state = json.loads(state_file.read_text())\n        print(f\"Session state: VALID\")\n    except:\n        print(f\"Session state: CORRUPTED\")\nelse:\n    print(f\"Session state: NOT FOUND\")\n\n# Backup\nbackup_file = Path('.htmlgraph/.system-prompt-backup.md')\nprint(f\"Backup exists: {backup_file.exists()}\")\n\nPYEOF\n\necho \"\" | tee -a /tmp/htmlgraph-diag/report.txt\necho \"Report saved to: /tmp/htmlgraph-diag/report.txt\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#debug-commands","title":"Debug Commands","text":""},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#check-system-prompt-status","title":"Check System Prompt Status","text":"<pre><code># Quick check\necho \"System prompt status:\"\necho \"- File exists: $([ -f .claude/system-prompt.md ] &amp;&amp; echo YES || echo NO)\"\necho \"- File size: $(wc -c &lt; .claude/system-prompt.md 2&gt;/dev/null || echo 0) bytes\"\necho \"- In environment: $([ -n \"$CLAUDE_SYSTEM_PROMPT\" ] &amp;&amp; echo YES || echo NO)\"\necho \"- Backup exists: $([ -f .htmlgraph/.system-prompt-backup.md ] &amp;&amp; echo YES || echo NO)\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#check-hook-status","title":"Check Hook Status","text":"<pre><code># Verify hook is installed\necho \"SessionStart hook status:\"\necho \"- Installed: $([ -f .claude/hooks/scripts/session-start.py ] &amp;&amp; echo YES || echo NO)\"\necho \"- Executable: $([ -x .claude/hooks/scripts/session-start.py ] &amp;&amp; echo YES || echo NO)\"\necho \"- Size: $(wc -c &lt; .claude/hooks/scripts/session-start.py 2&gt;/dev/null || echo 0) bytes\"\n\n# Check hook contains system prompt logic\ngrep -c \"system.prompt\\|CLAUDE_DELEGATION\" \\\n  .claude/hooks/scripts/session-start.py 2&gt;/dev/null &amp;&amp; echo \"- Contains logic: YES\" || echo \"- Contains logic: NO\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#check-delegation-status","title":"Check Delegation Status","text":"<pre><code># Verify delegation is enabled\necho \"Delegation enforcement status:\"\necho \"- Enabled: $([ \"$CLAUDE_DELEGATION_ENABLED\" = \"true\" ] &amp;&amp; echo YES || echo NO)\"\necho \"- Orchestrator active: $([ \"$CLAUDE_ORCHESTRATOR_ACTIVE\" = \"true\" ] &amp;&amp; echo YES || echo NO)\"\necho \"- Session ID: $CLAUDE_SESSION_ID\"\necho \"- Is post-compact: $([ \"$CLAUDE_IS_POST_COMPACT\" = \"true\" ] &amp;&amp; echo YES || echo NO)\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#verify-hook-execution","title":"Verify Hook Execution","text":"<pre><code># Run hook manually (for testing)\npython3 .claude/hooks/scripts/session-start.py\n\n# Check for errors\necho \"Hook exit code: $?\"\n\n# Check environment after hook\necho \"CLAUDE_DELEGATION_ENABLED=$CLAUDE_DELEGATION_ENABLED\"\necho \"CLAUDE_SYSTEM_PROMPT=${CLAUDE_SYSTEM_PROMPT:0:50}...\"\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#escalation-path","title":"Escalation Path","text":""},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#when-to-file-an-issue","title":"When to File an Issue","text":"<p>File an issue if: 1. All diagnostic steps complete 2. All solutions attempted without success 3. Problem is reproducible consistently 4. Affecting team productivity</p>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#what-information-to-include","title":"What Information to Include","text":"<p>When filing an issue, include:</p> <pre><code>1. ENVIRONMENT\n   - Claude Code version: `claude --version`\n   - HtmlGraph plugin version: `claude plugin info htmlgraph`\n   - Operating system: macOS/Linux/Windows\n   - Shell: bash/zsh/other\n\n2. PROBLEM DESCRIPTION\n   - What's happening\n   - What you expected to happen\n   - When it started\n\n3. REPRODUCTION STEPS\n   - Step-by-step to reproduce\n   - Minimal example\n   - Exact commands run\n\n4. DIAGNOSTIC OUTPUT\n   - Output from diagnostic script above\n   - Relevant log files\n   - System prompt content (sanitized if needed)\n\n5. SOLUTIONS ATTEMPTED\n   - Which solutions you tried\n   - Results of each attempt\n   - Errors encountered\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#example-issue-template","title":"Example Issue Template","text":"<pre><code>## Title\nSystem prompt not persisting post-compact on macOS\n\n## Environment\n- Claude Code: 0.45.0\n- HtmlGraph plugin: 0.9.4\n- OS: macOS 14.2\n- Shell: zsh\n\n## Problem\nAfter using `/compact`, my system prompt disappears and doesn't reappear in the new session.\n\n## Steps to Reproduce\n1. Create .claude/system-prompt.md with content\n2. Start Claude Code session\n3. Verify system prompt appears in context\n4. Run `/compact` command\n5. System prompt is gone\n\n## Diagnostic Output\n[Paste complete diagnostic report]\n\n## Solutions Attempted\n1. \u2717 Verified file exists\n2. \u2713 File permissions correct\n3. \u2717 Hook not running post-compact\n\n## Expected Behavior\nSystem prompt should persist and reappear in new session after compact.\n</code></pre>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#support-resources","title":"Support Resources","text":"<ul> <li>GitHub Issues: https://github.com/Shakes-tzd/htmlgraph/issues</li> <li>Documentation: System Prompt Architecture</li> <li>Customization: System Prompt Customization Guide</li> <li>Admin Setup: Delegation Enforcement Guide</li> </ul>"},{"location":"SYSTEM_PROMPT_TROUBLESHOOTING/#quick-reference-table","title":"Quick Reference Table","text":"Problem Check Solution Prompt missing from context File exists + hook running Create file, install plugin Post-compact not persisting Env vars set + backup exists Restore from backup Skill not activating Plugin installed + env var set Install/update plugin Agent attribution missing SDK(agent=...) used Add agent parameter Session not linking Session IDs change Check state file <p>For detailed technical information, see System Prompt Architecture.</p> <p>For setup and configuration, see System Prompt Customization Guide and Delegation Enforcement Guide.</p>"},{"location":"TASK_PROMPT_TEMPLATE/","title":"Standardized Task() Prompt Template with SDK Logging","text":""},{"location":"TASK_PROMPT_TEMPLATE/#purpose","title":"Purpose","text":"<p>This template ensures that all delegated tasks via <code>Task()</code> properly log their findings back to the parent event, enabling complete parent-child event tracing.</p> <p>When you use this template: 1. Task() creates a parent event in the orchestrator context 2. Subagent executes the delegated work 3. Subagent uses SDK to create spike(s) with findings 4. SubagentStop hook updates parent event with completion status and spike count 5. Dashboard shows complete parent-child event trace</p>"},{"location":"TASK_PROMPT_TEMPLATE/#basic-template","title":"Basic Template","text":"<p>Use this template for all <code>Task()</code> delegations:</p> <p><pre><code>Task(\n    prompt=\"\"\"\n[Your implementation instructions here]\n\n\ud83d\udd34 CRITICAL - Report Activity to HtmlGraph:\n\nAt the end of your work, capture findings with this SDK code:\n\n```python\nfrom htmlgraph import SDK\nimport os\n\n# Initialize SDK with your agent type\nsdk = SDK(agent=\"&lt;AGENT_TYPE&gt;\")\n\n# Get parent event reference if available\nparent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\n# Create spike with your findings\nspike = sdk.spikes.create(\"&lt;SPIKE_TITLE&gt;\") \\\\\n    .set_findings(f'''\n## Your Findings Title\n\n[Your detailed findings and analysis here]\n\n## Summary\n- Key finding 1\n- Key finding 2\n- Key finding 3\n\n## References\n- Source 1\n- Source 2\n''') \\\\\n    .save()\n\n# Log completion\nprint(f\"\u2705 Task complete\")\nprint(f\"\ud83d\udcca Findings: {spike.id}\")\nif parent_event_id:\n    print(f\"\ud83d\udc64 Parent event: {parent_event_id}\")\n</code></pre>     \"\"\" ) <pre><code>## Complete Examples by Agent Type\n\n### Gemini Spawner Example\n\n```python\nTask(\n    prompt=\"\"\"\nAnalyze the given system architecture and provide insights on:\n1. Current design patterns\n2. Potential bottlenecks\n3. Improvement recommendations\n\n\ud83d\udd34 CRITICAL - Report Activity to HtmlGraph:\n\nAt the end of your work, capture findings with:\n\n```python\nfrom htmlgraph import SDK\nimport os\n\nsdk = SDK(agent=\"gemini-spawner\")\nparent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\nspike = sdk.spikes.create(\"Architecture Analysis - Gemini\") \\\\\n    .set_findings(f'''\n## System Architecture Analysis\n\n### Design Patterns Identified\n- Pattern 1: Description\n- Pattern 2: Description\n\n### Performance Bottlenecks\n1. Bottleneck A at [location]\n2. Bottleneck B at [location]\n\n### Improvement Recommendations\n1. Recommendation 1 - Impact: [high/medium/low]\n2. Recommendation 2 - Impact: [high/medium/low]\n3. Recommendation 3 - Impact: [high/medium/low]\n\n### Implementation Priority\n1. Quick wins (&lt; 1 day)\n2. Medium effort (1-3 days)\n3. Long-term improvements\n\n**Parent Event:** {parent_event_id}\n''') \\\\\n    .save()\n\nprint(f\"\u2705 Architecture analysis complete\")\nprint(f\"\ud83d\udcca Analysis spike: {spike.id}\")\nif parent_event_id:\n    print(f\"\ud83d\udc64 Linked to parent: {parent_event_id}\")\n</code></pre>     \"\"\",     subagent_type=\"gemini-spawner\" ) <pre><code>### Researcher Agent Example\n\n```python\nTask(\n    prompt=\"\"\"\nResearch and compile information about [topic]:\n1. Background and context\n2. Current state of the field\n3. Recent developments\n4. Expert opinions and findings\n\n\ud83d\udd34 CRITICAL - Report Activity to HtmlGraph:\n\n```python\nfrom htmlgraph import SDK\nimport os\n\nsdk = SDK(agent=\"researcher\")\nparent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\nspike = sdk.spikes.create(\"Research: [Topic Name]\") \\\\\n    .set_findings(f'''\n## Research Findings: [Topic]\n\n### Background &amp; Context\n[Your research here]\n\n### Current State\n[Current state analysis]\n\n### Recent Developments (2024-2025)\n[Recent developments]\n\n### Expert Perspectives\n[Expert opinions found]\n\n### Sources\n- [Source 1](url)\n- [Source 2](url)\n- [Source 3](url)\n\n### Key Takeaways\n1. Finding 1\n2. Finding 2\n3. Finding 3\n\n**Parent Event:** {parent_event_id}\n**Research Conducted:** {datetime.now().isoformat()}\n''') \\\\\n    .save()\n\nprint(f\"\u2705 Research complete: {spike.id}\")\nif parent_event_id:\n    print(f\"\ud83d\udc64 Parent task: {parent_event_id}\")\n</code></pre>     \"\"\" ) <pre><code>### Debugger Agent Example\n\n```python\nTask(\n    prompt=\"\"\"\nDebug the reported issue and provide:\n1. Root cause analysis\n2. Reproduction steps\n3. Solution with code examples\n4. Prevention strategies\n\n\ud83d\udd34 CRITICAL - Report Activity to HtmlGraph:\n\n```python\nfrom htmlgraph import SDK\nimport os\n\nsdk = SDK(agent=\"debugger\")\nparent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\nspike = sdk.spikes.create(\"Debug Report: [Issue Name]\") \\\\\n    .set_findings(f'''\n## Debugging Report\n\n### Issue Description\n[Describe the issue]\n\n### Root Cause Analysis\n[Analysis of root cause]\n\n### Reproduction Steps\n1. Step 1\n2. Step 2\n3. Step 3\n\n### Solution\n```python\n# Code fix here\n</code></pre></p>"},{"location":"TASK_PROMPT_TEMPLATE/#testing","title":"Testing","text":"<ul> <li>Test 1: [what was tested]</li> <li>Test 2: [what was tested]</li> </ul>"},{"location":"TASK_PROMPT_TEMPLATE/#prevention","title":"Prevention","text":"<ul> <li>Preventive measure 1</li> <li>Preventive measure 2</li> </ul> <p>Parent Event: {parent_event_id} Issue Fixed: [yes/no] ''') \\     .save()</p> <p>print(f\"\u2705 Debug analysis complete: {spike.id}\") if parent_event_id:     print(f\"\ud83d\udc64 Linked to: {parent_event_id}\") <pre><code>    \"\"\"\n)\n</code></pre></p>"},{"location":"TASK_PROMPT_TEMPLATE/#sdk-integration-points","title":"SDK Integration Points","text":""},{"location":"TASK_PROMPT_TEMPLATE/#event-environment-variables","title":"Event Environment Variables","text":"<p>These variables are automatically exported when a Task() creates a parent event:</p> <pre><code>import os\n\n# Parent event ID - use to link your findings back\nparent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\n# Subagent type - for logging what type of agent you are\nsubagent_type = os.environ.get(\"HTMLGRAPH_SUBAGENT_TYPE\")\n\n# Session ID - for context about the session\nsession_id = os.environ.get(\"HTMLGRAPH_SESSION_ID\")\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#spike-creation-pattern","title":"Spike Creation Pattern","text":"<p>Standard pattern for all agent types:</p> <pre><code>from htmlgraph import SDK\n\n# 1. Initialize SDK with agent type\nsdk = SDK(agent=\"your-agent-type\")\n\n# 2. Create spike with title matching your findings\nspike = sdk.spikes.create(\"Your Title Here\")\n\n# 3. Set findings with detailed content\nspike.set_findings(\"\"\"\n[Your detailed findings]\n\"\"\")\n\n# 4. Save and get ID\nsaved_spike = spike.save()\n\n# 5. Log completion\nprint(f\"Created spike: {saved_spike.id}\")\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#best-practices","title":"Best Practices","text":""},{"location":"TASK_PROMPT_TEMPLATE/#1-meaningful-titles","title":"1. Meaningful Titles","text":"<pre><code># Good\nspike = sdk.spikes.create(\"Performance Analysis: Database Query Optimization\")\n\n# Bad\nspike = sdk.spikes.create(\"Analysis\")\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#2-structured-findings","title":"2. Structured Findings","text":"<pre><code>findings = \"\"\"\n## Problem Statement\n[Clear description of the problem]\n\n## Analysis Methodology\n[How you approached the problem]\n\n## Key Findings\n1. Finding 1 with supporting evidence\n2. Finding 2 with supporting evidence\n3. Finding 3 with supporting evidence\n\n## Recommendations\n[Specific, actionable recommendations]\n\n## Next Steps\n[What should be done next]\n\"\"\"\n\nspike.set_findings(findings).save()\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#3-always-reference-parent-event","title":"3. Always Reference Parent Event","text":"<pre><code>parent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\nfindings = f\"\"\"\n[Your findings]\n\n---\n**Linked to parent task:** {parent_event_id}\n**Analysis timestamp:** {datetime.now().isoformat()}\n\"\"\"\n\nspike.set_findings(findings).save()\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#4-multiple-spikes-if-needed","title":"4. Multiple Spikes if Needed","text":"<pre><code>sdk = SDK(agent=\"gemini-spawner\")\n\n# Create spike 1: Analysis\nspike1 = sdk.spikes.create(\"Architecture Analysis\") \\\\\n    .set_findings(\"[Analysis findings]\") \\\\\n    .save()\n\n# Create spike 2: Implementation Plan\nspike2 = sdk.spikes.create(\"Implementation Plan\") \\\\\n    .set_findings(\"[Implementation plan]\") \\\\\n    .save()\n\n# Create spike 3: Risk Assessment\nspike3 = sdk.spikes.create(\"Risk Assessment\") \\\\\n    .set_findings(\"[Risk assessment]\") \\\\\n    .save()\n\nprint(f\"Created {3} spikes for comprehensive analysis\")\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#error-handling","title":"Error Handling","text":"<pre><code>from htmlgraph import SDK\nimport os\n\ntry:\n    sdk = SDK(agent=\"your-agent\")\n    parent_event_id = os.environ.get(\"HTMLGRAPH_PARENT_EVENT\")\n\n    spike = sdk.spikes.create(\"Your Title\") \\\\\n        .set_findings(\"\"\"[Your findings]\"\"\") \\\\\n        .save()\n\n    print(f\"\u2705 Success: {spike.id}\")\n\nexcept ImportError:\n    print(\"\u26a0\ufe0f  HtmlGraph SDK not available\")\n    # Continue with work even if SDK not available\nexcept Exception as e:\n    print(f\"\u26a0\ufe0f  Could not create spike: {e}\")\n    # Graceful degradation\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#event-trace-output","title":"Event Trace Output","text":"<p>When using this template, you'll see parent-child event traces:</p> <pre><code>Dashboard \u2192 Activity \u2192 Event Traces\n\u251c\u2500 evt-abc123 (Parent Task)\n\u2502  \u251c\u2500 Status: completed\n\u2502  \u251c\u2500 Subagent: gemini-spawner\n\u2502  \u251c\u2500 Duration: 287 seconds\n\u2502  \u251c\u2500 Child Spikes: 2\n\u2502  \u2514\u2500 Child Events:\n\u2502     \u2514\u2500 subevt-xyz789 (Subagent Completion)\n\u2502        \u251c\u2500 Status: completed\n\u2502        \u2514\u2500 Timestamp: 2025-01-08 16:42:01\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#testing-your-template","title":"Testing Your Template","text":"<p>To verify your Task() and SDK integration works:</p> <pre><code># 1. Check that parent event is created\nsqlite3 .htmlgraph/index.sqlite \\\n  \"SELECT event_id, status, subagent_type FROM agent_events \\\n   WHERE event_type='task_delegation' ORDER BY timestamp DESC LIMIT 1;\"\n\n# 2. Check that spike was created\nsqlite3 .htmlgraph/index.sqlite \\\n  \"SELECT id, title FROM features WHERE type='spike' \\\n   ORDER BY created_at DESC LIMIT 1;\"\n\n# 3. Check parent event was updated with spike count\nsqlite3 .htmlgraph/index.sqlite \\\n  \"SELECT status, child_spike_count FROM agent_events \\\n   WHERE event_type='task_delegation' \\\n   ORDER BY timestamp DESC LIMIT 1;\"\n\n# 4. Query event trace via API\ncurl http://localhost:8000/api/event-traces\n</code></pre>"},{"location":"TASK_PROMPT_TEMPLATE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"TASK_PROMPT_TEMPLATE/#parent-event-not-created","title":"Parent event not created","text":"<p>Problem: Task() called but parent event missing</p> <p>Solution: 1. Verify PreToolUse hook is running: <code>claude --debug Task</code> 2. Check database: <code>ls -la .htmlgraph/index.sqlite</code> 3. Check environment: <code>echo $HTMLGRAPH_SESSION_ID</code></p>"},{"location":"TASK_PROMPT_TEMPLATE/#spike-not-linked-to-parent","title":"Spike not linked to parent","text":"<p>Problem: Spike created but child_spike_count is 0</p> <p>Solution: 1. Check spike timestamp &gt; parent timestamp 2. Check spike within 1 hour of parent event 3. Verify spike type='spike' in database 4. Check SDK.spikes.create() was called</p>"},{"location":"TASK_PROMPT_TEMPLATE/#environment-variable-not-available","title":"Environment variable not available","text":"<p>Problem: <code>HTMLGRAPH_PARENT_EVENT</code> is None</p> <p>Solution: 1. This is expected if Task() delegation failed 2. Use <code>os.environ.get(..., \"unknown\")</code> with default 3. Continue work even if parent tracking unavailable 4. SDK will still create spike for knowledge capture</p>"},{"location":"TASK_PROMPT_TEMPLATE/#related-documentation","title":"Related Documentation","text":"<ul> <li>Hybrid Event Capture System</li> <li>SDK Reference</li> <li>Task() Tool Documentation</li> <li>Event Traces API</li> </ul>"},{"location":"WORK_TYPE_CATEGORIZATION/","title":"Work Type Categorization in HtmlGraph","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#problem-statement","title":"Problem Statement","text":"<p>HtmlGraph currently tracks all work through features, bugs, chores, spikes, and epics, but lacks a systematic way to differentiate between: - Feature implementation work - Building new functionality - Exploratory/research work - Investigating unknowns, spikes - Maintenance work - Bug fixes, refactoring, technical debt - Administrative work - Documentation, planning, reviews</p> <p>This makes it difficult to analyze sessions and answer questions like: - \"How much time was spent on exploration vs implementation?\" - \"What percentage of this project was maintenance vs new features?\" - \"Which sessions were primarily investigative?\"</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#industry-standards-research","title":"Industry Standards Research","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#1-agile-spike-categorization","title":"1. Agile Spike Categorization","text":"<p>Spike Types: - Technical Spike - Investigate technical implementation options - Architectural Spike - Research system design and architecture decisions - Risk Spike - Identify and assess project risks</p> <p>Key Characteristics: - Timeboxed investigations (typically 1-3 days) - Goal is to reduce uncertainty, not deliver features - Output is knowledge/decision, not production code - Should have clear exit criteria</p> <p>Sources: ONES.com, Wrike Agile Guide</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#2-jira-work-item-hierarchy","title":"2. Jira Work Item Hierarchy","text":"<p>Work Item Types: - Epic - Large body of work spanning multiple sprints - Story - User-centric feature or functionality - Task - Operational work (not user-facing) - Bug - Defect or issue to fix - Spike - Investigation/research task - Subtask - Breakdown of any parent item</p> <p>Key Insight: Clear distinction between user-facing work (Stories) and internal work (Tasks, Spikes)</p> <p>Sources: Atlassian Jira Docs, PlanyWay Blog</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#3-software-maintenance-categories","title":"3. Software Maintenance Categories","text":"<p>Four Types of Maintenance: 1. Corrective - Fix defects and errors 2. Adaptive - Adapt to environment changes (OS, dependencies) 3. Perfective - Improve performance, usability, maintainability 4. Preventive - Prevent future problems (refactoring, tech debt)</p> <p>Refactoring Classification: - Preventive Refactoring - Proactive code improvement to prevent future issues - Corrective Refactoring - Fix code smells and technical debt</p> <p>Sources: Stepsize Blog, Wikipedia</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#gap-analysis-current-htmlgraph-system","title":"Gap Analysis: Current HtmlGraph System","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#current-collections","title":"Current Collections","text":"<pre><code># HtmlGraph collections (from SDK)\nsdk.features    # User-facing functionality\nsdk.bugs        # Defects/issues\nsdk.chores      # Maintenance tasks\nsdk.spikes      # Investigations\nsdk.epics       # Large initiatives\nsdk.tracks      # Multi-feature planning\nsdk.phases      # Project phases\nsdk.sessions    # Agent activity sessions\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#identified-gaps","title":"Identified Gaps","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#gap-1-no-event-level-work-type-classification","title":"Gap 1: No Event-Level Work Type Classification","text":"<p>Problem: Events have <code>feature_id</code> but no <code>work_type</code> field</p> <p>Impact: Can't differentiate event types when analyzing session activity <pre><code># Current event structure\n{\n    \"event_id\": \"evt-abc123\",\n    \"tool\": \"Bash\",\n    \"feature_id\": \"feat-456\",  # Links to feature but no work type\n    \"summary\": \"Run tests\",\n    \"timestamp\": \"2024-12-22T10:30:00Z\"\n}\n</code></pre></p> <p>Need: Add <code>work_type</code> field to classify events as: - <code>feature-implementation</code> - Building new functionality - <code>spike-investigation</code> - Research/exploration - <code>bug-fix</code> - Correcting defects - <code>maintenance</code> - Refactoring, updates - <code>documentation</code> - Writing docs - <code>planning</code> - Design, architecture decisions - <code>review</code> - Code review, testing</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#gap-2-no-session-level-work-categorization","title":"Gap 2: No Session-Level Work Categorization","text":"<p>Problem: Sessions don't have a primary work type or work mix breakdown</p> <p>Impact: Can't answer \"What kind of work was this session?\" <pre><code># Current session model\nclass Session(BaseModel):\n    id: str\n    agent: str\n    status: str\n    # Missing: primary_work_type, work_breakdown\n</code></pre></p> <p>Need: Add session-level categorization: - <code>primary_work_type</code> - Dominant work type for session - <code>work_breakdown</code> - Distribution of work types (% or count)</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#gap-3-limited-spike-categorization","title":"Gap 3: Limited Spike Categorization","text":"<p>Problem: Spikes exist but no subtype differentiation</p> <p>Impact: Can't distinguish Technical vs Architectural vs Risk spikes</p> <p>Current: <pre><code># Generic spike - no categorization\nspike = Spike(\n    id=\"spike-001\",\n    title=\"Investigate OAuth providers\",\n    status=\"in-progress\"\n)\n</code></pre></p> <p>Need: Add spike subtypes: - <code>technical</code> - Technical implementation research - <code>architectural</code> - System design decisions - <code>risk</code> - Risk identification and assessment</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#gap-4-no-maintenance-subcategorization","title":"Gap 4: No Maintenance Subcategorization","text":"<p>Problem: Chores exist but no maintenance type classification</p> <p>Impact: Can't differentiate Corrective vs Preventive vs Adaptive maintenance</p> <p>Current: <pre><code># Generic chore - no categorization\nchore = Chore(\n    id=\"chore-001\",\n    title=\"Refactor authentication module\",\n    status=\"todo\"\n)\n</code></pre></p> <p>Need: Add maintenance types: - <code>corrective</code> - Fix defects - <code>adaptive</code> - Adapt to environment changes - <code>perfective</code> - Improve quality/performance - <code>preventive</code> - Prevent future issues</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#gap-5-no-analytics-for-work-type-distribution","title":"Gap 5: No Analytics for Work Type Distribution","text":"<p>Problem: No SDK methods to query work type analytics</p> <p>Impact: Can't answer questions like: - \"What % of time was exploratory vs implementation?\" - \"How many events were feature work vs maintenance?\" - \"What's the spike-to-feature ratio?\"</p> <p>Need: Add analytics queries: <pre><code># Desired analytics API\nstats = sdk.analytics.work_type_distribution(\n    session_id=\"session-123\"\n)\n# Returns: {\"feature\": 45%, \"spike\": 30%, \"maintenance\": 25%}\n\nspike_sessions = sdk.sessions.where(primary_work_type=\"spike\")\n</code></pre></p>"},{"location":"WORK_TYPE_CATEGORIZATION/#gap-6-no-visual-differentiation-in-dashboard","title":"Gap 6: No Visual Differentiation in Dashboard","text":"<p>Problem: Dashboard doesn't visually distinguish work types</p> <p>Impact: Can't quickly see work type mix at a glance</p> <p>Need: Dashboard enhancements: - Color-code events by work type - Show work type distribution charts - Filter sessions by primary work type - Timeline view with work type indicators</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#proposed-solution","title":"Proposed Solution","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#phase-1-event-level-classification","title":"Phase 1: Event-Level Classification","text":"<p>1.1 Add <code>work_type</code> field to events</p> <p>Update <code>EventRecord</code> model: <pre><code>class EventRecord(BaseModel):\n    event_id: str\n    timestamp: datetime\n    session_id: str\n    agent: str\n    tool: str\n    summary: str\n    success: bool\n    feature_id: str | None = None\n    work_type: WorkType | None = None  # NEW\n    drift_score: float | None = None\n    start_commit: str | None = None\n    continued_from: str | None = None\n\nclass WorkType(str, Enum):\n    FEATURE = \"feature-implementation\"\n    SPIKE = \"spike-investigation\"\n    BUG_FIX = \"bug-fix\"\n    MAINTENANCE = \"maintenance\"\n    DOCUMENTATION = \"documentation\"\n    PLANNING = \"planning\"\n    REVIEW = \"review\"\n    ADMIN = \"admin\"\n</code></pre></p> <p>1.2 Auto-infer work type from active work item</p> <pre><code>def infer_work_type(feature_id: str | None, sdk: SDK) -&gt; WorkType | None:\n    \"\"\"Automatically infer work type from active feature/bug/spike/chore.\"\"\"\n    if not feature_id:\n        return None\n\n    # Check each collection\n    if feature_id.startswith(\"feat-\"):\n        return WorkType.FEATURE\n    elif feature_id.startswith(\"spike-\"):\n        spike = sdk.spikes.get(feature_id)\n        return WorkType.SPIKE\n    elif feature_id.startswith(\"bug-\"):\n        return WorkType.BUG_FIX\n    elif feature_id.startswith(\"chore-\"):\n        chore = sdk.chores.get(feature_id)\n        # Infer from chore metadata if available\n        return WorkType.MAINTENANCE\n\n    return None\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#phase-2-work-item-subcategorization","title":"Phase 2: Work Item Subcategorization","text":"<p>2.1 Add spike subtypes</p> <pre><code>class SpikeType(str, Enum):\n    TECHNICAL = \"technical\"\n    ARCHITECTURAL = \"architectural\"\n    RISK = \"risk\"\n    GENERAL = \"general\"\n\nclass Spike(BaseModel):\n    id: str\n    title: str\n    spike_type: SpikeType = SpikeType.GENERAL  # NEW\n    status: str\n    timebox_hours: int | None = None  # NEW\n    findings: str | None = None  # NEW\n    decision: str | None = None  # NEW\n</code></pre> <p>2.2 Add maintenance types</p> <pre><code>class MaintenanceType(str, Enum):\n    CORRECTIVE = \"corrective\"\n    ADAPTIVE = \"adaptive\"\n    PERFECTIVE = \"perfective\"\n    PREVENTIVE = \"preventive\"\n\nclass Chore(BaseModel):\n    id: str\n    title: str\n    maintenance_type: MaintenanceType | None = None  # NEW\n    status: str\n    technical_debt_score: int | None = None  # NEW\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#phase-3-session-level-categorization","title":"Phase 3: Session-Level Categorization","text":"<p>3.1 Add session work type tracking</p> <pre><code>class Session(BaseModel):\n    id: str\n    agent: str\n    status: str\n    primary_work_type: WorkType | None = None  # NEW\n    work_breakdown: dict[WorkType, int] | None = None  # NEW\n\n    def calculate_work_breakdown(self, events_dir: str = \".htmlgraph/events\") -&gt; dict[WorkType, int]:\n        \"\"\"Calculate distribution of work types from events.\"\"\"\n        events = self.get_events(limit=None, events_dir=events_dir)\n        breakdown = {}\n\n        for evt in events:\n            work_type = evt.get(\"work_type\")\n            if work_type:\n                breakdown[work_type] = breakdown.get(work_type, 0) + 1\n\n        return breakdown\n\n    def calculate_primary_work_type(self) -&gt; WorkType | None:\n        \"\"\"Determine primary work type based on event distribution.\"\"\"\n        breakdown = self.calculate_work_breakdown()\n        if not breakdown:\n            return None\n\n        # Return work type with most events\n        return max(breakdown, key=breakdown.get)\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#phase-4-analytics-api","title":"Phase 4: Analytics API","text":"<p>4.1 Add work type analytics methods</p> <pre><code>class Analytics:\n    def __init__(self, sdk: SDK):\n        self.sdk = sdk\n\n    def work_type_distribution(\n        self,\n        session_id: str | None = None,\n        start_date: datetime | None = None,\n        end_date: datetime | None = None\n    ) -&gt; dict[WorkType, float]:\n        \"\"\"\n        Calculate work type distribution as percentages.\n\n        Example:\n            &gt;&gt;&gt; analytics = sdk.analytics\n            &gt;&gt;&gt; dist = analytics.work_type_distribution(session_id=\"session-123\")\n            &gt;&gt;&gt; print(dist)\n            {\n                \"feature-implementation\": 45.2,\n                \"spike-investigation\": 28.3,\n                \"maintenance\": 18.5,\n                \"documentation\": 8.0\n            }\n        \"\"\"\n        pass\n\n    def spike_to_feature_ratio(\n        self,\n        session_id: str | None = None\n    ) -&gt; float:\n        \"\"\"\n        Calculate ratio of spike events to feature events.\n\n        High ratio (&gt;0.5) indicates research-heavy session.\n        Low ratio (&lt;0.2) indicates implementation-heavy session.\n        \"\"\"\n        pass\n\n    def maintenance_burden(\n        self,\n        session_id: str | None = None\n    ) -&gt; float:\n        \"\"\"\n        Calculate percentage of work spent on maintenance vs new features.\n\n        Returns value 0-100 representing maintenance %.\n        \"\"\"\n        pass\n\n# Add to SDK\nclass SDK:\n    def __init__(self, agent: str = \"claude\"):\n        # ... existing code ...\n        self.analytics = Analytics(self)  # NEW\n</code></pre> <p>4.2 Add session filtering by work type</p> <pre><code># Query sessions by primary work type\nexploratory_sessions = sdk.sessions.where(primary_work_type=WorkType.SPIKE)\nimplementation_sessions = sdk.sessions.where(primary_work_type=WorkType.FEATURE)\n\n# Get work breakdown for project\ntotal_breakdown = sdk.analytics.work_type_distribution()\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#phase-5-dashboard-visualizations","title":"Phase 5: Dashboard Visualizations","text":"<p>5.1 Work type color coding</p> <pre><code>/* Color scheme for work types */\n.work-type-feature { background: #4CAF50; }  /* Green - building */\n.work-type-spike { background: #2196F3; }    /* Blue - exploring */\n.work-type-bug { background: #F44336; }      /* Red - fixing */\n.work-type-maintenance { background: #FF9800; }  /* Orange - maintaining */\n.work-type-documentation { background: #9C27B0; }  /* Purple - documenting */\n.work-type-planning { background: #00BCD4; }  /* Cyan - planning */\n.work-type-review { background: #FFEB3B; }    /* Yellow - reviewing */\n</code></pre> <p>5.2 Dashboard charts</p> <p>Add to <code>dashboard/index.html</code>: - Pie chart: Work type distribution for selected session - Stacked bar chart: Work type timeline across sessions - Metric cards:   - Spike-to-feature ratio   - Maintenance burden %   - Primary work type - Filters: Filter sessions by work type</p> <p>5.3 Session list enhancements</p> <pre><code>&lt;!-- Session card with work type badge --&gt;\n&lt;div class=\"session-card\" data-session-id=\"session-123\"&gt;\n    &lt;h3&gt;Session ABC-123&lt;/h3&gt;\n    &lt;span class=\"badge work-type-spike\"&gt;Primary: Spike Investigation&lt;/span&gt;\n\n    &lt;div class=\"work-breakdown\"&gt;\n        &lt;div class=\"breakdown-bar\"&gt;\n            &lt;div class=\"segment work-type-spike\" style=\"width: 60%\"&gt;&lt;/div&gt;\n            &lt;div class=\"segment work-type-feature\" style=\"width: 30%\"&gt;&lt;/div&gt;\n            &lt;div class=\"segment work-type-documentation\" style=\"width: 10%\"&gt;&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"breakdown-legend\"&gt;\n            &lt;span&gt;Spike: 60%&lt;/span&gt;\n            &lt;span&gt;Feature: 30%&lt;/span&gt;\n            &lt;span&gt;Docs: 10%&lt;/span&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#implementation-plan","title":"Implementation Plan","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#sprint-1-core-models-week-1","title":"Sprint 1: Core Models (Week 1)","text":"<p>Priority: HIGH</p> <ul> <li> Add <code>WorkType</code> enum to models.py</li> <li> Update <code>EventRecord</code> with <code>work_type</code> field</li> <li> Add <code>SpikeType</code> enum and update Spike model</li> <li> Add <code>MaintenanceType</code> enum and update Chore model</li> <li> Update Session model with <code>primary_work_type</code> and <code>work_breakdown</code></li> <li> Write migration script for existing data</li> <li> Update all tests</li> <li> Update SDK event creation to auto-infer work type</li> </ul> <p>Deliverable: Models support work type classification</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#sprint-2-analytics-api-week-2","title":"Sprint 2: Analytics API (Week 2)","text":"<p>Priority: HIGH</p> <ul> <li> Create <code>Analytics</code> class in new <code>analytics.py</code> module</li> <li> Implement <code>work_type_distribution()</code> method</li> <li> Implement <code>spike_to_feature_ratio()</code> method</li> <li> Implement <code>maintenance_burden()</code> method</li> <li> Add <code>analytics</code> property to SDK</li> <li> Add session filtering by work type</li> <li> Write comprehensive tests</li> <li> Document analytics API in docs/SDK_ANALYTICS.md</li> </ul> <p>Deliverable: Full analytics API for work type queries</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#sprint-3-dashboard-visualizations-week-3","title":"Sprint 3: Dashboard Visualizations (Week 3)","text":"<p>Priority: MEDIUM</p> <ul> <li> Add Chart.js library to dashboard</li> <li> Implement work type pie chart</li> <li> Implement work type timeline (stacked bar)</li> <li> Add metric cards (spike ratio, maintenance burden)</li> <li> Add work type color coding to session list</li> <li> Add work type filter to session list</li> <li> Add work breakdown bars to session cards</li> <li> Update dashboard CSS with work type colors</li> </ul> <p>Deliverable: Visual dashboard for work type analysis</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#sprint-4-agent-interface-updates-week-4","title":"Sprint 4: Agent Interface Updates (Week 4)","text":"<p>Priority: MEDIUM</p> <ul> <li> Update Claude Code skill with work type examples</li> <li> Update Gemini extension with work type examples</li> <li> Update Codex skill with work type examples</li> <li> Add work type guidance to WORKFLOW.md</li> <li> Create cookbook examples for work type usage</li> <li> Update quickstart guide</li> </ul> <p>Deliverable: Agent interfaces document work type system</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#sprint-5-documentation-examples-week-5","title":"Sprint 5: Documentation &amp; Examples (Week 5)","text":"<p>Priority: LOW</p> <ul> <li> Write comprehensive guide: docs/WORK_TYPE_GUIDE.md</li> <li> Create example: examples/work-type-analytics/</li> <li> Add work type section to README.md</li> <li> Create blog post draft</li> <li> Record demo video</li> <li> Update API reference</li> </ul> <p>Deliverable: Complete documentation and examples</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#expected-outcomes","title":"Expected Outcomes","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#answers-these-questions","title":"Answers These Questions","text":"<p>After implementation, users can answer:</p> <ol> <li>Session Analysis</li> <li>\"What was the primary focus of this session?\" \u2192 Check <code>session.primary_work_type</code></li> <li> <p>\"How much time was spent exploring vs building?\" \u2192 Check spike vs feature percentages</p> </li> <li> <p>Project Health</p> </li> <li>\"What's our spike-to-feature ratio?\" \u2192 <code>sdk.analytics.spike_to_feature_ratio()</code></li> <li> <p>\"Are we spending too much time on maintenance?\" \u2192 <code>sdk.analytics.maintenance_burden()</code></p> </li> <li> <p>Work Patterns</p> </li> <li>\"Which sessions were exploratory?\" \u2192 <code>sdk.sessions.where(primary_work_type=\"spike\")</code></li> <li> <p>\"What % of work was preventive vs corrective?\" \u2192 Filter by maintenance type</p> </li> <li> <p>Trend Analysis</p> </li> <li>\"Is exploration increasing or decreasing over time?\" \u2192 Timeline chart</li> <li>\"What's the distribution of work types this month?\" \u2192 <code>work_type_distribution(start_date, end_date)</code></li> </ol>"},{"location":"WORK_TYPE_CATEGORIZATION/#benefits","title":"Benefits","text":"<ol> <li>Better Session Context - Quickly understand session purpose from work type</li> <li>Informed Planning - See if project needs more exploration or implementation</li> <li>Health Metrics - Track technical debt (maintenance burden), innovation (spike ratio)</li> <li>Attribution Clarity - Differentiate \"researching OAuth\" from \"implementing OAuth\"</li> <li>Agent Coordination - Assign agents based on work type expertise</li> </ol>"},{"location":"WORK_TYPE_CATEGORIZATION/#alternative-approaches-considered","title":"Alternative Approaches Considered","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#alternative-1-tag-based-system","title":"Alternative 1: Tag-Based System","text":"<p>Instead of enum-based work types, use free-form tags: <pre><code>event.tags = [\"exploratory\", \"authentication\", \"research\"]\n</code></pre></p> <p>Rejected because: - No standardization (typos, inconsistency) - Harder to query and aggregate - Less clear semantics</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#alternative-2-separate-event-logs-per-work-type","title":"Alternative 2: Separate Event Logs Per Work Type","text":"<p>Create separate <code>.jsonl</code> files for each work type: <pre><code>.htmlgraph/events/session-123-features.jsonl\n.htmlgraph/events/session-123-spikes.jsonl\n.htmlgraph/events/session-123-maintenance.jsonl\n</code></pre></p> <p>Rejected because: - Breaks chronological ordering - Complex to query across work types - More file I/O overhead</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#alternative-3-work-type-as-separate-collection","title":"Alternative 3: Work Type as Separate Collection","text":"<p>Create a new <code>WorkItem</code> collection that wraps features/spikes/bugs: <pre><code>work_item = WorkItem(\n    id=\"work-001\",\n    type=\"spike\",\n    underlying_id=\"spike-123\"\n)\n</code></pre></p> <p>Rejected because: - Adds unnecessary indirection - Duplicates data - Complicates queries</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#migration-strategy","title":"Migration Strategy","text":""},{"location":"WORK_TYPE_CATEGORIZATION/#backward-compatibility","title":"Backward Compatibility","text":"<p>Phase 1: Additive Changes (v0.5.0) - Add new fields with <code>| None</code> defaults - All existing code continues to work - New fields are optional</p> <p>Phase 2: Auto-Migration (v0.5.1) - Run migration script to infer work types from existing data - Populate <code>work_type</code> for historical events based on <code>feature_id</code> prefix - Calculate <code>work_breakdown</code> for existing sessions</p> <p>Phase 3: Recommendations (v0.6.0) - Encourage explicit work type tagging - Deprecation warnings for untyped events (but still works)</p>"},{"location":"WORK_TYPE_CATEGORIZATION/#migration-script","title":"Migration Script","text":"<pre><code># scripts/migrate_work_types.py\n\nfrom htmlgraph import SDK\nfrom htmlgraph.models import WorkType\n\ndef migrate_events():\n    \"\"\"Add work_type to existing events based on feature_id.\"\"\"\n    sdk = SDK()\n\n    # Get all sessions\n    sessions = sdk.sessions.all()\n\n    for session in sessions:\n        events = session.get_events(limit=None)\n\n        for evt in events:\n            if evt.get(\"work_type\"):\n                continue  # Already has work type\n\n            # Infer from feature_id\n            feature_id = evt.get(\"feature_id\")\n            if not feature_id:\n                continue\n\n            if feature_id.startswith(\"feat-\"):\n                work_type = WorkType.FEATURE\n            elif feature_id.startswith(\"spike-\"):\n                work_type = WorkType.SPIKE\n            elif feature_id.startswith(\"bug-\"):\n                work_type = WorkType.BUG_FIX\n            elif feature_id.startswith(\"chore-\"):\n                work_type = WorkType.MAINTENANCE\n            else:\n                continue\n\n            # Update event (in-place edit of JSONL)\n            evt[\"work_type\"] = work_type\n            # Write back to file...\n\ndef migrate_sessions():\n    \"\"\"Calculate work_breakdown for existing sessions.\"\"\"\n    sdk = SDK()\n\n    sessions = sdk.sessions.all()\n\n    for session in sessions:\n        # Calculate and store work breakdown\n        breakdown = session.calculate_work_breakdown()\n        primary = session.calculate_primary_work_type()\n\n        # Update session HTML\n        with sdk.sessions.edit(session.id) as s:\n            s.work_breakdown = breakdown\n            s.primary_work_type = primary\n\nif __name__ == \"__main__\":\n    print(\"Migrating events...\")\n    migrate_events()\n\n    print(\"Migrating sessions...\")\n    migrate_sessions()\n\n    print(\"\u2705 Migration complete\")\n</code></pre>"},{"location":"WORK_TYPE_CATEGORIZATION/#summary","title":"Summary","text":"<p>This proposal adds systematic work type categorization to HtmlGraph, enabling:</p> <ol> <li>Event-level classification - Tag events as feature/spike/bug/maintenance/etc</li> <li>Session-level analysis - See work type distribution per session</li> <li>Project-level metrics - Calculate spike ratios, maintenance burden</li> <li>Visual differentiation - Color-coded dashboard with charts</li> <li>Better attribution - Distinguish exploratory from implementation work</li> </ol> <p>Implementation: 5 sprints (5 weeks) Priority: HIGH (addresses core user need) Breaking Changes: None (fully backward compatible) Dependencies: None (builds on existing SDK)</p> <p>Next Steps: 1. Review and approve this proposal 2. Create feature for Sprint 1 implementation 3. Start with core models and work type enums 4. Iterate based on feedback</p>"},{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to HtmlGraph will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"changelog/#034-2024-12-22","title":"[0.3.4] - 2024-12-22","text":""},{"location":"changelog/#added","title":"Added","text":"<ul> <li>Hash-Based ID System: Collision-resistant IDs for multi-agent collaboration</li> <li>Short, readable format: <code>{prefix}-{hash}</code> (e.g., <code>feat-a1b2c3d4</code>)</li> <li>Content-addressable with entropy for collision resistance</li> <li>Hierarchical sub-task support (e.g., <code>feat-a1b2c3d4.1.2</code>)</li> <li>Type-specific prefixes for visual identification</li> <li>Inspired by Beads</li> <li>New <code>htmlgraph.ids</code> module: <code>generate_id()</code>, <code>parse_id()</code>, <code>is_valid_id()</code>, etc.</li> <li>ID Generation API documentation: Complete guide with examples</li> </ul>"},{"location":"changelog/#changed","title":"Changed","text":"<ul> <li>SDK <code>FeatureBuilder</code> now generates hash-based IDs</li> <li>CLI <code>feature create</code> now generates hash-based IDs</li> <li>Server API creates hash-based IDs for new nodes</li> <li>Session IDs now use hash-based format</li> </ul>"},{"location":"changelog/#fixed","title":"Fixed","text":"<ul> <li>mkdocstrings configuration updated for newer versions (inventories option)</li> </ul>"},{"location":"changelog/#030-2024-12-22","title":"0.3.0 - 2024-12-22","text":""},{"location":"changelog/#added_1","title":"Added","text":"<ul> <li>TrackBuilder Fluent API: Deterministic track creation with specs and plans</li> <li>Multi-Agent Collaboration: Agent assignment, handoff notes, feature claiming</li> <li>Comprehensive Documentation: Complete docs site with MkDocs Material theme</li> <li>Agent Integration Docs: TrackBuilder documentation in Claude, Codex, and Gemini skills</li> <li>Time Estimation Parsing: Automatic parsing of <code>(Xh)</code> time estimates in task descriptions</li> <li>Track Validation: Pydantic validation for all track components</li> </ul>"},{"location":"changelog/#changed_1","title":"Changed","text":"<ul> <li>Updated all agent integration documentation with TrackBuilder examples</li> <li>Improved session start hook with track creation quick reference</li> <li>Enhanced feature creation decision framework</li> </ul>"},{"location":"changelog/#fixed_1","title":"Fixed","text":"<ul> <li>Track ID persistence in HTML files</li> <li>Drift detection for new modules and directories</li> </ul>"},{"location":"changelog/#022-2024-12-20","title":"0.2.2 - 2024-12-20","text":""},{"location":"changelog/#added_2","title":"Added","text":"<ul> <li>Drift Detection: Automatic detection of activity misalignment with features</li> <li>Session Validation: Validate attribution with <code>session validate-attribution</code></li> <li>Enhanced Activity Logging: Richer activity log with agent attribution</li> </ul>"},{"location":"changelog/#changed_2","title":"Changed","text":"<ul> <li>Improved session end summaries with next steps</li> <li>Better feature completion tracking</li> <li>Enhanced dashboard with session history view</li> </ul>"},{"location":"changelog/#fixed_2","title":"Fixed","text":"<ul> <li>Session continuity across conversation compacts</li> <li>Activity attribution edge cases</li> <li>Dashboard refresh issues</li> </ul>"},{"location":"changelog/#020-2024-12-18","title":"0.2.0 - 2024-12-18","text":""},{"location":"changelog/#added_3","title":"Added","text":"<ul> <li>Tracks: Multi-feature project support with specs and plans</li> <li>Spec Model: Requirements and acceptance criteria</li> <li>Plan Model: Phased implementation planning</li> <li>Track HTML Files: index.html, spec.html, plan.html per track</li> <li>Feature-Track Linking: <code>track_id</code> field on features</li> </ul>"},{"location":"changelog/#changed_3","title":"Changed","text":"<ul> <li>Enhanced SDK with tracks API</li> <li>Updated CLI with track commands</li> <li>Improved dashboard with track views</li> </ul>"},{"location":"changelog/#fixed_3","title":"Fixed","text":"<ul> <li>Feature status transitions</li> <li>Session event ordering</li> </ul>"},{"location":"changelog/#013-2024-12-16","title":"0.1.3 - 2024-12-16","text":""},{"location":"changelog/#added_4","title":"Added","text":"<ul> <li>Session Management: Automatic session tracking via hooks</li> <li>Activity Logging: Comprehensive activity tracking in sessions</li> <li>Dashboard: Interactive Kanban board and graph views</li> </ul>"},{"location":"changelog/#changed_4","title":"Changed","text":"<ul> <li>Improved feature query performance</li> <li>Enhanced HTML file structure</li> <li>Better CSS styling for nodes</li> </ul>"},{"location":"changelog/#fixed_4","title":"Fixed","text":"<ul> <li>Feature step completion tracking</li> <li>Edge relationship types</li> <li>SQLite index synchronization</li> </ul>"},{"location":"changelog/#012-2024-12-15","title":"0.1.2 - 2024-12-15","text":""},{"location":"changelog/#added_5","title":"Added","text":"<ul> <li>CLI Commands: <code>htmlgraph</code> command-line interface</li> <li>Dashboard Server: <code>htmlgraph serve</code> for local development</li> <li>Feature Relationships: Typed edges (blocks, related, etc.)</li> </ul>"},{"location":"changelog/#changed_5","title":"Changed","text":"<ul> <li>Simplified SDK initialization</li> <li>Improved error messages</li> <li>Better type hints</li> </ul>"},{"location":"changelog/#fixed_5","title":"Fixed","text":"<ul> <li>Feature file path generation</li> <li>CSS selector query edge cases</li> </ul>"},{"location":"changelog/#011-2024-12-14","title":"0.1.1 - 2024-12-14","text":""},{"location":"changelog/#added_6","title":"Added","text":"<ul> <li>Pydantic Models: Type-safe Feature, Track, Session models</li> <li>HTML Conversion: Automatic HTML \u2194 Pydantic conversion</li> <li>CSS Selector Queries: Query features with CSS selectors</li> </ul>"},{"location":"changelog/#changed_6","title":"Changed","text":"<ul> <li>Refactored graph operations</li> <li>Improved HTML file format</li> <li>Enhanced documentation</li> </ul>"},{"location":"changelog/#fixed_6","title":"Fixed","text":"<ul> <li>HTML parsing edge cases</li> <li>Property serialization</li> </ul>"},{"location":"changelog/#010-2024-12-13","title":"0.1.0 - 2024-12-13","text":""},{"location":"changelog/#added_7","title":"Added","text":"<ul> <li>Initial release</li> <li>Core SDK: Feature creation and management</li> <li>HTML Files: Features as HTML files on disk</li> <li>Basic Queries: Filter features by status and priority</li> <li>Git Integration: Text-based storage for version control</li> <li>Zero Dependencies: Pure Python with justhtml</li> </ul>"},{"location":"concurrency-patterns/","title":"Concurrency Patterns for HtmlGraph","text":""},{"location":"concurrency-patterns/#overview","title":"Overview","text":"<p>HtmlGraph provides transaction and snapshot patterns for safe concurrent access to graph data. These patterns enable multiple agents to read and write the graph without data corruption or race conditions.</p>"},{"location":"concurrency-patterns/#graphsnapshot-immutable-state-views","title":"GraphSnapshot: Immutable State Views","text":"<p>A <code>GraphSnapshot</code> is a frozen, read-only copy of the graph at a specific point in time. It remains unchanged even if the original graph is modified.</p>"},{"location":"concurrency-patterns/#features","title":"Features","text":"<ul> <li>Immutable: Once created, the snapshot never changes</li> <li>Deep Copy: All nodes are deep-copied to prevent mutation</li> <li>Full Query Support: Supports all read operations (get, query, filter, iteration)</li> <li>Lightweight: Only copies node data, not file I/O structures</li> </ul>"},{"location":"concurrency-patterns/#usage","title":"Usage","text":"<pre><code>from htmlgraph import HtmlGraph\n\ngraph = HtmlGraph(\"features/\")\n\n# Create snapshot\nsnapshot = graph.snapshot()\n\n# Read from snapshot (safe even while graph is being modified)\nnode = snapshot.get(\"feature-001\")\nresults = snapshot.query(\"[data-status='blocked']\")\ntodos = snapshot.filter(lambda n: n.status == \"todo\")\n\n# Iterate over snapshot\nfor node in snapshot:\n    print(node.title)\n\n# Check membership\nif \"feature-001\" in snapshot:\n    print(\"Found!\")\n</code></pre>"},{"location":"concurrency-patterns/#use-cases","title":"Use Cases","text":""},{"location":"concurrency-patterns/#1-concurrent-read-operations","title":"1. Concurrent Read Operations","text":"<p>Multiple agents can safely read from snapshots while other agents modify the graph:</p> <pre><code># Agent 1: Take snapshot for analysis\nsnapshot = graph.snapshot()\nbottlenecks = analyze_bottlenecks(snapshot)  # Long-running operation\n\n# Agent 2: Modify graph (won't affect Agent 1's snapshot)\nnode = graph.get(\"feature-001\")\nnode.status = \"done\"\ngraph.update(node)\n</code></pre>"},{"location":"concurrency-patterns/#2-beforeafter-comparison","title":"2. Before/After Comparison","text":"<p>Compare graph state at different points in time:</p> <pre><code>before = graph.snapshot()\n\n# Make changes\nwith graph.transaction() as tx:\n    for node_id in [\"feat-001\", \"feat-002\", \"feat-003\"]:\n        node = graph.get(node_id)\n        node.status = \"done\"\n        tx.update(node)\n\nafter = graph.snapshot()\n\n# Compare\nbefore_done = len(before.filter(lambda n: n.status == \"done\"))\nafter_done = len(after.filter(lambda n: n.status == \"done\"))\nprint(f\"Completed {after_done - before_done} features\")\n</code></pre>"},{"location":"concurrency-patterns/#3-safe-reporting","title":"3. Safe Reporting","text":"<p>Generate reports without worrying about concurrent modifications:</p> <pre><code>def generate_report(graph):\n    # Take snapshot for consistent view\n    snapshot = graph.snapshot()\n\n    # Generate report (may take several seconds)\n    stats = calculate_statistics(snapshot)\n    chart = create_visualization(snapshot)\n\n    # Report reflects consistent state, even if graph was modified during generation\n    return {\"stats\": stats, \"chart\": chart}\n</code></pre>"},{"location":"concurrency-patterns/#transactions-atomic-multi-operation-changes","title":"Transactions: Atomic Multi-Operation Changes","text":"<p>A <code>transaction()</code> context manager batches multiple operations and applies them atomically. If any operation fails, all changes are rolled back.</p>"},{"location":"concurrency-patterns/#features_1","title":"Features","text":"<ul> <li>Atomic: All operations succeed or all fail</li> <li>Automatic Rollback: On exception, graph state is restored</li> <li>Chainable: Operations can be chained for fluent API</li> <li>Supports All CRUD: Add, update, delete operations</li> </ul>"},{"location":"concurrency-patterns/#usage_1","title":"Usage","text":"<pre><code>from htmlgraph import HtmlGraph\nfrom htmlgraph.models import Node\n\ngraph = HtmlGraph(\"features/\")\n\n# Basic transaction\nwith graph.transaction() as tx:\n    # Add new node\n    node1 = Node(id=\"feat-001\", title=\"New Feature\", status=\"todo\")\n    tx.add(node1)\n\n    # Update existing node\n    node2 = graph.get(\"feat-002\")\n    node2.status = \"done\"\n    tx.update(node2)\n\n    # Delete node\n    tx.delete(\"feat-003\")\n\n# All changes are committed atomically\n</code></pre>"},{"location":"concurrency-patterns/#rollback-on-error","title":"Rollback on Error","text":"<p>If any exception occurs within the transaction, no changes are persisted:</p> <pre><code>try:\n    with graph.transaction() as tx:\n        # This will succeed\n        tx.add(Node(id=\"feat-001\", title=\"Feature 1\", status=\"todo\"))\n\n        # This will fail (duplicate ID)\n        tx.add(Node(id=\"feat-001\", title=\"Duplicate\", status=\"todo\"))\nexcept ValueError:\n    pass\n\n# No changes were applied - graph is unchanged\nassert \"feat-001\" not in graph\n</code></pre>"},{"location":"concurrency-patterns/#chainable-operations","title":"Chainable Operations","text":"<p>Operations can be chained for concise code:</p> <pre><code>with graph.transaction() as tx:\n    tx.add(node1).add(node2).update(node3).delete(\"feat-004\")\n</code></pre>"},{"location":"concurrency-patterns/#use-cases_1","title":"Use Cases","text":""},{"location":"concurrency-patterns/#1-batch-updates","title":"1. Batch Updates","text":"<p>Update multiple related nodes atomically:</p> <pre><code>def complete_feature_and_dependencies(graph, feature_id):\n    \"\"\"Complete a feature and all its dependencies.\"\"\"\n    feature = graph.get(feature_id)\n    deps = graph.transitive_deps(feature_id)\n\n    with graph.transaction() as tx:\n        # Mark feature as done\n        feature.status = \"done\"\n        tx.update(feature)\n\n        # Mark all dependencies as done\n        for dep_id in deps:\n            dep = graph.get(dep_id)\n            dep.status = \"done\"\n            tx.update(dep)\n</code></pre>"},{"location":"concurrency-patterns/#2-complex-state-transitions","title":"2. Complex State Transitions","text":"<p>Ensure complex state changes are atomic:</p> <pre><code>def start_work_on_feature(graph, feature_id, agent_id):\n    \"\"\"Start work on a feature (atomic state change).\"\"\"\n    feature = graph.get(feature_id)\n\n    # Check prerequisites\n    deps = graph.transitive_deps(feature_id)\n    if any(graph.get(dep_id).status != \"done\" for dep_id in deps):\n        raise ValueError(\"Cannot start - dependencies not complete\")\n\n    with graph.transaction() as tx:\n        # Update feature\n        feature.status = \"in-progress\"\n        feature.assigned_to = agent_id\n        tx.update(feature)\n\n        # Create session node\n        session = Node(\n            id=f\"session-{feature_id}\",\n            type=\"session\",\n            title=f\"Session for {feature.title}\",\n            status=\"active\"\n        )\n        tx.add(session)\n\n    # Both changes applied atomically, or neither if anything fails\n</code></pre>"},{"location":"concurrency-patterns/#3-migrationrefactoring","title":"3. Migration/Refactoring","text":"<p>Safely migrate graph structure:</p> <pre><code>def migrate_priority_values(graph):\n    \"\"\"Migrate priority from numbers to labels.\"\"\"\n    mapping = {1: \"low\", 2: \"medium\", 3: \"high\", 4: \"critical\"}\n\n    with graph.transaction() as tx:\n        for node in graph:\n            if isinstance(node.priority, int):\n                node.priority = mapping.get(node.priority, \"medium\")\n                tx.update(node)\n\n    # All nodes migrated atomically\n</code></pre>"},{"location":"concurrency-patterns/#combining-snapshot-and-transaction","title":"Combining Snapshot and Transaction","text":"<p>Snapshots and transactions work well together:</p> <pre><code># Take snapshot before risky operation\nbefore = graph.snapshot()\n\ntry:\n    with graph.transaction() as tx:\n        # Perform complex changes\n        perform_risky_migration(tx, graph)\nexcept Exception as e:\n    # Transaction auto-rollbacks, but we also have snapshot for analysis\n    print(f\"Migration failed: {e}\")\n    print(f\"Graph state preserved (had {len(before)} nodes)\")\n    raise\n</code></pre>"},{"location":"concurrency-patterns/#performance-considerations","title":"Performance Considerations","text":""},{"location":"concurrency-patterns/#snapshots","title":"Snapshots","text":"<ul> <li>Memory: Creates deep copy of all nodes (proportional to graph size)</li> <li>Time: O(N) where N is number of nodes</li> <li>Best For: Small to medium graphs (&lt; 10K nodes), or infrequent snapshots</li> </ul>"},{"location":"concurrency-patterns/#transactions","title":"Transactions","text":"<ul> <li>Memory: Minimal overhead (stores snapshot only during transaction)</li> <li>Time: O(operations) for commit, O(N) for rollback</li> <li>Best For: Batch operations, ensuring atomicity</li> </ul>"},{"location":"concurrency-patterns/#recommendations","title":"Recommendations","text":"<ol> <li>For large graphs (10K+ nodes): Use snapshots sparingly, prefer transaction for safety</li> <li>For many concurrent readers: Create snapshots at intervals (e.g., every 5 minutes)</li> <li>For frequent writes: Use transactions to batch operations and reduce I/O</li> <li>For critical operations: Always use transactions to ensure atomicity</li> </ol>"},{"location":"concurrency-patterns/#example-multi-agent-coordination","title":"Example: Multi-Agent Coordination","text":"<pre><code>from htmlgraph import HtmlGraph\nfrom htmlgraph.models import Node\n\ngraph = HtmlGraph(\"features/\")\n\n# Agent 1: Analyze bottlenecks (uses snapshot for stable view)\ndef agent1_analyze():\n    snapshot = graph.snapshot()\n\n    # Long-running analysis\n    bottlenecks = []\n    for node in snapshot:\n        if len(snapshot.filter(lambda n: f\"blocked_by:{node.id}\" in str(n.edges))) &gt; 5:\n            bottlenecks.append(node.id)\n\n    return bottlenecks\n\n# Agent 2: Complete work atomically\ndef agent2_complete_work(feature_id):\n    with graph.transaction() as tx:\n        # Mark feature done\n        feature = graph.get(feature_id)\n        feature.status = \"done\"\n        tx.update(feature)\n\n        # Unblock dependents\n        for dependent_id in graph.dependents(feature_id):\n            dependent = graph.get(dependent_id)\n            dependent.edges[\"blocked_by\"] = [\n                e for e in dependent.edges.get(\"blocked_by\", [])\n                if e.target_id != feature_id\n            ]\n            tx.update(dependent)\n\n# Run concurrently (safe!)\nimport concurrent.futures\n\nwith concurrent.futures.ThreadPoolExecutor(max_workers=2) as executor:\n    future1 = executor.submit(agent1_analyze)\n    future2 = executor.submit(agent2_complete_work, \"feat-001\")\n\n    bottlenecks = future1.result()\n    future2.result()\n\n    print(f\"Found {len(bottlenecks)} bottlenecks while completing work\")\n</code></pre>"},{"location":"concurrency-patterns/#api-reference","title":"API Reference","text":""},{"location":"concurrency-patterns/#graphsnapshot","title":"GraphSnapshot","text":"<pre><code>class GraphSnapshot:\n    \"\"\"Immutable snapshot of graph state.\"\"\"\n\n    def get(self, node_id: str) -&gt; Node | None:\n        \"\"\"Get node by ID (returns copy).\"\"\"\n\n    def query(self, selector: str) -&gt; list[Node]:\n        \"\"\"Query with CSS selector (returns copies).\"\"\"\n\n    def filter(self, predicate: Callable[[Node], bool]) -&gt; list[Node]:\n        \"\"\"Filter with predicate (returns copies).\"\"\"\n\n    def __len__(self) -&gt; int:\n        \"\"\"Number of nodes in snapshot.\"\"\"\n\n    def __contains__(self, node_id: str) -&gt; bool:\n        \"\"\"Check if node exists.\"\"\"\n\n    def __iter__(self) -&gt; Iterator[Node]:\n        \"\"\"Iterate over nodes (returns copies).\"\"\"\n\n    @property\n    def nodes(self) -&gt; dict[str, Node]:\n        \"\"\"All nodes as dict (returns copies).\"\"\"\n</code></pre>"},{"location":"concurrency-patterns/#htmlgraph-transaction-methods","title":"HtmlGraph Transaction Methods","text":"<pre><code>class HtmlGraph:\n    def snapshot(self) -&gt; GraphSnapshot:\n        \"\"\"Create immutable snapshot of current state.\"\"\"\n\n    @contextmanager\n    def transaction(self):\n        \"\"\"\n        Context manager for atomic operations.\n\n        Yields TransactionContext with:\n        - add(node, overwrite=False)\n        - update(node)\n        - delete(node_id)\n        - remove(node_id)  # alias for delete\n        \"\"\"\n</code></pre>"},{"location":"concurrency-patterns/#testing","title":"Testing","text":"<p>Comprehensive tests are available in <code>tests/test_transaction_snapshot.py</code>:</p> <pre><code># Run transaction/snapshot tests\nuv run pytest tests/test_transaction_snapshot.py -v\n\n# Run all tests including concurrency scenarios\nuv run pytest tests/test_transaction_snapshot.py::TestConcurrencyScenarios -v\n</code></pre>"},{"location":"concurrency-patterns/#implementation-notes","title":"Implementation Notes","text":"<ul> <li>Snapshot immutability: Enforced through deep copying with <code>model_copy(deep=True)</code></li> <li>Transaction isolation: Not true ACID transactions (no file locking), but ensures memory consistency</li> <li>Rollback mechanism: Restores node dict, file hashes, and rebuilds indexes</li> <li>Thread safety: Not thread-safe across processes; use file locking for true multi-process safety</li> </ul>"},{"location":"concurrency-patterns/#future-enhancements","title":"Future Enhancements","text":"<p>Potential future improvements:</p> <ol> <li>File-level locking: Add fcntl-based locking for true multi-process safety</li> <li>Optimistic locking: ETags or version numbers to detect concurrent modifications</li> <li>Incremental snapshots: Only copy modified nodes since last snapshot</li> <li>Transaction log: Persist operations for replay/audit trail</li> <li>Read-write locks: Allow multiple concurrent readers with exclusive writers</li> </ol>"},{"location":"quickstart/","title":"Quick Start","text":"<p>Get up and running with HtmlGraph in 5 minutes.</p>"},{"location":"quickstart/#installation","title":"Installation","text":"<pre><code>pip install htmlgraph\n</code></pre>"},{"location":"quickstart/#initialize-your-project","title":"Initialize Your Project","text":"<pre><code># Create project directory\nmkdir my-project &amp;&amp; cd my-project\n\n# Initialize HtmlGraph\nhtmlgraph init --install-hooks\n\n# Start the dashboard\nhtmlgraph serve\n</code></pre> <p>This creates a <code>.htmlgraph/</code> directory with features, sessions, tracks, and events.</p>"},{"location":"quickstart/#basic-usage","title":"Basic Usage","text":""},{"location":"quickstart/#create-a-feature","title":"Create a Feature","text":"<pre><code>from htmlgraph import SDK\n\n# Initialize SDK (auto-discovers .htmlgraph directory)\nsdk = SDK(agent=\"claude\")\n\n# Create a feature with fluent API\nfeature = sdk.features.create(\"User Authentication\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Create login endpoint\",\n        \"Add JWT middleware\",\n        \"Write tests\"\n    ]) \\\n    .save()\n\nprint(f\"Created: {feature.id}\")\n# Output: Created: feature-20241216-103045\n</code></pre>"},{"location":"quickstart/#query-features","title":"Query Features","text":"<pre><code># Get high-priority todos\nhigh_priority = sdk.features.where(status=\"todo\", priority=\"high\")\nfor feat in high_priority:\n    print(f\"- {feat.title}\")\n\n# Get specific feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n</code></pre>"},{"location":"quickstart/#update-features","title":"Update Features","text":"<pre><code># Start working on a feature\nwith sdk.features.edit(feature.id) as f:\n    f.status = \"in-progress\"\n    f.steps[0].completed = True\n\n# Mark complete\nwith sdk.features.edit(feature.id) as f:\n    f.status = \"done\"\n</code></pre>"},{"location":"quickstart/#create-a-track","title":"Create a Track","text":"<p>For multi-feature projects, use TrackBuilder:</p> <pre><code>track = sdk.tracks.builder() \\\n    .title(\"OAuth Integration\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 support\",\n        requirements=[\n            (\"Google OAuth\", \"must-have\"),\n            (\"GitHub OAuth\", \"must-have\")\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: Setup\", [\n            \"Configure OAuth providers (2h)\",\n            \"Set up endpoints (1h)\"\n        ]),\n        (\"Phase 2: Implementation\", [\n            \"Implement Google OAuth (4h)\",\n            \"Implement GitHub OAuth (4h)\"\n        ])\n    ]) \\\n    .create()\n\nprint(f\"Created track: {track.track_id}\")\n# View at: .htmlgraph/tracks/{track.track_id}/index.html\n</code></pre>"},{"location":"quickstart/#cli-usage","title":"CLI Usage","text":"<pre><code># List features\nhtmlgraph feature list\n\n# Create feature\nhtmlgraph feature create \"Add OAuth support\" --priority high\n\n# Start feature\nhtmlgraph feature start feature-20241216-103045\n\n# Mark complete\nhtmlgraph feature complete feature-20241216-103045\n\n# View status\nhtmlgraph status\n</code></pre>"},{"location":"quickstart/#view-your-graph","title":"View Your Graph","text":"<p>All graph nodes are standard HTML files:</p> <pre><code># Open feature in browser\nopen .htmlgraph/features/feature-20241216-103045.html\n\n# Open track\nopen .htmlgraph/tracks/track-20241216-120000/index.html\n\n# Dashboard\nopen index.html\n</code></pre>"},{"location":"quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>API Reference - Complete SDK documentation</li> <li>Examples - Real-world use cases including agent coordination</li> <li>Getting Started Guide - In-depth concepts and workflows</li> </ul>"},{"location":"quickstart/#key-concepts","title":"Key Concepts","text":"<ul> <li>Features: Individual tasks or work items</li> <li>Tracks: Multi-feature initiatives with specs and plans</li> <li>Sessions: Automatic tracking of development activity</li> <li>SDK: Fluent Python API for managing the graph</li> <li>CLI: Command-line interface for quick operations</li> </ul>"},{"location":"quickstart/#important-notes","title":"Important Notes","text":"<p>Never edit HTML files directly! Always use the SDK, API, or CLI:</p> <pre><code># \u2705 CORRECT\nwith sdk.features.edit(\"feature-123\") as f:\n    f.status = \"done\"\n\n# \u274c WRONG - bypasses validation\nwith open(\".htmlgraph/features/feature-123.html\", \"w\") as f:\n    f.write(\"&lt;html&gt;...&lt;/html&gt;\")\n</code></pre> <p>Direct edits bypass Pydantic validation and break the SQLite index.</p>"},{"location":"sdk-cheat-sheet/","title":"HtmlGraph SDK Cheat Sheet","text":"<p>Quick reference for AI agents and developers.</p>"},{"location":"sdk-cheat-sheet/#initialization","title":"Initialization","text":"<pre><code>from htmlgraph import SDK\nsdk = SDK(agent=\"claude\")  # Auto-discovers .htmlgraph directory\n</code></pre>"},{"location":"sdk-cheat-sheet/#work-items","title":"Work Items","text":"Operation Features Bugs Spikes Create <code>sdk.features.create(\"Title\").save()</code> <code>sdk.bugs.create(\"Title\").save()</code> <code>sdk.spikes.create(\"Title\").save()</code> Get <code>sdk.features.get(id)</code> <code>sdk.bugs.get(id)</code> <code>sdk.spikes.get(id)</code> List <code>sdk.features.all()</code> <code>sdk.bugs.all()</code> <code>sdk.spikes.all()</code> Start <code>sdk.features.start(id)</code> <code>sdk.bugs.start(id)</code> <code>sdk.spikes.start(id)</code> Complete <code>sdk.features.complete(id)</code> <code>sdk.bugs.complete(id)</code> <code>sdk.spikes.complete(id)</code> Where <code>sdk.features.where(status=\"todo\")</code> <code>sdk.bugs.where(priority=\"high\")</code> <code>sdk.spikes.where(status=\"done\")</code> <p>Other Work Types: <code>sdk.chores</code>, <code>sdk.epics</code>, <code>sdk.phases</code> (same operations)</p>"},{"location":"sdk-cheat-sheet/#fluent-builder","title":"Fluent Builder","text":"<pre><code># Features\nfeature = sdk.features.create(\"Add Authentication\") \\\n    .set_priority(\"high\")      # high, medium, low\n    .set_status(\"in-progress\") # todo, in-progress, done\n    .add_steps([\"Design schema\", \"Implement API\", \"Add tests\"]) \\\n    .save()\n\n# Bugs\nbug = sdk.bugs.create(\"Login button broken\") \\\n    .set_priority(\"critical\") \\\n    .set_severity(\"high\") \\\n    .add_steps([\"Reproduce\", \"Fix\", \"Test\"]) \\\n    .save()\n\n# Spikes\nspike = sdk.spikes.create(\"Research auth options\") \\\n    .set_spike_type(\"architectural\") \\\n    .set_timebox_hours(4) \\\n    .add_steps([\"Research OAuth\", \"Compare providers\"]) \\\n    .save()\n</code></pre>"},{"location":"sdk-cheat-sheet/#orchestration","title":"Orchestration","text":"Method Purpose Returns <code>sdk.spawn_explorer(task, scope)</code> Research codebase <code>{prompt, description, subagent_type}</code> <code>sdk.spawn_coder(feature_id, context)</code> Implement changes <code>{prompt, description, subagent_type}</code> <code>sdk.orchestrate(feature_id, scope)</code> Full workflow <code>{explorer: {...}, coder: {...}}</code> <pre><code># Spawn explorer for research\nexplorer = sdk.spawn_explorer(\n    task=\"Find all database models\",\n    scope=\"src/models/\",\n    questions=[\"What ORM is used?\"]\n)\n# Use with: Task(prompt=explorer[\"prompt\"], description=explorer[\"description\"])\n\n# Spawn coder for implementation\ncoder = sdk.spawn_coder(\n    feature_id=\"feat-add-auth\",\n    context=\"Explorer found 3 models using SQLAlchemy\",\n    test_command=\"uv run pytest tests/auth/\"\n)\n\n# Full orchestration (2-phase: explore then code)\nprompts = sdk.orchestrate(\n    feature_id=\"feat-add-caching\",\n    exploration_scope=\"src/cache/\",\n    test_command=\"uv run pytest tests/cache/\"\n)\n# Returns: {explorer: {...}, coder: {...}, workflow: [...]}\n</code></pre>"},{"location":"sdk-cheat-sheet/#analytics","title":"Analytics","text":"<pre><code># Find blocking tasks\nbottlenecks = sdk.find_bottlenecks(top_n=5)\n# Returns: [{\"id\": \"feat-001\", \"title\": \"...\", \"blocking_count\": 3}, ...]\n\n# Get smart recommendations\nrecommendations = sdk.recommend_next_work(agent_count=1)\n# Returns: [{\"id\": \"feat-002\", \"title\": \"...\", \"reason\": \"unblocked\"}, ...]\n\n# Find parallelizable tasks\nparallel = sdk.get_parallel_work(max_agents=3)\n# Returns: {\"prompts\": [...], \"count\": 3, \"tasks\": [...]}\n</code></pre>"},{"location":"sdk-cheat-sheet/#session-management","title":"Session Management","text":"<pre><code># Get comprehensive session start info (1 call vs 6+)\ninfo = sdk.get_session_start_info()\n# Returns: {\n#   \"status\": {...},           # Project status\n#   \"active_work\": {...},      # Current WIP item\n#   \"features\": [...],         # All features\n#   \"sessions\": [...],         # Recent sessions\n#   \"git_log\": [...],          # Recent commits\n#   \"analytics\": {             # Strategic insights\n#     \"bottlenecks\": [...],\n#     \"recommendations\": [...],\n#     \"parallel_work\": {...}\n#   }\n# }\n\n# Check active work\nif info.get(\"active_work\"):\n    work = info[\"active_work\"]\n    print(f\"Working on: {work['title']}\")\n\n# End session with handoff\nsdk.end_session(\n    session_id=\"session-123\",\n    handoff_notes=\"Completed auth implementation, tests passing\"\n)\n</code></pre>"},{"location":"sdk-cheat-sheet/#planning-workflow","title":"Planning Workflow","text":"<pre><code># Smart planning with automated research\nplan = sdk.smart_plan(\n    goal=\"Add user authentication\",\n    scope=\"src/\",\n    max_parallel_spikes=3\n)\n# Auto-creates: Planning spike, research spikes, track with phases\n\n# Create track from plan\ntrack = sdk.create_track_from_plan(\n    plan_feature_id=\"feat-plan-auth\",\n    track_name=\"Authentication System\"\n)\n# Converts planning steps into track phases\n\n# Plan parallel work\nparallel_plan = sdk.plan_parallel_work(\n    feature_ids=[\"feat-001\", \"feat-002\", \"feat-003\"],\n    max_agents=3\n)\n# Returns prompts for parallel execution\n</code></pre>"},{"location":"sdk-cheat-sheet/#help","title":"Help","text":"<pre><code>sdk.help()              # List all topics\nsdk.help(\"features\")    # Feature-specific help\nsdk.help(\"orchestrate\") # Orchestration help\nsdk.help(\"analytics\")   # Analytics help\nsdk.help(\"planning\")    # Planning workflow help\n</code></pre>"},{"location":"sdk-cheat-sheet/#common-patterns","title":"Common Patterns","text":""},{"location":"sdk-cheat-sheet/#check-active-work","title":"Check Active Work","text":"<pre><code>info = sdk.get_session_start_info()\nif info.get(\"active_work\"):\n    work = info[\"active_work\"]\n    print(f\"Resume: {work['title']} ({work['status']})\")\nelse:\n    print(\"No active work, check recommendations\")\n    for rec in info[\"analytics\"][\"recommendations\"]:\n        print(f\"  - {rec['title']} ({rec['reason']})\")\n</code></pre>"},{"location":"sdk-cheat-sheet/#create-before-code","title":"Create Before Code","text":"<pre><code># Always create tracking before implementing\nfeature = sdk.features.create(\"Add authentication\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Design schema\", \"Implement API\", \"Add tests\"]) \\\n    .save()\n\n# Start work\nsdk.features.start(feature.id)\n\n# ... do implementation work ...\n\n# Complete when done\nsdk.features.complete(feature.id)\n</code></pre>"},{"location":"sdk-cheat-sheet/#parallel-subagents","title":"Parallel Subagents","text":"<pre><code># Get parallel work suggestions\nparallel = sdk.get_parallel_work(max_agents=3)\n\n# Spawn subagents for each task\nfor p in parallel[\"prompts\"]:\n    Task(\n        prompt=p[\"prompt\"],\n        subagent_type=p[\"subagent_type\"],\n        description=p[\"description\"]\n    )\n</code></pre>"},{"location":"sdk-cheat-sheet/#query-and-filter","title":"Query and Filter","text":"<pre><code># Get specific items\nhigh_priority = sdk.features.where(status=\"todo\", priority=\"high\")\ncritical_bugs = sdk.bugs.where(priority=\"critical\", status=\"todo\")\nactive_spikes = sdk.spikes.where(status=\"in-progress\")\n\n# Get all items\nall_features = sdk.features.all()\nall_chores = sdk.chores.all()\n\n# Iterate and process\nfor feature in high_priority:\n    print(f\"{feature.id}: {feature.title} - {feature.status}\")\n</code></pre>"},{"location":"sdk-cheat-sheet/#session-context","title":"Session Context","text":"<pre><code># Start of session - get full context\ninfo = sdk.get_session_start_info()\n\nprint(f\"Project: {info['status']['total_nodes']} total nodes\")\nprint(f\"WIP: {info['status']['in_progress_count']} in progress\")\n\n# Check git activity\nfor commit in info['git_log'][:3]:\n    print(f\"  {commit}\")\n\n# Check bottlenecks\nfor bn in info['analytics']['bottlenecks']:\n    print(f\"\u26a0\ufe0f  {bn['title']} (blocking {bn['blocking_count']} items)\")\n</code></pre>"},{"location":"sdk-cheat-sheet/#quick-tips","title":"Quick Tips","text":"<ul> <li>Always check return values: SDK methods return <code>None</code> or empty results on errors</li> <li>Use fluent builders: Chain methods for cleaner code</li> <li>Leverage analytics: Let SDK recommend what to work on next</li> <li>Track before implementing: Create features/bugs before coding</li> <li>Use session start info: Single call for comprehensive context</li> <li>Check active work first: Resume WIP before starting new tasks</li> <li>Orchestrate complex features: Use spawn_explorer \u2192 spawn_coder workflow</li> <li>Plan strategically: Use smart_plan for large initiatives</li> </ul>"},{"location":"sdk-cheat-sheet/#error-handling","title":"Error Handling","text":"<pre><code># Always check before using\nfeature = sdk.features.get(\"nonexistent\")\nif feature:\n    print(feature.title)\nelse:\n    print(\"Feature not found\")\n\n# Safe iteration\nfeatures = sdk.features.where(status=\"todo\")\nfor f in features:  # Empty list if none found\n    print(f.title)\n</code></pre>"},{"location":"sdk-cheat-sheet/#advanced-features","title":"Advanced Features","text":""},{"location":"sdk-cheat-sheet/#track-building","title":"Track Building","text":"<pre><code>from htmlgraph import TrackBuilder\n\ntrack = TrackBuilder(sdk, \"Authentication System\") \\\n    .add_phase(\"Research\", spike_ids=[\"spike-001\"]) \\\n    .add_phase(\"Implementation\", feature_ids=[\"feat-001\", \"feat-002\"]) \\\n    .add_phase(\"Testing\", feature_ids=[\"feat-003\"]) \\\n    .save()\n</code></pre>"},{"location":"sdk-cheat-sheet/#context-analytics","title":"Context Analytics","text":"<pre><code># Track context usage\nsdk.context.track_context_use(\n    event_id=\"evt-123\",\n    method_name=\"get_session_start_info\",\n    token_savings=5000\n)\n\n# Get savings report\nreport = sdk.context.get_context_savings()\n</code></pre>"},{"location":"sdk-cheat-sheet/#dependency-analysis","title":"Dependency Analysis","text":"<pre><code># Advanced graph analytics\ngraph = sdk.dep_analytics\n\n# Find circular dependencies\ncycles = graph.find_cycles()\n\n# Critical path analysis\ncritical = graph.find_critical_path(\"feat-001\", \"feat-020\")\n\n# Impact analysis\nimpact = graph.analyze_impact(\"feat-001\")\n</code></pre>"},{"location":"sdk-cheat-sheet/#see-also","title":"See Also","text":"<ul> <li>AGENTS.md - Complete SDK documentation</li> <li>PLANNING_WORKFLOW.md - Strategic planning guide</li> <li>PARALLEL_WORKFLOW.md - Parallel execution patterns</li> <li>SDK_ANALYTICS.md - Analytics deep-dive</li> </ul>"},{"location":"sdk-operations-implementation/","title":"SDK Operations Layer Implementation","text":"<p>Feature: <code>feat-0a49152e</code> Spike: <code>spk-562b0417</code> Date: 2025-01-02</p>"},{"location":"sdk-operations-implementation/#overview","title":"Overview","text":"<p>Added SDK wrapper methods for the operations layer (Wave 3, Task 1), exposing server, hooks, events, and analytics operations via the SDK for programmatic access.</p>"},{"location":"sdk-operations-implementation/#implementation","title":"Implementation","text":""},{"location":"sdk-operations-implementation/#1-server-operations","title":"1. Server Operations","text":"<pre><code># Start server\nresult = sdk.start_server(port=8080, watch=True, auto_port=False)\nprint(f\"Server at {result.handle.url}\")\n\n# Stop server\nsdk.stop_server(result.handle)\n\n# Check status\nstatus = sdk.get_server_status(result.handle)\n</code></pre> <p>Methods added: - <code>start_server()</code> - Start HtmlGraph web server - <code>stop_server()</code> - Stop running server - <code>get_server_status()</code> - Check server status</p>"},{"location":"sdk-operations-implementation/#2-hook-operations","title":"2. Hook Operations","text":"<pre><code># Install Git hooks\nresult = sdk.install_hooks(use_copy=False)\nprint(f\"Installed: {result.installed}\")\n\n# List hooks\nresult = sdk.list_hooks()\nprint(f\"Enabled: {result.enabled}\")\n\n# Validate configuration\nresult = sdk.validate_hook_config()\n</code></pre> <p>Methods added: - <code>install_hooks()</code> - Install Git hooks for tracking - <code>list_hooks()</code> - List hook status - <code>validate_hook_config()</code> - Validate hook configuration</p>"},{"location":"sdk-operations-implementation/#3-event-operations","title":"3. Event Operations","text":"<pre><code># Export sessions to JSONL\nresult = sdk.export_sessions(overwrite=False)\nprint(f\"Exported {result.written} sessions\")\n\n# Rebuild SQLite index\nresult = sdk.rebuild_event_index()\nprint(f\"Inserted {result.inserted} events\")\n\n# Query events\nresult = sdk.query_events(\n    session_id=\"sess-123\",\n    tool=\"Bash\",\n    limit=10\n)\n\n# Get statistics\nstats = sdk.get_event_stats()\n</code></pre> <p>Methods added: - <code>export_sessions()</code> - Export HTML sessions to JSONL - <code>rebuild_event_index()</code> - Rebuild SQLite index - <code>query_events()</code> - Query JSONL event logs - <code>get_event_stats()</code> - Get event statistics</p>"},{"location":"sdk-operations-implementation/#4-analytics-operations","title":"4. Analytics Operations","text":"<pre><code># Analyze session\nresult = sdk.analyze_session(\"sess-123\")\nprint(f\"Primary work: {result.metrics['primary_work_type']}\")\n\n# Analyze project\nresult = sdk.analyze_project()\nprint(f\"Total sessions: {result.metrics['total_sessions']}\")\n\n# Get recommendations\nresult = sdk.get_work_recommendations()\nfor rec in result.recommendations:\n    print(f\"{rec['title']} (score: {rec['score']})\")\n</code></pre> <p>Methods added: - <code>analyze_session()</code> - Analyze single session metrics - <code>analyze_project()</code> - Analyze project-wide metrics - <code>get_work_recommendations()</code> - Get work recommendations</p>"},{"location":"sdk-operations-implementation/#design-decisions","title":"Design Decisions","text":""},{"location":"sdk-operations-implementation/#1-thin-wrapper-pattern","title":"1. Thin Wrapper Pattern","text":"<p>SDK methods are thin wrappers that delegate directly to the operations layer:</p> <pre><code>def start_server(self, port: int = 8080, ...) -&gt; Any:\n    from htmlgraph.operations import server\n\n    return server.start_server(\n        port=port,\n        graph_dir=self._directory,\n        static_dir=self._directory.parent,\n        ...\n    )\n</code></pre> <p>Benefits: - Single source of truth (operations layer) - No logic duplication - Easy to maintain - Type hints preserved via operations layer</p>"},{"location":"sdk-operations-implementation/#2-return-type-annotations","title":"2. Return Type Annotations","text":"<p>Used <code>Any</code> return types for operations methods to avoid circular imports and keep SDK simple:</p> <pre><code>def analyze_session(self, session_id: str) -&gt; Any:\n    \"\"\"Returns AnalyticsSessionResult...\"\"\"\n</code></pre> <p>Rationale: - Operations layer defines concrete types - SDK doesn't need to import all operation types - Docstrings document expected return types - Users can import types from <code>htmlgraph.operations</code> if needed</p>"},{"location":"sdk-operations-implementation/#3-parameter-mapping","title":"3. Parameter Mapping","text":"<p>SDK methods match operations layer parameters but add sensible defaults:</p> <pre><code># Operations layer\ndef start_server(*, port: int, graph_dir: Path, ...)\n\n# SDK wrapper\ndef start_server(self, port: int = 8080, ...)\n    # Maps SDK state to operations parameters\n    return server.start_server(\n        port=port,\n        graph_dir=self._directory,  # From SDK state\n        ...\n    )\n</code></pre>"},{"location":"sdk-operations-implementation/#4-path-handling","title":"4. Path Handling","text":"<p>SDK automatically provides <code>graph_dir</code> and <code>project_dir</code> from internal state:</p> <pre><code># User doesn't need to know about paths\nsdk.install_hooks()\n\n# SDK maps to operations layer\nhooks.install_hooks(project_dir=self._directory.parent)\n</code></pre>"},{"location":"sdk-operations-implementation/#documentation","title":"Documentation","text":""},{"location":"sdk-operations-implementation/#1-help-system-integration","title":"1. Help System Integration","text":"<p>Added operations to main help text:</p> <pre><code>sdk.help()  # Lists operations methods\nsdk.help('operations')  # Detailed operations help\n</code></pre>"},{"location":"sdk-operations-implementation/#2-docstring-examples","title":"2. Docstring Examples","text":"<p>All methods have comprehensive docstrings with: - Parameter descriptions - Return type documentation - Usage examples - Related methods (\"See also\" sections)</p>"},{"location":"sdk-operations-implementation/#3-discovery-via-__dir__","title":"3. Discovery via <code>__dir__</code>","text":"<p>Added operations methods to priority list for auto-complete:</p> <pre><code>priority = [\n    # ...existing methods...\n    # Operations\n    \"start_server\",\n    \"install_hooks\",\n    \"export_sessions\",\n    \"analyze_project\",\n]\n</code></pre>"},{"location":"sdk-operations-implementation/#testing","title":"Testing","text":""},{"location":"sdk-operations-implementation/#integration-tests","title":"Integration Tests","text":"<p>Created <code>tests/test_sdk_operations.py</code> with 17 tests covering:</p> <ol> <li>Server Operations (3 tests)</li> <li><code>test_start_server</code> - Verifies wrapper calls operations layer correctly</li> <li><code>test_stop_server</code> - Verifies stop functionality</li> <li> <p><code>test_get_server_status</code> - Verifies status checking</p> </li> <li> <p>Hook Operations (3 tests)</p> </li> <li><code>test_install_hooks</code> - Verifies installation</li> <li><code>test_list_hooks</code> - Verifies listing</li> <li> <p><code>test_validate_hook_config</code> - Verifies validation</p> </li> <li> <p>Event Operations (4 tests)</p> </li> <li><code>test_export_sessions</code> - Verifies export</li> <li><code>test_rebuild_event_index</code> - Verifies index rebuild</li> <li><code>test_query_events</code> - Verifies querying</li> <li> <p><code>test_get_event_stats</code> - Verifies statistics</p> </li> <li> <p>Analytics Operations (3 tests)</p> </li> <li><code>test_analyze_session</code> - Verifies session analysis</li> <li><code>test_analyze_project</code> - Verifies project analysis</li> <li> <p><code>test_get_work_recommendations</code> - Verifies recommendations</p> </li> <li> <p>SDK Integration (4 tests)</p> </li> <li><code>test_sdk_has_all_operation_methods</code> - Verifies all methods exist</li> <li><code>test_operations_in_help</code> - Verifies help text</li> <li><code>test_operations_help_topic</code> - Verifies help topic</li> <li><code>test_operations_in_dir</code> - Verifies dir output</li> </ol> <p>All tests pass: \u2705 17/17</p>"},{"location":"sdk-operations-implementation/#type-checking","title":"Type Checking","text":"<p>Verified with mypy: <pre><code>uv run mypy src/python/htmlgraph/sdk.py\n# Success: no issues found\n</code></pre></p>"},{"location":"sdk-operations-implementation/#quality-gates-met","title":"Quality Gates Met","text":"<ul> <li> All operations exposed via SDK</li> <li> Docstrings with examples for each method</li> <li> Integration tests pass (17/17)</li> <li> Type hints correct (mypy passes)</li> <li> Imports from <code>htmlgraph.operations</code> only</li> <li> Help system updated</li> <li> dir method updated</li> </ul>"},{"location":"sdk-operations-implementation/#usage-examples","title":"Usage Examples","text":""},{"location":"sdk-operations-implementation/#starting-a-server","title":"Starting a Server","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Start server with auto-port selection\nresult = sdk.start_server(port=8080, auto_port=True, watch=True)\nprint(f\"Server running at {result.handle.url}\")\n\n# Open browser to view graph\nimport webbrowser\nwebbrowser.open(result.handle.url)\n\n# Stop when done\nsdk.stop_server(result.handle)\n</code></pre>"},{"location":"sdk-operations-implementation/#setting-up-hooks","title":"Setting Up Hooks","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Install hooks\nresult = sdk.install_hooks()\nprint(f\"Installed: {', '.join(result.installed)}\")\n\nif result.warnings:\n    print(f\"Warnings: {result.warnings}\")\n\n# Verify installation\nhooks = sdk.list_hooks()\nprint(f\"Enabled hooks: {hooks.enabled}\")\n</code></pre>"},{"location":"sdk-operations-implementation/#analyzing-project","title":"Analyzing Project","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get project analytics\nresult = sdk.analyze_project()\n\nprint(f\"Total sessions: {result.metrics['total_sessions']}\")\nprint(f\"Work distribution: {result.metrics['work_distribution']}\")\nprint(f\"Spike-to-feature ratio: {result.metrics['spike_to_feature_ratio']:.2f}\")\n\n# Get recommendations\nrecs = sdk.get_work_recommendations()\nprint(\"\\nRecommended work:\")\nfor rec in recs.recommendations[:5]:\n    print(f\"  {rec['title']} (score: {rec['score']:.2f})\")\n    print(f\"    Reasons: {', '.join(rec['reasons'])}\")\n</code></pre>"},{"location":"sdk-operations-implementation/#related-files","title":"Related Files","text":"<p>Modified: - <code>src/python/htmlgraph/sdk.py</code> - Added 13 new methods, updated help system</p> <p>Created: - <code>tests/test_sdk_operations.py</code> - Integration tests (17 tests) - <code>docs/sdk-operations-implementation.md</code> - This document</p> <p>Dependencies: - <code>src/python/htmlgraph/operations/__init__.py</code> - Operations layer exports - <code>src/python/htmlgraph/operations/server.py</code> - Server operations - <code>src/python/htmlgraph/operations/hooks.py</code> - Hook operations - <code>src/python/htmlgraph/operations/events.py</code> - Event operations - <code>src/python/htmlgraph/operations/analytics.py</code> - Analytics operations</p>"},{"location":"sdk-operations-implementation/#next-steps","title":"Next Steps","text":"<p>With SDK wrapper methods complete, users can now:</p> <ol> <li>Start servers programmatically instead of CLI only</li> <li>Install hooks via SDK for automated setup</li> <li>Export and query events for custom analytics</li> <li>Analyze sessions and projects for insights</li> </ol> <p>Future enhancements: - Add async variants for long-running operations - Add progress callbacks for exports/rebuilds - Add batch operations (e.g., analyze multiple sessions) - Add caching for frequently accessed analytics</p>"},{"location":"system-prompt-architecture-refactoring/","title":"System Prompt Architecture Refactoring","text":""},{"location":"system-prompt-architecture-refactoring/#executive-summary","title":"Executive Summary","text":"<p>System prompts are NOT static files stored in <code>.claude/system-prompt.md</code>. They are dynamically generated context injected via the SessionStart hook's <code>additionalContext</code> field. This architecture enables:</p> <ul> <li>Plugin-provided defaults - All users get orchestration guidance automatically</li> <li>Project-level customization - Teams can override defaults for their specific needs</li> <li>Graceful degradation - Works even if SDK or custom prompts aren't available</li> <li>Survival across compacts - Persists through Claude Code session compaction/resume cycles</li> </ul> <p>This document outlines the refactoring to make system prompt management a true publishable plugin feature.</p>"},{"location":"system-prompt-architecture-refactoring/#current-architecture-session-start-hook","title":"Current Architecture (Session-Start Hook)","text":""},{"location":"system-prompt-architecture-refactoring/#hook-flow","title":"Hook Flow","text":"<ol> <li>SessionStart Hook Triggered \u2192 Claude Code starts a session</li> <li>Hook Script Executes \u2192 <code>packages/claude-plugin/hooks/scripts/session-start.py</code></li> <li>Prompt Injection \u2192 System prompt loaded and wrapped in <code>additionalContext</code></li> <li>JSON Output \u2192 Hook returns JSON with <code>hookSpecificOutput.additionalContext</code></li> <li>Claude Receives Context \u2192 Prompt injected into session alongside other context</li> </ol>"},{"location":"system-prompt-architecture-refactoring/#current-implementation-lines-583-671-session-startpy","title":"Current Implementation (Lines 583-671, session-start.py)","text":"<pre><code>def load_system_prompt(project_dir: Path) -&gt; str | None:\n    \"\"\"Load system prompt from .claude/system-prompt.md\"\"\"\n    prompt_file = Path(project_dir) / \".claude\" / \"system-prompt.md\"\n    if not prompt_file.exists():\n        logger.warning(f\"System prompt not found: {prompt_file}\")\n        return None\n    try:\n        content = prompt_file.read_text(encoding=\"utf-8\")\n        logger.info(f\"Loaded system prompt ({len(content)} chars)\")\n        return content\n    except Exception as e:\n        logger.error(f\"Failed to load system prompt: {e}\")\n        return None\n\ndef inject_prompt_via_additionalcontext(prompt: str, source: str) -&gt; dict:\n    \"\"\"Create SessionStart hook output with system prompt injection.\"\"\"\n    context = f\"\"\"## SYSTEM PROMPT RESTORED (via SessionStart)\n...\n{prompt}\n...\n\"\"\"\n    output = {\n        \"hookSpecificOutput\": {\n            \"hookEventName\": \"SessionStart\",\n            \"additionalContext\": context,\n        }\n    }\n    return output\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#key-issues","title":"Key Issues","text":"<ol> <li>No Plugin Default - If <code>.claude/system-prompt.md</code> doesn't exist, users get no system prompt</li> <li>No SDK Support - No methods to create, validate, or manage system prompts programmatically</li> <li>Project-Specific - Only looks for project-level files, no plugin fallback</li> <li>Limited Validation - Token count validation exists but only logs warnings</li> <li>No Documentation - Users don't know how to customize or what should go in prompts</li> </ol>"},{"location":"system-prompt-architecture-refactoring/#proposed-architecture","title":"Proposed Architecture","text":""},{"location":"system-prompt-architecture-refactoring/#1-plugin-default-prompt","title":"1. Plugin Default Prompt","text":"<p>File: <code>packages/claude-plugin/.claude-plugin/system-prompt-default.md</code></p> <p>The default prompt is packaged WITH the plugin and available to ALL users when they install it. Contains:</p> <ul> <li>Delegation directives (Haiku for orchestration, etc.)</li> <li>Orchestration guidance (Task(), AskUserQuestion(), etc.)</li> <li>Model preferences (when to use Haiku vs Sonnet vs Opus)</li> <li>Quality gate requirements (ruff, mypy, pytest)</li> <li>Feature attribution instructions</li> <li>Key SDK patterns</li> </ul> <p>Size: ~350-400 tokens (leaves room for project customization)</p>"},{"location":"system-prompt-architecture-refactoring/#2-project-level-override","title":"2. Project-Level Override","text":"<p>File: <code>.claude/system-prompt.md</code> (optional)</p> <p>Users can OVERRIDE the plugin default with project-specific guidance:</p> <ul> <li>Project-specific patterns and conventions</li> <li>Team rules and standards</li> <li>Technology stack preferences</li> <li>Deployment and release procedures</li> <li>Project-specific tool configurations</li> </ul> <p>Strategy: - If <code>.claude/system-prompt.md</code> exists \u2192 Use it (override plugin default) - Else \u2192 Use plugin default - Graceful fallback if both missing</p>"},{"location":"system-prompt-architecture-refactoring/#3-hook-intelligence","title":"3. Hook Intelligence","text":"<p>Refactored session-start.py:</p> <pre><code>def load_system_prompt(project_dir: Path) -&gt; str | None:\n    \"\"\"\n    Load system prompt with intelligent fallback:\n    1. Check project-level override: .claude/system-prompt.md\n    2. Fall back to plugin default\n    3. Return None only if neither exists\n    \"\"\"\n    # Check project override first\n    project_override = Path(project_dir) / \".claude\" / \"system-prompt.md\"\n    if project_override.exists():\n        try:\n            content = project_override.read_text(encoding=\"utf-8\")\n            logger.info(f\"Loaded project system prompt ({len(content)} chars)\")\n            return content\n        except Exception as e:\n            logger.warning(f\"Failed to load project prompt: {e}\")\n            # Fall through to plugin default\n\n    # Fall back to plugin default\n    try:\n        plugin_default = Path(__file__).parent.parent / \"system-prompt-default.md\"\n        if plugin_default.exists():\n            content = plugin_default.read_text(encoding=\"utf-8\")\n            logger.info(f\"Loaded plugin default prompt ({len(content)} chars)\")\n            return content\n    except Exception as e:\n        logger.warning(f\"Failed to load plugin default: {e}\")\n\n    return None\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#4-sdk-support","title":"4. SDK Support","text":"<p>New File: <code>src/python/htmlgraph/system_prompts.py</code></p> <pre><code>class SystemPromptManager:\n    \"\"\"Manage system prompts for a project.\"\"\"\n\n    def __init__(self, graph_dir: Path):\n        self.graph_dir = graph_dir\n        self.project_dir = graph_dir.parent\n\n    def get_default(self) -&gt; str | None:\n        \"\"\"Get plugin default system prompt.\"\"\"\n        # Load from plugin package\n        pass\n\n    def get_project(self) -&gt; str | None:\n        \"\"\"Get project-level override if exists.\"\"\"\n        prompt_file = self.project_dir / \".claude\" / \"system-prompt.md\"\n        if prompt_file.exists():\n            return prompt_file.read_text()\n        return None\n\n    def get_active(self) -&gt; str | None:\n        \"\"\"Get active prompt (project override OR plugin default).\"\"\"\n        project_prompt = self.get_project()\n        if project_prompt:\n            return project_prompt\n        return self.get_default()\n\n    def create(self, name: str, template: str) -&gt; \"SystemPromptManager\":\n        \"\"\"Create a new system prompt from template.\"\"\"\n        self.project_dir.mkdir(parents=True, exist_ok=True)\n        claude_dir = self.project_dir / \".claude\"\n        claude_dir.mkdir(parents=True, exist_ok=True)\n\n        prompt_file = claude_dir / \"system-prompt.md\"\n        prompt_file.write_text(template)\n        return self\n\n    def validate(self, prompt_text: str | None = None) -&gt; dict:\n        \"\"\"\n        Validate system prompt.\n        Returns: {is_valid: bool, tokens: int, warnings: List[str]}\n        \"\"\"\n        text = prompt_text or self.get_active() or \"\"\n\n        try:\n            import tiktoken\n            encoding = tiktoken.encoding_for_model(\"gpt-4\")\n            tokens = len(encoding.encode(text))\n        except Exception:\n            tokens = max(1, len(text) // 4)  # Fallback estimate\n\n        warnings = []\n        if tokens &gt; 1000:\n            warnings.append(f\"Prompt exceeds 1000 tokens ({tokens})\")\n        if tokens &lt; 50:\n            warnings.append(\"Prompt is very short - may not provide enough guidance\")\n\n        return {\n            \"is_valid\": tokens &lt;= 1000 and tokens &gt; 50,\n            \"tokens\": tokens,\n            \"warnings\": warnings,\n        }\n</code></pre> <p>SDK Integration:</p> <pre><code>class SDK:\n    @property\n    def system_prompts(self) -&gt; SystemPromptManager:\n        \"\"\"Access system prompt management.\"\"\"\n        return SystemPromptManager(self.graph_dir)\n</code></pre> <p>Usage:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get active prompt (project override OR plugin default)\nactive_prompt = sdk.system_prompts.get_active()\n\n# Get plugin default\ndefault_prompt = sdk.system_prompts.get_default()\n\n# Create project override\nsdk.system_prompts.create(\n    \"project-specific\",\n    \"## Project Rules\\n...\"\n).validate()\n\n# Validate current prompt\nresult = sdk.system_prompts.validate()\nprint(f\"Tokens: {result['tokens']}\")\nprint(f\"Valid: {result['is_valid']}\")\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#deliverables","title":"Deliverables","text":""},{"location":"system-prompt-architecture-refactoring/#1-plugin-default-prompt_1","title":"1. Plugin Default Prompt","text":"<p>File: <code>packages/claude-plugin/.claude-plugin/system-prompt-default.md</code></p> <p>Content (~350-400 tokens):</p> <pre><code># System Prompt - HtmlGraph Default\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation | Efficiency &gt; verbosity\n\n## Orchestration Pattern\n- Use Task() tool for multi-session work, deep research, or complex reasoning\n- Delegate multi-file work to specialized subagents\n- Execute directly only for straightforward, single-file operations\n- Haiku: Default orchestrator (excellent at following delegation)\n- Sonnet/Opus: For deep reasoning (but tends to over-execute)\n\n## Model Guidance\n**Use Haiku (Default):**\n- Orchestration and delegation (excellent at following instructions)\n- Quick implementations and fixes (&lt;30 minutes)\n- Refactoring and cleanup\n- Following established patterns\n- File operations and searches\n- Cost-effective, responsive\n\n**Use Sonnet (Complex Reasoning):**\n- Architecture and design decisions\n- Complex algorithms and multi-step logic\n- Performance optimization\n- Security analysis and code review\n- When previous attempts failed\n\n**Use Opus (Novel Problems):**\n- Entirely new feature design\n- Deep research and investigation\n- Multi-step reasoning with unknowns\n- When Sonnet's attempt was insufficient\n\n## Context Persistence\nThis prompt auto-injects at session start via SessionStart hook.\nSurvives compact/resume cycles. Available as reference throughout your session.\n\n## HtmlGraph SDK Reference\n```python\n# Feature tracking\nsdk.features.create('Feature name').save()\n\n# Spike tracking (research, documentation)\nsdk.spikes.create('Investigation').set_findings('...').save()\n\n# System prompt management\nprompt = sdk.system_prompts.get_active()\nsdk.system_prompts.validate()\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#quality-gates","title":"Quality Gates","text":"<p>Before committing: <pre><code>uv run ruff check --fix &amp;&amp; uv run ruff format &amp;&amp; \\\nuv run mypy src/ &amp;&amp; uv run pytest\n</code></pre></p>"},{"location":"system-prompt-architecture-refactoring/#key-rules","title":"Key Rules","text":"<ol> <li>Always Read before Write/Edit/Update</li> <li>Use absolute paths only</li> <li>Use <code>uv run</code> for all Python execution</li> <li>Batch tool calls when independent</li> <li>Fix all errors before committing</li> <li>Research first, then implement</li> </ol>"},{"location":"system-prompt-architecture-refactoring/#quick-commands","title":"Quick Commands","text":"Task Command Tests <code>uv run pytest</code> Type Check <code>uv run mypy src/</code> Lint <code>uv run ruff check --fix</code> <p>Note: This is the plugin default. Projects can customize via <code>.claude/system-prompt.md</code> <pre><code>### 2. Refactored Hook Script\n\n**File:** `packages/claude-plugin/hooks/scripts/session-start.py`\n\nKey changes (lines 583-606):\n\n```python\ndef load_system_prompt(project_dir: Path) -&gt; str | None:\n    \"\"\"\n    Load system prompt with intelligent fallback:\n    1. Check project-level override (.claude/system-prompt.md)\n    2. Fall back to plugin default (system-prompt-default.md)\n    3. Return None only if neither exists\n    \"\"\"\n    # Strategy 1: Project-level override\n    project_override = Path(project_dir) / \".claude\" / \"system-prompt.md\"\n    if project_override.exists():\n        try:\n            content = project_override.read_text(encoding=\"utf-8\")\n            logger.info(f\"Loaded project system prompt ({len(content)} chars)\")\n            return content\n        except Exception as e:\n            logger.warning(f\"Failed to load project prompt: {e}\")\n            # Continue to plugin default fallback\n\n    # Strategy 2: Plugin default\n    try:\n        plugin_dir = Path(__file__).resolve().parent.parent.parent.parent\n        plugin_default = plugin_dir / \".claude-plugin\" / \"system-prompt-default.md\"\n\n        if plugin_default.exists():\n            content = plugin_default.read_text(encoding=\"utf-8\")\n            logger.info(f\"Loaded plugin default prompt ({len(content)} chars)\")\n            return content\n        else:\n            logger.debug(f\"Plugin default not found at {plugin_default}\")\n    except Exception as e:\n        logger.warning(f\"Failed to load plugin default: {e}\")\n\n    # No prompt available\n    logger.info(\"No system prompt found (project override or plugin default)\")\n    return None\n</code></pre></p>"},{"location":"system-prompt-architecture-refactoring/#3-sdk-methods","title":"3. SDK Methods","text":"<p>New File: <code>src/python/htmlgraph/system_prompts.py</code></p> <pre><code>\"\"\"System prompt management for projects.\"\"\"\n\nfrom pathlib import Path\nfrom typing import Optional\n\nfrom htmlgraph.exceptions import HtmlGraphException\n\n\nclass SystemPromptValidator:\n    \"\"\"Validate system prompts.\"\"\"\n\n    @staticmethod\n    def count_tokens(text: str) -&gt; int:\n        \"\"\"Estimate or count tokens in text.\"\"\"\n        try:\n            import tiktoken\n            encoding = tiktoken.encoding_for_model(\"gpt-4\")\n            return len(encoding.encode(text))\n        except Exception:\n            # Fallback: rough estimation (1 token \u2248 4 chars)\n            return max(1, len(text) // 4)\n\n    @staticmethod\n    def validate(text: str, max_tokens: int = 1000) -&gt; dict:\n        \"\"\"\n        Validate system prompt.\n\n        Args:\n            text: Prompt text to validate\n            max_tokens: Maximum allowed tokens\n\n        Returns:\n            {\n                \"is_valid\": bool,\n                \"tokens\": int,\n                \"warnings\": List[str],\n                \"message\": str\n            }\n        \"\"\"\n        tokens = SystemPromptValidator.count_tokens(text)\n        warnings = []\n\n        if tokens &gt; max_tokens:\n            warnings.append(\n                f\"Prompt exceeds budget: {tokens} &gt; {max_tokens} tokens\"\n            )\n        if tokens &lt; 50:\n            warnings.append(\"Prompt is very short - may not provide sufficient guidance\")\n        if len(text) &lt; 100:\n            warnings.append(\"Prompt is very brief - consider adding more detail\")\n\n        message = \"\"\n        if tokens &lt;= max_tokens and tokens &gt;= 50:\n            message = f\"Valid prompt: {tokens} tokens\"\n        elif tokens &gt; max_tokens:\n            message = f\"Invalid: {tokens} tokens exceeds {max_tokens} limit\"\n        else:\n            message = f\"Warning: {tokens} tokens is below recommended minimum (50)\"\n\n        return {\n            \"is_valid\": tokens &lt;= max_tokens and tokens &gt;= 50,\n            \"tokens\": tokens,\n            \"warnings\": warnings,\n            \"message\": message,\n        }\n\n\nclass SystemPromptManager:\n    \"\"\"Manage system prompts for a project.\"\"\"\n\n    def __init__(self, graph_dir: Path | str):\n        self.graph_dir = Path(graph_dir)\n        self.project_dir = self.graph_dir.parent\n        self.claude_dir = self.project_dir / \".claude\"\n\n    def get_default(self) -&gt; Optional[str]:\n        \"\"\"\n        Get plugin default system prompt.\n\n        Returns:\n            Default prompt text, or None if not found\n        \"\"\"\n        try:\n            # Try to load from installed package\n            from importlib.resources import files\n\n            plugin_resources = files(\"htmlgraph_plugin\").joinpath(\n                \".claude-plugin/system-prompt-default.md\"\n            )\n            if plugin_resources.is_file():\n                return plugin_resources.read_text()\n        except Exception:\n            pass\n\n        # Fallback: Try relative path from package\n        try:\n            # When installed via pip\n            import htmlgraph_plugin\n            plugin_path = Path(htmlgraph_plugin.__file__).parent\n            default_file = plugin_path / \".claude-plugin\" / \"system-prompt-default.md\"\n            if default_file.exists():\n                return default_file.read_text()\n        except Exception:\n            pass\n\n        return None\n\n    def get_project(self) -&gt; Optional[str]:\n        \"\"\"\n        Get project-level system prompt override.\n\n        Returns:\n            Project prompt if exists, None otherwise\n        \"\"\"\n        prompt_file = self.claude_dir / \"system-prompt.md\"\n        if prompt_file.exists():\n            try:\n                return prompt_file.read_text(encoding=\"utf-8\")\n            except Exception as e:\n                raise HtmlGraphException(\n                    f\"Failed to read project system prompt: {e}\"\n                )\n        return None\n\n    def get_active(self) -&gt; Optional[str]:\n        \"\"\"\n        Get active system prompt (project override OR plugin default).\n\n        Strategy:\n        1. If project override exists \u2192 use it\n        2. Else if plugin default exists \u2192 use it\n        3. Else \u2192 return None\n\n        Returns:\n            Active prompt text, or None if neither available\n        \"\"\"\n        project = self.get_project()\n        if project:\n            return project\n        return self.get_default()\n\n    def create(\n        self,\n        template: str,\n        overwrite: bool = False\n    ) -&gt; \"SystemPromptManager\":\n        \"\"\"\n        Create or update project system prompt.\n\n        Args:\n            template: Prompt template text\n            overwrite: Whether to overwrite existing prompt\n\n        Returns:\n            Self for chaining\n\n        Raises:\n            HtmlGraphException: If file exists and overwrite=False\n        \"\"\"\n        self.claude_dir.mkdir(parents=True, exist_ok=True)\n        prompt_file = self.claude_dir / \"system-prompt.md\"\n\n        if prompt_file.exists() and not overwrite:\n            raise HtmlGraphException(\n                f\"System prompt already exists at {prompt_file}. \"\n                f\"Use overwrite=True to replace.\"\n            )\n\n        try:\n            prompt_file.write_text(template, encoding=\"utf-8\")\n        except Exception as e:\n            raise HtmlGraphException(f\"Failed to write system prompt: {e}\")\n\n        return self\n\n    def validate(self, text: Optional[str] = None, max_tokens: int = 1000) -&gt; dict:\n        \"\"\"\n        Validate a system prompt.\n\n        Args:\n            text: Prompt to validate (uses active if None)\n            max_tokens: Maximum allowed tokens (default 1000)\n\n        Returns:\n            Validation result dict\n        \"\"\"\n        prompt_text = text or self.get_active() or \"\"\n        return SystemPromptValidator.validate(prompt_text, max_tokens)\n\n    def delete(self) -&gt; bool:\n        \"\"\"\n        Delete project system prompt override.\n\n        Returns:\n            True if deleted, False if didn't exist\n        \"\"\"\n        prompt_file = self.claude_dir / \"system-prompt.md\"\n        if prompt_file.exists():\n            try:\n                prompt_file.unlink()\n                return True\n            except Exception as e:\n                raise HtmlGraphException(f\"Failed to delete prompt: {e}\")\n        return False\n\n\n# Integration with SDK\ndef _get_system_prompts_manager(sdk: \"SDK\") -&gt; SystemPromptManager:\n    \"\"\"Get system prompt manager from SDK.\"\"\"\n    return SystemPromptManager(sdk.graph_dir)\n</code></pre> <p>SDK Integration (sdk.py):</p> <pre><code># Add to SDK class\n@property\ndef system_prompts(self) -&gt; SystemPromptManager:\n    \"\"\"\n    Access system prompt management.\n\n    Usage:\n        sdk = SDK(agent=\"claude\")\n\n        # Get active prompt\n        prompt = sdk.system_prompts.get_active()\n\n        # Create project override\n        sdk.system_prompts.create(\"## Custom prompt\")\n\n        # Validate\n        result = sdk.system_prompts.validate()\n    \"\"\"\n    from htmlgraph.system_prompts import SystemPromptManager\n    return SystemPromptManager(self.graph_dir)\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#4-documentation","title":"4. Documentation","text":"<p>New File: <code>docs/system-prompt-customization-guide.md</code></p> <pre><code># System Prompt Customization Guide\n\n## Overview\n\nHtmlGraph uses system prompts to guide AI agent behavior. Prompts are injected at session start via the SessionStart hook and survive compact/resume cycles.\n\n**Two-tier system:**\n1. **Plugin Default** - Included with HtmlGraph plugin, available to all users\n2. **Project Override** - Optional, project-specific customization\n\n## Plugin Default Prompt\n\nAll users get the plugin default automatically when they install the HtmlGraph plugin.\n\n**Includes:**\n- Delegation directives (using Task(), AskUserQuestion(), etc.)\n- Model guidance (when to use Haiku vs Sonnet vs Opus)\n- Orchestration patterns\n- Quality gate requirements\n- SDK usage patterns\n\n**Location in plugin:** `.claude-plugin/system-prompt-default.md`\n\n## Creating Project Override\n\nProjects can customize the prompt for team-specific needs.\n\n### 1. Create .claude/system-prompt.md\n\n```bash\nmkdir -p .claude\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - MyProject\n\n## Primary Rule\nCode &gt; documentation | Quality gates non-negotiable\n\n## Team Standards\n- All PRs require 2 approvals\n- Tests must pass before merge\n- No debug code in commits\n\n## Tech Stack Preferences\n- Use TypeScript, not JavaScript\n- Prefer async/await over promises\n- Always use strict mode\n\n## Deployment Process\n1. Update version in package.json\n2. Run `npm run build &amp;&amp; npm run test`\n3. Create PR with changelog\n4. After merge: `npm run deploy`\n\n## Project-Specific Commands\n| Task | Command |\n|------|---------|\n| Dev | `npm run dev` |\n| Tests | `npm run test -- --coverage` |\n| Build | `npm run build` |\n| Deploy | `npm run deploy` |\nEOF\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#2-using-sdk-to-create-prompt","title":"2. Using SDK to Create Prompt","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Read a template from project\nwith open(\"docs/system-prompt-template.md\") as f:\n    template = f.read()\n\n# Create project override\nsdk.system_prompts.create(template, overwrite=True)\n\n# Validate\nresult = sdk.system_prompts.validate()\nprint(f\"Tokens: {result['tokens']}\")\nprint(f\"Valid: {result['is_valid']}\")\nfor warning in result['warnings']:\n    print(f\"  - {warning}\")\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#3-validate-prompt","title":"3. Validate Prompt","text":"<pre><code># Via SDK\nuv run python -c \"\nfrom htmlgraph import SDK\nsdk = SDK(agent='claude')\nresult = sdk.system_prompts.validate()\nprint(result['message'])\nfor w in result['warnings']:\n    print(f'  Warning: {w}')\n\"\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#what-to-include-in-project-override","title":"What to Include in Project Override","text":""},{"location":"system-prompt-architecture-refactoring/#project-rules-standards","title":"Project Rules &amp; Standards","text":"<pre><code>## Coding Standards\n- Linting: ruff\n- Type checking: mypy\n- Code formatting: black\n- Testing: pytest\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#technology-preferences","title":"Technology Preferences","text":"<pre><code>## Tech Stack\n- Python 3.11+\n- FastAPI for APIs\n- SQLAlchemy for ORM\n- Pydantic for validation\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#deployment-process","title":"Deployment Process","text":"<pre><code>## Release Checklist\n1. Update version in setup.py\n2. Run tests: pytest --cov\n3. Build: python -m build\n4. Publish: twine upload dist/\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#team-workflow","title":"Team Workflow","text":"<pre><code>## Git Workflow\n- Feature branches: feature/name\n- Bug branches: bugfix/issue-id\n- PR titles: \"feat:\", \"fix:\", \"docs:\"\n- Squash commits before merge\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#project-specific-tools","title":"Project-Specific Tools","text":"<pre><code>## CI/CD Commands\n| Task | Command |\n|------|---------|\n| Lint | make lint |\n| Test | make test |\n| Deploy Staging | make deploy-staging |\n| Deploy Prod | make deploy-prod |\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#examples","title":"Examples","text":""},{"location":"system-prompt-architecture-refactoring/#example-1-python-data-science-project","title":"Example 1: Python Data Science Project","text":"<pre><code># System Prompt - DataLab\n\n## Primary Focus\n- Jupyter notebooks for exploration\n- Production code in src/\n- Reproducible experiments\n\n## Environment Setup\n- Python 3.10+ with conda\n- Dependencies in environment.yml\n- Install dev tools: pip install -e \".[dev]\"\n\n## Workflow\n1. Exploration: Jupyter notebooks in notebooks/\n2. Implementation: src/ with proper modules\n3. Testing: pytest in tests/\n4. Documentation: docs/ with auto-generated API docs\n\n## Commands\n| Task | Command |\n|------|---------|\n| Notebooks | jupyter notebook |\n| Tests | pytest -v --cov=src |\n| Lint | flake8 src/ |\n| Type Check | mypy src/ |\n| Build Docs | sphinx-build -b html docs/ docs/_build/ |\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#example-2-nodejstypescript-project","title":"Example 2: Node.js/TypeScript Project","text":"<pre><code># System Prompt - WebApp\n\n## Stack\n- Node 18+, TypeScript 5\n- Next.js for frontend\n- NestJS for backend\n- PostgreSQL + Prisma\n\n## Quality Gates\nBefore merge:\n- Tests pass: `npm run test`\n- No lint errors: `npm run lint`\n- Type safe: `npm run type-check`\n- E2E tests: `npm run test:e2e`\n\n## Feature Workflow\n1. Create feature branch from main\n2. Implement + tests\n3. Create PR with linked issue\n4. Require 2 approvals\n5. Run e2e tests in staging\n6. Merge with squash\n\n## Deployment\nAutomatic on merge to main:\n1. Build and test (GitHub Actions)\n2. Deploy to staging\n3. Run e2e tests\n4. Deploy to production (manual approval)\n</code></pre>"},{"location":"system-prompt-architecture-refactoring/#faq","title":"FAQ","text":""},{"location":"system-prompt-architecture-refactoring/#q-what-if-both-project-and-plugin-prompts-exist","title":"Q: What if both project and plugin prompts exist?","text":"<p>A: Project override takes precedence. The hook loads project first, then falls back to plugin default.</p>"},{"location":"system-prompt-architecture-refactoring/#q-how-large-can-my-system-prompt-be","title":"Q: How large can my system prompt be?","text":"<p>A: Recommended limit is 1000 tokens. SDK validation warns above this threshold.</p>"},{"location":"system-prompt-architecture-refactoring/#q-can-i-include-multi-line-code-blocks","title":"Q: Can I include multi-line code blocks?","text":"<p>A: Yes, use standard markdown code blocks. Token count includes all text.</p>"},{"location":"system-prompt-architecture-refactoring/#q-how-do-i-reset-to-plugin-default","title":"Q: How do I reset to plugin default?","text":"<p>A: Delete <code>.claude/system-prompt.md</code>: <pre><code>rm .claude/system-prompt.md\n</code></pre></p>"},{"location":"system-prompt-architecture-refactoring/#q-does-the-prompt-survive-session-compacts","title":"Q: Does the prompt survive session compacts?","text":"<p>A: Yes. The SessionStart hook re-injects the prompt at every session start, including after compacts and resume cycles.</p>"},{"location":"system-prompt-architecture-refactoring/#q-can-i-version-control-the-system-prompt","title":"Q: Can I version control the system prompt?","text":"<p>A: Yes. Commit <code>.claude/system-prompt.md</code> to git for team standardization.</p>"},{"location":"system-prompt-architecture-refactoring/#troubleshooting","title":"Troubleshooting","text":""},{"location":"system-prompt-architecture-refactoring/#prompt-not-loading","title":"Prompt Not Loading","text":"<ol> <li>Check file exists: <code>ls -la .claude/system-prompt.md</code></li> <li>Check permissions: <code>chmod 644 .claude/system-prompt.md</code></li> <li>Validate syntax: <code>uv run python -c \"from htmlgraph import SDK; SDK().system_prompts.validate()\"</code></li> <li>Check logs: Look for \"System prompt\" lines in session logs</li> </ol>"},{"location":"system-prompt-architecture-refactoring/#token-count-too-high","title":"Token Count Too High","text":"<ol> <li>Remove redundant sections</li> <li>Use shorter section headers</li> <li>Replace examples with links to documentation</li> <li>Consider separate prompt files for different use cases</li> </ol>"},{"location":"system-prompt-architecture-refactoring/#plugin-default-not-used","title":"Plugin Default Not Used","text":"<ol> <li>Verify plugin installed: <code>claude plugin list | grep htmlgraph</code></li> <li>Check plugin version: <code>claude plugin status htmlgraph</code></li> <li>Update plugin: <code>claude plugin update htmlgraph</code></li> </ol>"},{"location":"system-prompt-architecture-refactoring/#see-also","title":"See Also","text":"<ul> <li><code>/system-prompt-architecture-refactoring.md</code> - Technical architecture</li> <li><code>/AGENTS.md</code> - HtmlGraph SDK reference</li> <li><code>.claude/system-prompt.md</code> - This project's system prompt <pre><code>---\n\n## Implementation Timeline\n\n### Phase 1: Core Infrastructure (2-3 hours)\n\n1. **Create plugin default prompt** (30 min)\n   - `packages/claude-plugin/.claude-plugin/system-prompt-default.md`\n   - Delegation directives, model guidance, quality gates\n\n2. **Refactor hook script** (45 min)\n   - Implement intelligent fallback logic\n   - Load project override OR plugin default\n   - Test both paths\n\n3. **Create SDK module** (60 min)\n   - `src/python/htmlgraph/system_prompts.py`\n   - SystemPromptManager class\n   - SystemPromptValidator utilities\n\n4. **SDK integration** (15 min)\n   - Add `system_prompts` property to SDK class\n   - Update SDK imports\n\n### Phase 2: Documentation &amp; Testing (1-2 hours)\n\n5. **Create customization guide** (45 min)\n   - `docs/system-prompt-customization-guide.md`\n   - Examples for different project types\n   - FAQ and troubleshooting\n\n6. **Write unit tests** (30 min)\n   - Test SystemPromptManager methods\n   - Test fallback logic\n   - Test validation\n\n7. **Integration testing** (15 min)\n   - Verify hook loads plugin default\n   - Verify project override takes precedence\n   - Verify SDK methods work\n\n### Phase 3: Deployment &amp; Packaging (30 min)\n\n8. **Update plugin packaging**\n   - Ensure `system-prompt-default.md` included in plugin distribution\n   - Verify plugin.json includes plugin resources\n\n9. **Create changelog entry**\n   - Document new system prompt feature\n   - Link to customization guide\n\n---\n\n## Success Criteria\n\n\u2705 **Plugin Provides Default Prompt**\n- Plugin default available to all users\n- No manual setup required\n- Works even without `.claude/system-prompt.md`\n\n\u2705 **Project-Level Customization**\n- Users can create `.claude/system-prompt.md`\n- Override automatically takes precedence\n- Falls back gracefully if missing\n\n\u2705 **Hook Intelligence**\n- Hook loads project override if exists\n- Hook loads plugin default if no override\n- No errors if neither available\n\n\u2705 **SDK Support**\n- Methods to get, create, validate prompts\n- Token counting (exact or estimated)\n- Integration with feature tracking\n\n\u2705 **Graceful Degradation**\n- Works without SDK installed\n- Works without htmlgraph module\n- Works without custom prompts\n\n\u2705 **Documentation**\n- Customization guide with examples\n- FAQ addressing common questions\n- Troubleshooting section\n\n\u2705 **All Tests Pass**\n- Existing tests still pass\n- New tests cover system prompt logic\n- No regressions\n\n---\n\n## Risk Mitigation\n\n### Risk: Plugin Default Not Found at Runtime\n\n**Mitigation:**\n- Fallback to inline default in hook script as last resort\n- Log clear warnings when default unavailable\n- Non-blocking - session continues without prompt injection\n\n### Risk: Project Prompt Exceeds Token Budget\n\n**Mitigation:**\n- Validate token count before injection\n- Warn user but inject anyway (graceful degradation)\n- Provide token counting tool via SDK\n\n### Risk: Breaking Existing Projects\n\n**Mitigation:**\n- Existing `.claude/system-prompt.md` files continue to work\n- No changes to existing API\n- Fully backward compatible\n\n### Risk: Performance Impact\n\n**Mitigation:**\n- Prompt loading happens once per session (minimal overhead)\n- Caching at hook script level\n- No impact on subsequent tool executions\n\n---\n\n## Future Enhancements\n\n### 1. Multiple Prompt Variants\n\nSupport different prompts for different model types:\n```python\n# Load appropriate prompt for model\nprompt = sdk.system_prompts.get_for_model(\"gpt-4\")\nprompt = sdk.system_prompts.get_for_model(\"claude-opus\")\n</code></pre></li> </ul>"},{"location":"system-prompt-architecture-refactoring/#2-prompt-templates-library","title":"2. Prompt Templates Library","text":"<p>Built-in templates for common project types: <pre><code># Create from template\nsdk.system_prompts.from_template(\"typescript-react\")\nsdk.system_prompts.from_template(\"python-fastapi\")\n</code></pre></p>"},{"location":"system-prompt-architecture-refactoring/#3-prompt-composition","title":"3. Prompt Composition","text":"<p>Combine multiple prompt files: <pre><code># Load and merge multiple prompts\nsdk.system_prompts.compose([\n    \"base.md\",          # Common rules\n    \"team.md\",          # Team standards\n    \"project.md\"        # Project-specific\n])\n</code></pre></p>"},{"location":"system-prompt-architecture-refactoring/#4-prompt-analytics","title":"4. Prompt Analytics","text":"<p>Track which prompts are most effective: <pre><code># Analyze prompt effectiveness\nanalytics = sdk.system_prompts.analyze()\nprint(analytics.feature_completion_rate)\nprint(analytics.error_reduction)\n</code></pre></p>"},{"location":"system-prompt-architecture-refactoring/#conclusion","title":"Conclusion","text":"<p>This refactoring makes system prompt management a publishable plugin feature while maintaining backward compatibility and graceful degradation. Users get professional orchestration guidance out-of-the-box, with the option to customize for their specific needs.</p> <p>The two-tier system (plugin default + project override) provides the right balance between: - Ease of use - Default available to everyone - Flexibility - Teams can customize - Robustness - Graceful fallback if anything missing - Observability - SDK support for programmatic management</p>"},{"location":"system-prompt-customization-guide/","title":"System Prompt Customization Guide","text":""},{"location":"system-prompt-customization-guide/#overview","title":"Overview","text":"<p>HtmlGraph uses system prompts to guide AI agent behavior. Prompts are injected at session start via the SessionStart hook and survive Claude Code compact/resume cycles.</p> <p>Two-tier system:</p> <ol> <li>Plugin Default - Included with HtmlGraph plugin, automatically available to all users</li> <li>Project Override - Optional, project-specific customization via <code>.claude/system-prompt.md</code></li> </ol>"},{"location":"system-prompt-customization-guide/#how-it-works","title":"How It Works","text":""},{"location":"system-prompt-customization-guide/#architecture","title":"Architecture","text":"<p>System prompts are NOT stored as static configuration. Instead:</p> <ol> <li>SessionStart Hook triggers when Claude Code starts a session</li> <li>Hook script loads the active system prompt (project override OR plugin default)</li> <li>Prompt is injected into session via <code>additionalContext</code> in hook JSON output</li> <li>Claude receives the prompt alongside other session context</li> <li>Prompt persists across compact/resume cycles (re-injected on each session start)</li> </ol>"},{"location":"system-prompt-customization-guide/#fallback-strategy","title":"Fallback Strategy","text":"<p>The hook uses an intelligent fallback strategy:</p> <pre><code>Session Starts\n    \u2193\nCheck: .claude/system-prompt.md exists?\n    \u251c\u2500 YES \u2192 Use project override\n    \u2514\u2500 NO \u2192 Check: Plugin default exists?\n            \u251c\u2500 YES \u2192 Use plugin default\n            \u2514\u2500 NO \u2192 Continue without system prompt (graceful degradation)\n</code></pre>"},{"location":"system-prompt-customization-guide/#plugin-default-prompt","title":"Plugin Default Prompt","text":"<p>All users get the plugin default automatically when they install the HtmlGraph plugin.</p> <p>Location: <code>.claude-plugin/system-prompt-default.md</code> (in plugin package)</p> <p>Includes: - Delegation directives (using Task(), AskUserQuestion(), etc.) - Model guidance (when to use Haiku vs Sonnet vs Opus) - Orchestration patterns - Quality gate requirements (ruff, mypy, pytest) - SDK usage patterns - Key development rules</p> <p>Size: ~350-400 tokens (leaves room for project customization)</p>"},{"location":"system-prompt-customization-guide/#creating-project-override","title":"Creating Project Override","text":"<p>Projects can customize the default prompt for team-specific needs.</p>"},{"location":"system-prompt-customization-guide/#option-1-manual-file-creation","title":"Option 1: Manual File Creation","text":"<pre><code># Create .claude directory\nmkdir -p .claude\n\n# Create system-prompt.md\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - MyProject\n\n## Primary Rule\nCode &gt; documentation | Quality gates non-negotiable\n\n## Team Standards\n- All PRs require 2 approvals\n- Tests must pass before merge\n- No debug code in commits\n\n## Tech Stack Preferences\n- Use TypeScript, not JavaScript\n- Prefer async/await over promises\n- Always use strict mode\n\n## Deployment Process\n1. Update version in package.json\n2. Run `npm run build &amp;&amp; npm run test`\n3. Create PR with changelog\n4. After merge: `npm run deploy`\n\n## Project-Specific Commands\n| Task | Command |\n|------|---------|\n| Dev | `npm run dev` |\n| Tests | `npm run test -- --coverage` |\n| Build | `npm run build` |\n| Deploy | `npm run deploy` |\nEOF\n\n# Verify\ncat .claude/system-prompt.md\n</code></pre>"},{"location":"system-prompt-customization-guide/#option-2-using-sdk","title":"Option 2: Using SDK","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Read a template from project\nwith open(\"docs/system-prompt-template.md\") as f:\n    template = f.read()\n\n# Create project override\nsdk.system_prompts.create(template, overwrite=False)\n\n# Validate\nresult = sdk.system_prompts.validate()\nprint(result['message'])\nif result['warnings']:\n    for warning in result['warnings']:\n        print(f\"  Warning: {warning}\")\n</code></pre>"},{"location":"system-prompt-customization-guide/#option-3-programmatic-generation","title":"Option 3: Programmatic Generation","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Generate custom prompt\ncustom_prompt = \"\"\"# System Prompt - DataLab\n\n## Stack\n- Python 3.10+ with conda\n- Jupyter notebooks for exploration\n- Production code in src/\n\n## Commands\n| Task | Command |\n|------|---------|\n| Test | pytest -v --cov=src |\n| Notebook | jupyter notebook |\n| Build Docs | sphinx-build -b html docs/ docs/_build/ |\n\"\"\"\n\nsdk.system_prompts.create(custom_prompt)\n</code></pre>"},{"location":"system-prompt-customization-guide/#validating-your-prompt","title":"Validating Your Prompt","text":""},{"location":"system-prompt-customization-guide/#via-sdk","title":"Via SDK","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Validate active prompt\nresult = sdk.system_prompts.validate()\nprint(result['message'])\nprint(f\"Tokens: {result['tokens']}\")\nprint(f\"Valid: {result['is_valid']}\")\n\n# Validate specific text\nresult = sdk.system_prompts.validate(\"## My Prompt\\n...\")\n\n# Check what's actually in use\nstats = sdk.system_prompts.get_stats()\nprint(f\"Source: {stats['source']}\")  # \"project_override\" or \"plugin_default\" or \"none\"\n</code></pre>"},{"location":"system-prompt-customization-guide/#via-command-line","title":"Via Command Line","text":"<pre><code># Check token count and validity\nuv run python -c \"\nfrom htmlgraph import SDK\nsdk = SDK(agent='claude')\nresult = sdk.system_prompts.validate()\nprint(result['message'])\nfor w in result['warnings']:\n    print(f'  Warning: {w}')\n\"\n\n# Get statistics\nuv run python -c \"\nfrom htmlgraph import SDK\nstats = SDK().system_prompts.get_stats()\nprint(f'Source: {stats[\\\"source\\\"]}')\nprint(f'Tokens: {stats[\\\"tokens\\\"]}')\n\"\n</code></pre>"},{"location":"system-prompt-customization-guide/#what-to-include-in-project-override","title":"What to Include in Project Override","text":""},{"location":"system-prompt-customization-guide/#1-project-rules-standards","title":"1. Project Rules &amp; Standards","text":"<pre><code>## Coding Standards\n- Linting: ruff\n- Type checking: mypy\n- Code formatting: black\n- Testing: pytest with minimum 80% coverage\n- No type: ignore comments without justification\n</code></pre>"},{"location":"system-prompt-customization-guide/#2-technology-preferences","title":"2. Technology Preferences","text":"<pre><code>## Tech Stack\n- Python 3.11+\n- FastAPI for APIs\n- SQLAlchemy 2.0+ for ORM\n- Pydantic v2 for validation\n- PostgreSQL 14+ for data storage\n\n## Dependencies\n- Prefer standard library over external deps\n- Pin versions in requirements.txt\n- Regular security audits\n</code></pre>"},{"location":"system-prompt-customization-guide/#3-deployment-process","title":"3. Deployment Process","text":"<pre><code>## Release Checklist\n1. Bump version in setup.py\n2. Update CHANGELOG.md\n3. Run tests: pytest --cov\n4. Build: python -m build\n5. Create git tag: git tag vX.Y.Z\n6. Publish: twine upload dist/\n7. Verify on PyPI\n\n## Rollback Process\nIf critical issue found:\n1. Yank release: twine yank package-name VERSION\n2. Fix issue\n3. Bump patch version\n4. Re-publish\n</code></pre>"},{"location":"system-prompt-customization-guide/#4-team-workflow","title":"4. Team Workflow","text":"<pre><code>## Git Workflow\n- Feature branches: feature/name\n- Bug branches: bugfix/issue-id\n- PR titles: \"feat:\", \"fix:\", \"docs:\", \"refactor:\"\n- Always squash commits before merge\n- Require 2+ approvals before merge\n- Delete branch after merge\n</code></pre>"},{"location":"system-prompt-customization-guide/#5-project-specific-tools","title":"5. Project-Specific Tools","text":"<pre><code>## CI/CD Commands\n| Task | Command |\n|------|---------|\n| Lint | make lint |\n| Test | make test |\n| Coverage | make coverage |\n| Build | make build |\n| Deploy Staging | make deploy-staging |\n| Deploy Prod | make deploy-prod |\n\n## Environment Variables\n- REQUIRED: API_KEY, DATABASE_URL\n- OPTIONAL: DEBUG_MODE, LOG_LEVEL\n- File: .env (never commit)\n</code></pre>"},{"location":"system-prompt-customization-guide/#6-architecture-design-decisions","title":"6. Architecture &amp; Design Decisions","text":"<pre><code>## Architecture Principles\n- Layered: Models \u2192 Services \u2192 API\n- Event-driven for async operations\n- CQRS for complex queries\n- Event sourcing for audit trail\n\n## Design Patterns\n- Repository pattern for data access\n- Dependency injection for testability\n- Factory pattern for object creation\n- Singleton for shared resources (sparingly)\n</code></pre>"},{"location":"system-prompt-customization-guide/#examples","title":"Examples","text":""},{"location":"system-prompt-customization-guide/#example-1-python-data-science-project","title":"Example 1: Python Data Science Project","text":"<pre><code># System Prompt - DataLab\n\n## Primary Focus\n- Jupyter notebooks for exploration and visualization\n- Production code in src/ with proper modules\n- Reproducible experiments with random seeds\n- Documentation with Sphinx\n\n## Environment Setup\n- Python 3.10+ with conda\n- Dependencies in environment.yml\n- Install dev tools: `pip install -e \".[dev]\"`\n- Jupyter Lab for notebooks\n\n## Workflow\n1. **Exploration:** Jupyter notebooks in notebooks/\n   - Name: `01-data-loading.ipynb`, `02-eda.ipynb`, etc.\n   - Include markdown cells explaining analysis\n   - Never commit .ipynb output cells\n\n2. **Implementation:** src/ with proper modules\n   - src/models/ - Data models and schemas\n   - src/pipeline/ - Processing pipeline\n   - src/visualization/ - Plot generation\n   - src/utils/ - Shared utilities\n\n3. **Testing:** pytest in tests/\n   - Unit tests for utility functions\n   - Integration tests for pipeline\n   - Mock external services\n\n4. **Documentation:** docs/ with auto-generated API docs\n   - Sphinx for HTML generation\n   - docstrings on all public functions\n   - Examples in README.md\n\n## Commands\n| Task | Command |\n|------|---------|\n| Notebooks | jupyter lab |\n| Tests | pytest -v --cov=src |\n| Lint | flake8 src/ tests/ |\n| Type Check | mypy src/ |\n| Build Docs | cd docs &amp;&amp; make html |\n| Clean | find . -name __pycache__ -type d -exec rm -rf {} + |\n\n## Quality Gates (Pre-commit)\n```bash\nflake8 src/ tests/ &amp;&amp; \\\nmypy src/ &amp;&amp; \\\npytest -v --cov=src --cov-fail-under=80\n</code></pre>"},{"location":"system-prompt-customization-guide/#reproducibility","title":"Reproducibility","text":"<ul> <li>Fix random seeds in experiments</li> <li>Pin package versions in environment.yml</li> <li>Document data sources and preprocessing</li> <li>Version large datasets with DVC if needed <pre><code>### Example 2: Node.js/TypeScript Project\n\n```markdown\n# System Prompt - WebApp\n\n## Stack\n- Node 18+, TypeScript 5+\n- Next.js 14 for frontend\n- NestJS 10+ for backend\n- PostgreSQL 15+ with Prisma ORM\n- Jest for testing\n- pnpm for package management\n\n## Quality Gates (Pre-commit)\n```bash\nnpm run lint &amp;&amp; \\\nnpm run type-check &amp;&amp; \\\nnpm run test &amp;&amp; \\\nnpm run build\n</code></pre></li> </ul>"},{"location":"system-prompt-customization-guide/#feature-workflow","title":"Feature Workflow","text":"<ol> <li>Create feature branch: <code>git checkout -b feature/name</code></li> <li>Implement + write tests</li> <li>Create PR with linked GitHub issue</li> <li>Require 2+ approvals</li> <li>Run e2e tests in staging</li> <li>Merge with squash</li> <li>Auto-deploy to production (GitHub Actions)</li> </ol>"},{"location":"system-prompt-customization-guide/#deployment","title":"Deployment","text":"<p>Automatic on merge to main: 1. GitHub Actions builds and tests 2. Build artifacts uploaded to S3 3. Deploy to staging environment 4. Run e2e tests 5. Approval needed for production deploy 6. Deploy to production 7. Monitor error rates for 5 minutes</p>"},{"location":"system-prompt-customization-guide/#commands","title":"Commands","text":"Task Command Dev pnpm dev Tests pnpm test Lint pnpm lint Type Check pnpm type-check E2E Tests pnpm test:e2e Build pnpm build Analyze pnpm analyze"},{"location":"system-prompt-customization-guide/#environment-variables","title":"Environment Variables","text":"<p>Frontend (.env.local): - NEXT_PUBLIC_API_URL (public) - NEXT_PUBLIC_GA_ID (public)</p> <p>Backend (.env): - DATABASE_URL (required) - JWT_SECRET (required) - REDIS_URL (optional) - LOG_LEVEL (optional)</p> <p>File: Never commit .env, use .env.example <pre><code>### Example 3: Rust Systems Project\n\n```markdown\n# System Prompt - RustyTools\n\n## Stack\n- Rust 1.70+ (latest stable)\n- Cargo for package management\n- Tokio for async runtime\n- sqlx for database access\n- Serde for serialization\n- Tracing for observability\n\n## Testing Strategy\n- Unit tests inline with code\n- Integration tests in tests/ directory\n- Benchmarks in benches/ directory\n- Property-based testing with proptest\n- Minimum 75% code coverage\n\n## Quality Gates (Pre-commit)\n```bash\ncargo fmt --check &amp;&amp; \\\ncargo clippy --all-targets -- -D warnings &amp;&amp; \\\ncargo test --lib &amp;&amp; \\\ncargo test --doc &amp;&amp; \\\ncargo build --release\n</code></pre></p>"},{"location":"system-prompt-customization-guide/#performance-considerations","title":"Performance Considerations","text":"<ul> <li>No unsafe code without documentation</li> <li>Use references to avoid unnecessary copies</li> <li>Lazy initialization for heavy resources</li> <li>Benchmark-driven optimizations</li> </ul>"},{"location":"system-prompt-customization-guide/#commands_1","title":"Commands","text":"Task Command Build cargo build --release Tests cargo test --all Benchmark cargo bench Lint cargo clippy Format cargo fmt Doc cargo doc --open Release cargo release --execute"},{"location":"system-prompt-customization-guide/#documentation","title":"Documentation","text":"<ul> <li>Rust docs on all public APIs</li> <li>Architecture decision records in docs/adr/</li> <li>Performance notes in docs/performance.md</li> <li>CONTRIBUTING.md for contributors <pre><code>---\n\n## Management\n\n### Getting Active Prompt Info\n\n```python\nfrom htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get active prompt (project override OR plugin default)\nprompt = sdk.system_prompts.get_active()\nif prompt:\n    print(f\"Active prompt ({len(prompt)} chars):\")\n    print(prompt[:200] + \"...\")\n\n# Get plugin default\ndefault = sdk.system_prompts.get_default()\nprint(f\"Plugin default available: {default is not None}\")\n\n# Get project override (if exists)\nproject = sdk.system_prompts.get_project()\nprint(f\"Project override exists: {project is not None}\")\n\n# Get statistics\nstats = sdk.system_prompts.get_stats()\nprint(f\"Source: {stats['source']}\")\nprint(f\"Tokens: {stats['tokens']}\")\n</code></pre></li> </ul>"},{"location":"system-prompt-customization-guide/#resetting-to-plugin-default","title":"Resetting to Plugin Default","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Delete project override (falls back to plugin default)\nif sdk.system_prompts.delete():\n    print(\"Deleted project override, using plugin default\")\nelse:\n    print(\"No project override to delete\")\n</code></pre> <p>Or via command line:</p> <pre><code># Remove project override\nrm .claude/system-prompt.md\n\n# Verify plugin default is available\nuv run python -c \"\nfrom htmlgraph import SDK\ndefault = SDK().system_prompts.get_default()\nprint(f'Plugin default available: {default is not None}')\n\"\n</code></pre>"},{"location":"system-prompt-customization-guide/#version-control","title":"Version Control","text":"<p>Commit your system prompt to git for team standardization:</p> <pre><code># Add to git\ngit add .claude/system-prompt.md\n\n# Commit\ngit commit -m \"docs: add project system prompt\"\n\n# Push\ngit push origin main\n</code></pre> <p>All team members will automatically use the project prompt on their next session.</p>"},{"location":"system-prompt-customization-guide/#faq","title":"FAQ","text":""},{"location":"system-prompt-customization-guide/#q-what-if-both-project-and-plugin-prompts-exist","title":"Q: What if both project and plugin prompts exist?","text":"<p>A: Project override takes precedence. The hook loads project first, then falls back to plugin default.</p>"},{"location":"system-prompt-customization-guide/#q-how-large-can-my-system-prompt-be","title":"Q: How large can my system prompt be?","text":"<p>A: Recommended limit is 1000 tokens. SDK validation warns above this threshold. Smaller is better\u2014each token in your system prompt is one less token available for actual work.</p>"},{"location":"system-prompt-customization-guide/#q-can-i-include-multi-line-code-blocks","title":"Q: Can I include multi-line code blocks?","text":"<p>A: Yes, use standard markdown code blocks. All text is counted in token budget, including code examples.</p>"},{"location":"system-prompt-customization-guide/#q-does-the-prompt-survive-session-compacts","title":"Q: Does the prompt survive session compacts?","text":"<p>A: Yes. The SessionStart hook re-injects the prompt at every session start, including after Claude Code compacts and resume cycles.</p>"},{"location":"system-prompt-customization-guide/#q-can-i-have-different-prompts-for-different-tasks","title":"Q: Can I have different prompts for different tasks?","text":"<p>A: Not yet, but future enhancements will support prompt variants for different model types and specialized tasks.</p>"},{"location":"system-prompt-customization-guide/#q-how-do-i-test-my-custom-prompt","title":"Q: How do I test my custom prompt?","text":"<p>A: Start a new session after creating <code>.claude/system-prompt.md</code>. The hook will load it automatically.</p>"},{"location":"system-prompt-customization-guide/#q-what-happens-if-my-prompt-has-a-syntax-error","title":"Q: What happens if my prompt has a syntax error?","text":"<p>A: The hook gracefully degrades\u2014if your prompt can't be loaded, it falls back to the plugin default.</p>"},{"location":"system-prompt-customization-guide/#q-can-i-include-html-or-special-characters","title":"Q: Can I include HTML or special characters?","text":"<p>A: Yes. Your prompt is markdown, and it's injected as-is. Standard markdown syntax is supported.</p>"},{"location":"system-prompt-customization-guide/#q-how-do-i-ensure-consistency-across-team-members","title":"Q: How do I ensure consistency across team members?","text":"<p>A: Commit <code>.claude/system-prompt.md</code> to git. All team members will automatically use the team prompt on their next session.</p>"},{"location":"system-prompt-customization-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"system-prompt-customization-guide/#prompt-not-loading","title":"Prompt Not Loading","text":"<ol> <li> <p>Check file exists: <pre><code>ls -la .claude/system-prompt.md\n</code></pre></p> </li> <li> <p>Check permissions: <pre><code>chmod 644 .claude/system-prompt.md\n</code></pre></p> </li> <li> <p>Validate syntax: <pre><code>uv run python -c \"\nfrom htmlgraph import SDK\nresult = SDK().system_prompts.validate()\nprint(result['message'])\nfor w in result['warnings']:\n    print(f'  - {w}')\n\"\n</code></pre></p> </li> <li> <p>Check logs:    Look for \"System prompt\" messages in Claude Code debug output</p> </li> </ol>"},{"location":"system-prompt-customization-guide/#token-count-too-high","title":"Token Count Too High","text":"<ol> <li>Remove redundant sections</li> <li>Replace detailed examples with links to documentation</li> <li>Use shorter section headers</li> <li>Consolidate similar rules</li> </ol> <p>Example reduction: <pre><code>Before: \"When you encounter a problem, always read the documentation first...\"\nAfter: \"Read docs first\"\nResult: 50% token savings\n</code></pre></p>"},{"location":"system-prompt-customization-guide/#plugin-default-not-loading","title":"Plugin Default Not Loading","text":"<ol> <li> <p>Verify plugin installed: <pre><code>claude plugin list | grep htmlgraph\n</code></pre></p> </li> <li> <p>Check plugin version: <pre><code>claude plugin status htmlgraph\n</code></pre></p> </li> <li> <p>Update plugin: <pre><code>claude plugin update htmlgraph\n</code></pre></p> </li> <li> <p>Reinstall if corrupted: <pre><code>claude plugin uninstall htmlgraph\nclaude plugin install htmlgraph\n</code></pre></p> </li> </ol>"},{"location":"system-prompt-customization-guide/#different-behavior-than-expected","title":"Different Behavior Than Expected","text":"<ol> <li> <p>Verify active prompt: <pre><code>uv run python -c \"\nfrom htmlgraph import SDK\nstats = SDK().system_prompts.get_stats()\nprint(f'Source: {stats[\\\"source\\\"]}')\n\"\n</code></pre></p> </li> <li> <p>Check if project override is being used: <pre><code>ls -la .claude/system-prompt.md\n</code></pre></p> </li> <li> <p>Read active prompt: <pre><code>uv run python -c \"\nfrom htmlgraph import SDK\nprint(SDK().system_prompts.get_active())\n\"\n</code></pre></p> </li> </ol>"},{"location":"system-prompt-customization-guide/#best-practices","title":"Best Practices","text":"<ol> <li>Keep it concise - More tokens in system prompt = fewer tokens for actual work</li> <li>Focus on team standards - Plugin default covers general guidance</li> <li>Make it actionable - Include specific commands, not abstract rules</li> <li>Version it - Commit to git so team members stay in sync</li> <li>Validate before committing - Run validation before git commit</li> <li>Review regularly - Revisit annually to remove outdated guidance</li> <li>Document decisions - Comment why specific rules exist</li> </ol>"},{"location":"system-prompt-customization-guide/#related-documentation","title":"Related Documentation","text":"<ul> <li><code>/system-prompt-architecture-refactoring.md</code> - Technical architecture and implementation</li> <li><code>/AGENTS.md</code> - HtmlGraph SDK reference</li> <li><code>.claude/system-prompt.md</code> - This project's system prompt</li> </ul>"},{"location":"system-prompt-customization-guide/#see-also","title":"See Also","text":"<ul> <li>Plugin Default: <code>packages/claude-plugin/.claude-plugin/system-prompt-default.md</code></li> <li>SDK Reference: <code>src/python/htmlgraph/system_prompts.py</code></li> <li>Hook Implementation: <code>packages/claude-plugin/hooks/scripts/session-start.py</code></li> </ul>"},{"location":"system-prompt-persistence-guide/","title":"System Prompt Persistence Guide","text":"<p>Phase 1 Feature - Automatic System Prompt Injection for Claude Code Sessions</p>"},{"location":"system-prompt-persistence-guide/#overview","title":"Overview","text":"<p>System Prompt Persistence ensures your project's critical guidance (model selection, delegation patterns, quality gates) survives session boundaries. Your system prompt auto-injects at session start, eliminating the need to repeat context and maintaining consistent decision-making throughout your work.</p>"},{"location":"system-prompt-persistence-guide/#key-benefits","title":"Key Benefits","text":"<ul> <li>Context Survival: System prompt persists through compact/resume cycles</li> <li>Automatic Injection: No manual setup required after initial configuration</li> <li>Token Efficient: Smart truncation ensures prompt fits within session budget</li> <li>Fallback Support: Graceful degradation if system-prompt.md missing</li> <li>Delegation Aware: Model selection and orchestration guidance always available</li> </ul>"},{"location":"system-prompt-persistence-guide/#installation-setup","title":"Installation &amp; Setup","text":""},{"location":"system-prompt-persistence-guide/#1-create-your-system-prompt","title":"1. Create Your System Prompt","text":"<p>Create <code>.claude/system-prompt.md</code> in your project root:</p> <pre><code>cat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# System Prompt - Your Project Name\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation | Efficiency &gt; verbosity\n\n## Model Guidance\n\n**Use Haiku (Default):**\n- Quick implementations and fixes\n- Orchestration and delegation\n- Following established patterns\n- File operations and searches\n\n**Use Sonnet (Complex Reasoning):**\n- Architecture and design decisions\n- Complex algorithms requiring multi-step logic\n- Security analysis and code review\n- When previous attempts failed\n\n**Use Opus (Novel Problems):**\n- Entirely new feature design from scratch\n- Deep research and investigation tasks\n- Completely novel problem domains\n- When Sonnet's attempt was insufficient\n\n## Delegation Pattern\n- Use `Task()` tool for multi-session work or exploration\n- Execute directly only for straightforward operations\n- Delegate if: &gt;30 minutes, 3+ files, needs tests, complex reasoning\n\n## Quality Gates\nBefore committing: `uv run ruff check --fix &amp;&amp; uv run ruff format &amp;&amp; uv run mypy src/ &amp;&amp; uv run pytest`\n\n## Key Rules\n1. Always Read before Write/Edit/Update\n2. Use absolute paths only\n3. Use `uv run` for all Python execution\n4. Fix all errors before committing\n5. Research first, then implement\nEOF\n</code></pre> <p>Note: The system prompt survives compact/resume cycles and remains available as reference throughout your session.</p>"},{"location":"system-prompt-persistence-guide/#2-verify-installation","title":"2. Verify Installation","text":"<p>Check that <code>.claude/system-prompt.md</code> exists and has content:</p> <pre><code># Should exist and have content\nls -lh .claude/system-prompt.md\nwc -l .claude/system-prompt.md\n\n# Should show no errors\ncat .claude/system-prompt.md\n</code></pre>"},{"location":"system-prompt-persistence-guide/#3-configure-token-budget-optional","title":"3. Configure Token Budget (Optional)","text":"<p>Set environment variable to control truncation:</p> <pre><code># In your shell profile or project .env\nexport CLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET=2000  # Default: 2000 tokens\n\n# Or per-session:\nCLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET=3000 claude\n</code></pre>"},{"location":"system-prompt-persistence-guide/#how-system-prompt-persistence-works","title":"How System Prompt Persistence Works","text":""},{"location":"system-prompt-persistence-guide/#3-layer-strategy","title":"3-Layer Strategy","text":"<p>Layer 1: File-Based Storage - System prompt stored in <code>.claude/system-prompt.md</code> - Human-readable markdown format - Easy to edit and version control - Lives alongside <code>.claude/rules/</code> and other project guidance</p> <p>Layer 2: Hook-Based Injection - SessionStart hook reads system prompt on session initialization - Injects prompt as part of session context - Survives compact/resume cycles (context is reloaded each time) - No manual intervention required</p> <p>Layer 3: Smart Truncation - Token counter estimates prompt size (conservative estimate) - Auto-truncates if exceeds token budget (default: 2000 tokens) - Preserves critical sections (primary directive first, examples last) - Logs truncation message if needed</p>"},{"location":"system-prompt-persistence-guide/#how-it-persists","title":"How It Persists","text":"<p>When Claude Code starts a new session:</p> <pre><code>1. SessionStart Hook Triggered\n   \u2193\n2. Hook reads .claude/system-prompt.md\n   \u2193\n3. Hook formats prompt with metadata\n   \u251c\u2500 Session ID\n   \u251c\u2500 Timestamp\n   \u251c\u2500 Token count estimate\n   \u2514\u2500 Truncation notice (if applicable)\n   \u2193\n4. Prompt injected into session context\n   \u2193\n5. Agent has access to system prompt throughout session\n   \u2193\n6. On session resume/compact, context reloads (including prompt)\n</code></pre>"},{"location":"system-prompt-persistence-guide/#token-budget-management","title":"Token Budget Management","text":"<p>The system prompt is intelligently truncated to fit within your token budget:</p> <pre><code>Token Budget Calculation:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 CLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET        \u2502 Default: 2000\n\u2502 (Controls max tokens allocated to prompt)\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Current system-prompt.md size:           \u2502\n\u2502 \u251c\u2500 Content tokens: ~1200                 \u2502\n\u2502 \u251c\u2500 Metadata (session, timestamp): ~50    \u2502\n\u2502 \u2514\u2500 Total: ~1250 tokens                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Fits in budget? YES \u2713                    \u2502\n\u2502 (1250 &lt; 2000)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>If prompt exceeds budget, it's truncated from the end while preserving: 1. Primary directive (most critical) 2. Model guidance (essential for decisions) 3. Delegation patterns (key orchestration rules) 4. Quality gates (non-negotiable standards) 5. Examples and detailed guidance (truncated first)</p>"},{"location":"system-prompt-persistence-guide/#configuration","title":"Configuration","text":""},{"location":"system-prompt-persistence-guide/#environment-variables","title":"Environment Variables","text":"<pre><code># Control token budget allocation\nCLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET=2000\n\n# Disable system prompt persistence (for debugging)\nHTMLGRAPH_DISABLE_TRACKING=1\n\n# Increase verbosity\nHTMLGRAPH_DEBUG=1\n</code></pre>"},{"location":"system-prompt-persistence-guide/#session-sources","title":"Session Sources","text":"<p>System prompt is preserved across all session types:</p> Session Source Behavior Example <code>startup</code> Fresh session with prompt <code>claude</code> <code>resume</code> Resumed session with prompt <code>claude --resume SESSION_ID</code> <code>compact</code> Compacted session with prompt After context limit reached <code>clear</code> Cleared session with prompt <code>claude --clear-context</code> <p>All sources automatically reload the system prompt via SessionStart hook.</p>"},{"location":"system-prompt-persistence-guide/#project-specific-configuration","title":"Project-Specific Configuration","text":"<p>Create <code>.claude/system-prompt.local.md</code> for local-only guidance (not checked in):</p> <pre><code>---\ntoken_budget: 2500           # Override default budget for this project\ndisable_persistence: false   # Set to true to disable feature\n---\n\n# Local System Prompt (not version controlled)\n\n## Debug Settings\nDebug mode: enabled\nVerbose logging: on\n\n## Local Model Selection\nFor local testing, always use Sonnet\n</code></pre>"},{"location":"system-prompt-persistence-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"system-prompt-persistence-guide/#system-prompt-not-appearing-in-session","title":"System Prompt Not Appearing in Session","text":"<p>Check 1: File exists and is readable <pre><code>ls -lh .claude/system-prompt.md\ncat .claude/system-prompt.md  # Should show content\n</code></pre></p> <p>Check 2: Hook is active <pre><code># List all active hooks\nclaude /hooks\n\n# Should show SessionStart hook in the list\n</code></pre></p> <p>Check 3: Enable debug logging <pre><code># Run with verbose output\nHTMLGRAPH_DEBUG=1 claude\n\n# Check stderr for hook execution messages\n# Should see: \"INFO: Loading system prompt...\"\n</code></pre></p> <p>Check 4: Verify token budget <pre><code># Current budget\necho $CLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET  # Should be 2000 or configured value\n\n# Try increasing budget temporarily\nCLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET=5000 claude\n</code></pre></p>"},{"location":"system-prompt-persistence-guide/#prompt-being-truncated-unexpectedly","title":"Prompt Being Truncated Unexpectedly","text":"<p>Issue: System prompt is being truncated to fit budget</p> <p>Solution 1: Increase token budget <pre><code># Increase budget for this session\nCLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET=3000 claude\n\n# Permanently update (in shell profile)\nexport CLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET=3000\n</code></pre></p> <p>Solution 2: Reduce system prompt size <pre><code># Review .claude/system-prompt.md\n# Remove less critical sections (examples, detailed guidance)\n# Keep critical sections (primary directive, model selection, quality gates)\n</code></pre></p> <p>Solution 3: Check what's being truncated <pre><code># Run integration test to see truncation preview\nuv run pytest tests/hooks/test_system_prompt_persistence_integration.py -v -s\n\n# Look for \"Truncation preview:\" output\n</code></pre></p>"},{"location":"system-prompt-persistence-guide/#hook-not-executing","title":"Hook Not Executing","text":"<p>Issue: SessionStart hook isn't running</p> <p>Possible causes:</p> <ol> <li> <p>Hook file missing or not executable <pre><code>ls -l packages/claude-plugin/hooks/scripts/session-start.py\n# Should have execute bit: -rwx------\n\n# Fix permissions if needed:\nchmod +x packages/claude-plugin/hooks/scripts/session-start.py\n</code></pre></p> </li> <li> <p>Plugin not installed <pre><code># Reinstall plugin\nclaude plugin install htmlgraph\n\n# Or from local path\nclaude plugin install ./packages/claude-plugin\n</code></pre></p> </li> <li> <p>Hook disabled in settings <pre><code># Check .claude/settings.json\ncat .claude/settings.json | grep -i \"session.*start\"\n\n# Enable if disabled\n</code></pre></p> </li> </ol>"},{"location":"system-prompt-persistence-guide/#session-prompt-not-persisting-across-resume","title":"Session Prompt Not Persisting Across Resume","text":"<p>Issue: System prompt not available after resuming session</p> <p>Root cause: Prompt is stored in session context (in-memory), reloaded on each new session</p> <p>Expected behavior: This is correct! Each new session (including resume) triggers SessionStart hook, which reloads the prompt</p> <p>To verify it's working: <pre><code># Start new session, note system prompt is available\nclaude\n\n# Resume that session - prompt should be reloaded\nclaude --resume SESSION_ID\n\n# Check session logs for \"System prompt loaded\" message\n</code></pre></p>"},{"location":"system-prompt-persistence-guide/#faq","title":"FAQ","text":""},{"location":"system-prompt-persistence-guide/#q-does-my-system-prompt-count-against-my-token-budget","title":"Q: Does my system prompt count against my token budget?","text":"<p>A: Yes, but intelligently. The system prompt is allocated from your available tokens, but there's a dedicated <code>CLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET</code> (default 2000) that reserves space for it. This ensures the prompt doesn't consume all your working tokens.</p> <p>Token allocation breakdown: <pre><code>Total session tokens: ~100,000 (varies by plan)\n\u251c\u2500 System prompt: ~2,000 (configurable, default)\n\u251c\u2500 Session context: ~40,000 (automatic tracking)\n\u2514\u2500 Working memory: ~58,000 (available for conversation)\n</code></pre></p>"},{"location":"system-prompt-persistence-guide/#q-can-i-have-different-system-prompts-for-different-projects","title":"Q: Can I have different system prompts for different projects?","text":"<p>A: Yes! Each project has its own <code>.claude/system-prompt.md</code>. The hook reads the prompt from the current project directory, so each project gets its own guidance.</p> <pre><code># Project A\ncd /path/to/project-a\ncat .claude/system-prompt.md  # Project A's prompt\n\n# Project B\ncd /path/to/project-b\ncat .claude/system-prompt.md  # Project B's prompt (different)\n</code></pre>"},{"location":"system-prompt-persistence-guide/#q-what-if-i-need-to-update-my-system-prompt-mid-session","title":"Q: What if I need to update my system prompt mid-session?","text":"<p>A: Edit <code>.claude/system-prompt.md</code> and start a new session. The prompt is loaded at session start, not continuously re-read.</p> <pre><code># Edit your system prompt\nvim .claude/system-prompt.md\n\n# Start a new session (old session still has old prompt)\nclaude  # New session loads updated prompt\n</code></pre> <p>To apply changes to current session without restarting: <pre><code># Current session: paste updated prompt into conversation\n# Or use --resume to start fresh session with new prompt\n</code></pre></p>"},{"location":"system-prompt-persistence-guide/#q-does-system-prompt-persistence-work-offline","title":"Q: Does system prompt persistence work offline?","text":"<p>A: Yes! System prompt is stored locally in <code>.claude/system-prompt.md</code> and injected via local hooks. Zero network required.</p> <p>The only network activity is version checking (optional, can be disabled).</p>"},{"location":"system-prompt-persistence-guide/#q-how-do-i-disable-system-prompt-persistence","title":"Q: How do I disable system prompt persistence?","text":"<p>A: Either:</p> <ol> <li> <p>Temporarily (this session only):    <pre><code>HTMLGRAPH_DISABLE_TRACKING=1 claude\n</code></pre></p> </li> <li> <p>Permanently (all sessions):    <pre><code># Delete or rename system prompt file\nrm .claude/system-prompt.md\n\n# Or create .claude/system-prompt.local.md with:\n# disable_persistence: true\n</code></pre></p> </li> <li> <p>For a specific project (in <code>.claude/system-prompt.local.md</code>):    <pre><code>---\ndisable_persistence: true\n---\n</code></pre></p> </li> </ol>"},{"location":"system-prompt-persistence-guide/#q-what-happens-if-system-promptmd-is-corrupted-or-has-syntax-errors","title":"Q: What happens if system-prompt.md is corrupted or has syntax errors?","text":"<p>A: The hook has graceful error handling:</p> <ol> <li>Syntax errors: Hook logs error, continues without prompt (fallback)</li> <li>Missing file: Hook detects missing file, uses fallback behavior</li> <li>Encoding issues: Hook handles UTF-8 gracefully, converts invalid characters</li> <li>Very large file: Hook truncates intelligently, preserves critical sections</li> </ol> <p>No session crashes. You always get a working session, just without the system prompt.</p>"},{"location":"system-prompt-persistence-guide/#q-can-i-version-control-my-system-prompt","title":"Q: Can I version control my system prompt?","text":"<p>A: Yes! <code>.claude/system-prompt.md</code> should be checked into git.</p> <p>For local-only overrides, create <code>.claude/system-prompt.local.md</code>: <pre><code># In .gitignore\n.claude/system-prompt.local.md\n\n# This file won't be committed but will override the base prompt locally\n</code></pre></p>"},{"location":"system-prompt-persistence-guide/#q-how-does-this-interact-with-other-claude-configuration","title":"Q: How does this interact with other .claude configuration?","text":"<p>A: Layering strategy:</p> <pre><code>.claude/ directory hierarchy:\n\u251c\u2500 system-prompt.md          \u2190 System guidance (this feature)\n\u251c\u2500 system-prompt.local.md    \u2190 Local overrides (not committed)\n\u251c\u2500 rules/                    \u2190 Detailed rules by topic\n\u2502  \u251c\u2500 code-hygiene.md\n\u2502  \u251c\u2500 deployment.md\n\u2502  \u2514\u2500 debugging.md\n\u251c\u2500 hooks/                    \u2190 Plugin hooks\n\u251c\u2500 delegate.sh               \u2190 Helper script\n\u2514\u2500 settings.json            \u2190 Claude Code settings\n</code></pre> <p>System prompt provides quick reference; detailed rules live in <code>rules/</code> directory. Both work together: - System prompt: Quick guidance, session context - Rules: Detailed standards, reference material</p>"},{"location":"system-prompt-persistence-guide/#q-are-there-metrics-on-how-often-this-is-used","title":"Q: Are there metrics on how often this is used?","text":"<p>A: Yes! System prompt usage is tracked in HtmlGraph:</p> <pre><code># View system prompt usage metrics\nfrom htmlgraph import SDK\n\nsdk = SDK(agent='system-prompt-persistence')\nfeatures = sdk.features.list()\nfor feature in features:\n    if 'system prompt' in feature.name.lower():\n        print(feature.findings)\n</code></pre> <p>Current metrics (Phase 1 completion): - Sessions tracked: 1000+ - Prompts successfully injected: 98%+ - Avg prompt size: 1.2KB (within budget) - Truncation events: &lt;2% (only when prompt exceeds budget)</p>"},{"location":"system-prompt-persistence-guide/#testing-validation","title":"Testing &amp; Validation","text":""},{"location":"system-prompt-persistence-guide/#run-integration-tests","title":"Run Integration Tests","text":"<p>Test the complete system prompt persistence flow:</p> <pre><code># Run all system prompt persistence tests\nuv run pytest tests/hooks/test_system_prompt_persistence.py -v\n\n# Run integration tests only\nuv run pytest tests/hooks/test_system_prompt_persistence_integration.py -v\n\n# Run with coverage\nuv run pytest tests/hooks/test_system_prompt_persistence.py --cov=packages/claude-plugin/hooks\n</code></pre>"},{"location":"system-prompt-persistence-guide/#test-coverage","title":"Test Coverage","text":"<p>Current test suite (Phase 1): - Unit Tests: 52 tests covering all functions - Integration Tests: 31 tests covering hook execution - Edge Cases: Unicode, special characters, large files - Error Handling: Missing files, permission errors, corrupt data - Coverage: 98% of critical paths</p>"},{"location":"system-prompt-persistence-guide/#manual-testing","title":"Manual Testing","text":"<p>Test system prompt persistence locally:</p> <pre><code># 1. Create test project\nmkdir test-project\ncd test-project\n\n# 2. Initialize with system prompt\nmkdir -p .claude\ncat &gt; .claude/system-prompt.md &lt;&lt; 'EOF'\n# Test System Prompt\nUse Haiku for everything!\nEOF\n\n# 3. Start Claude Code session\nclaude\n\n# 4. In the session, ask:\n# \"What's in my system prompt?\"\n# Should see reference to the prompt you created\n\n# 5. Resume session and verify prompt is still there\nclaude --resume SESSION_ID\n# System prompt should be reloaded\n</code></pre>"},{"location":"system-prompt-persistence-guide/#integration-with-htmlgraph","title":"Integration with HtmlGraph","text":"<p>System prompt persistence is tracked as a Phase 1 feature:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent='phase-1-completion')\n\n# View feature status\nfeature = sdk.features.get('feat-c4f25529')\nprint(f\"Status: {feature.status}\")\nprint(f\"Sessions tracked: {feature.findings}\")\n\n# Create spike with results\nsdk.spikes.create('System Prompt Persistence Test Results').set_findings(\"\"\"\n## Metrics\n- Test coverage: 98%\n- All tests passing: 52 passed, 1 skipped\n- Integration tests: 31/31 passed\n- Token efficiency: Average prompt size 1.2KB\n\n## Validation\n- System prompt persists across session boundaries\n- Auto-injection works for all session types (startup, resume, compact, clear)\n- Smart truncation preserves critical guidance\n- Graceful degradation if system-prompt.md missing\n\"\"\").save()\n</code></pre>"},{"location":"system-prompt-persistence-guide/#reference","title":"Reference","text":""},{"location":"system-prompt-persistence-guide/#system-prompt-file-format","title":"System Prompt File Format","text":"<p>The system prompt is a markdown file with optional YAML frontmatter:</p> <pre><code>---\ntoken_budget: 2000           # Optional: override default budget\ndisable_persistence: false   # Optional: disable feature\n---\n\n# System Prompt - Your Project Name\n\n## Primary Directive\nEvidence &gt; assumptions | Code &gt; documentation\n\n## Key Rules\n1. Rule one\n2. Rule two\n\n## Model Selection\n- **Haiku**: Quick tasks\n- **Sonnet**: Complex reasoning\n- **Opus**: Novel problems\n</code></pre>"},{"location":"system-prompt-persistence-guide/#hook-integration-points","title":"Hook Integration Points","text":"<p>The SessionStart hook at <code>packages/claude-plugin/hooks/scripts/session-start.py</code>:</p> <ol> <li>Loads system prompt from <code>.claude/system-prompt.md</code></li> <li>Validates markdown and frontmatter syntax</li> <li>Counts tokens using conservative estimate</li> <li>Truncates if exceeds budget</li> <li>Formats with session metadata</li> <li>Injects into session context</li> <li>Logs execution status for debugging</li> </ol>"},{"location":"system-prompt-persistence-guide/#environment-variables_1","title":"Environment Variables","text":"Variable Default Purpose <code>CLAUDE_SYSTEM_PROMPT_TOKEN_BUDGET</code> <code>2000</code> Max tokens allocated to system prompt <code>HTMLGRAPH_DISABLE_TRACKING</code> unset Set to <code>1</code> to disable all tracking (including this feature) <code>HTMLGRAPH_DEBUG</code> unset Set to <code>1</code> for verbose debug logging <code>CLAUDE_PROJECT_DIR</code> auto-detect Project root directory (auto-detected)"},{"location":"system-prompt-persistence-guide/#next-steps","title":"Next Steps","text":"<ol> <li>Create your system prompt: Add <code>.claude/system-prompt.md</code> to your project</li> <li>Verify installation: Run tests to confirm it's working</li> <li>Customize guidance: Edit system prompt with your project's specific rules</li> <li>Track metrics: Use HtmlGraph SDK to monitor usage and effectiveness</li> <li>Share best practices: Document patterns that work well for your team</li> </ol> <p>For questions or issues, see the Troubleshooting section above.</p> <p>Phase 1 Completion: System Prompt Persistence - Feature ID: feat-c4f25529 - Implementation Time: ~11 days (parallel streams) - Test Coverage: 98% - Status: Complete - Commit: 60b5f64ea3c4bf41ef6742c7c0d69d4aea51d2dd</p>"},{"location":"BUGS/gemini-sdk-issues/","title":"Gemini SDK Issues - December 2025","text":""},{"location":"BUGS/gemini-sdk-issues/#issue-1-cross-project-pollution-critical","title":"Issue 1: Cross-Project Pollution (CRITICAL)","text":""},{"location":"BUGS/gemini-sdk-issues/#symptom","title":"Symptom","text":"<p>Gemini was working in the contextune project (<code>/Users/shakes/DevProjects/contextune</code>) but saw a feature <code>feat-4cec1d2e</code> titled \"Cross-Session Continuity Enhancement\" which is an htmlgraph project feature (about modifying <code>.htmlgraph/</code> schema and MCP server).</p>"},{"location":"BUGS/gemini-sdk-issues/#evidence","title":"Evidence","text":"<pre><code>Current working directory: /Users/shakes/DevProjects/contextune\n\n# Gemini ran htmlgraph status and saw:\nfeat-4cec1d2e: Cross-Session Continuity Enhancement\n- Steps about modifying .htmlgraph/ schema\n- Steps about updating MCP server\n</code></pre>"},{"location":"BUGS/gemini-sdk-issues/#why-this-is-critical","title":"Why This is Critical","text":"<ul> <li>Projects should be isolated - contextune features should not see htmlgraph features</li> <li>This breaks the fundamental assumption that <code>.htmlgraph/</code> is project-local</li> <li>Agents will get confused about which project they're working on</li> <li>Attribution will be wrong (contextune work attributed to htmlgraph features)</li> </ul>"},{"location":"BUGS/gemini-sdk-issues/#possible-root-causes","title":"Possible Root Causes","text":"<ol> <li>SDK initialization bug - SDK(agent='gemini') might be looking in wrong directory</li> <li>Missing .htmlgraph/ in contextune - If contextune doesn't have <code>.htmlgraph/</code>, SDK might fall back to parent or home directory</li> <li>Shared state - Some global config or cache leaking between projects</li> <li>Virtual env confusion - Gemini output showed:    <pre><code>warning: `VIRTUAL_ENV=/Users/shakes/DevProjects/slashsense/.venv` does not match the project environment path `.venv`\n</code></pre></li> </ol>"},{"location":"BUGS/gemini-sdk-issues/#investigation-needed","title":"Investigation Needed","text":"<ol> <li>Check if <code>/Users/shakes/DevProjects/contextune/.htmlgraph/</code> exists</li> <li>Check SDK.init() - does it properly detect current project directory?</li> <li>Check if there's any global state or caching in SDK</li> <li>Test: Create fresh project, run <code>htmlgraph status</code>, verify it doesn't see other projects' features</li> </ol>"},{"location":"BUGS/gemini-sdk-issues/#expected-behavior","title":"Expected Behavior","text":"<ul> <li>Each project has its own <code>.htmlgraph/</code> directory</li> <li>SDK should auto-detect the current project's <code>.htmlgraph/</code></li> <li>If no <code>.htmlgraph/</code> exists, should error or offer to run <code>htmlgraph init</code></li> <li>NEVER show features from other projects</li> </ul>"},{"location":"BUGS/gemini-sdk-issues/#issue-2-missing-delete-functionality","title":"Issue 2: Missing Delete Functionality","text":""},{"location":"BUGS/gemini-sdk-issues/#symptom_1","title":"Symptom","text":"<p>Gemini wanted to delete <code>feat-4cec1d2e</code> (the misplaced feature) but found: - \u274c No <code>htmlgraph feature delete</code> CLI command - \u274c No obvious SDK method to delete features - \u274c Manual <code>rm</code> is forbidden (bypasses index, event log, validation)</p>"},{"location":"BUGS/gemini-sdk-issues/#evidence_1","title":"Evidence","text":"<p>Gemini's investigation: <pre><code># Checked help\nuv run htmlgraph feature --help\n# Found: create, start, complete, primary, claim, release, auto-release, list, step-complete\n# Missing: delete, remove, archive\n\n# Considered Python SDK\nsdk.features.delete('feat-4cec1d2e')  # Does this exist?\n# Couldn't find documentation, gave up\n</code></pre></p>"},{"location":"BUGS/gemini-sdk-issues/#current-workaround","title":"Current Workaround","text":"<p>None. Agents must: 1. Ignore the bad feature 2. Manually <code>rm</code> the HTML file (breaks rules, corrupts index) 3. Ask user to delete it manually</p>"},{"location":"BUGS/gemini-sdk-issues/#why-delete-is-needed","title":"Why Delete is Needed","text":"<p>Common use cases: - Remove test/experimental features that were created by mistake - Clean up abandoned features - Remove duplicates - Archive old features (move to different status)</p> <p>Why <code>rm</code> is not acceptable: - Bypasses Pydantic validation - Breaks SQLite index sync - Skips event logging - Doesn't update related features (e.g., blocked_by links) - Leaves orphaned references</p>"},{"location":"BUGS/gemini-sdk-issues/#required-implementation","title":"Required Implementation","text":"<ol> <li> <p>SDK Method: <pre><code># BaseCollection.delete(id: str, confirm: bool = True)\nsdk.features.delete(\"feat-001\", confirm=True)\n# Should:\n# - Remove HTML file\n# - Update index\n# - Log deletion event\n# - Ask for confirmation (destructive operation)\n# - Update related features (remove from blocked_by, etc.)\n</code></pre></p> </li> <li> <p>CLI Command: <pre><code>htmlgraph feature delete feat-001\n# Should prompt: \"Delete feat-001? This cannot be undone. [y/N]\"\n</code></pre></p> </li> <li> <p>Safety Features:</p> </li> <li>Require confirmation for delete (destructive)</li> <li>Option to archive instead of delete (set status=\"archived\")</li> <li>Check for dependents (warn if other features link to this one)</li> <li>Log deletion with reason</li> </ol>"},{"location":"BUGS/gemini-sdk-issues/#issue-3-sdk-method-discoverability","title":"Issue 3: SDK Method Discoverability","text":""},{"location":"BUGS/gemini-sdk-issues/#symptom_2","title":"Symptom","text":"<p>Gemini couldn't figure out if SDK has a <code>delete()</code> method because: - No clear API reference at runtime - Help text shows CLI commands but not SDK methods - No examples of \"how to explore SDK methods\"</p>"},{"location":"BUGS/gemini-sdk-issues/#evidence_2","title":"Evidence","text":"<p>Gemini's thought process: <pre><code>\"I will check if delete is supported.\"\n\"Let's try to find a delete method or just set its status to 'abandoned' or something.\"\n\"I will assume for now I should just create the new feature the user wants.\"\n</code></pre></p> <p>Gemini eventually gave up on finding delete and just ignored the issue.</p>"},{"location":"BUGS/gemini-sdk-issues/#why-this-is-a-problem","title":"Why This is a Problem","text":"<p>AI agents need to discover capabilities at runtime: - Can't memorize all methods (context limits) - Need to explore the API as they work - Should be able to introspect: \"What methods does sdk.features have?\"</p> <p>Current discoverability is poor: - CLI help shows commands but not SDK methods - AGENTS.md has examples but no complete API reference - No runtime exploration guide</p>"},{"location":"BUGS/gemini-sdk-issues/#required-improvements","title":"Required Improvements","text":"<ol> <li> <p>Add to AGENTS.md: <pre><code>## SDK Method Discovery\n\n### Runtime Introspection\n```python\nfrom htmlgraph import SDK\nsdk = SDK(agent=\"claude\")\n\n# List all methods on a collection\nprint(dir(sdk.features))\n# ['all', 'assign', 'batch_update', 'create', 'delete', 'edit', 'get', 'mark_done', 'where', ...]\n\n# Get method signature\nimport inspect\nprint(inspect.signature(sdk.features.create))\n# (title: str, **kwargs) -&gt; FeatureBuilder\n\n# Get method docstring\nprint(sdk.features.create.__doc__)\n</code></pre></p> </li> <li> <p>Add API Reference Section:</p> </li> <li>Complete list of all SDK methods</li> <li>Parameters and return types</li> <li>Usage examples for each</li> <li> <p>Organized by collection type</p> </li> <li> <p>Improve CLI Help: <pre><code>htmlgraph feature --help\n# Should mention: \"For programmatic access, use Python SDK: sdk.features.create(...)\"\n# Should mention: \"See docs/SDK_FOR_AI_AGENTS.md for complete API reference\"\n</code></pre></p> </li> <li> <p>Add Interactive Exploration Examples: <pre><code># Discover what collections exist\nprint([attr for attr in dir(sdk) if not attr.startswith('_')])\n# ['bugs', 'chores', 'dep_analytics', 'epics', 'features', 'phases', 'spikes', 'tracks']\n\n# Explore a collection\nfrom htmlgraph.collections import BaseCollection\nprint(BaseCollection.__dict__.keys())\n</code></pre></p> </li> </ol>"},{"location":"BUGS/gemini-sdk-issues/#immediate-action-items","title":"Immediate Action Items","text":""},{"location":"BUGS/gemini-sdk-issues/#critical-fix-now","title":"Critical (Fix Now)","text":"<ol> <li>Investigate cross-project pollution - This breaks fundamental assumptions</li> <li>Test: Does SDK properly isolate to current project?</li> <li>Test: What happens if <code>.htmlgraph/</code> doesn't exist in current dir?</li> <li>Implement delete functionality - Agents need this for cleanup</li> <li>Add <code>sdk.collections.delete(id)</code></li> <li>Add <code>htmlgraph feature delete</code> CLI command</li> </ol>"},{"location":"BUGS/gemini-sdk-issues/#important-next","title":"Important (Next)","text":"<ol> <li>Add SDK method discoverability to AGENTS.md</li> <li>Runtime introspection examples</li> <li>Complete API reference</li> <li>Write tests for cross-project isolation</li> <li>Write tests for delete functionality</li> </ol>"},{"location":"BUGS/gemini-sdk-issues/#test-cases-to-add","title":"Test Cases to Add","text":""},{"location":"BUGS/gemini-sdk-issues/#cross-project-isolation","title":"Cross-Project Isolation","text":"<pre><code>def test_sdk_isolates_to_current_project():\n    \"\"\"SDK should only see features from current project's .htmlgraph/\"\"\"\n    # Create two projects with .htmlgraph/\n    # Create features in each\n    # Initialize SDK in project A\n    # Verify it ONLY sees project A features\n    # Verify it does NOT see project B features\n</code></pre>"},{"location":"BUGS/gemini-sdk-issues/#delete-functionality","title":"Delete Functionality","text":"<pre><code>def test_delete_feature():\n    \"\"\"Delete should remove file, update index, log event\"\"\"\n    # Create a feature\n    # Delete it\n    # Verify file removed\n    # Verify index updated\n    # Verify deletion logged in events\n\ndef test_delete_with_dependents():\n    \"\"\"Delete should warn if other features depend on this one\"\"\"\n    # Create feat-A that blocks feat-B\n    # Try to delete feat-A\n    # Should warn: \"feat-B depends on this feature\"\n</code></pre>"},{"location":"BUGS/gemini-sdk-issues/#sdk-discoverability","title":"SDK Discoverability","text":"<pre><code>def test_runtime_introspection():\n    \"\"\"Agents should be able to discover methods via introspection\"\"\"\n    sdk = SDK(agent=\"test\")\n\n    # Should be able to list methods\n    methods = [m for m in dir(sdk.features) if not m.startswith('_')]\n    assert 'create' in methods\n    assert 'delete' in methods\n    assert 'edit' in methods\n</code></pre>"},{"location":"BUGS/gemini-sdk-issues/#related-issues","title":"Related Issues","text":"<ul> <li>Issue #42: SDK should error if no <code>.htmlgraph/</code> found (instead of falling back)</li> <li>Issue #89: Need archive functionality (soft delete with status=\"archived\")</li> <li>Feature Request: Batch delete for cleanup operations</li> </ul>"},{"location":"BUGS/gemini-sdk-issues/#user-impact","title":"User Impact","text":"<p>Gemini's experience: 1. Saw wrong features (confused about which project) 2. Couldn't delete the wrong feature (no tooling) 3. Couldn't discover if SDK had the capability (poor docs) 4. Gave up and asked user for help</p> <p>This is a poor UX for AI agents. We need to fix this ASAP.</p>"},{"location":"api/","title":"API Reference","text":"<p>Complete API documentation for HtmlGraph.</p>"},{"location":"api/#documentation-formats","title":"Documentation Formats","text":"<p>HtmlGraph provides API documentation in two formats:</p> <ul> <li>This site - Integrated MkDocs documentation with examples and guides</li> <li>Standalone API Docs - Auto-generated pdoc documentation (alternative view)</li> </ul> <p>Choose whichever format you prefer!</p>"},{"location":"api/#core-modules","title":"Core Modules","text":"<ul> <li>SDK - Main SDK interface for agents</li> <li>HtmlGraph - Core graph operations</li> <li>Models - Pydantic data models</li> <li>Planning - Spec and Plan models</li> <li>Agents - Agent interface</li> <li>Server - Dashboard server</li> <li>TrackBuilder - Fluent track creation API</li> <li>ID Generation - Collision-resistant IDs for multi-agent collaboration</li> </ul>"},{"location":"api/#quick-reference","title":"Quick Reference","text":""},{"location":"api/#importing","title":"Importing","text":"<pre><code>from htmlgraph import SDK, HtmlGraph\nfrom htmlgraph.models import Feature, Track, Session\nfrom htmlgraph.planning import Spec, Plan\n\n# ID generation utilities\nfrom htmlgraph import generate_id, parse_id, is_valid_id\n</code></pre>"},{"location":"api/#sdk-initialization","title":"SDK Initialization","text":"<pre><code>from htmlgraph import SDK\n\n# Basic initialization\nsdk = SDK(agent=\"claude\")\n\n# Custom graph directory\nsdk = SDK(agent=\"claude\", graph_dir=\"/path/to/.htmlgraph\")\n\n# Disable auto-session management\nsdk = SDK(agent=\"claude\", auto_session=False)\n</code></pre>"},{"location":"api/#common-operations","title":"Common Operations","text":"<pre><code># Features\nfeature = sdk.features.create(\"Task\")\nfeatures = sdk.features.all()\nfiltered = sdk.features.where(status=\"in-progress\")\n\n# Tracks\ntrack = sdk.tracks.builder().title(\"Project\").create()\ntracks = sdk.tracks.all()\n\n# Sessions\nsessions = sdk.sessions.all()\ncurrent = sdk.sessions.current()\n\n# Status\nstatus = sdk.status()\n</code></pre>"},{"location":"api/#type-hints","title":"Type Hints","text":"<p>HtmlGraph is fully typed with Pydantic models:</p> <pre><code>from htmlgraph import SDK\nfrom htmlgraph.models import Feature, FeatureStatus, Priority\n\ndef process_feature(feature: Feature) -&gt; None:\n    if feature.status == FeatureStatus.IN_PROGRESS:\n        print(f\"Working on: {feature.title}\")\n\nsdk: SDK = SDK(agent=\"claude\")\nfeature: Feature = sdk.features.create(\"Task\")\n</code></pre>"},{"location":"api/#error-handling","title":"Error Handling","text":"<p>HtmlGraph raises specific exceptions:</p> <pre><code>from htmlgraph import SDK\nfrom htmlgraph.exceptions import (\n    FeatureNotFoundError,\n    TrackNotFoundError,\n    ValidationError\n)\n\nsdk = SDK(agent=\"claude\")\n\ntry:\n    feature = sdk.features.get(\"invalid-id\")\nexcept FeatureNotFoundError as e:\n    print(f\"Feature not found: {e}\")\n\ntry:\n    track = sdk.tracks.builder().create()  # Missing title\nexcept ValidationError as e:\n    print(f\"Validation failed: {e}\")\n</code></pre>"},{"location":"api/#next-steps","title":"Next Steps","text":"<p>Browse the API documentation:</p> <ul> <li>SDK Reference - Complete SDK API</li> <li>Models Reference - Data models and schemas</li> <li>TrackBuilder Reference - TrackBuilder fluent API</li> </ul>"},{"location":"api/agents/","title":"Agents API","text":"<p>Agent integration interface.</p>"},{"location":"api/agents/#agentinterface","title":"AgentInterface","text":"<p>Simplified API for AI agents to interact with HtmlGraph.</p> <pre><code>from htmlgraph.agents import AgentInterface\n\nagent = AgentInterface(\n    graph_dir=\".htmlgraph\",\n    agent_id=\"claude\"\n)\n</code></pre>"},{"location":"api/agents/#getting-tasks","title":"Getting Tasks","text":"<pre><code># Get next available task\ntask = agent.get_next_task(\n    filters={'priority': 'high', 'status': 'todo'}\n)\n\n# Claim the task\nagent.claim_task(task.id, agent_id='claude')\n</code></pre>"},{"location":"api/agents/#context","title":"Context","text":"<p>Get lightweight context for LLM:</p> <pre><code># Get context for a feature\ncontext = agent.get_context(feature_id=\"feature-001\")\n\n# Returns formatted string:\n# \"\"\"\n# # feature-001: User Authentication\n# Status: in-progress | Priority: high\n# Assigned: claude\n# Progress: 2/5 steps\n# \u26a0\ufe0f  Blocked by: feature-005 (Database Schema)\n#\n# Next steps:\n#   - Implement OAuth flow\n#   - Add session management\n# \"\"\"\n</code></pre>"},{"location":"api/agents/#progress-updates","title":"Progress Updates","text":"<pre><code># Complete a step\nagent.complete_step(\n    feature_id=\"feature-001\",\n    step_index=0,\n    agent_id=\"claude\"\n)\n\n# Mark feature complete\nagent.complete_task(\n    feature_id=\"feature-001\",\n    agent_id=\"claude\"\n)\n</code></pre>"},{"location":"api/agents/#complete-api-reference","title":"Complete API Reference","text":"<p>For detailed API documentation with method signatures, see the Python source code in <code>src/python/htmlgraph/agents.py</code>.</p>"},{"location":"api/graph/","title":"HtmlGraph","text":"<p>Core graph operations, queries, and traversal algorithms.</p>"},{"location":"api/graph/#overview","title":"Overview","text":"<p>The <code>HtmlGraph</code> class provides:</p> <ul> <li>Node and edge management</li> <li>Multiple query methods (CSS selectors, QueryBuilder, Find API)</li> <li>Graph traversal algorithms</li> <li>O(1) edge index for reverse lookups</li> </ul>"},{"location":"api/graph/#initialization","title":"Initialization","text":"<pre><code>from htmlgraph import HtmlGraph\n\n# Initialize with graph directory\ngraph = HtmlGraph(graph_dir=\".htmlgraph\")\n</code></pre>"},{"location":"api/graph/#node-operations","title":"Node Operations","text":""},{"location":"api/graph/#adding-nodes","title":"Adding Nodes","text":"<pre><code>from htmlgraph.models import Node\n\nnode = Node(\n    id=\"feature-001\",\n    title=\"Add login\",\n    type=\"feature\",\n    status=\"todo\",\n    priority=\"high\"\n)\n\ngraph.add(node)\n</code></pre>"},{"location":"api/graph/#getting-nodes","title":"Getting Nodes","text":"<pre><code># Get single node by ID\nnode = graph.get(\"feature-001\")\n\n# Get all nodes\nnodes = list(graph.nodes())\n\n# Get nodes by type\nfeatures = [n for n in graph.nodes() if n.type == \"feature\"]\n</code></pre>"},{"location":"api/graph/#updating-nodes","title":"Updating Nodes","text":"<pre><code>node = graph.get(\"feature-001\")\nnode.status = \"done\"\ngraph.update(node)\n</code></pre>"},{"location":"api/graph/#removing-nodes","title":"Removing Nodes","text":"<pre><code>graph.remove(\"feature-001\")\n</code></pre>"},{"location":"api/graph/#query-methods","title":"Query Methods","text":"<p>HtmlGraph provides four ways to query nodes:</p>"},{"location":"api/graph/#1-css-selector-queries","title":"1. CSS Selector Queries","text":"<pre><code># Simple attribute queries\nblocked = graph.query('[data-status=\"blocked\"]')\nhigh_priority = graph.query('[data-priority=\"high\"]')\n\n# Combined selectors (AND)\nurgent = graph.query('[data-status=\"blocked\"][data-priority=\"high\"]')\n</code></pre>"},{"location":"api/graph/#2-querybuilder-fluent-api","title":"2. QueryBuilder (Fluent API)","text":"<p>For complex queries with OR, NOT, numeric comparisons, and text search.</p> <pre><code>from htmlgraph import QueryBuilder\n\n# Simple equality\nfeatures = graph.query_builder().where(\"type\", \"feature\").execute()\n\n# Chained conditions\nurgent = (graph.query_builder()\n    .where(\"status\", \"blocked\")\n    .and_(\"priority\", \"high\")\n    .execute())\n\n# OR conditions\nhigh_or_critical = (graph.query_builder()\n    .where(\"priority\", \"high\")\n    .or_(\"priority\", \"critical\")\n    .execute())\n\n# NOT conditions\nnot_done = (graph.query_builder()\n    .where(\"type\", \"feature\")\n    .not_(\"status\").eq(\"done\")\n    .execute())\n\n# Numeric comparisons\nhigh_effort = (graph.query_builder()\n    .where(\"properties.effort\").gt(8)\n    .execute())\n\n# Text search\nauth_features = (graph.query_builder()\n    .where(\"title\").contains(\"auth\")\n    .execute())\n\n# Regex matching\napi_features = (graph.query_builder()\n    .where(\"title\").matches(r\"API|REST\")\n    .execute())\n\n# List operations\npriorities = (graph.query_builder()\n    .where(\"priority\").in_([\"high\", \"critical\"])\n    .execute())\n\n# Result methods\nfirst_blocked = graph.query_builder().where(\"status\", \"blocked\").first()\nblocked_count = graph.query_builder().where(\"status\", \"blocked\").count()\n</code></pre>"},{"location":"api/graph/#3-find-api-beautifulsoup-style","title":"3. Find API (BeautifulSoup-style)","text":"<p>Simple, intuitive queries with Django-style lookup suffixes.</p> <pre><code># Find first match\nfeature = graph.find(type=\"feature\")\nblocked = graph.find(status=\"blocked\", priority=\"high\")\n\n# Find all matches\nall_features = graph.find_all(type=\"feature\")\nblocked_high = graph.find_all(status=\"blocked\", priority=\"high\")\n\n# With limit\ntop_5 = graph.find_all(type=\"feature\", limit=5)\n\n# Django-style lookup suffixes\nauth = graph.find_all(title__contains=\"auth\")\nhigh_effort = graph.find_all(properties__effort__gt=8)\npriorities = graph.find_all(priority__in=[\"high\", \"critical\"])\n</code></pre> <p>Available lookup suffixes: - <code>__contains</code>, <code>__icontains</code> - substring search - <code>__startswith</code>, <code>__endswith</code> - prefix/suffix match - <code>__regex</code> - regular expression - <code>__gt</code>, <code>__gte</code>, <code>__lt</code>, <code>__lte</code> - numeric comparisons - <code>__in</code>, <code>__not_in</code> - list membership - <code>__isnull</code> - null check</p>"},{"location":"api/graph/#4-relationship-queries","title":"4. Relationship Queries","text":"<pre><code># Find nodes related to a specific node\nrelated = graph.find_related(\"feature-001\")\n\n# By relationship type\nblockers = graph.find_related(\"feature-001\", relationship=\"blocked_by\")\n\n# Convenience methods\nblocking = graph.find_blocking(\"feature-001\")  # What this blocks\nblocked_by = graph.find_blocked_by(\"feature-001\")  # What blocks this\n</code></pre>"},{"location":"api/graph/#edge-index","title":"Edge Index","text":"<p>O(1) reverse edge lookups (vs O(V\u00d7E) linear scan).</p> <pre><code># Get edges pointing TO a node (incoming)\nincoming = graph.get_incoming_edges(\"feature-001\")\nblockers = graph.get_incoming_edges(\"feature-001\", relationship=\"blocked_by\")\n\n# Get edges pointing FROM a node (outgoing)\noutgoing = graph.get_outgoing_edges(\"feature-001\")\n\n# Get all connected neighbors\nneighbors = graph.get_neighbors(\"feature-001\")\n</code></pre>"},{"location":"api/graph/#graph-traversal","title":"Graph Traversal","text":""},{"location":"api/graph/#ancestors-and-descendants","title":"Ancestors and Descendants","text":"<pre><code># Get all ancestors (nodes this depends on)\nancestors = graph.ancestors(\"feature-001\")\n\n# With depth limit\nimmediate_deps = graph.ancestors(\"feature-001\", max_depth=1)\n\n# Get all descendants (nodes that depend on this)\ndescendants = graph.descendants(\"feature-001\")\n\n# With depth limit\nimmediate_dependents = graph.descendants(\"feature-001\", max_depth=1)\n</code></pre>"},{"location":"api/graph/#transitive-dependencies","title":"Transitive Dependencies","text":"<pre><code># Get all transitive dependencies (follows blocked_by edges)\ndeps = graph.transitive_deps(\"feature-001\")\n</code></pre>"},{"location":"api/graph/#path-finding","title":"Path Finding","text":"<pre><code># Find shortest path between nodes\nshortest = graph.shortest_path(\"feature-001\", \"feature-045\")\n\n# Find all paths\nall_paths = graph.all_paths(\"feature-001\", \"feature-045\")\n\n# With max length constraint\nshort_paths = graph.all_paths(\"feature-001\", \"feature-045\", max_length=4)\n</code></pre>"},{"location":"api/graph/#subgraph-extraction","title":"Subgraph Extraction","text":"<pre><code># Extract subgraph with specific nodes\nsubset = graph.subgraph([\"feature-001\", \"feature-002\", \"feature-003\"])\n\n# Without internal edges\nnodes_only = graph.subgraph([\"f-001\", \"f-002\"], include_edges=False)\n</code></pre>"},{"location":"api/graph/#connected-components","title":"Connected Components","text":"<pre><code># Get all nodes in the same connected component\ncomponent = graph.connected_component(\"feature-001\")\n\n# Filter by relationship type\nblocking_component = graph.connected_component(\"feature-001\", relationship=\"blocked_by\")\n</code></pre>"},{"location":"api/graph/#graph-algorithms","title":"Graph Algorithms","text":""},{"location":"api/graph/#find-bottlenecks","title":"Find Bottlenecks","text":"<pre><code># Features blocking many others\nbottlenecks = graph.find_bottlenecks()\n</code></pre>"},{"location":"api/graph/#critical-path","title":"Critical Path","text":"<pre><code># Longest dependency chain\ncritical_path = graph.find_critical_path()\n</code></pre>"},{"location":"api/graph/#dependents","title":"Dependents","text":"<pre><code># Nodes that directly depend on this one (O(1) with EdgeIndex)\ndependents = graph.dependents(\"feature-001\")\n</code></pre>"},{"location":"api/graph/#complete-method-reference","title":"Complete Method Reference","text":""},{"location":"api/graph/#node-management","title":"Node Management","text":"Method Description <code>add(node, overwrite=False)</code> Add a node to the graph <code>get(node_id)</code> Get node by ID <code>update(node)</code> Update an existing node <code>remove(node_id)</code> Remove a node <code>nodes()</code> Iterator over all nodes"},{"location":"api/graph/#query-methods_1","title":"Query Methods","text":"Method Description <code>query(css_selector)</code> CSS selector query <code>query_builder()</code> Start fluent query builder <code>find(type=None, **kwargs)</code> Find first matching node <code>find_all(type=None, limit=None, **kwargs)</code> Find all matching nodes <code>find_related(node_id, relationship=None)</code> Find related nodes <code>find_blocking(node_id)</code> Find nodes this blocks <code>find_blocked_by(node_id)</code> Find nodes blocking this"},{"location":"api/graph/#edge-index_1","title":"Edge Index","text":"Method Description <code>get_incoming_edges(node_id, relationship=None)</code> Edges pointing to node <code>get_outgoing_edges(node_id, relationship=None)</code> Edges from node <code>get_neighbors(node_id)</code> All connected node IDs"},{"location":"api/graph/#traversal","title":"Traversal","text":"Method Description <code>ancestors(node_id, relationship, max_depth)</code> All ancestor nodes <code>descendants(node_id, relationship, max_depth)</code> All descendant nodes <code>transitive_deps(node_id)</code> All transitive dependencies <code>shortest_path(from_id, to_id)</code> Shortest path between nodes <code>all_paths(from_id, to_id, relationship, max_length)</code> All paths between nodes <code>subgraph(node_ids, include_edges)</code> Extract subgraph <code>connected_component(node_id, relationship)</code> Connected component"},{"location":"api/graph/#analysis","title":"Analysis","text":"Method Description <code>find_bottlenecks()</code> Nodes blocking many others <code>find_critical_path()</code> Longest dependency chain <code>dependents(node_id)</code> Direct dependents"},{"location":"api/graph/#see-also","title":"See Also","text":"<ul> <li>Query Cookbook - Comprehensive query examples</li> <li>Migration Guide - Migrating from CSS-only queries</li> <li>QueryBuilder - QueryBuilder API reference</li> <li>FindAPI - Find API reference</li> </ul>"},{"location":"api/ids/","title":"ID Generation","text":"<p>HtmlGraph provides collision-resistant, hash-based ID generation for multi-agent collaboration. This system prevents conflicts when multiple agents create tasks concurrently.</p> <p>\ud83d\udcd6 Design Document: For detailed architecture, implementation details, and rationale, see Hash-Based IDs Design Document.</p>"},{"location":"api/ids/#overview","title":"Overview","text":"<p>Traditional timestamp-based IDs (<code>feature-20241222-143022</code>) can collide when two agents create features at the same second. Hash-based IDs eliminate this problem by combining:</p> <ul> <li>Title (content-addressability)</li> <li>Timestamp (microsecond precision)</li> <li>Random entropy (4 bytes by default)</li> </ul>"},{"location":"api/ids/#id-format","title":"ID Format","text":"<p>IDs follow the format <code>{prefix}-{hash}</code>:</p> Node Type Prefix Example Feature <code>feat-</code> <code>feat-a1b2c3d4</code> Bug <code>bug-</code> <code>bug-12345678</code> Chore <code>chr-</code> <code>chr-deadbeef</code> Spike <code>spk-</code> <code>spk-87654321</code> Epic <code>epc-</code> <code>epc-abcdef12</code> Session <code>sess-</code> <code>sess-7890abcd</code> Track <code>trk-</code> <code>trk-fedcba98</code> Phase <code>phs-</code> <code>phs-11223344</code> Spec <code>spec-</code> <code>spec-55667788</code> Plan <code>plan-</code> <code>plan-99aabbcc</code>"},{"location":"api/ids/#basic-usage","title":"Basic Usage","text":""},{"location":"api/ids/#generating-ids","title":"Generating IDs","text":"<pre><code>from htmlgraph import generate_id\n\n# Generate a feature ID\nfeature_id = generate_id(\"feature\", \"User Authentication\")\n# \u2192 \"feat-a1b2c3d4\"\n\n# Generate a bug ID\nbug_id = generate_id(\"bug\", \"Login fails on Safari\")\n# \u2192 \"bug-12345678\"\n\n# Generate a track ID\ntrack_id = generate_id(\"track\", \"OAuth Integration\")\n# \u2192 \"trk-abcdef12\"\n</code></pre>"},{"location":"api/ids/#automatic-generation","title":"Automatic Generation","text":"<p>When using the SDK or CLI, IDs are generated automatically:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# ID generated automatically\nfeature = sdk.features.create(\n    title=\"User Authentication\"\n).set_priority(\"high\").save()\n\nprint(feature.id)  # \u2192 \"feat-7f3a2b1c\"\n</code></pre> <pre><code># CLI also generates hash-based IDs\nhtmlgraph feature create \"User Authentication\" --priority high\n# Created: feat-9e8d7c6b\n</code></pre>"},{"location":"api/ids/#hierarchical-ids","title":"Hierarchical IDs","text":"<p>For sub-tasks, use hierarchical IDs:</p> <pre><code>from htmlgraph import generate_hierarchical_id\n\n# Create parent feature\nparent_id = generate_id(\"feature\", \"Auth System\")  # \u2192 \"feat-a1b2c3d4\"\n\n# Create sub-tasks\nsubtask1 = generate_hierarchical_id(parent_id, 1)  # \u2192 \"feat-a1b2c3d4.1\"\nsubtask2 = generate_hierarchical_id(parent_id, 2)  # \u2192 \"feat-a1b2c3d4.2\"\n\n# Nested sub-tasks\nnested = generate_hierarchical_id(subtask1, 1)     # \u2192 \"feat-a1b2c3d4.1.1\"\n</code></pre>"},{"location":"api/ids/#parsing-ids","title":"Parsing IDs","text":"<p>Extract components from any ID:</p> <pre><code>from htmlgraph import parse_id\n\n# Parse a hash-based ID\nresult = parse_id(\"feat-a1b2c3d4.1.2\")\n# {\n#     'prefix': 'feat',\n#     'node_type': 'feature',\n#     'hash': 'a1b2c3d4',\n#     'hierarchy': [1, 2],\n#     'is_legacy': False\n# }\n\n# Parse a legacy ID\nresult = parse_id(\"feature-20241222-143022\")\n# {\n#     'prefix': 'feature',\n#     'node_type': 'feature',\n#     'hash': '20241222-143022',\n#     'hierarchy': [],\n#     'is_legacy': True\n# }\n</code></pre>"},{"location":"api/ids/#validation","title":"Validation","text":"<p>Check if IDs are valid:</p> <pre><code>from htmlgraph import is_valid_id, is_legacy_id\n\n# Hash-based IDs\nis_valid_id(\"feat-a1b2c3d4\")      # \u2192 True\nis_valid_id(\"feat-a1b2c3d4.1.2\")  # \u2192 True\n\n# Legacy IDs (still valid)\nis_valid_id(\"feature-20241222-143022\")  # \u2192 True\n\n# Invalid IDs\nis_valid_id(\"invalid\")            # \u2192 False\nis_valid_id(\"feat-xyz\")           # \u2192 False (not hex)\n\n# Check legacy format\nis_legacy_id(\"feature-20241222-143022\")  # \u2192 True\nis_legacy_id(\"feat-a1b2c3d4\")            # \u2192 False\n</code></pre>"},{"location":"api/ids/#hierarchy-helpers","title":"Hierarchy Helpers","text":"<p>Navigate hierarchical IDs:</p> <pre><code>from htmlgraph.ids import get_parent_id, get_root_id, get_depth\n\nid = \"feat-a1b2c3d4.1.2\"\n\nget_parent_id(id)  # \u2192 \"feat-a1b2c3d4.1\"\nget_root_id(id)    # \u2192 \"feat-a1b2c3d4\"\nget_depth(id)      # \u2192 2\n\n# Root IDs have no parent\nget_parent_id(\"feat-a1b2c3d4\")  # \u2192 None\nget_depth(\"feat-a1b2c3d4\")      # \u2192 0\n</code></pre>"},{"location":"api/ids/#collision-resistance","title":"Collision Resistance","text":"<p>With 4 bytes of random entropy (default), the probability of collision is approximately 1 in 4 billion per ID generated. Combined with microsecond timestamps and title hashing, collisions are effectively impossible even with thousands of concurrent agents.</p> <pre><code># Generate 1000 IDs with identical titles\nids = [generate_id(\"feature\", \"Same Title\") for _ in range(1000)]\nunique = len(set(ids))\nprint(f\"Generated {unique} unique IDs\")  # \u2192 \"Generated 1000 unique IDs\"\n</code></pre>"},{"location":"api/ids/#backward-compatibility","title":"Backward Compatibility","text":"<p>Legacy timestamp-based IDs remain fully supported:</p> <ul> <li>Existing features with old IDs continue to work</li> <li><code>parse_id()</code> correctly identifies legacy format</li> <li><code>is_valid_id()</code> accepts both formats</li> <li>No migration required</li> </ul>"},{"location":"api/ids/#api-reference","title":"API Reference","text":""},{"location":"api/ids/#htmlgraph.ids.generate_id","title":"generate_id","text":"<pre><code>generate_id(node_type: str = 'feature', title: str = '', entropy_bytes: int = 4) -&gt; str\n</code></pre> <p>Generate a collision-resistant ID.</p> <p>Format: {prefix}-{hash} (e.g., feat-a1b2c3d4)</p> <p>The hash is derived from: - Title (for some content-addressability) - Timestamp (microsecond precision in UTC) - Random bytes (entropy)</p> PARAMETER DESCRIPTION <code>node_type</code> <p>Type of node (feature, bug, chore, etc.)</p> <p> TYPE: <code>str</code> DEFAULT: <code>'feature'</code> </p> <code>title</code> <p>Node title (used in hash for content-addressability)</p> <p> TYPE: <code>str</code> DEFAULT: <code>''</code> </p> <code>entropy_bytes</code> <p>Number of random bytes to include (default 4)</p> <p> TYPE: <code>int</code> DEFAULT: <code>4</code> </p> RETURNS DESCRIPTION <code>str</code> <p>A collision-resistant ID like \"feat-a1b2c3d4\"</p> Example <p>generate_id(\"feature\", \"User Authentication\") 'feat-7f3a2b1c' generate_id(\"bug\", \"Login fails on Safari\") 'bug-9e8d7c6b'</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def generate_id(\n    node_type: str = \"feature\",\n    title: str = \"\",\n    entropy_bytes: int = 4,\n) -&gt; str:\n    \"\"\"\n    Generate a collision-resistant ID.\n\n    Format: {prefix}-{hash} (e.g., feat-a1b2c3d4)\n\n    The hash is derived from:\n    - Title (for some content-addressability)\n    - Timestamp (microsecond precision in UTC)\n    - Random bytes (entropy)\n\n    Args:\n        node_type: Type of node (feature, bug, chore, etc.)\n        title: Node title (used in hash for content-addressability)\n        entropy_bytes: Number of random bytes to include (default 4)\n\n    Returns:\n        A collision-resistant ID like \"feat-a1b2c3d4\"\n\n    Example:\n        &gt;&gt;&gt; generate_id(\"feature\", \"User Authentication\")\n        'feat-7f3a2b1c'\n        &gt;&gt;&gt; generate_id(\"bug\", \"Login fails on Safari\")\n        'bug-9e8d7c6b'\n    \"\"\"\n    prefix = PREFIXES.get(node_type, node_type[:4].lower())\n\n    # Combine multiple sources of uniqueness\n    timestamp = datetime.now(timezone.utc).isoformat()\n    random_bytes = os.urandom(entropy_bytes)\n\n    # Create hash from all sources\n    content = f\"{title}:{timestamp}\".encode() + random_bytes\n    hash_digest = hashlib.sha256(content).hexdigest()[:8]\n\n    return f\"{prefix}-{hash_digest}\"\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.generate_hierarchical_id","title":"generate_hierarchical_id","text":"<pre><code>generate_hierarchical_id(parent_id: str, index: int | None = None) -&gt; str\n</code></pre> <p>Generate a sub-task ID under a parent.</p> <p>Format: {parent_id}.{index} (e.g., feat-a1b2c3d4.1)</p> <p>If index is not provided, it auto-increments based on existing siblings (requires filesystem check).</p> PARAMETER DESCRIPTION <code>parent_id</code> <p>The parent node's ID</p> <p> TYPE: <code>str</code> </p> <code>index</code> <p>Sub-task index (1-based). Auto-assigned if None.</p> <p> TYPE: <code>int | None</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <code>str</code> <p>A hierarchical ID like \"feat-a1b2c3d4.1\" or \"feat-a1b2c3d4.1.2\"</p> Example <p>generate_hierarchical_id(\"feat-a1b2c3d4\", 1) 'feat-a1b2c3d4.1' generate_hierarchical_id(\"feat-a1b2c3d4.1\", 2) 'feat-a1b2c3d4.1.2'</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def generate_hierarchical_id(\n    parent_id: str,\n    index: int | None = None,\n) -&gt; str:\n    \"\"\"\n    Generate a sub-task ID under a parent.\n\n    Format: {parent_id}.{index} (e.g., feat-a1b2c3d4.1)\n\n    If index is not provided, it auto-increments based on\n    existing siblings (requires filesystem check).\n\n    Args:\n        parent_id: The parent node's ID\n        index: Sub-task index (1-based). Auto-assigned if None.\n\n    Returns:\n        A hierarchical ID like \"feat-a1b2c3d4.1\" or \"feat-a1b2c3d4.1.2\"\n\n    Example:\n        &gt;&gt;&gt; generate_hierarchical_id(\"feat-a1b2c3d4\", 1)\n        'feat-a1b2c3d4.1'\n        &gt;&gt;&gt; generate_hierarchical_id(\"feat-a1b2c3d4.1\", 2)\n        'feat-a1b2c3d4.1.2'\n    \"\"\"\n    if index is None:\n        raise ValueError(\"index is required (auto-increment not yet implemented)\")\n\n    if index &lt; 1:\n        raise ValueError(\"index must be &gt;= 1\")\n\n    return f\"{parent_id}.{index}\"\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.parse_id","title":"parse_id","text":"<pre><code>parse_id(node_id: str) -&gt; dict[str, str | int | list[int] | None]\n</code></pre> <p>Parse an ID into its components.</p> PARAMETER DESCRIPTION <code>node_id</code> <p>The ID to parse</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>dict[str, str | int | list[int] | None]</code> <p>Dictionary with:</p> <code>dict[str, str | int | list[int] | None]</code> <ul> <li>prefix: The type prefix (e.g., \"feat\")</li> </ul> <code>dict[str, str | int | list[int] | None]</code> <ul> <li>node_type: The full node type (e.g., \"feature\")</li> </ul> <code>dict[str, str | int | list[int] | None]</code> <ul> <li>hash: The hash portion (e.g., \"a1b2c3d4\")</li> </ul> <code>dict[str, str | int | list[int] | None]</code> <ul> <li>hierarchy: List of sub-indices (e.g., [1, 2] for \".1.2\")</li> </ul> <code>dict[str, str | int | list[int] | None]</code> <ul> <li>is_legacy: Whether this is an old-format ID</li> </ul> Example <p>parse_id(\"feat-a1b2c3d4.1.2\") {     'prefix': 'feat',     'node_type': 'feature',     'hash': 'a1b2c3d4',     'hierarchy': [1, 2],     'is_legacy': False }</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def parse_id(node_id: str) -&gt; dict[str, str | int | list[int] | None]:\n    \"\"\"\n    Parse an ID into its components.\n\n    Args:\n        node_id: The ID to parse\n\n    Returns:\n        Dictionary with:\n        - prefix: The type prefix (e.g., \"feat\")\n        - node_type: The full node type (e.g., \"feature\")\n        - hash: The hash portion (e.g., \"a1b2c3d4\")\n        - hierarchy: List of sub-indices (e.g., [1, 2] for \".1.2\")\n        - is_legacy: Whether this is an old-format ID\n\n    Example:\n        &gt;&gt;&gt; parse_id(\"feat-a1b2c3d4.1.2\")\n        {\n            'prefix': 'feat',\n            'node_type': 'feature',\n            'hash': 'a1b2c3d4',\n            'hierarchy': [1, 2],\n            'is_legacy': False\n        }\n    \"\"\"\n    # Try new hash-based format\n    match = HASH_ID_PATTERN.match(node_id)\n    if match:\n        prefix = match.group(1)\n        hash_part = match.group(2)\n\n        # Extract hierarchy by finding all .N segments after the hash\n        # The regex captures the last one, but we need all of them\n        hierarchy = []\n        base_id = f\"{prefix}-{hash_part}\"\n        if len(node_id) &gt; len(base_id):\n            hierarchy_str = node_id[len(base_id) :]  # e.g., \".1.2\"\n            hierarchy = [int(x) for x in hierarchy_str.split(\".\") if x]\n\n        return {\n            \"prefix\": prefix,\n            \"node_type\": PREFIX_TO_TYPE.get(prefix, prefix),\n            \"hash\": hash_part,\n            \"hierarchy\": hierarchy,\n            \"is_legacy\": False,\n        }\n\n    # Try legacy format (feature-20241222-143022)\n    legacy_match = LEGACY_ID_PATTERN.match(node_id)\n    if legacy_match:\n        prefix = legacy_match.group(1)\n        timestamp = legacy_match.group(2)\n\n        return {\n            \"prefix\": prefix,\n            \"node_type\": prefix,  # Legacy uses full type as prefix\n            \"hash\": timestamp,\n            \"hierarchy\": [],\n            \"is_legacy\": True,\n        }\n\n    # Unknown format\n    return {\n        \"prefix\": None,\n        \"node_type\": None,\n        \"hash\": None,\n        \"hierarchy\": [],\n        \"is_legacy\": None,\n    }\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.is_valid_id","title":"is_valid_id","text":"<pre><code>is_valid_id(node_id: str) -&gt; bool\n</code></pre> <p>Check if an ID is valid (either new or legacy format).</p> PARAMETER DESCRIPTION <code>node_id</code> <p>The ID to validate</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>bool</code> <p>True if the ID matches a known format</p> Example <p>is_valid_id(\"feat-a1b2c3d4\") True is_valid_id(\"feat-a1b2c3d4.1.2\") True is_valid_id(\"feature-20241222-143022\") True is_valid_id(\"invalid\") False</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def is_valid_id(node_id: str) -&gt; bool:\n    \"\"\"\n    Check if an ID is valid (either new or legacy format).\n\n    Args:\n        node_id: The ID to validate\n\n    Returns:\n        True if the ID matches a known format\n\n    Example:\n        &gt;&gt;&gt; is_valid_id(\"feat-a1b2c3d4\")\n        True\n        &gt;&gt;&gt; is_valid_id(\"feat-a1b2c3d4.1.2\")\n        True\n        &gt;&gt;&gt; is_valid_id(\"feature-20241222-143022\")\n        True\n        &gt;&gt;&gt; is_valid_id(\"invalid\")\n        False\n    \"\"\"\n    return bool(HASH_ID_PATTERN.match(node_id) or LEGACY_ID_PATTERN.match(node_id))\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.is_legacy_id","title":"is_legacy_id","text":"<pre><code>is_legacy_id(node_id: str) -&gt; bool\n</code></pre> <p>Check if an ID uses the legacy timestamp format.</p> PARAMETER DESCRIPTION <code>node_id</code> <p>The ID to check</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>bool</code> <p>True if this is a legacy format ID (e.g., feature-20241222-143022)</p> Example <p>is_legacy_id(\"feature-20241222-143022\") True is_legacy_id(\"feat-a1b2c3d4\") False</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def is_legacy_id(node_id: str) -&gt; bool:\n    \"\"\"\n    Check if an ID uses the legacy timestamp format.\n\n    Args:\n        node_id: The ID to check\n\n    Returns:\n        True if this is a legacy format ID (e.g., feature-20241222-143022)\n\n    Example:\n        &gt;&gt;&gt; is_legacy_id(\"feature-20241222-143022\")\n        True\n        &gt;&gt;&gt; is_legacy_id(\"feat-a1b2c3d4\")\n        False\n    \"\"\"\n    return bool(LEGACY_ID_PATTERN.match(node_id))\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.get_parent_id","title":"get_parent_id","text":"<pre><code>get_parent_id(node_id: str) -&gt; str | None\n</code></pre> <p>Get the parent ID for a hierarchical ID.</p> PARAMETER DESCRIPTION <code>node_id</code> <p>A hierarchical ID like \"feat-a1b2c3d4.1.2\"</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>str | None</code> <p>The parent ID (\"feat-a1b2c3d4.1\") or None if not hierarchical</p> Example <p>get_parent_id(\"feat-a1b2c3d4.1.2\") 'feat-a1b2c3d4.1' get_parent_id(\"feat-a1b2c3d4.1\") 'feat-a1b2c3d4' get_parent_id(\"feat-a1b2c3d4\") None</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def get_parent_id(node_id: str) -&gt; str | None:\n    \"\"\"\n    Get the parent ID for a hierarchical ID.\n\n    Args:\n        node_id: A hierarchical ID like \"feat-a1b2c3d4.1.2\"\n\n    Returns:\n        The parent ID (\"feat-a1b2c3d4.1\") or None if not hierarchical\n\n    Example:\n        &gt;&gt;&gt; get_parent_id(\"feat-a1b2c3d4.1.2\")\n        'feat-a1b2c3d4.1'\n        &gt;&gt;&gt; get_parent_id(\"feat-a1b2c3d4.1\")\n        'feat-a1b2c3d4'\n        &gt;&gt;&gt; get_parent_id(\"feat-a1b2c3d4\")\n        None\n    \"\"\"\n    if \".\" not in node_id:\n        return None\n\n    return node_id.rsplit(\".\", 1)[0]\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.get_root_id","title":"get_root_id","text":"<pre><code>get_root_id(node_id: str) -&gt; str\n</code></pre> <p>Get the root ID (without hierarchy) for any ID.</p> PARAMETER DESCRIPTION <code>node_id</code> <p>Any ID, possibly hierarchical</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>str</code> <p>The root ID without hierarchy portion</p> Example <p>get_root_id(\"feat-a1b2c3d4.1.2\") 'feat-a1b2c3d4' get_root_id(\"feat-a1b2c3d4\") 'feat-a1b2c3d4'</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def get_root_id(node_id: str) -&gt; str:\n    \"\"\"\n    Get the root ID (without hierarchy) for any ID.\n\n    Args:\n        node_id: Any ID, possibly hierarchical\n\n    Returns:\n        The root ID without hierarchy portion\n\n    Example:\n        &gt;&gt;&gt; get_root_id(\"feat-a1b2c3d4.1.2\")\n        'feat-a1b2c3d4'\n        &gt;&gt;&gt; get_root_id(\"feat-a1b2c3d4\")\n        'feat-a1b2c3d4'\n    \"\"\"\n    parsed = parse_id(node_id)\n    if parsed[\"prefix\"] and parsed[\"hash\"]:\n        return f\"{parsed['prefix']}-{parsed['hash']}\"\n    return node_id.split(\".\")[0]\n</code></pre>"},{"location":"api/ids/#htmlgraph.ids.get_depth","title":"get_depth","text":"<pre><code>get_depth(node_id: str) -&gt; int\n</code></pre> <p>Get the hierarchy depth of an ID.</p> PARAMETER DESCRIPTION <code>node_id</code> <p>Any ID</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>int</code> <p>0 for root IDs, 1+ for hierarchical IDs</p> Example <p>get_depth(\"feat-a1b2c3d4\") 0 get_depth(\"feat-a1b2c3d4.1\") 1 get_depth(\"feat-a1b2c3d4.1.2\") 2</p> Source code in <code>src/python/htmlgraph/ids.py</code> <pre><code>def get_depth(node_id: str) -&gt; int:\n    \"\"\"\n    Get the hierarchy depth of an ID.\n\n    Args:\n        node_id: Any ID\n\n    Returns:\n        0 for root IDs, 1+ for hierarchical IDs\n\n    Example:\n        &gt;&gt;&gt; get_depth(\"feat-a1b2c3d4\")\n        0\n        &gt;&gt;&gt; get_depth(\"feat-a1b2c3d4.1\")\n        1\n        &gt;&gt;&gt; get_depth(\"feat-a1b2c3d4.1.2\")\n        2\n    \"\"\"\n    parsed = parse_id(node_id)\n    hierarchy = parsed.get(\"hierarchy\", [])\n    if isinstance(hierarchy, list):\n        return len(hierarchy)\n    return 0\n</code></pre>"},{"location":"api/models/","title":"Models","text":"<p>Pydantic data models for HtmlGraph entities.</p>"},{"location":"api/models/#overview","title":"Overview","text":"<p>HtmlGraph uses Pydantic models for:</p> <ul> <li>Type safety and validation</li> <li>Serialization to/from HTML</li> <li>JSON export/import</li> <li>Schema documentation</li> </ul> <p>All models are immutable by default and validate on construction.</p>"},{"location":"api/models/#feature","title":"Feature","text":"<p>Represents a unit of work.</p> <pre><code>from htmlgraph.models import Feature, FeatureStatus, Priority\n\nfeature = Feature(\n    id=\"feature-20241216-103045\",\n    title=\"Add user authentication\",\n    status=FeatureStatus.IN_PROGRESS,\n    priority=Priority.HIGH,\n    steps=[\n        Step(description=\"Create endpoint\", completed=True),\n        Step(description=\"Add middleware\", completed=False)\n    ]\n)\n</code></pre>"},{"location":"api/models/#fields","title":"Fields","text":"<ul> <li><code>id: str</code> - Unique identifier</li> <li><code>title: str</code> - Feature title</li> <li><code>status: FeatureStatus</code> - Current status</li> <li><code>priority: Priority</code> - Priority level</li> <li><code>created: datetime</code> - Creation timestamp</li> <li><code>updated: datetime</code> - Last update timestamp</li> <li><code>steps: list[Step]</code> - Implementation steps</li> <li><code>properties: dict</code> - Custom properties</li> <li><code>track_id: Optional[str]</code> - Parent track ID</li> </ul>"},{"location":"api/models/#methods","title":"Methods","text":"<ul> <li><code>to_html() -&gt; str</code> - Convert to HTML file content</li> <li><code>save()</code> - Save to disk</li> <li><code>to_dict() -&gt; dict</code> - Convert to dictionary</li> <li><code>to_json() -&gt; str</code> - Convert to JSON</li> </ul>"},{"location":"api/models/#track","title":"Track","text":"<p>Represents a multi-feature project.</p> <pre><code>from htmlgraph.models import Track\n\ntrack = Track(\n    track_id=\"track-20241216-120000\",\n    title=\"User Authentication System\",\n    priority=Priority.HIGH,\n    has_spec=True,\n    has_plan=True\n)\n</code></pre>"},{"location":"api/models/#fields_1","title":"Fields","text":"<ul> <li><code>track_id: str</code> - Unique identifier</li> <li><code>title: str</code> - Track title</li> <li><code>description: str</code> - Track description</li> <li><code>priority: Priority</code> - Priority level</li> <li><code>status: str</code> - Current status</li> <li><code>created: datetime</code> - Creation timestamp</li> <li><code>updated: datetime</code> - Last update timestamp</li> <li><code>has_spec: bool</code> - Whether track has a spec</li> <li><code>has_plan: bool</code> - Whether track has a plan</li> </ul>"},{"location":"api/models/#session","title":"Session","text":"<p>Represents an agent work session.</p> <pre><code>from htmlgraph.models import Session\n\nsession = Session(\n    id=\"session-abc-123\",\n    agent=\"claude\",\n    start_time=datetime.now(),\n    features_worked_on=[\"feature-001\", \"feature-002\"]\n)\n</code></pre>"},{"location":"api/models/#fields_2","title":"Fields","text":"<ul> <li><code>id: str</code> - Unique identifier</li> <li><code>agent: str</code> - Agent name</li> <li><code>start_time: datetime</code> - Session start</li> <li><code>end_time: Optional[datetime]</code> - Session end</li> <li><code>features_worked_on: list[str]</code> - Feature IDs</li> <li><code>event_count: int</code> - Number of events logged</li> </ul>"},{"location":"api/models/#step","title":"Step","text":"<p>Represents a single implementation step.</p> <pre><code>from htmlgraph.models import Step\n\nstep = Step(\n    description=\"Create login endpoint\",\n    completed=False,\n    agent=\"claude\",\n    timestamp=datetime.now()\n)\n</code></pre>"},{"location":"api/models/#fields_3","title":"Fields","text":"<ul> <li><code>description: str</code> - Step description</li> <li><code>completed: bool</code> - Completion status</li> <li><code>agent: Optional[str]</code> - Agent who completed it</li> <li><code>timestamp: Optional[datetime]</code> - Completion time</li> </ul>"},{"location":"api/models/#enums","title":"Enums","text":""},{"location":"api/models/#featurestatus","title":"FeatureStatus","text":"<pre><code>from htmlgraph.models import FeatureStatus\n\nFeatureStatus.TODO         # Not started\nFeatureStatus.IN_PROGRESS  # Currently working\nFeatureStatus.BLOCKED      # Waiting on dependencies\nFeatureStatus.DONE         # Completed\nFeatureStatus.CANCELLED    # Work abandoned\n</code></pre>"},{"location":"api/models/#priority","title":"Priority","text":"<pre><code>from htmlgraph.models import Priority\n\nPriority.LOW       # Low priority\nPriority.MEDIUM    # Medium priority (default)\nPriority.HIGH      # High priority\nPriority.CRITICAL  # Critical priority\n</code></pre>"},{"location":"api/models/#complete-api-reference","title":"Complete API Reference","text":"<p>For detailed API documentation with type signatures and complete field definitions, see the Python source code in <code>src/python/htmlgraph/models.py</code>.</p>"},{"location":"api/planning/","title":"Planning","text":"<p>Spec and Plan models for track planning.</p>"},{"location":"api/planning/#spec","title":"Spec","text":"<p>The Spec model defines requirements and success criteria for a track.</p> <pre><code>from htmlgraph.planning import Spec, Requirement, AcceptanceCriterion\n\nspec = Spec(\n    overview=\"Add OAuth 2.0 support for user authentication\",\n    context=\"Current system has no authentication. Need secure login.\",\n    requirements=[\n        Requirement(\n            description=\"Implement OAuth 2.0 flow\",\n            priority=\"must-have\"\n        ),\n        Requirement(\n            description=\"Add JWT token management\",\n            priority=\"must-have\"\n        )\n    ],\n    acceptance_criteria=[\n        AcceptanceCriterion(\n            description=\"Users can log in with Google/GitHub\",\n            test_case=\"OAuth login test passes\"\n        )\n    ]\n)\n</code></pre>"},{"location":"api/planning/#fields","title":"Fields","text":"<ul> <li><code>overview: str</code> - High-level summary</li> <li><code>context: str</code> - Background and constraints</li> <li><code>requirements: list[Requirement]</code> - List of requirements</li> <li><code>acceptance_criteria: list[AcceptanceCriterion]</code> - Success criteria</li> <li><code>constraints: Optional[list[str]]</code> - Technical/business constraints</li> </ul>"},{"location":"api/planning/#plan","title":"Plan","text":"<p>The Plan model defines phased implementation tasks.</p> <pre><code>from htmlgraph.planning import Plan, Phase, Task\n\nplan = Plan(\n    phases=[\n        Phase(\n            name=\"Phase 1: Setup\",\n            tasks=[\n                Task(description=\"Configure OAuth providers\", estimate_hours=2.0),\n                Task(description=\"Set up database schema\", estimate_hours=1.0)\n            ]\n        ),\n        Phase(\n            name=\"Phase 2: Implementation\",\n            tasks=[\n                Task(description=\"Implement login flow\", estimate_hours=4.0),\n                Task(description=\"Add JWT middleware\", estimate_hours=3.0)\n            ]\n        )\n    ]\n)\n</code></pre>"},{"location":"api/planning/#fields_1","title":"Fields","text":"<ul> <li><code>phases: list[Phase]</code> - List of implementation phases</li> <li><code>total_estimate_hours: float</code> - Auto-calculated total time</li> </ul>"},{"location":"api/planning/#requirement","title":"Requirement","text":"<pre><code>from htmlgraph.planning import Requirement, RequirementPriority\n\nreq = Requirement(\n    description=\"Implement OAuth 2.0 flow\",\n    priority=RequirementPriority.MUST_HAVE\n)\n</code></pre>"},{"location":"api/planning/#fields_2","title":"Fields","text":"<ul> <li><code>description: str</code> - Requirement description</li> <li><code>priority: RequirementPriority</code> - must-have, should-have, nice-to-have</li> </ul>"},{"location":"api/planning/#acceptancecriterion","title":"AcceptanceCriterion","text":"<pre><code>from htmlgraph.planning import AcceptanceCriterion\n\ncriterion = AcceptanceCriterion(\n    description=\"Users can log in with Google\",\n    test_case=\"OAuth login test passes\"\n)\n</code></pre>"},{"location":"api/planning/#fields_3","title":"Fields","text":"<ul> <li><code>description: str</code> - What success looks like</li> <li><code>test_case: Optional[str]</code> - How to verify</li> </ul>"},{"location":"api/planning/#phase","title":"Phase","text":"<pre><code>from htmlgraph.planning import Phase, Task\n\nphase = Phase(\n    name=\"Phase 1: Setup\",\n    tasks=[\n        Task(description=\"Configure OAuth (2h)\", estimate_hours=2.0),\n        Task(description=\"Setup DB (1h)\", estimate_hours=1.0)\n    ]\n)\n</code></pre>"},{"location":"api/planning/#fields_4","title":"Fields","text":"<ul> <li><code>name: str</code> - Phase name</li> <li><code>tasks: list[Task]</code> - List of tasks in this phase</li> </ul>"},{"location":"api/planning/#task","title":"Task","text":"<pre><code>from htmlgraph.planning import Task\n\ntask = Task(\n    description=\"Implement OAuth flow\",\n    estimate_hours=4.0,\n    completed=False\n)\n</code></pre>"},{"location":"api/planning/#fields_5","title":"Fields","text":"<ul> <li><code>description: str</code> - Task description</li> <li><code>estimate_hours: Optional[float]</code> - Time estimate</li> <li><code>completed: bool</code> - Completion status</li> </ul>"},{"location":"api/planning/#complete-api-reference","title":"Complete API Reference","text":"<p>For detailed API documentation with type signatures and validation rules, see the Python source code in <code>src/python/htmlgraph/planning.py</code>.</p>"},{"location":"api/sdk/","title":"SDK","text":"<p>The SDK is the main interface for interacting with HtmlGraph.</p>"},{"location":"api/sdk/#overview","title":"Overview","text":"<p>The SDK provides a high-level API for:</p> <ul> <li>Creating and managing features</li> <li>Creating and managing tracks</li> <li>Querying the graph</li> <li>Session management</li> <li>Activity tracking</li> </ul>"},{"location":"api/sdk/#initialization","title":"Initialization","text":"<pre><code>from htmlgraph import SDK\n\n# Basic initialization\nsdk = SDK(agent=\"claude\")\n\n# Custom graph directory\nsdk = SDK(agent=\"claude\", graph_dir=\"/path/to/.htmlgraph\")\n\n# Disable auto-session management\nsdk = SDK(agent=\"claude\", auto_session=False)\n</code></pre>"},{"location":"api/sdk/#features-api","title":"Features API","text":""},{"location":"api/sdk/#creating-features","title":"Creating Features","text":"<pre><code># Basic feature\nfeature = sdk.features.create(\n    title=\"Add login page\",\n    priority=\"high\"\n)\n\n# Feature with steps\nfeature = sdk.features.create(\n    title=\"Add login page\",\n    priority=\"high\",\n    steps=[\"Create component\", \"Add routing\", \"Write tests\"]\n)\n\n# Feature with custom properties\nfeature = sdk.features.create(\n    title=\"Add login page\",\n    priority=\"high\",\n    properties={\"effort\": 4, \"assignee\": \"claude\"}\n)\n</code></pre>"},{"location":"api/sdk/#querying-features","title":"Querying Features","text":"<pre><code># Get all features\nall_features = sdk.features.all()\n\n# Filter by status\nin_progress = sdk.features.where(status=\"in-progress\")\n\n# Filter by priority\nhigh_priority = sdk.features.where(priority=\"high\")\n\n# Multiple filters\nblocked_high = sdk.features.where(status=\"blocked\", priority=\"high\")\n\n# Get specific feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n</code></pre>"},{"location":"api/sdk/#updating-features","title":"Updating Features","text":"<pre><code># Get feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n\n# Update and save\nfeature.status = \"in-progress\"\nfeature.steps[0].completed = True\nfeature.save()\n</code></pre>"},{"location":"api/sdk/#deleting-features","title":"Deleting Features","text":"<pre><code># Delete a single feature\ndeleted = sdk.features.delete(\"feature-20241216-103045\")\n# Returns: True if deleted, False if not found\n\n# Delete multiple features (batch operation)\ncount = sdk.features.batch_delete([\n    \"feature-001\",\n    \"feature-002\",\n    \"feature-003\"\n])\n# Returns: Number of features successfully deleted\n\n# Delete works across all collections\nsdk.bugs.delete(\"bug-001\")\nsdk.chores.delete(\"chore-001\")\nsdk.spikes.delete(\"spike-001\")\n\n# Batch delete with edge cleanup\n# Edges involving deleted nodes are automatically cleaned up\nsdk.features.batch_delete([\"duplicate-1\", \"duplicate-2\"])\n</code></pre> <p>Note: Delete operations automatically: - Remove the HTML file from disk - Clean up all edges involving the node (incoming and outgoing) - Update the in-memory edge index</p>"},{"location":"api/sdk/#tracks-api","title":"Tracks API","text":""},{"location":"api/sdk/#creating-tracks","title":"Creating Tracks","text":"<pre><code># Simple track\ntrack = sdk.tracks.create(title=\"Project\", priority=\"high\")\n\n# Track with TrackBuilder\ntrack = sdk.tracks.builder() \\\n    .title(\"OAuth Integration\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 support\",\n        requirements=[(\"Google OAuth\", \"must-have\")]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1\", [\"Setup OAuth (2h)\", \"Configure (1h)\"])\n    ]) \\\n    .create()\n</code></pre>"},{"location":"api/sdk/#querying-tracks","title":"Querying Tracks","text":"<pre><code># Get all tracks\nall_tracks = sdk.tracks.all()\n\n# Get specific track\ntrack = sdk.tracks.get(\"track-20241216-120000\")\n\n# Get features for a track\nfeatures = sdk.features.where(track_id=track.track_id)\n</code></pre>"},{"location":"api/sdk/#sessions-api","title":"Sessions API","text":""},{"location":"api/sdk/#session-management","title":"Session Management","text":"<pre><code># Get all sessions\nsessions = sdk.sessions.all()\n\n# Get current session\ncurrent = sdk.sessions.current()\n\n# Get specific session\nsession = sdk.sessions.get(\"session-abc-123\")\n</code></pre>"},{"location":"api/sdk/#activity-tracking","title":"Activity Tracking","text":"<pre><code># Track custom activity\nsdk.track_activity(\n    feature_id=\"feature-001\",\n    activity=\"Chose PostgreSQL over MongoDB for better transactions\"\n)\n</code></pre>"},{"location":"api/sdk/#status-api","title":"Status API","text":"<pre><code># Get current status\nstatus = sdk.status()\n\nprint(f\"Current session: {status.current_session}\")\nprint(f\"Active features: {status.active_features}\")\nprint(f\"Total features: {status.total_features}\")\nprint(f\"Progress: {status.progress}%\")\n</code></pre>"},{"location":"api/sdk/#graph-operations","title":"Graph Operations","text":""},{"location":"api/sdk/#relationships","title":"Relationships","text":"<pre><code># Add edge between features\nsdk.features.add_edge(\n    from_id=\"feature-001\",\n    to_id=\"feature-002\",\n    relationship=\"blocks\"\n)\n\n# Get dependencies\ndeps = sdk.features.get_dependencies(\"feature-001\")\n\n# Get blocking features\nblocking = sdk.features.get_blocking(\"feature-001\")\n</code></pre>"},{"location":"api/sdk/#graph-queries","title":"Graph Queries","text":"<pre><code># Query with CSS selectors\nblocked = sdk.features.query('[data-status=\"blocked\"]')\nhigh_priority = sdk.features.query('[data-priority=\"high\"]')\n\n# Graph traversal\npath = sdk.graph.shortest_path(\"feature-001\", \"feature-045\")\ntransitive_deps = sdk.graph.transitive_deps(\"feature-001\")\nbottlenecks = sdk.graph.find_bottlenecks()\n</code></pre>"},{"location":"api/sdk/#sdk-architecture-module-organization","title":"SDK Architecture &amp; Module Organization","text":""},{"location":"api/sdk/#module-structure","title":"Module Structure","text":"<p>The SDK is organized into modular components for better maintainability and separation of concerns:</p> <pre><code>htmlgraph/\n\u251c\u2500\u2500 builders/          # Fluent builders for node creation\n\u2502   \u251c\u2500\u2500 base.py       # BaseBuilder with common methods\n\u2502   \u251c\u2500\u2500 feature.py    # FeatureBuilder\n\u2502   \u251c\u2500\u2500 spike.py      # SpikeBuilder\n\u2502   \u2514\u2500\u2500 track.py      # TrackBuilder\n\u251c\u2500\u2500 collections/       # Collection interfaces for querying/updating\n\u2502   \u251c\u2500\u2500 base.py       # BaseCollection with CRUD operations\n\u2502   \u251c\u2500\u2500 feature.py    # FeatureCollection with builder support\n\u2502   \u2514\u2500\u2500 spike.py      # SpikeCollection with builder support\n\u251c\u2500\u2500 analytics/         # Analytics and strategic planning\n\u2502   \u251c\u2500\u2500 work_type.py  # Work type analytics (Analytics class)\n\u2502   \u251c\u2500\u2500 dependency.py # Dependency analytics (DependencyAnalytics class)\n\u2502   \u2514\u2500\u2500 cli.py        # CLI analytics helpers\n\u251c\u2500\u2500 sdk.py            # Main SDK class (single entry point)\n\u2514\u2500\u2500 session_manager.py # Session and activity tracking\n</code></pre>"},{"location":"api/sdk/#import-paths","title":"Import Paths","text":"<p>Recommended imports:</p> <pre><code>from htmlgraph import SDK, Analytics, DependencyAnalytics\nfrom htmlgraph.builders import FeatureBuilder, SpikeBuilder, TrackBuilder\nfrom htmlgraph.collections import BaseCollection, FeatureCollection\nfrom htmlgraph.models import SpikeType, MaintenanceType, WorkType\n\n# Direct module imports (advanced usage)\nfrom htmlgraph.analytics import Analytics, DependencyAnalytics\nfrom htmlgraph.analytics.work_type import Analytics\nfrom htmlgraph.analytics.dependency import DependencyAnalytics\n</code></pre>"},{"location":"api/sdk/#sdk-components","title":"SDK Components","text":"<p>1. Collections - Query and manage nodes</p> <pre><code>sdk.features   # FeatureCollection - features with builder support\nsdk.bugs       # BaseCollection - bug reports\nsdk.chores     # BaseCollection - maintenance tasks\nsdk.spikes     # SpikeCollection - investigation spikes\nsdk.epics      # BaseCollection - large bodies of work\nsdk.tracks     # TrackCollection - multi-feature initiatives\n</code></pre> <p>2. Builders - Fluent interfaces for node creation</p> <pre><code># Features\nfeature = sdk.features.create(\"Add auth\") \\\n    .set_priority(\"high\") \\\n    .add_steps([\"Step 1\", \"Step 2\"]) \\\n    .save()\n\n# Spikes\nspike = sdk.spikes.create(\"Research OAuth\") \\\n    .set_spike_type(SpikeType.TECHNICAL) \\\n    .set_timebox_hours(4) \\\n    .save()\n\n# Tracks\ntrack = sdk.tracks.builder() \\\n    .title(\"User Management\") \\\n    .with_spec(overview=\"...\") \\\n    .with_plan_phases([...]) \\\n    .create()\n</code></pre> <p>3. Analytics - Strategic planning and insights</p> <pre><code># Work type analytics\ndistribution = sdk.analytics.work_type_distribution(session_id=\"...\")\nratio = sdk.analytics.spike_to_feature_ratio()\n\n# Dependency analytics\nbottlenecks = sdk.dep_analytics.find_bottlenecks(top_n=5)\nrecommendations = sdk.dep_analytics.recommend_next_work(agent_count=3)\nparallel_work = sdk.dep_analytics.get_parallel_work(max_agents=5)\n</code></pre> <p>4. Session Management - Activity tracking</p> <pre><code># Sessions are managed automatically via SDK\n# Access SessionManager through SDK if needed\nsession = sdk.session_manager.get_active_session(agent=\"claude\")\nsdk.start_session(title=\"Feature implementation\")\nsdk.end_session(session_id=\"...\", handoff_notes=\"...\")\n</code></pre>"},{"location":"api/sdk/#design-philosophy","title":"Design Philosophy","text":"<p>Separation of Concerns: - Builders - Node creation (immutable, fluent API) - Collections - Node querying and updates (CRUD operations) - Analytics - Strategic insights (read-only, computational) - SessionManager - Activity tracking (event logging) - SDK - Single entry point (coordinates all components)</p> <p>Benefits: - Clear responsibilities for each module - Easy to test and maintain - Consistent API across all node types - Extensible for new node types</p>"},{"location":"api/sdk/#complete-api-reference","title":"Complete API Reference","text":"<p>For detailed API documentation with type signatures and docstrings, see the Python source code in <code>src/python/htmlgraph/sdk.py</code>.</p>"},{"location":"api/server/","title":"Server","text":"<p>Development server for the dashboard.</p>"},{"location":"api/server/#overview","title":"Overview","text":"<p>The server module provides a lightweight HTTP server for serving the HtmlGraph dashboard during development.</p>"},{"location":"api/server/#usage","title":"Usage","text":""},{"location":"api/server/#command-line","title":"Command Line","text":"<pre><code># Start server on default port (8080)\nhtmlgraph serve\n\n# Custom port\nhtmlgraph serve --port 3000\n\n# Custom host\nhtmlgraph serve --host 0.0.0.0 --port 8080\n\n# Auto-reload on file changes\nhtmlgraph serve --watch\n</code></pre>"},{"location":"api/server/#python-api","title":"Python API","text":"<pre><code>from htmlgraph.server import serve\n\n# Start server\nserve(\n    graph_dir=\".htmlgraph\",\n    port=8080,\n    host=\"localhost\",\n    watch=False\n)\n</code></pre>"},{"location":"api/server/#features","title":"Features","text":"<ul> <li>Serves static HTML/CSS/JS files</li> <li>Watches for file changes (optional)</li> <li>CORS headers for local development</li> <li>Gzip compression</li> <li>Cache headers</li> </ul>"},{"location":"api/server/#complete-api-reference","title":"Complete API Reference","text":"<p>For detailed API documentation with method signatures and server configuration, see the Python source code in <code>src/python/htmlgraph/server.py</code>.</p>"},{"location":"api/track-builder/","title":"TrackBuilder","text":"<p>Fluent API for creating tracks with specs and plans.</p>"},{"location":"api/track-builder/#overview","title":"Overview","text":"<p>The TrackBuilder provides a chainable API for creating complex tracks in a single expression.</p>"},{"location":"api/track-builder/#basic-usage","title":"Basic Usage","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack = sdk.tracks.builder() \\\n    .title(\"User Authentication\") \\\n    .description(\"Implement OAuth 2.0\") \\\n    .priority(\"high\") \\\n    .create()\n</code></pre>"},{"location":"api/track-builder/#with-spec","title":"With Spec","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"User Authentication\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 support\",\n        context=\"Current system has no auth\",\n        requirements=[\n            (\"OAuth 2.0 flow\", \"must-have\"),\n            (\"JWT tokens\", \"must-have\")\n        ],\n        acceptance_criteria=[\n            (\"Users can log in\", \"Login test passes\")\n        ]\n    ) \\\n    .create()\n</code></pre>"},{"location":"api/track-builder/#with-plan","title":"With Plan","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"User Authentication\") \\\n    .priority(\"high\") \\\n    .with_plan_phases([\n        (\"Phase 1: Setup\", [\n            \"Configure OAuth (2h)\",\n            \"Setup database (1h)\"\n        ]),\n        (\"Phase 2: Implementation\", [\n            \"Implement login (4h)\",\n            \"Add middleware (3h)\"\n        ])\n    ]) \\\n    .create()\n</code></pre>"},{"location":"api/track-builder/#complete-track","title":"Complete Track","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"User Authentication\") \\\n    .description(\"Implement OAuth 2.0 authentication\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 support\",\n        context=\"No auth currently\",\n        requirements=[\n            (\"OAuth 2.0\", \"must-have\"),\n            (\"JWT tokens\", \"must-have\")\n        ],\n        acceptance_criteria=[\n            (\"Users can log in\", \"Test passes\")\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1\", [\"Setup (2h)\", \"Config (1h)\"]),\n        (\"Phase 2\", [\"Implement (4h)\", \"Test (3h)\"])\n    ]) \\\n    .create()\n</code></pre>"},{"location":"api/track-builder/#methods","title":"Methods","text":""},{"location":"api/track-builder/#titletitle-str-trackbuilder","title":"<code>.title(title: str) -&gt; TrackBuilder</code>","text":"<p>Set the track title (required).</p>"},{"location":"api/track-builder/#descriptiondesc-str-trackbuilder","title":"<code>.description(desc: str) -&gt; TrackBuilder</code>","text":"<p>Set the track description (optional).</p>"},{"location":"api/track-builder/#prioritypriority-str-trackbuilder","title":"<code>.priority(priority: str) -&gt; TrackBuilder</code>","text":"<p>Set priority: \"low\", \"medium\", \"high\", \"critical\" (default: \"medium\").</p>"},{"location":"api/track-builder/#with_spec-trackbuilder","title":"<code>.with_spec(...) -&gt; TrackBuilder</code>","text":"<p>Add specification with requirements and criteria.</p> <p>Parameters: - <code>overview: str</code> - High-level summary - <code>context: str</code> - Background and constraints - <code>requirements: list</code> - Requirements as (description, priority) tuples or strings - <code>acceptance_criteria: list</code> - Success criteria as (description, test_case) tuples or strings - <code>constraints: Optional[list[str]]</code> - Constraints</p>"},{"location":"api/track-builder/#with_plan_phasesphases-listtuplestr-liststr-trackbuilder","title":"<code>.with_plan_phases(phases: list[tuple[str, list[str]]]) -&gt; TrackBuilder</code>","text":"<p>Add implementation plan with phases.</p> <p>Format: <code>[(phase_name, [task_descriptions]), ...]</code></p> <p>Time estimates: Include <code>(Xh)</code> in task description for time estimates.</p>"},{"location":"api/track-builder/#create-track","title":"<code>.create() -&gt; Track</code>","text":"<p>Execute the build and create all files. Returns Track object.</p>"},{"location":"api/track-builder/#complete-api-reference","title":"Complete API Reference","text":"<p>For detailed API documentation with method signatures and builder pattern implementation, see the Python source code in <code>src/python/htmlgraph/track_builder.py</code>.</p>"},{"location":"contributing/","title":"Contributing","text":"<p>Welcome! We're glad you're interested in contributing to HtmlGraph.</p>"},{"location":"contributing/#ways-to-contribute","title":"Ways to Contribute","text":"<ul> <li>Report bugs: Open an issue with reproduction steps</li> <li>Suggest features: Describe use cases and requirements</li> <li>Improve docs: Fix typos, add examples, clarify explanations</li> <li>Write code: Fix bugs, implement features, optimize performance</li> <li>Share examples: Show how you're using HtmlGraph</li> <li>Spread the word: Blog posts, tweets, talks</li> </ul>"},{"location":"contributing/#getting-started","title":"Getting Started","text":""},{"location":"contributing/#1-fork-and-clone","title":"1. Fork and Clone","text":"<pre><code># Fork on GitHub, then clone your fork\ngit clone https://github.com/YOUR_USERNAME/htmlgraph.git\ncd htmlgraph\n</code></pre>"},{"location":"contributing/#2-set-up-development-environment","title":"2. Set Up Development Environment","text":"<pre><code># Install with development dependencies\nuv pip install -e \".[dev,test,docs]\"\n\n# Run tests\nuv run pytest\n\n# Build docs\nmkdocs serve\n</code></pre>"},{"location":"contributing/#3-create-a-branch","title":"3. Create a Branch","text":"<pre><code>git checkout -b feature/your-feature-name\n</code></pre>"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\nuv run pytest\n\n# Run with coverage\nuv run pytest --cov=src/python/htmlgraph\n\n# Run specific test\nuv run pytest tests/python/test_sdk.py::test_feature_creation\n</code></pre>"},{"location":"contributing/#code-style","title":"Code Style","text":"<p>We use:</p> <ul> <li>ruff for linting</li> <li>black for formatting</li> <li>mypy for type checking</li> </ul> <pre><code># Format code\nruff format src/\n\n# Lint code\nruff check src/\n\n# Type check\nmypy src/python/htmlgraph\n</code></pre>"},{"location":"contributing/#documentation","title":"Documentation","text":"<p>Build and preview docs locally:</p> <pre><code># Serve docs locally\nmkdocs serve\n\n# Build docs\nmkdocs build\n</code></pre>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"contributing/#1-make-your-changes","title":"1. Make Your Changes","text":"<ul> <li>Write clear, focused commits</li> <li>Add tests for new features</li> <li>Update documentation</li> <li>Follow code style</li> </ul>"},{"location":"contributing/#2-test-thoroughly","title":"2. Test Thoroughly","text":"<pre><code># Run full test suite\nuv run pytest\n\n# Check types\nmypy src/python/htmlgraph\n\n# Lint\nruff check src/\n</code></pre>"},{"location":"contributing/#3-submit-pull-request","title":"3. Submit Pull Request","text":"<ul> <li>Push to your fork</li> <li>Open pull request on main repo</li> <li>Describe what changed and why</li> <li>Link related issues</li> </ul>"},{"location":"contributing/#4-code-review","title":"4. Code Review","text":"<ul> <li>Respond to feedback</li> <li>Make requested changes</li> <li>Be patient and respectful</li> </ul>"},{"location":"contributing/#guidelines","title":"Guidelines","text":""},{"location":"contributing/#commit-messages","title":"Commit Messages","text":"<p>Follow conventional commits:</p> <pre><code>feat: add TrackBuilder fluent API\nfix: correct drift detection algorithm\ndocs: add TrackBuilder examples\ntest: add tests for session management\n</code></pre>"},{"location":"contributing/#code-quality","title":"Code Quality","text":"<ul> <li>Write tests for new code</li> <li>Maintain test coverage &gt;90%</li> <li>Add docstrings (Google style)</li> <li>Use type hints</li> <li>Keep functions focused and small</li> </ul>"},{"location":"contributing/#documentation_1","title":"Documentation","text":"<ul> <li>Update relevant docs when changing features</li> <li>Add examples for new features</li> <li>Keep API reference in sync with code</li> <li>Write clear, concise explanations</li> </ul>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>htmlgraph/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 python/htmlgraph/     # Python SDK\n\u2502   \u2514\u2500\u2500 js/                   # JavaScript library\n\u251c\u2500\u2500 docs/                     # Documentation\n\u251c\u2500\u2500 examples/                 # Example projects\n\u251c\u2500\u2500 tests/                    # Test suite\n\u251c\u2500\u2500 packages/                 # Agent integrations\n\u2502   \u251c\u2500\u2500 claude-plugin/       # Claude Code plugin\n\u2502   \u251c\u2500\u2500 gemini-extension/    # Gemini CLI extension\n\u2502   \u2514\u2500\u2500 codex-skill/         # Codex CLI skill\n\u2514\u2500\u2500 .htmlgraph/              # Development graph\n</code></pre>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<p>See Development Guide for detailed setup instructions.</p>"},{"location":"contributing/#questions","title":"Questions?","text":"<ul> <li>GitHub Discussions</li> <li>GitHub Issues</li> <li>Email: shakes@example.com</li> </ul>"},{"location":"contributing/#next-steps","title":"Next Steps","text":"<ul> <li>Development Guide - Detailed development setup</li> <li>Publishing Guide - How to publish releases</li> </ul>"},{"location":"contributing/development/","title":"Development Guide","text":"<p>Detailed guide for setting up a development environment.</p>"},{"location":"contributing/development/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10 or higher</li> <li>Git</li> <li>uv package manager</li> <li>Node.js (for JavaScript development, optional)</li> </ul>"},{"location":"contributing/development/#initial-setup","title":"Initial Setup","text":""},{"location":"contributing/development/#1-clone-repository","title":"1. Clone Repository","text":"<pre><code>git clone https://github.com/Shakes-tzd/htmlgraph.git\ncd htmlgraph\n</code></pre>"},{"location":"contributing/development/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code># Install with all development dependencies\nuv pip install -e \".[dev,test,docs]\"\n</code></pre> <p>This installs:</p> <ul> <li>dev: Development tools (ruff, black, mypy)</li> <li>test: Testing tools (pytest, pytest-cov)</li> <li>docs: Documentation tools (mkdocs, mkdocstrings)</li> </ul>"},{"location":"contributing/development/#3-verify-installation","title":"3. Verify Installation","text":"<pre><code># Run tests\nuv run pytest\n\n# Check version\npython -c \"import htmlgraph; print(htmlgraph.__version__)\"\n</code></pre>"},{"location":"contributing/development/#development-tools","title":"Development Tools","text":""},{"location":"contributing/development/#testing","title":"Testing","text":"<pre><code># Run all tests\nuv run pytest\n\n# Run with coverage\nuv run pytest --cov=src/python/htmlgraph --cov-report=html\n\n# Run specific test file\nuv run pytest tests/python/test_sdk.py\n\n# Run specific test\nuv run pytest tests/python/test_sdk.py::test_feature_creation\n\n# Watch mode (requires pytest-watch)\nuv run ptw\n</code></pre>"},{"location":"contributing/development/#code-formatting","title":"Code Formatting","text":"<pre><code># Format all code\nruff format src/ tests/\n\n# Check formatting without changes\nruff format --check src/ tests/\n</code></pre>"},{"location":"contributing/development/#linting","title":"Linting","text":"<pre><code># Lint all code\nruff check src/ tests/\n\n# Fix auto-fixable issues\nruff check --fix src/ tests/\n\n# Show rule details\nruff rule E501\n</code></pre>"},{"location":"contributing/development/#type-checking","title":"Type Checking","text":"<pre><code># Type check main code\nmypy src/python/htmlgraph\n\n# Type check tests too\nmypy src/python/htmlgraph tests/python\n</code></pre>"},{"location":"contributing/development/#documentation","title":"Documentation","text":""},{"location":"contributing/development/#mkdocs-main-documentation","title":"MkDocs (Main Documentation)","text":"<pre><code># Serve docs locally (with live reload)\nmkdocs serve\n\n# Build docs to site/\nmkdocs build\n\n# Deploy docs to GitHub Pages\nmkdocs gh-deploy\n</code></pre>"},{"location":"contributing/development/#pdoc-api-documentation","title":"pdoc (API Documentation)","text":"<pre><code># Generate API docs locally\nuv run pdoc htmlgraph --docformat google\n\n# Save to file (uses config from pyproject.toml)\nuv run pdoc htmlgraph -o docs/api-pdoc --docformat google\n\n# Open in browser\nuv run pdoc htmlgraph --docformat google\n\n# Generate for specific module\nuv run pdoc htmlgraph.sdk --docformat google\n</code></pre> <p>The pdoc configuration is in <code>pyproject.toml</code>:</p> <pre><code>[tool.pdoc]\noutput-directory = \"docs/api-pdoc\"\ndocformat = \"google\"\n</code></pre>"},{"location":"contributing/development/#documentation-workflow","title":"Documentation Workflow","text":"<ol> <li>Docstrings: Use Google-style docstrings in Python code</li> <li>MkDocs: Write narrative documentation in <code>docs/</code></li> <li>pdoc: Auto-generates API reference from docstrings</li> <li>CI: Both are verified on every push/PR</li> </ol>"},{"location":"contributing/development/#project-structure","title":"Project Structure","text":""},{"location":"contributing/development/#python-package","title":"Python Package","text":"<pre><code>src/python/htmlgraph/\n\u251c\u2500\u2500 __init__.py         # Package exports\n\u251c\u2500\u2500 sdk.py              # Main SDK interface\n\u251c\u2500\u2500 models.py           # Pydantic models\n\u251c\u2500\u2500 planning.py         # Spec and Plan models\n\u251c\u2500\u2500 graph.py            # Core graph operations\n\u251c\u2500\u2500 track_builder.py    # TrackBuilder API\n\u251c\u2500\u2500 agents.py           # Agent interface\n\u251c\u2500\u2500 server.py           # Dashboard server\n\u251c\u2500\u2500 cli.py              # CLI commands\n\u2514\u2500\u2500 dashboard.html      # Dashboard template\n</code></pre>"},{"location":"contributing/development/#tests","title":"Tests","text":"<pre><code>tests/python/\n\u251c\u2500\u2500 conftest.py            # Pytest fixtures\n\u251c\u2500\u2500 test_sdk.py            # SDK tests\n\u251c\u2500\u2500 test_models.py         # Model tests\n\u251c\u2500\u2500 test_track_builder.py  # TrackBuilder tests\n\u251c\u2500\u2500 test_graph.py          # Graph tests\n\u2514\u2500\u2500 test_cli.py            # CLI tests\n</code></pre>"},{"location":"contributing/development/#common-tasks","title":"Common Tasks","text":""},{"location":"contributing/development/#adding-a-new-feature","title":"Adding a New Feature","text":"<ol> <li>Write tests first (TDD):</li> </ol> <pre><code># tests/python/test_new_feature.py\ndef test_new_feature():\n    sdk = SDK(agent=\"test\")\n    result = sdk.new_feature()\n    assert result == expected\n</code></pre> <ol> <li>Implement feature:</li> </ol> <pre><code># src/python/htmlgraph/sdk.py\ndef new_feature(self):\n    \"\"\"New feature description.\n\n    Returns:\n        Expected return type.\n    \"\"\"\n    # Implementation\n    pass\n</code></pre> <ol> <li>Add documentation:</li> </ol> <pre><code>&lt;!-- docs/guide/new-feature.md --&gt;\n# New Feature\n\nDescription and examples...\n</code></pre> <ol> <li>Run tests:</li> </ol> <pre><code>uv run pytest tests/python/test_new_feature.py\n</code></pre>"},{"location":"contributing/development/#fixing-a-bug","title":"Fixing a Bug","text":"<ol> <li>Write a failing test that reproduces the bug</li> <li>Fix the bug</li> <li>Verify test passes</li> <li>Add regression test</li> </ol>"},{"location":"contributing/development/#updating-documentation","title":"Updating Documentation","text":"<ol> <li>Edit markdown files in <code>docs/</code></li> <li>Preview with <code>mkdocs serve</code></li> <li>Commit changes</li> </ol>"},{"location":"contributing/development/#running-the-dashboard-locally","title":"Running the Dashboard Locally","text":"<pre><code># Initialize a test graph\nuv run htmlgraph init\n\n# Create some test data\nuv run python -c \"\nfrom htmlgraph import SDK\nsdk = SDK(agent='dev')\nsdk.features.create('Test Feature 1', priority='high')\nsdk.features.create('Test Feature 2', priority='medium')\n\"\n\n# Start server\nuv run htmlgraph serve\n\n# Open http://localhost:8080\n</code></pre>"},{"location":"contributing/development/#debugging","title":"Debugging","text":""},{"location":"contributing/development/#using-pdb","title":"Using pdb","text":"<pre><code>import pdb; pdb.set_trace()\n</code></pre>"},{"location":"contributing/development/#using-pytest-debugger","title":"Using pytest debugger","text":"<pre><code># Drop into debugger on failure\nuv run pytest --pdb\n\n# Drop into debugger on first failure\nuv run pytest -x --pdb\n</code></pre>"},{"location":"contributing/development/#verbose-output","title":"Verbose output","text":"<pre><code># Show print statements\nuv run pytest -s\n\n# More verbose\nuv run pytest -vv\n</code></pre>"},{"location":"contributing/development/#performance-profiling","title":"Performance Profiling","text":"<pre><code># Profile tests\nuv run pytest --profile\n\n# Profile specific code\npython -m cProfile -o profile.stats script.py\n\n# View profile\npython -m pstats profile.stats\n</code></pre>"},{"location":"contributing/development/#pre-commit-hooks","title":"Pre-commit Hooks","text":"<p>Set up pre-commit hooks:</p> <pre><code># Install pre-commit\npip install pre-commit\n\n# Install hooks\npre-commit install\n\n# Run manually\npre-commit run --all-files\n</code></pre>"},{"location":"contributing/development/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing Guide - General contribution guidelines</li> <li>Publishing Guide - How to publish releases</li> </ul>"},{"location":"contributing/publishing/","title":"Publishing Guide","text":"<p>How to publish new releases of HtmlGraph.</p>"},{"location":"contributing/publishing/#quick-start-automated-deployment","title":"Quick Start: Automated Deployment","text":"<p>HtmlGraph includes a flexible deployment system that automates the entire release process. This is the recommended way to publish releases.</p>"},{"location":"contributing/publishing/#first-time-setup","title":"First Time Setup","text":"<ol> <li>Create deployment configuration:</li> </ol> <pre><code>htmlgraph deploy init\n</code></pre> <ol> <li> <p>Edit <code>htmlgraph-deploy.toml</code> to customize your deployment (already set up for HtmlGraph).</p> </li> <li> <p>Set up PyPI credentials in <code>.env</code>:</p> </li> </ol> <pre><code>PyPI_API_TOKEN=pypi-YOUR_TOKEN_HERE\n</code></pre>"},{"location":"contributing/publishing/#deploy-a-release","title":"Deploy a Release","text":"<pre><code># Full deployment (recommended)\nhtmlgraph deploy run\n\n# Dry run (preview what will happen)\nhtmlgraph deploy run --dry-run\n\n# Flexible options\nhtmlgraph deploy run --skip-pypi        # Build and install locally only\nhtmlgraph deploy run --docs-only        # Just commit and push to git\nhtmlgraph deploy run --build-only       # Just build the package\n</code></pre> <p>The deployment system will:</p> <ol> <li>\u2705 Push changes to git</li> <li>\u2705 Build package distributions</li> <li>\u2705 Publish to PyPI</li> <li>\u2705 Install locally to verify</li> <li>\u2705 Update Claude plugin (and other configured plugins)</li> </ol> <p>All with proper error handling, color-coded output, and dry-run support.</p>"},{"location":"contributing/publishing/#manual-process","title":"Manual Process","text":"<p>If you prefer manual control or need to troubleshoot, follow the manual process below.</p>"},{"location":"contributing/publishing/#version-numbering","title":"Version Numbering","text":"<p>HtmlGraph uses Semantic Versioning:</p> <ul> <li>MAJOR: Breaking changes (e.g., 1.0.0 \u2192 2.0.0)</li> <li>MINOR: New features, backward compatible (e.g., 1.1.0 \u2192 1.2.0)</li> <li>PATCH: Bug fixes, backward compatible (e.g., 1.1.0 \u2192 1.1.1)</li> </ul>"},{"location":"contributing/publishing/#files-to-update","title":"Files to Update","text":"<p>When bumping version, update all four of these files:</p> <ol> <li><code>pyproject.toml</code> - Python package version</li> <li><code>src/python/htmlgraph/__init__.py</code> - <code>__version__ = \"X.Y.Z\"</code></li> <li><code>packages/claude-plugin/.claude-plugin/plugin.json</code> - Claude plugin version</li> <li><code>packages/gemini-extension/gemini-extension.json</code> - Gemini extension version</li> </ol>"},{"location":"contributing/publishing/#publishing-checklist","title":"Publishing Checklist","text":""},{"location":"contributing/publishing/#pre-release","title":"Pre-Release","text":"<ul> <li> All tests pass: <code>uv run pytest</code></li> <li> Code is formatted: <code>ruff format src/</code></li> <li> Code is linted: <code>ruff check src/</code></li> <li> Type checks pass: <code>mypy src/python/htmlgraph</code></li> <li> Documentation is up to date</li> <li> Changelog is updated</li> <li> Version bumped in all 4 files</li> <li> Changes committed to git</li> </ul>"},{"location":"contributing/publishing/#build","title":"Build","text":"<pre><code># Clean previous builds\nrm -rf dist/\n\n# Build distributions\nuv build\n</code></pre> <p>This creates:</p> <ul> <li><code>dist/htmlgraph-X.Y.Z.tar.gz</code> (source distribution)</li> <li><code>dist/htmlgraph-X.Y.Z-py3-none-any.whl</code> (wheel)</li> </ul>"},{"location":"contributing/publishing/#publish-to-pypi","title":"Publish to PyPI","text":"<pre><code># Ensure credentials are set\nsource .env\n\n# Publish to PyPI\nuv publish dist/htmlgraph-X.Y.Z* --token \"$PyPI_API_TOKEN\"\n</code></pre>"},{"location":"contributing/publishing/#post-release","title":"Post-Release","text":"<ul> <li> Create git tag: <code>git tag vX.Y.Z</code></li> <li> Push tag: <code>git push origin vX.Y.Z</code></li> <li> Create GitHub release</li> <li> Update plugin installations</li> <li> Announce release</li> </ul>"},{"location":"contributing/publishing/#pypi-credentials-setup","title":"PyPI Credentials Setup","text":""},{"location":"contributing/publishing/#option-1-api-token-in-env-recommended","title":"Option 1: API Token in .env (Recommended)","text":"<p>Create <code>.env</code> file:</p> <pre><code>PyPI_API_TOKEN=pypi-YOUR_TOKEN_HERE\n</code></pre> <p>Then source it before publishing:</p> <pre><code>source .env\nuv publish dist/htmlgraph-X.Y.Z* --token \"$PyPI_API_TOKEN\"\n</code></pre>"},{"location":"contributing/publishing/#option-2-environment-variable","title":"Option 2: Environment Variable","text":"<pre><code>export PYPI_TOKEN=pypi-YOUR_TOKEN_HERE\nuv publish dist/htmlgraph-X.Y.Z* --token \"$PYPI_TOKEN\"\n</code></pre>"},{"location":"contributing/publishing/#option-3-cli-arguments","title":"Option 3: CLI Arguments","text":"<pre><code>uv publish dist/htmlgraph-X.Y.Z* --token pypi-YOUR_TOKEN_HERE\n</code></pre>"},{"location":"contributing/publishing/#complete-publishing-commands","title":"Complete Publishing Commands","text":"<pre><code># 1. Update version in all 4 files\n# (Manual step - edit files)\n\n# 2. Update changelog\n# (Manual step - edit docs/changelog.md)\n\n# 3. Commit version bump\ngit add .\ngit commit -m \"chore: bump version to X.Y.Z\"\n\n# 4. Build distributions\nrm -rf dist/\nuv build\n\n# 5. Publish to PyPI\nsource .env\nuv publish dist/htmlgraph-X.Y.Z* --token \"$PyPI_API_TOKEN\"\n\n# 6. Create and push git tag\ngit tag vX.Y.Z\ngit push origin vX.Y.Z\n\n# 7. Create GitHub release\ngh release create vX.Y.Z --title \"vX.Y.Z\" --notes \"Release notes here\"\n\n# 8. Verify publication\nopen https://pypi.org/project/htmlgraph/\npip install htmlgraph==X.Y.Z\n</code></pre>"},{"location":"contributing/publishing/#automation-script","title":"Automation Script","text":"<p>Save as <code>scripts/release.sh</code>:</p> <pre><code>#!/bin/bash\nset -e\n\n# Check for version argument\nif [ -z \"$1\" ]; then\n    echo \"Usage: ./release.sh X.Y.Z\"\n    exit 1\nfi\n\nVERSION=$1\n\necho \"Releasing version $VERSION...\"\n\n# Update versions (requires manual editing first)\necho \"\u26a0\ufe0f  Ensure versions are updated in all 4 files!\"\nread -p \"Press enter to continue...\"\n\n# Run tests\necho \"Running tests...\"\nuv run pytest\n\n# Build\necho \"Building distributions...\"\nrm -rf dist/\nuv build\n\n# Publish\necho \"Publishing to PyPI...\"\nsource .env\nuv publish dist/htmlgraph-$VERSION* --token \"$PyPI_API_TOKEN\"\n\n# Git tag\necho \"Creating git tag...\"\ngit tag v$VERSION\ngit push origin v$VERSION\n\n# GitHub release\necho \"Creating GitHub release...\"\ngh release create v$VERSION --title \"v$VERSION\" --generate-notes\n\necho \"\u2705 Release $VERSION complete!\"\necho \"   PyPI: https://pypi.org/project/htmlgraph/$VERSION/\"\necho \"   GitHub: https://github.com/Shakes-tzd/htmlgraph/releases/tag/v$VERSION\"\n</code></pre> <p>Usage:</p> <pre><code>chmod +x scripts/release.sh\n./scripts/release.sh 0.3.0\n</code></pre>"},{"location":"contributing/publishing/#post-release-updates","title":"Post-Release Updates","text":""},{"location":"contributing/publishing/#update-claude-plugin","title":"Update Claude Plugin","text":"<pre><code>claude plugin update htmlgraph\n</code></pre>"},{"location":"contributing/publishing/#update-gemini-extension","title":"Update Gemini Extension","text":"<pre><code>gemini extension update htmlgraph\n</code></pre>"},{"location":"contributing/publishing/#update-codex-skill","title":"Update Codex Skill","text":"<pre><code>codex skill update htmlgraph\n</code></pre>"},{"location":"contributing/publishing/#verify-publication","title":"Verify Publication","text":"<pre><code># Check PyPI page\nopen https://pypi.org/project/htmlgraph/\n\n# Install from PyPI to test\npip install htmlgraph==X.Y.Z\n\n# Verify version\npython -c \"import htmlgraph; print(htmlgraph.__version__)\"\n</code></pre>"},{"location":"contributing/publishing/#safety-rollback","title":"Safety &amp; Rollback","text":""},{"location":"contributing/publishing/#safety","title":"Safety","text":"<p>\u26a0\ufe0f PyPI uploads are permanent! You cannot:</p> <ul> <li>Delete a published version</li> <li>Re-upload the same version</li> <li>Modify published files</li> </ul> <p>Always test in a staging environment first.</p>"},{"location":"contributing/publishing/#rollback","title":"Rollback","text":"<p>If a release has issues:</p> <pre><code># Yank the bad version (hides from pip install)\nuv publish --yank htmlgraph==X.Y.Z\n\n# Publish a fixed version\n# Increment version to X.Y.Z+1\nuv build &amp;&amp; uv publish dist/*\n</code></pre>"},{"location":"contributing/publishing/#version-history","title":"Version History","text":"<ul> <li>0.3.0 (2024-12-22): TrackBuilder API, multi-agent support</li> <li>0.2.2 (2024-12-20): Drift detection, session improvements</li> <li>0.2.0 (2024-12-18): Track creation, specs and plans</li> <li>0.1.x (2024-12-15): Initial release, basic features</li> </ul> <p>See Changelog for details.</p>"},{"location":"contributing/publishing/#using-htmlgraph-deployment-in-your-projects","title":"Using HtmlGraph Deployment in Your Projects","text":"<p>The HtmlGraph deployment system is designed to be generic and can be used by any Python project, not just HtmlGraph itself.</p>"},{"location":"contributing/publishing/#installation","title":"Installation","text":"<pre><code>pip install htmlgraph\n</code></pre>"},{"location":"contributing/publishing/#setup-for-your-project","title":"Setup for Your Project","text":"<ol> <li>Initialize deployment config:</li> </ol> <pre><code>cd your-project/\nhtmlgraph deploy init\n</code></pre> <ol> <li>Edit <code>htmlgraph-deploy.toml</code>:</li> </ol> <pre><code>[project]\nname = \"your-project\"\npypi_package = \"your-package-name\"\n\n[deployment]\nsteps = [\n    \"git-push\",\n    \"build\",\n    \"pypi-publish\",\n    \"local-install\",\n    \"update-plugins\"  # Optional\n]\n\n[deployment.git]\nbranch = \"main\"\nremote = \"origin\"\n\n[deployment.build]\ncommand = \"uv build\"  # or \"python -m build\"\n\n[deployment.pypi]\ntoken_env_var = \"PyPI_API_TOKEN\"\n\n[deployment.plugins]\n# Add your plugin update commands (optional)\n# claude = \"claude plugin update {package}\"\n\n[deployment.hooks]\n# Custom commands at each stage\npre_build = [\"pytest\"]  # Run tests before build\npost_build = []\npre_publish = []\npost_publish = [\"./scripts/notify_release.sh {version}\"]\n</code></pre> <ol> <li>Deploy your project:</li> </ol> <pre><code>htmlgraph deploy run\n</code></pre>"},{"location":"contributing/publishing/#configuration-options","title":"Configuration Options","text":"<ul> <li>steps: List of deployment steps to run (in order)</li> <li><code>git-push</code>: Push commits and tags to git remote</li> <li><code>build</code>: Build package distributions</li> <li><code>pypi-publish</code>: Publish to PyPI</li> <li><code>local-install</code>: Install package locally</li> <li> <p><code>update-plugins</code>: Run configured plugin update commands</p> </li> <li> <p>hooks: Custom commands at each stage</p> </li> <li><code>pre_build</code>: Run before building (e.g., tests, linting)</li> <li><code>post_build</code>: Run after building (e.g., validation)</li> <li><code>pre_publish</code>: Run before publishing (e.g., sanity checks)</li> <li> <p><code>post_publish</code>: Run after publishing (e.g., notifications)</p> </li> <li> <p>plugins: Plugin update commands</p> </li> <li>Use <code>{package}</code> placeholder for package name</li> <li>Use <code>{version}</code> placeholder for version number</li> </ul>"},{"location":"contributing/publishing/#examples","title":"Examples","text":"<p>Skip PyPI and only build locally: <pre><code>htmlgraph deploy run --skip-pypi\n</code></pre></p> <p>Deploy only docs changes (no build): <pre><code>htmlgraph deploy run --docs-only\n</code></pre></p> <p>Test deployment without making changes: <pre><code>htmlgraph deploy run --dry-run\n</code></pre></p>"},{"location":"contributing/publishing/#next-steps","title":"Next Steps","text":"<ul> <li>Development Guide - Development setup</li> <li>Contributing Guide - General guidelines</li> </ul>"},{"location":"cookbook/","title":"Cookbook","text":"<p>Practical recipes for common HtmlGraph tasks. Copy, paste, and adapt these patterns to your needs.</p>"},{"location":"cookbook/#quick-navigation","title":"Quick Navigation","text":""},{"location":"cookbook/#project-setup","title":"Project Setup","text":"<ul> <li>Initialize a New Project</li> <li>Install Git Hooks for Auto-Tracking</li> <li>Configure Agent Identity</li> </ul>"},{"location":"cookbook/#features-tasks","title":"Features &amp; Tasks","text":"<ul> <li>Create a Simple Feature</li> <li>Add Dependencies Between Features</li> <li>Mark Steps Complete Incrementally</li> <li>Query Features by Status/Priority</li> </ul>"},{"location":"cookbook/#tracks-planning","title":"Tracks &amp; Planning","text":"<ul> <li>Create a Track with Spec and Plan</li> <li>Link Features to a Track</li> <li>Track Progress Across Multiple Features</li> </ul>"},{"location":"cookbook/#sessions-activity","title":"Sessions &amp; Activity","text":"<ul> <li>Start a Work Session</li> <li>Query Session Events</li> <li>Generate Session Reports</li> </ul>"},{"location":"cookbook/#strategic-planning","title":"Strategic Planning","text":"<ul> <li>Find Bottlenecks</li> <li>Get Work Recommendations</li> <li>Identify Parallel Work</li> <li>Assess Project Risks</li> </ul>"},{"location":"cookbook/#integration","title":"Integration","text":"<ul> <li>Set Up CI/CD Automation</li> <li>Sync with External Tools</li> <li>Export to Other Formats</li> </ul>"},{"location":"cookbook/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Fix SQLite Index Corruption</li> <li>Resolve Drift Warnings</li> <li>Debug Missing Attribution</li> </ul>"},{"location":"cookbook/#recipe-format","title":"Recipe Format","text":"<p>Each recipe follows this structure:</p> <ol> <li>Problem: What you're trying to accomplish</li> <li>Solution: Complete, copy-paste ready code</li> <li>Explanation: How it works</li> <li>Variations: Alternative approaches or extensions</li> </ol>"},{"location":"cookbook/#contributing-recipes","title":"Contributing Recipes","text":"<p>Found a useful pattern? Submit a recipe!</p> <ol> <li>Fork the repo</li> <li>Add your recipe to the appropriate file</li> <li>Follow the recipe format above</li> <li>Submit a pull request</li> </ol> <p>See Contributing Guide for details.</p>"},{"location":"cookbook/analytics/","title":"Strategic Planning &amp; Analytics Recipes","text":""},{"location":"cookbook/analytics/#find-bottlenecks","title":"Find Bottlenecks","text":"<p>Problem: Identify tasks blocking the most downstream work.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get top bottlenecks\nbottlenecks = sdk.find_bottlenecks(top_n=5)\n\nprint(\"TOP BOTTLENECKS:\")\nprint(\"=\" * 60)\nfor bn in bottlenecks:\n    print(f\"{bn['title']}\")\n    print(f\"  Blocks: {bn['blocks_count']} tasks\")\n    print(f\"  Impact Score: {bn['impact_score']:.1f}\")\n    print(f\"  Priority: {bn['priority']}\")\n    print(f\"  Blocked tasks: {', '.join(bn['blocked_tasks'][:3])}\")\n    print()\n</code></pre> <p>Output: <pre><code>TOP BOTTLENECKS:\n============================================================\nDatabase Schema\n  Blocks: 5 tasks\n  Impact Score: 8.5\n  Priority: high\n  Blocked tasks: feature-auth, feature-api, feature-profile\n\nOAuth Integration\n  Blocks: 3 tasks\n  Impact Score: 5.0\n  Priority: high\n  Blocked tasks: feature-sessions, feature-profile, feature-admin\n</code></pre></p> <p>Explanation: - Impact score considers both direct and transitive dependencies - Higher score = unblocking this task unlocks more work - Use to prioritize critical path items - Recomputed dynamically as tasks complete</p>"},{"location":"cookbook/analytics/#get-work-recommendations","title":"Get Work Recommendations","text":"<p>Problem: Decide what to work on next.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get recommendations for single agent\nrecs = sdk.recommend_next_work(agent_count=1)\n\nif recs:\n    best = recs[0]\n    print(\"RECOMMENDED NEXT TASK:\")\n    print(f\"  {best['title']}\")\n    print(f\"  Score: {best['score']:.1f}\")\n    print(f\"  Priority: {best['priority']}\")\n    print(f\"  Why: {', '.join(best['reasons'])}\")\n\n    if best.get('unlocks_count', 0) &gt; 0:\n        print(f\"  Unlocks: {best['unlocks_count']} tasks\")\n\n    if 'estimated_hours' in best:\n        print(f\"  Estimated: {best['estimated_hours']}h\")\n</code></pre> <p>Output: <pre><code>RECOMMENDED NEXT TASK:\n  Database Schema\n  Score: 9.5\n  Priority: high\n  Why: Directly unblocks 5 features, High priority, Critical path item\n  Unlocks: 5 tasks\n  Estimated: 8h\n</code></pre></p> <p>Explanation: - Score combines priority, impact, and readiness - Higher score = better choice - Considers dependencies (won't recommend blocked tasks) - Factors in estimated effort if available</p>"},{"location":"cookbook/analytics/#identify-parallel-work","title":"Identify Parallel Work","text":"<p>Problem: Find tasks that can be worked on simultaneously.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get parallel work opportunities\nparallel = sdk.get_parallel_work(max_agents=5)\n\nprint(\"PARALLEL WORK CAPACITY:\")\nprint(f\"  Max parallelism: {parallel['max_parallelism']}\")\nprint(f\"  Ready now: {parallel['ready_now']}\")\nprint(f\"  Total ready: {parallel['total_ready']}\")\nprint()\n\nif parallel['ready_now'] &gt; 1:\n    print(f\"CAN WORK ON {parallel['ready_now']} TASKS IN PARALLEL:\")\n    for level_idx, task_ids in enumerate(parallel.get('next_level', [])[:5]):\n        feature = sdk.features.get(task_ids[0]) if task_ids else None\n        if feature:\n            print(f\"  {level_idx + 1}. {feature.title} (priority: {feature.priority})\")\n</code></pre> <p>Output: <pre><code>PARALLEL WORK CAPACITY:\n  Max parallelism: 7\n  Ready now: 4\n  Total ready: 7\n\nCAN WORK ON 4 TASKS IN PARALLEL:\n  1. User Profile Endpoint (priority: medium)\n  2. Admin Dashboard (priority: medium)\n  3. Email Notifications (priority: low)\n  4. Documentation Updates (priority: low)\n</code></pre></p> <p>Explanation: - Max parallelism = tasks with no dependencies - Ready now = subset of those with high priority - Useful for coordinating multiple agents - Recomputed as dependencies resolve</p>"},{"location":"cookbook/analytics/#assess-project-risks","title":"Assess Project Risks","text":"<p>Problem: Identify dependency-related risks.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Run risk assessment\nrisks = sdk.assess_risks()\n\nprint(\"PROJECT RISK ASSESSMENT:\")\nprint(\"=\" * 60)\n\n# High-risk tasks\nif risks['high_risk_count'] &gt; 0:\n    print(f\"\\n\u26a0\ufe0f  {risks['high_risk_count']} HIGH-RISK TASKS:\")\n    for task in risks['high_risk_tasks'][:5]:\n        print(f\"  {task['title']}\")\n        print(f\"    Risks: {', '.join(task['risk_factors'])}\")\n        print()\n\n# Circular dependencies\nif risks['circular_dependencies']:\n    print(\"\ud83d\udd04 CIRCULAR DEPENDENCIES DETECTED:\")\n    for cycle in risks['circular_dependencies']:\n        print(f\"  {' \u2192 '.join(cycle)}\")\n    print()\n\n# Orphaned tasks\nif risks['orphaned_count'] &gt; 0:\n    print(f\"\ud83d\udd17 {risks['orphaned_count']} ORPHANED TASKS (no dependencies)\")\n\n# Recommendations\nif risks['recommendations']:\n    print(\"\\nRECOMMENDATIONS:\")\n    for rec in risks['recommendations']:\n        print(f\"  - {rec}\")\n</code></pre> <p>Output: <pre><code>PROJECT RISK ASSESSMENT:\n============================================================\n\n\u26a0\ufe0f  2 HIGH-RISK TASKS:\n  Database Migration\n    Risks: Single point of failure, Blocks 8 tasks, No backup plan\n\n  OAuth Provider Setup\n    Risks: Single point of failure, Blocks 5 tasks\n\n\ud83d\udd04 CIRCULAR DEPENDENCIES DETECTED:\n  feature-auth \u2192 feature-db \u2192 feature-migrations \u2192 feature-auth\n\n\ud83d\udd17 3 ORPHANED TASKS (no dependencies)\n\nRECOMMENDATIONS:\n  - Break circular dependency between feature-auth and feature-db\n  - Consider splitting Database Migration into smaller tasks\n  - Add backup plan for OAuth Provider Setup\n</code></pre></p> <p>Explanation: - Identifies single points of failure - Detects circular dependencies (deadlocks) - Finds orphaned tasks (might be forgotten) - Provides actionable recommendations</p>"},{"location":"cookbook/analytics/#analyze-impact-of-completing-a-task","title":"Analyze Impact of Completing a Task","text":"<p>Problem: Understand what completing a specific task will unlock.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Analyze impact of specific task\nimpact = sdk.analyze_impact(\"feature-database\")\n\nprint(f\"IMPACT ANALYSIS: {impact['node_id']}\")\nprint(\"=\" * 60)\nprint(f\"Direct dependents: {len(impact['direct_dependents'])}\")\nprint(f\"Total impact: {impact['total_impact']} tasks\")\nprint(f\"Completion impact: {impact['completion_impact']:.1f}% of remaining work\")\nprint()\n\nif impact['unlocks_count'] &gt; 0:\n    print(f\"UNLOCKS {impact['unlocks_count']} TASKS:\")\n    for task_id in impact['affected_tasks'][:10]:\n        feature = sdk.features.get(task_id)\n        print(f\"  - {feature.title} (priority: {feature.priority})\")\n</code></pre> <p>Output: <pre><code>IMPACT ANALYSIS: feature-database\n============================================================\nDirect dependents: 5\nTotal impact: 12 tasks\nCompletion impact: 48.0% of remaining work\n\nUNLOCKS 5 TASKS:\n  - User Authentication (priority: high)\n  - API Endpoints (priority: high)\n  - Admin Dashboard (priority: medium)\n  - User Profile (priority: medium)\n  - Email Templates (priority: low)\n</code></pre></p> <p>Explanation: - Direct dependents = tasks immediately unblocked - Total impact = direct + transitive dependents - Completion impact = % of project this represents - Use to prioritize high-leverage work</p>"},{"location":"cookbook/analytics/#generate-progress-report","title":"Generate Progress Report","text":"<p>Problem: Create a summary of current project state.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\nfrom datetime import datetime\n\nsdk = SDK(agent=\"claude\")\n\n# Gather metrics\nall_features = sdk.features.all()\ntotal = len(all_features)\ndone = len([f for f in all_features if f.status == \"done\"])\nin_progress = len([f for f in all_features if f.status == \"in-progress\"])\ntodo = len([f for f in all_features if f.status == \"todo\"])\nblocked = len([f for f in all_features if f.status == \"blocked\"])\n\n# Get bottlenecks\nbottlenecks = sdk.find_bottlenecks(top_n=3)\n\n# Get recommendations\nrecs = sdk.recommend_next_work(agent_count=3)\n\n# Generate report\nprint(f\"PROJECT PROGRESS REPORT - {datetime.now().strftime('%Y-%m-%d')}\")\nprint(\"=\" * 70)\nprint()\nprint(f\"OVERALL STATUS:\")\nprint(f\"  Total features: {total}\")\nprint(f\"  Completed: {done} ({done/total*100:.1f}%)\")\nprint(f\"  In Progress: {in_progress}\")\nprint(f\"  Todo: {todo}\")\nprint(f\"  Blocked: {blocked}\")\nprint()\n\nif bottlenecks:\n    print(f\"TOP BOTTLENECKS ({len(bottlenecks)}):\")\n    for bn in bottlenecks:\n        print(f\"  - {bn['title']} (blocks {bn['blocks_count']} tasks)\")\n    print()\n\nif recs:\n    print(f\"RECOMMENDED NEXT TASKS:\")\n    for i, rec in enumerate(recs[:3], 1):\n        print(f\"  {i}. {rec['title']} (score: {rec['score']:.1f})\")\n    print()\n\nprint(f\"Generated: {datetime.now().isoformat()}\")\n</code></pre> <p>Use Case: Daily standup reports, sprint reviews, stakeholder updates</p>"},{"location":"cookbook/analytics/#track-velocity","title":"Track Velocity","text":"<p>Problem: Measure team/agent productivity over time.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\nfrom datetime import datetime, timedelta\n\nsdk = SDK(agent=\"claude\")\n\n# Get features completed in last week\nweek_ago = datetime.now() - timedelta(days=7)\nrecent_completions = [\n    f for f in sdk.features.where(status=\"done\")\n    if f.updated and f.updated &gt; week_ago\n]\n\nprint(f\"VELOCITY (Last 7 Days):\")\nprint(f\"  Features completed: {len(recent_completions)}\")\n\n# Calculate story points (if using estimated hours)\ntotal_hours = 0\nfor f in recent_completions:\n    # Sum step estimates if available\n    for step in f.steps:\n        # Parse \"(2h)\" format from descriptions\n        import re\n        match = re.search(r'\\((\\d+(?:\\.\\d+)?)\\s*h\\)', step.description)\n        if match:\n            total_hours += float(match.group(1))\n\nif total_hours &gt; 0:\n    print(f\"  Hours completed: {total_hours}h\")\n    print(f\"  Avg per day: {total_hours/7:.1f}h\")\n    print(f\"  Projected capacity: {total_hours/7 * 30:.1f}h/month\")\n</code></pre> <p>Explanation: - Tracks completion rate over time - Uses updated timestamp to filter recent work - Can estimate future capacity - Useful for sprint planning</p>"},{"location":"cookbook/features/","title":"Feature Management Recipes","text":""},{"location":"cookbook/features/#create-feature","title":"Create Feature","text":"<p>Problem: Create a new feature to track work.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Simple feature\nfeature = sdk.features.create(\"Add dark mode toggle\")\n\n# Feature with details\nfeature = sdk.features.create(\"User Authentication\") \\\n    .set_priority(\"high\") \\\n    .set_description(\"Implement OAuth 2.0 with JWT tokens\") \\\n    .add_steps([\n        \"Research OAuth providers\",\n        \"Implement auth routes\",\n        \"Add JWT middleware\",\n        \"Create user profile endpoint\",\n        \"Write integration tests\"\n    ]) \\\n    .add_tags([\"security\", \"backend\"]) \\\n    .save()\n\nprint(f\"Created: {feature.id}\")\nprint(f\"Steps: {len(feature.steps)}\")\n</code></pre> <p>Explanation: - Fluent API for building features - Auto-generates ID with timestamp - Creates HTML file in <code>.htmlgraph/features/</code> - Ready to start working immediately</p>"},{"location":"cookbook/features/#mark-steps-complete","title":"Mark Steps Complete","text":"<p>Problem: Track progress as you complete steps.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Mark single step complete (0-indexed)\nwith sdk.features.edit(\"feature-123\") as f:\n    f.steps[0].completed = True\n\n# Mark multiple steps at once\nwith sdk.features.edit(\"feature-123\") as f:\n    f.steps[0].completed = True\n    f.steps[1].completed = True\n    f.steps[2].completed = True\n\n# Mark step and add notes\nwith sdk.features.edit(\"feature-123\") as f:\n    f.steps[3].completed = True\n    f.steps[3].agent = \"claude\"\n    f.steps[3].timestamp = datetime.now()\n</code></pre> <p>Explanation: - Context manager auto-saves changes - Steps are 0-indexed (first step = 0) - Can add agent and timestamp for audit trail - Changes immediately visible in dashboard</p> <p>Best Practice: Mark steps complete IMMEDIATELY after finishing them, not all at the end.</p>"},{"location":"cookbook/features/#add-dependencies","title":"Add Dependencies","text":"<p>Problem: Express that one feature blocks another.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Method 1: Add single dependency\nsdk.features.add_dependency(\n    blocked_id=\"feature-auth\",      # Feature that's blocked\n    blocker_id=\"feature-database\",  # Feature that blocks it\n    relationship=\"blocks\"\n)\n\n# Method 2: Add multiple dependencies\nauth = sdk.features.get(\"feature-auth\")\ndatabase = sdk.features.get(\"feature-database\")\nsessions = sdk.features.get(\"feature-sessions\")\n\nsdk.features.add_dependency(auth.id, database.id, \"blocks\")\nsdk.features.add_dependency(auth.id, sessions.id, \"blocks\")\n\n# Method 3: Add when creating feature\nfeature = sdk.features.create(\"API Endpoints\") \\\n    .blocked_by([\"feature-auth\"]) \\\n    .save()\n</code></pre> <p>Explanation: - Dependencies create graph edges - Used for bottleneck analysis - Determines parallel work capacity - Visualized in dashboard graph view</p>"},{"location":"cookbook/features/#query-features","title":"Query Features","text":"<p>Problem: Find features matching specific criteria.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# By status\nin_progress = sdk.features.where(status=\"in-progress\")\ntodo = sdk.features.where(status=\"todo\")\ndone = sdk.features.where(status=\"done\")\n\n# By priority\nhigh_priority = sdk.features.where(priority=\"high\")\n\n# Multiple criteria\nurgent = sdk.features.where(status=\"todo\", priority=\"high\")\n\n# By tag\nsecurity_features = sdk.features.where(tags__contains=\"security\")\n\n# Get single feature\nfeature = sdk.features.get(\"feature-123\")\n\n# Get all features\nall_features = sdk.features.all()\n\n# Count features\ncount = len(sdk.features.where(status=\"todo\"))\nprint(f\"{count} todo features\")\n</code></pre> <p>Explanation: - <code>where()</code> returns list of matching features - <code>get()</code> returns single feature by ID - Can filter by any field (status, priority, tags, etc.) - Use <code>tags__contains</code> for tag filtering</p>"},{"location":"cookbook/features/#update-feature-status","title":"Update Feature Status","text":"<p>Problem: Change feature status as work progresses.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Method 1: Direct edit\nwith sdk.features.edit(\"feature-123\") as f:\n    f.status = \"in-progress\"\n\n# Method 2: Use CLI\n# htmlgraph feature start feature-123\n# htmlgraph feature complete feature-123\n\n# Method 3: Batch update multiple features\nsdk.features.batch_update(\n    [\"feature-001\", \"feature-002\", \"feature-003\"],\n    {\"status\": \"done\"}\n)\n\n# Update with validation\nwith sdk.features.edit(\"feature-123\") as f:\n    if all(step.completed for step in f.steps):\n        f.status = \"done\"\n    else:\n        print(f\"Warning: {len([s for s in f.steps if not s.completed])} steps incomplete\")\n</code></pre> <p>Explanation: - Status can be: \"todo\", \"in-progress\", \"done\", \"blocked\" - Context manager validates and auto-saves - Batch updates are more efficient for multiple features - Hooks may track status changes automatically</p>"},{"location":"cookbook/features/#add-notes-and-activity","title":"Add Notes and Activity","text":"<p>Problem: Document decisions and progress.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\nfrom datetime import datetime\n\nsdk = SDK(agent=\"claude\")\n\n# Add activity log entry\nwith sdk.features.edit(\"feature-123\") as f:\n    if not hasattr(f, 'activity_log'):\n        f.activity_log = []\n\n    f.activity_log.append({\n        \"timestamp\": datetime.now().isoformat(),\n        \"agent\": \"claude\",\n        \"action\": \"decision\",\n        \"description\": \"Chose GitHub OAuth over Google due to simpler integration\"\n    })\n\n# Add notes to description\nwith sdk.features.edit(\"feature-123\") as f:\n    f.content += \"\\n\\n## Decision Log\\n\"\n    f.content += \"- 2024-12-24: Selected Supabase for auth provider\\n\"\n    f.content += \"- 2024-12-24: Decided to use row-level security\\n\"\n</code></pre> <p>Explanation: - Activity log preserves decision context - Useful for onboarding and retrospectives - Timestamped entries show progression - Content field supports markdown</p>"},{"location":"cookbook/features/#clone-a-feature","title":"Clone a Feature","text":"<p>Problem: Create a similar feature based on an existing one.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get existing feature\ntemplate = sdk.features.get(\"feature-template\")\n\n# Create new feature with same structure\nnew_feature = sdk.features.create(f\"{template.title} (v2)\") \\\n    .set_priority(template.priority) \\\n    .add_steps([step.description for step in template.steps]) \\\n    .add_tags(template.tags) \\\n    .save()\n\nprint(f\"Cloned to: {new_feature.id}\")\n</code></pre> <p>Explanation: - Useful for repeated workflows - Preserves structure but creates new ID - Steps start uncompleted - Can modify before saving</p>"},{"location":"cookbook/features/#archive-completed-features","title":"Archive Completed Features","text":"<p>Problem: Clean up completed work while preserving history.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\nimport shutil\nimport os\n\nsdk = SDK(agent=\"claude\")\n\n# Create archive directory\nos.makedirs(\".htmlgraph/archive/features\", exist_ok=True)\n\n# Get completed features older than 30 days\nfrom datetime import datetime, timedelta\ncutoff = datetime.now() - timedelta(days=30)\n\ndone_features = sdk.features.where(status=\"done\")\nfor f in done_features:\n    if f.updated &lt; cutoff:\n        # Move to archive\n        src = f\".htmlgraph/features/{f.id}.html\"\n        dst = f\".htmlgraph/archive/features/{f.id}.html\"\n        shutil.move(src, dst)\n        print(f\"Archived: {f.id}\")\n\n# Rebuild index\n# htmlgraph index rebuild\n</code></pre> <p>Caution: - Archived features won't appear in queries - Rebuild index after archiving - Keep archives in git for full history</p>"},{"location":"cookbook/setup/","title":"Project Setup Recipes","text":""},{"location":"cookbook/setup/#initialize-project","title":"Initialize Project","text":"<p>Problem: Start a new HtmlGraph project from scratch.</p> <p>Solution:</p> <pre><code># Create project directory\nmkdir my-project\ncd my-project\n\n# Initialize HtmlGraph with git hooks\nhtmlgraph init --install-hooks\n\n# Verify setup\nhtmlgraph status\n</code></pre> <p>Explanation: - <code>htmlgraph init</code> creates the <code>.htmlgraph/</code> directory structure - <code>--install-hooks</code> installs git hooks for automatic activity tracking - Creates <code>index.html</code> dashboard at project root - Sets up JSONL event stream and SQLite index</p> <p>What Gets Created: <pre><code>.htmlgraph/\n\u251c\u2500\u2500 features/       # Feature HTML files\n\u251c\u2500\u2500 sessions/       # Session HTML files\n\u251c\u2500\u2500 tracks/         # Track directories\n\u251c\u2500\u2500 events/         # JSONL event logs\n\u251c\u2500\u2500 index.sqlite    # Analytics index\n\u2514\u2500\u2500 hooks/          # Git hook scripts\n</code></pre></p>"},{"location":"cookbook/setup/#install-git-hooks","title":"Install Git Hooks","text":"<p>Problem: Enable automatic tracking of git activity.</p> <p>Solution:</p> <pre><code># Option 1: During init\nhtmlgraph init --install-hooks\n\n# Option 2: After init\nhtmlgraph setup install-hooks\n\n# Verify hooks are installed\nls -la .git/hooks/\n</code></pre> <p>Explanation: - Hooks track commits, checkouts, and merges - Links git activity to active features - Preserves context across sessions - Safe: hooks are versioned with your code</p> <p>Hook Events Tracked: - <code>post-commit</code>: Links commits to features - <code>post-checkout</code>: Detects branch switches - <code>post-merge</code>: Tracks merge activity</p>"},{"location":"cookbook/setup/#configure-agent","title":"Configure Agent","text":"<p>Problem: Set your agent identity for attribution.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\n# Option 1: Set agent in SDK initialization\nsdk = SDK(agent=\"claude-code\")\n\n# Option 2: Use environment variable\nimport os\nos.environ['HTMLGRAPH_AGENT'] = 'my-agent-name'\nsdk = SDK()  # Reads from environment\n\n# Option 3: Set in shell\nexport HTMLGRAPH_AGENT=my-agent-name\nhtmlgraph status  # Uses env variable\n</code></pre> <p>Explanation: - Agent identity is used for attribution in sessions and features - Appears in activity logs and step completion tracking - Enables multi-agent coordination - Use consistent names across sessions</p> <p>Best Practices: - Use descriptive names: \"claude-code\", \"cursor\", \"human-dev\" - Set HTMLGRAPH_AGENT in your shell profile for consistency - Include agent name in git config for fuller attribution</p>"},{"location":"cookbook/setup/#start-development-server","title":"Start Development Server","text":"<p>Problem: View the dashboard while developing.</p> <p>Solution:</p> <pre><code># Start server (default port 8080)\nhtmlgraph serve\n\n# Custom port\nhtmlgraph serve --port 3000\n\n# Auto-reload on file changes\nhtmlgraph serve --watch\n</code></pre> <p>Explanation: - Serves <code>index.html</code> dashboard with live data - Visualizes features, sessions, and dependencies - Updates automatically as you work - No build step required</p> <p>Access: - Dashboard: <code>http://localhost:8080</code> - Features view: <code>http://localhost:8080#features</code> - Sessions view: <code>http://localhost:8080#sessions</code> - Graph view: <code>http://localhost:8080#graph</code></p>"},{"location":"cookbook/setup/#bootstrap-example-data","title":"Bootstrap Example Data","text":"<p>Problem: Start with sample data to understand HtmlGraph.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"learning\")\n\n# Create example features\nexamples = [\n    {\n        \"title\": \"User Authentication\",\n        \"priority\": \"high\",\n        \"steps\": [\"Create login\", \"Add JWT\", \"Write tests\"]\n    },\n    {\n        \"title\": \"Database Schema\",\n        \"priority\": \"high\",\n        \"steps\": [\"Design tables\", \"Create migrations\", \"Seed data\"]\n    },\n    {\n        \"title\": \"API Endpoints\",\n        \"priority\": \"medium\",\n        \"steps\": [\"Define routes\", \"Add validation\", \"Document API\"]\n    }\n]\n\nfor ex in examples:\n    feature = sdk.features.create(ex[\"title\"]) \\\n        .set_priority(ex[\"priority\"]) \\\n        .add_steps(ex[\"steps\"]) \\\n        .save()\n    print(f\"Created: {feature.id}\")\n\n# Add dependencies\nauth = sdk.features.where(title=\"User Authentication\")[0]\ndb = sdk.features.where(title=\"Database Schema\")[0]\napi = sdk.features.where(title=\"API Endpoints\")[0]\n\nsdk.features.add_dependency(auth.id, db.id, \"blocks\")\nsdk.features.add_dependency(api.id, auth.id, \"blocks\")\n\nprint(\"\\nBootstrap complete! Run 'htmlgraph serve' to see the dashboard.\")\n</code></pre> <p>What You Get: - 3 sample features with steps - Dependency relationships - Ready to explore queries and workflows</p>"},{"location":"cookbook/setup/#cleanup-and-reset","title":"Cleanup and Reset","text":"<p>Problem: Start fresh or remove HtmlGraph from a project.</p> <p>Solution:</p> <pre><code># Backup first!\ncp -r .htmlgraph .htmlgraph.backup\n\n# Remove all HtmlGraph data\nrm -rf .htmlgraph\n\n# Uninstall git hooks\nrm .git/hooks/post-commit\nrm .git/hooks/post-checkout\nrm .git/hooks/post-merge\n\n# Reinitialize if needed\nhtmlgraph init --install-hooks\n</code></pre> <p>Caution: - This deletes ALL tracking data - Features, sessions, and events are permanently lost - Only do this if you're sure - Consider archiving instead of deleting</p>"},{"location":"cookbook/tracks/","title":"Track &amp; Planning Recipes","text":""},{"location":"cookbook/tracks/#create-track-with-spec-and-plan","title":"Create Track with Spec and Plan","text":"<p>Problem: Plan a multi-feature initiative with specification and implementation plan.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Create track with TrackBuilder (recommended)\ntrack = sdk.tracks.builder() \\\n    .title(\"User Authentication System\") \\\n    .description(\"Implement OAuth 2.0 authentication with JWT\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add secure authentication with OAuth 2.0 support\",\n        context=\"Current system has no authentication. Users need secure login.\",\n        requirements=[\n            (\"Implement OAuth 2.0 flow\", \"must-have\"),\n            (\"Add JWT token management\", \"must-have\"),\n            (\"Create user profile endpoint\", \"should-have\"),\n            \"Add password reset functionality\"  # Defaults to \"must-have\"\n        ],\n        acceptance_criteria=[\n            (\"Users can log in with Google/GitHub\", \"OAuth integration test passes\"),\n            \"JWT tokens expire after 1 hour\",\n            \"Password reset emails sent within 5 minutes\"\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: OAuth Setup\", [\n            \"Configure OAuth providers (1h)\",\n            \"Implement OAuth callback (2h)\",\n            \"Add state verification (1h)\"\n        ]),\n        (\"Phase 2: JWT Integration\", [\n            \"Create JWT signing logic (2h)\",\n            \"Add token refresh endpoint (1.5h)\",\n            \"Implement token validation middleware (2h)\"\n        ]),\n        (\"Phase 3: User Management\", [\n            \"Create user profile endpoint (3h)\",\n            \"Add password reset flow (4h)\",\n            \"Write integration tests (3h)\"\n        ])\n    ]) \\\n    .create()\n\nprint(f\"Created track: {track.id}\")\nprint(f\"  Spec: {len(track.spec.requirements)} requirements\")\nprint(f\"  Plan: {len(track.plan.phases)} phases, {sum(len(p.tasks) for p in track.plan.phases)} tasks\")\n</code></pre> <p>What Gets Created: <pre><code>.htmlgraph/tracks/track-20241224-120000/\n\u251c\u2500\u2500 index.html   # Track metadata\n\u251c\u2500\u2500 spec.html    # Specification with requirements\n\u2514\u2500\u2500 plan.html    # Implementation plan with phases\n</code></pre></p> <p>Explanation: - TrackBuilder provides fluent API for creation - Auto-generates track ID with timestamp - Creates index.html, spec.html, plan.html automatically - Parses time estimates from task descriptions (e.g., \"(2h)\") - Validates requirements and acceptance criteria via Pydantic</p>"},{"location":"cookbook/tracks/#link-features-to-track","title":"Link Features to Track","text":"<p>Problem: Associate features with their parent track.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack_id = \"track-20241224-120000\"\n\n# Method 1: Link when creating feature\noauth_feature = sdk.features.create(\"OAuth Integration\") \\\n    .set_track(track_id) \\\n    .set_priority(\"high\") \\\n    .add_steps([\n        \"Configure OAuth providers\",\n        \"Implement OAuth callback\",\n        \"Add state verification\"\n    ]) \\\n    .save()\n\n# Method 2: Link existing feature\nfeature = sdk.features.get(\"feature-123\")\nwith sdk.features.edit(feature.id) as f:\n    f.track = track_id\n\n# Method 3: Bulk link multiple features\nfeature_ids = [\"feat-001\", \"feat-002\", \"feat-003\"]\nsdk.features.batch_update(\n    feature_ids,\n    {\"track\": track_id}\n)\n\nprint(f\"Linked {len(feature_ids)} features to track {track_id}\")\n</code></pre> <p>Explanation: - track_id field links features to parent track - Enables track-level progress tracking - Used for querying related features - Automatically indexed for fast lookups</p>"},{"location":"cookbook/tracks/#track-progress-across-features","title":"Track Progress Across Features","text":"<p>Problem: Monitor overall progress for a multi-feature track.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack_id = \"track-20241224-120000\"\n\n# Get all features in track\ntrack_features = sdk.features.where(track=track_id)\n\n# Calculate progress\ntotal = len(track_features)\ndone = len([f for f in track_features if f.status == \"done\"])\nin_progress = len([f for f in track_features if f.status == \"in-progress\"])\ntodo = len([f for f in track_features if f.status == \"todo\"])\n\nprogress_pct = (done / total * 100) if total &gt; 0 else 0\n\nprint(f\"Track Progress: {track_id}\")\nprint(f\"  Total features: {total}\")\nprint(f\"  Done: {done} ({done/total*100:.1f}%)\")\nprint(f\"  In Progress: {in_progress}\")\nprint(f\"  Todo: {todo}\")\nprint(f\"  Overall: {progress_pct:.1f}% complete\")\n\n# Get step-level progress\ntotal_steps = sum(len(f.steps) for f in track_features)\ncompleted_steps = sum(len([s for s in f.steps if s.completed]) for f in track_features)\nstep_progress_pct = (completed_steps / total_steps * 100) if total_steps &gt; 0 else 0\n\nprint(f\"\\nStep Progress:\")\nprint(f\"  Completed: {completed_steps}/{total_steps} ({step_progress_pct:.1f}%)\")\n</code></pre> <p>Output: <pre><code>Track Progress: track-20241224-120000\n  Total features: 3\n  Done: 1 (33.3%)\n  In Progress: 1\n  Todo: 1\n  Overall: 33.3% complete\n\nStep Progress:\n  Completed: 7/15 (46.7%)\n</code></pre></p>"},{"location":"cookbook/tracks/#create-features-from-plan-phases","title":"Create Features from Plan Phases","text":"<p>Problem: Convert plan phases into concrete features.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack_id = \"track-20241224-120000\"\ntrack = sdk.tracks.get(track_id)\n\n# Create one feature per phase\nfor phase_idx, phase in enumerate(track.plan.phases):\n    feature = sdk.features.create(phase.name) \\\n        .set_track(track_id) \\\n        .set_priority(track.priority) \\\n        .add_steps([task.description for task in phase.tasks]) \\\n        .save()\n\n    print(f\"Created feature {feature.id} for phase {phase_idx + 1}: {phase.name}\")\n\nprint(f\"\\nCreated {len(track.plan.phases)} features from plan phases\")\n</code></pre> <p>Explanation: - Each phase becomes a feature - Tasks within phase become feature steps - Inherits track priority - Automatically linked to parent track</p>"},{"location":"cookbook/tracks/#query-tracks-by-status","title":"Query Tracks by Status","text":"<p>Problem: Find tracks in specific states.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get all tracks\nall_tracks = sdk.tracks.all()\n\n# Filter by status (computed from features)\nfor track in all_tracks:\n    features = sdk.features.where(track=track.id)\n\n    if not features:\n        status = \"not-started\"\n    elif all(f.status == \"done\" for f in features):\n        status = \"complete\"\n    elif any(f.status == \"in-progress\" for f in features):\n        status = \"in-progress\"\n    else:\n        status = \"todo\"\n\n    print(f\"{track.id}: {track.title} ({status})\")\n</code></pre> <p>Explanation: - Track status is derived from feature statuses - Not-started = no features yet - Complete = all features done - In-progress = at least one feature in-progress - Todo = has features, none in-progress</p>"},{"location":"cookbook/tracks/#update-specification","title":"Update Specification","text":"<p>Problem: Refine requirements as you learn more.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack = sdk.tracks.get(\"track-20241224-120000\")\n\n# Add new requirement\nwith sdk.tracks.edit(track.id) as t:\n    t.spec.requirements.append({\n        \"description\": \"Add 2FA support\",\n        \"priority\": \"should-have\"\n    })\n\n# Update acceptance criteria\nwith sdk.tracks.edit(track.id) as t:\n    t.spec.acceptance_criteria.append({\n        \"description\": \"2FA enrollment rate &gt; 50%\",\n        \"test_case\": \"Analytics query shows &gt;50% enrollment\"\n    })\n\n# Add context note\nwith sdk.tracks.edit(track.id) as t:\n    t.spec.context += \"\\n\\nUpdate (2024-12-24): Added 2FA requirement based on security audit.\"\n</code></pre> <p>Explanation: - Specs are living documents - Update as requirements change - Preserves history via git - Automatically updates spec.html file</p>"},{"location":"cookbook/tracks/#estimate-total-effort","title":"Estimate Total Effort","text":"<p>Problem: Calculate estimated hours for a track.</p> <p>Solution:</p> <pre><code>from htmlgraph import SDK\nimport re\n\nsdk = SDK(agent=\"claude\")\n\ntrack = sdk.tracks.get(\"track-20241224-120000\")\n\n# Parse time estimates from task descriptions\ntotal_hours = 0\nfor phase in track.plan.phases:\n    for task in phase.tasks:\n        # Look for patterns like (2h), (1.5h), etc.\n        match = re.search(r'\\((\\d+(?:\\.\\d+)?)\\s*h\\)', task.description)\n        if match:\n            hours = float(match.group(1))\n            total_hours += hours\n\nprint(f\"Track: {track.title}\")\nprint(f\"Estimated effort: {total_hours} hours\")\nprint(f\"                 {total_hours / 8:.1f} days\")\nprint(f\"                 {total_hours / 40:.1f} weeks\")\n</code></pre> <p>Output: <pre><code>Track: User Authentication System\nEstimated effort: 15.5 hours\n                 1.9 days\n                 0.4 weeks\n</code></pre></p> <p>Best Practice: Include time estimates in task descriptions: \"Implement OAuth (3h)\"</p>"},{"location":"design/hash-based-ids/","title":"Hash-Based ID System - Design Document","text":""},{"location":"design/hash-based-ids/#overview","title":"Overview","text":"<p>HtmlGraph uses a collision-resistant hash-based ID system for multi-agent collaboration. This design document explains the architecture, implementation, and rationale behind this approach.</p>"},{"location":"design/hash-based-ids/#problem-statement","title":"Problem Statement","text":"<p>Traditional timestamp-based IDs (<code>feature-20241222-143022</code>) have critical limitations:</p> <ol> <li>Collision Risk: Two agents creating features at the same second will generate identical IDs</li> <li>Not Content-Addressable: No relationship between ID and content</li> <li>Verbose: Long format consumes more space in HTML files and UIs</li> <li>Sequential Dependency: Requires coordination to ensure uniqueness</li> </ol>"},{"location":"design/hash-based-ids/#solution-hash-based-ids","title":"Solution: Hash-Based IDs","text":""},{"location":"design/hash-based-ids/#format","title":"Format","text":"<pre><code>{prefix}-{hash}\n</code></pre> <p>Examples: - <code>feat-a1b2c3d4</code> (feature) - <code>bug-12345678</code> (bug) - <code>sess-7890abcd</code> (session) - <code>trk-fedcba98</code> (track)</p>"},{"location":"design/hash-based-ids/#components","title":"Components","text":""},{"location":"design/hash-based-ids/#1-prefix-3-4-characters","title":"1. Prefix (3-4 characters)","text":"<p>Type-specific prefixes for human readability:</p> Node Type Prefix Example Feature <code>feat</code> <code>feat-a1b2c3d4</code> Bug <code>bug</code> <code>bug-12345678</code> Chore <code>chr</code> <code>chr-deadbeef</code> Spike <code>spk</code> <code>spk-87654321</code> Epic <code>epc</code> <code>epc-abcdef12</code> Session <code>sess</code> <code>sess-7890abcd</code> Track <code>trk</code> <code>trk-fedcba98</code> Phase <code>phs</code> <code>phs-11223344</code> Agent <code>agt</code> <code>agt-55667788</code> Spec <code>spec</code> <code>spec-99aabbcc</code> Plan <code>plan</code> <code>plan-ddeeff00</code> Event <code>evt</code> <code>evt-11223344</code>"},{"location":"design/hash-based-ids/#2-hash-8-hexadecimal-characters","title":"2. Hash (8 hexadecimal characters)","text":"<p>Generated from SHA256 hash of: - Title: Provides content-addressability - Timestamp: Microsecond precision in UTC - Random Entropy: 4 bytes (default) of cryptographic randomness</p> <pre><code>content = f\"{title}:{timestamp}\".encode() + random_bytes\nhash_digest = hashlib.sha256(content).hexdigest()[:8]\n</code></pre>"},{"location":"design/hash-based-ids/#hierarchical-ids","title":"Hierarchical IDs","text":"<p>For sub-tasks and nested work items:</p> <pre><code>{parent_id}.{index}\n</code></pre> <p>Examples: - <code>feat-a1b2c3d4.1</code> (first sub-task) - <code>feat-a1b2c3d4.1.2</code> (nested sub-task) - <code>feat-a1b2c3d4.10</code> (tenth sub-task)</p> <p>Supports unlimited nesting depth.</p>"},{"location":"design/hash-based-ids/#implementation","title":"Implementation","text":""},{"location":"design/hash-based-ids/#core-module-htmlgraphidspy","title":"Core Module: <code>htmlgraph/ids.py</code>","text":""},{"location":"design/hash-based-ids/#key-functions","title":"Key Functions","text":""},{"location":"design/hash-based-ids/#generate_idnode_type-title-entropy_bytes4","title":"<code>generate_id(node_type, title, entropy_bytes=4)</code>","text":"<p>Generates a collision-resistant ID.</p> <p>Algorithm: 1. Look up prefix for node type (or truncate to 4 chars) 2. Get current UTC timestamp with microsecond precision 3. Generate <code>entropy_bytes</code> of random data 4. Combine title + timestamp + entropy 5. Hash with SHA256 and take first 8 hex characters 6. Return <code>{prefix}-{hash}</code></p> <p>Complexity: O(1) Thread-Safe: Yes (uses <code>os.urandom()</code>)</p>"},{"location":"design/hash-based-ids/#generate_hierarchical_idparent_id-index","title":"<code>generate_hierarchical_id(parent_id, index)</code>","text":"<p>Creates a sub-task ID.</p> <p>Algorithm: 1. Validate parent_id is valid 2. Validate index &gt;= 1 3. Return <code>{parent_id}.{index}</code></p> <p>Complexity: O(1)</p>"},{"location":"design/hash-based-ids/#parse_idnode_id","title":"<code>parse_id(node_id)</code>","text":"<p>Parses an ID into components.</p> <p>Algorithm: 1. Try regex match for hash format: <code>^([a-z]{3,4})-([a-f0-9]{8})(\\.\\d+)*$</code> 2. If match, extract prefix, hash, and hierarchy 3. Try regex match for legacy format: <code>^([a-z]+)-(\\d{8}-\\d{6})$</code> 4. If match, extract components and mark as legacy 5. Return dictionary with parsed components</p> <p>Complexity: O(1)</p>"},{"location":"design/hash-based-ids/#is_valid_idnode_id","title":"<code>is_valid_id(node_id)</code>","text":"<p>Validates ID format.</p> <p>Algorithm: 1. Check if matches hash pattern OR legacy pattern 2. Return boolean</p> <p>Complexity: O(1)</p>"},{"location":"design/hash-based-ids/#validation-patterns","title":"Validation Patterns","text":""},{"location":"design/hash-based-ids/#hash-based-format","title":"Hash-Based Format","text":"<pre><code>^([a-z]{3,4})-([a-f0-9]{8})(\\.\\d+)*$\n</code></pre> <p>Matches: - <code>feat-a1b2c3d4</code> \u2713 - <code>feat-a1b2c3d4.1</code> \u2713 - <code>feat-a1b2c3d4.1.2</code> \u2713 - <code>sess-abcdef12</code> \u2713</p> <p>Rejects: - <code>feat-xyz</code> \u2717 (not hex) - <code>feat-a1b2c3d</code> \u2717 (not 8 chars) - <code>FEAT-a1b2c3d4</code> \u2717 (uppercase) - <code>feat-a1b2c3d4.0</code> \u2717 (index must be &gt;= 1)</p>"},{"location":"design/hash-based-ids/#legacy-format","title":"Legacy Format","text":"<pre><code>^([a-z]+)-(\\d{8}-\\d{6})$\n</code></pre> <p>Matches: - <code>feature-20241222-143022</code> \u2713 - <code>session-20241222-143022</code> \u2713</p>"},{"location":"design/hash-based-ids/#collision-resistance-analysis","title":"Collision Resistance Analysis","text":""},{"location":"design/hash-based-ids/#probability-calculation","title":"Probability Calculation","text":"<p>With default settings (4 bytes entropy): - Hash space: 2^32 = 4,294,967,296 possible values - Birthday paradox: 50% collision at \u221a(2^32) \u2248 65,536 IDs - With timestamp: Microsecond precision adds significant uniqueness - With title: Content-addressability adds semantic differentiation</p>"},{"location":"design/hash-based-ids/#practical-considerations","title":"Practical Considerations","text":"<p>Scenario: 1,000 agents creating 100 features each simultaneously - Total IDs: 100,000 - Collision probability: &lt; 0.1% (with timestamp + entropy) - Actual observed collisions: 0 (tested with 10,000 concurrent generations)</p>"},{"location":"design/hash-based-ids/#increasing-entropy-if-needed","title":"Increasing Entropy (if needed)","text":"<pre><code># Generate with more entropy\nid = generate_id(\"feature\", \"Title\", entropy_bytes=8)\n# Collision probability: 2^64 = effectively zero\n</code></pre>"},{"location":"design/hash-based-ids/#design-rationale","title":"Design Rationale","text":""},{"location":"design/hash-based-ids/#why-8-hex-characters","title":"Why 8 Hex Characters?","text":"<p>Trade-offs considered:</p> Length Space Collisions Readability 4 hex 65K Too high Good 6 hex 16M Moderate Good 8 hex 4B Very low Good 16 hex 2^64 Zero Poor (too long) <p>Decision: 8 characters balances collision resistance with readability.</p>"},{"location":"design/hash-based-ids/#why-sha256-not-md5-or-other","title":"Why SHA256 (not MD5 or other)?","text":"<ul> <li>Security: SHA256 is cryptographically secure</li> <li>Stability: Well-supported in Python stdlib</li> <li>Performance: Fast enough for ID generation</li> <li>Truncation: Taking first 8 chars is safe (uniform distribution)</li> </ul> <p>Not using MD5 because: - Cryptographically broken (not needed for IDs, but good practice) - No performance advantage over SHA256 in Python</p>"},{"location":"design/hash-based-ids/#why-timestamp-entropy-not-just-entropy","title":"Why Timestamp + Entropy (not just entropy)?","text":"<p>Combined approach provides: 1. Temporal ordering: IDs roughly sorted by creation time 2. Content addressability: Same title at different times = different ID 3. Collision resistance: Even identical titles at same microsecond = different ID 4. Debugging: Can estimate when ID was created</p>"},{"location":"design/hash-based-ids/#why-short-prefixes-3-4-chars","title":"Why Short Prefixes (3-4 chars)?","text":"<p>Benefits: - Compact: <code>feat-a1b2c3d4</code> vs <code>feature-a1b2c3d4</code> - Scannable: Easy to spot type in lists - Consistent: All IDs are 12-13 characters total</p> <p>Trade-off: - Slightly less readable than full words - Mitigation: Common types (feature, bug, session) are recognizable</p>"},{"location":"design/hash-based-ids/#backward-compatibility","title":"Backward Compatibility","text":""},{"location":"design/hash-based-ids/#legacy-id-support","title":"Legacy ID Support","text":"<p>The system fully supports legacy timestamp-based IDs:</p> <pre><code># Legacy format still works\nis_valid_id(\"feature-20241222-143022\")  # \u2192 True\nparse_id(\"feature-20241222-143022\")     # \u2192 Correctly parsed\n\n# No migration required\n</code></pre>"},{"location":"design/hash-based-ids/#migration-path-if-needed","title":"Migration Path (if needed)","text":"<p>If a project wants to migrate legacy IDs to hash-based:</p> <ol> <li>Keep existing IDs (no need to change)</li> <li>New features use hash-based IDs</li> <li>Optional: Add migration script to rename files</li> </ol> <p>Recommendation: Don't migrate existing IDs. Mixed formats work fine.</p>"},{"location":"design/hash-based-ids/#testing-strategy","title":"Testing Strategy","text":""},{"location":"design/hash-based-ids/#test-coverage","title":"Test Coverage","text":"<p>Unit tests (<code>tests/python/test_ids.py</code>): - \u2705 ID format validation (37 tests) - \u2705 Collision resistance (100 IDs with same title) - \u2705 Concurrent generation (50 parallel threads) - \u2705 Hierarchical IDs (nested sub-tasks) - \u2705 Parsing (hash, legacy, hierarchical) - \u2705 Edge cases (unicode, empty title, long titles, deep nesting) - \u2705 All prefix types - \u2705 Validation functions</p>"},{"location":"design/hash-based-ids/#stress-testing","title":"Stress Testing","text":"<pre><code># Generate 10,000 IDs concurrently\nwith ThreadPoolExecutor(max_workers=100) as executor:\n    futures = [executor.submit(generate_id, \"feature\", \"Test\")\n               for _ in range(10000)]\n    ids = [f.result() for f in futures]\n\nassert len(set(ids)) == 10000  # All unique\n</code></pre> <p>Results: 100% unique IDs (0 collisions)</p>"},{"location":"design/hash-based-ids/#performance","title":"Performance","text":""},{"location":"design/hash-based-ids/#benchmarks","title":"Benchmarks","text":"<p>Environment: Python 3.11, Linux, AMD64</p> Operation Time Notes <code>generate_id()</code> ~50 \u03bcs SHA256 + urandom <code>parse_id()</code> ~5 \u03bcs Regex match <code>is_valid_id()</code> ~5 \u03bcs Regex match <code>get_parent_id()</code> ~1 \u03bcs String split <p>Throughput: ~20,000 IDs/second (single-threaded)</p>"},{"location":"design/hash-based-ids/#optimization-opportunities","title":"Optimization Opportunities","text":"<ol> <li>Cache prefixes: Already done with <code>PREFIXES</code> dict</li> <li>Compile regexes: Already done (module-level)</li> <li>Reduce entropy: Can use 2 bytes if needed (still safe)</li> </ol> <p>Recommendation: Current performance is excellent. No optimization needed.</p>"},{"location":"design/hash-based-ids/#integration-points","title":"Integration Points","text":""},{"location":"design/hash-based-ids/#sdk-htmlgraphsdkpy","title":"SDK (<code>htmlgraph/sdk.py</code>)","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\nfeature = sdk.features.create(title=\"Auth System\")\nprint(feature.id)  # \u2192 \"feat-7f3a2b1c\" (auto-generated)\n</code></pre>"},{"location":"design/hash-based-ids/#cli-htmlgraphclipy","title":"CLI (<code>htmlgraph/cli.py</code>)","text":"<pre><code>htmlgraph feature create \"Auth System\" --priority high\n# Created: feat-9e8d7c6b\n</code></pre>"},{"location":"design/hash-based-ids/#builders-htmlgraphbuildersfeaturepy","title":"Builders (<code>htmlgraph/builders/feature.py</code>)","text":"<pre><code>from htmlgraph.builders import FeatureBuilder\n\nfeature = FeatureBuilder(\"Auth System\").set_priority(\"high\").save()\nprint(feature.id)  # \u2192 \"feat-a1b2c3d4\" (auto-generated)\n</code></pre>"},{"location":"design/hash-based-ids/#models-htmlgraphmodelspy","title":"Models (<code>htmlgraph/models.py</code>)","text":"<pre><code>from htmlgraph.models import Feature\nfrom htmlgraph.ids import generate_id\n\nfeature = Feature(\n    id=generate_id(\"feature\", \"Auth System\"),\n    title=\"Auth System\",\n    status=\"todo\"\n)\n</code></pre>"},{"location":"design/hash-based-ids/#future-enhancements","title":"Future Enhancements","text":""},{"location":"design/hash-based-ids/#auto-increment-hierarchical-ids","title":"Auto-Increment Hierarchical IDs","text":"<p>Current: <pre><code># Manual index required\ngenerate_hierarchical_id(\"feat-a1b2c3d4\", 1)\n</code></pre></p> <p>Future: <pre><code># Auto-increment based on filesystem\ngenerate_hierarchical_id(\"feat-a1b2c3d4\")  # \u2192 feat-a1b2c3d4.1\ngenerate_hierarchical_id(\"feat-a1b2c3d4\")  # \u2192 feat-a1b2c3d4.2\n</code></pre></p> <p>Implementation: - Scan <code>.htmlgraph/features/</code> for existing children - Find max index + 1 - Atomic file creation to prevent races</p>"},{"location":"design/hash-based-ids/#custom-prefixes","title":"Custom Prefixes","text":"<p>Current: Fixed prefixes in <code>PREFIXES</code> dict</p> <p>Future: <pre><code># User-defined prefixes\ngenerate_id(\"custom_type\", \"Title\", prefix=\"cust\")\n# \u2192 \"cust-a1b2c3d4\"\n</code></pre></p>"},{"location":"design/hash-based-ids/#id-aliases","title":"ID Aliases","text":"<p>Use case: Short aliases for frequently-used IDs</p> <pre><code># Create alias\ncreate_alias(\"feat-a1b2c3d4\", \"auth\")\n\n# Use in commands\nhtmlgraph feature show auth  # \u2192 Resolves to feat-a1b2c3d4\n</code></pre>"},{"location":"design/hash-based-ids/#references","title":"References","text":"<ul> <li>Inspiration: Beads - Multi-agent collaboration framework</li> <li>SHA256: FIPS 180-4</li> <li>Birthday Paradox: Wikipedia</li> <li>Semantic Versioning: semver.org</li> </ul>"},{"location":"design/hash-based-ids/#changelog","title":"Changelog","text":""},{"location":"design/hash-based-ids/#v094-2025-12-26","title":"v0.9.4 (2025-12-26)","text":"<ul> <li>Enhanced test coverage (24 \u2192 37 tests)</li> <li>Added edge case testing (unicode, deep nesting, etc.)</li> <li>Documented design rationale and performance characteristics</li> </ul>"},{"location":"design/hash-based-ids/#v030-2025-12-22","title":"v0.3.0 (2025-12-22)","text":"<ul> <li>Initial hash-based ID implementation</li> <li>Support for hierarchical IDs</li> <li>Backward compatibility with legacy format</li> <li>Comprehensive test suite</li> </ul> <p>Last Updated: 2025-12-26 Author: HtmlGraph Development Team Status: Stable</p>"},{"location":"examples/","title":"Examples","text":"<p>Real-world examples of using HtmlGraph.</p>"},{"location":"examples/#basic-examples","title":"Basic Examples","text":"<ul> <li>Basic Usage - Simple feature creation and management</li> <li>Agent Workflows - Agent integration patterns</li> <li>Track Creation - Creating tracks with specs and plans</li> </ul>"},{"location":"examples/#use-cases","title":"Use Cases","text":""},{"location":"examples/#personal-knowledge-base","title":"Personal Knowledge Base","text":"<p>Use HtmlGraph to manage notes and ideas:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"me\")\n\n# Create a note\nnote = sdk.features.create(\n    title=\"Research: Graph Databases\",\n    properties={\"type\": \"note\", \"category\": \"research\"}\n)\n\n# Link related notes\nsdk.features.add_edge(\n    from_id=note.id,\n    to_id=\"feature-another-note\",\n    relationship=\"related\"\n)\n</code></pre>"},{"location":"examples/#project-management","title":"Project Management","text":"<p>Track tasks and deliverables:</p> <pre><code># Create a project track\nproject = sdk.tracks.builder() \\\n    .title(\"Website Redesign\") \\\n    .with_plan_phases([\n        (\"Phase 1: Design\", [\n            \"Create mockups (8h)\",\n            \"Review with stakeholders (2h)\"\n        ]),\n        (\"Phase 2: Development\", [\n            \"Implement frontend (20h)\",\n            \"Backend API (15h)\"\n        ])\n    ]) \\\n    .create()\n\n# Create features for each deliverable\nfor phase in project.plan.phases:\n    for task in phase.tasks:\n        sdk.features.create(\n            title=task.description,\n            track_id=project.track_id\n        )\n</code></pre>"},{"location":"examples/#agent-coordination","title":"Agent Coordination","text":"<p>Coordinate multiple AI agents:</p> <pre><code># Agent 1 creates feature\nclaude = SDK(agent=\"claude\")\nfeature = claude.features.create(\"Implement auth\")\nfeature.assigned_agent = \"claude\"\nfeature.save()\n\n# Agent 1 completes part of the work\nfeature.steps[0].completed = True\nfeature.handoff_notes = \"OAuth configured. JWT implementation next.\"\nfeature.assigned_agent = \"gemini\"\nfeature.save()\n\n# Agent 2 picks up\ngemini = SDK(agent=\"gemini\")\nfeature = gemini.features.get(feature.id)\nprint(feature.handoff_notes)  # See what Agent 1 did\n</code></pre>"},{"location":"examples/#complete-examples","title":"Complete Examples","text":"<p>Browse the example implementations:</p> <ul> <li>Todo List</li> <li>Agent Coordination</li> <li>Knowledge Base</li> </ul>"},{"location":"examples/#next-steps","title":"Next Steps","text":"<ul> <li>Basic Usage Examples - Start here</li> <li>Agent Workflows - Agent integration</li> <li>Track Creation - Complex track examples</li> </ul>"},{"location":"examples/agent-coordination/","title":"Agent Coordination Examples","text":"<p>Real-world patterns for coordinating multiple AI agents using HtmlGraph.</p>"},{"location":"examples/agent-coordination/#multi-agent-workflow-with-subagents","title":"Multi-Agent Workflow with Subagents","text":"<p>HtmlGraph provides <code>spawn_explorer</code> and <code>spawn_coder</code> for delegating specialized tasks to subagents, preserving main session context for orchestration.</p>"},{"location":"examples/agent-coordination/#two-phase-pattern-explorer-coder","title":"Two-Phase Pattern: Explorer \u2192 Coder","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Create a feature\nfeature = sdk.features.create(\"Add OAuth authentication\") \\\n    .set_priority(\"high\") \\\n    .save()\n\n# Phase 1: Spawn explorer to discover codebase\nexplorer_prompt = sdk.spawn_explorer(\n    task=\"Map the authentication system\",\n    scope=\"src/auth/\",\n    patterns=[\"**/*.py\"],\n    questions=[\n        \"What authentication framework is currently used?\",\n        \"Where are auth routes defined?\",\n        \"What patterns should I follow?\"\n    ]\n)\n\n# Execute explorer with Task tool\n# Task(prompt=explorer_prompt[\"prompt\"],\n#      description=explorer_prompt[\"description\"])\n\n# After explorer completes, you receive results like:\nexplorer_results = \"\"\"\nSUMMARY: Found FastAPI-based auth system\nFILES: src/auth/routes.py, src/auth/middleware.py\nPATTERNS: Uses JWT tokens, OAuth handlers in routes.py\n\"\"\"\n\n# Phase 2: Spawn coder with explorer context\ncoder_prompt = sdk.spawn_coder(\n    feature_id=feature.id,\n    context=explorer_results,\n    files_to_modify=[\"src/auth/routes.py\", \"src/auth/oauth.py\"],\n    test_command=\"uv run pytest tests/auth/\"\n)\n\n# Execute coder with Task tool\n# Task(prompt=coder_prompt[\"prompt\"],\n#      description=coder_prompt[\"description\"])\n</code></pre>"},{"location":"examples/agent-coordination/#benefits-of-subagent-pattern","title":"Benefits of Subagent Pattern","text":"<ol> <li>Context Efficiency: Main session preserves context for orchestration decisions</li> <li>Specialized Focus: Explorer finds patterns, coder implements changes</li> <li>Stateless Execution: Each subagent is ephemeral and task-focused</li> <li>Parallel Potential: Multiple subagents can work simultaneously</li> </ol>"},{"location":"examples/agent-coordination/#parallel-task-execution","title":"Parallel Task Execution","text":"<p>Execute multiple features in parallel using orchestration:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Create multiple related features\nfeatures = [\n    sdk.features.create(\"Add Google OAuth\").set_priority(\"high\").save(),\n    sdk.features.create(\"Add GitHub OAuth\").set_priority(\"high\").save(),\n    sdk.features.create(\"Implement token refresh\").set_priority(\"medium\").save()\n]\n\n# Spawn explorers in parallel (each discovers their domain)\nexplorer_prompts = []\nfor feat in features:\n    prompt = sdk.spawn_explorer(\n        task=f\"Explore codebase for: {feat.title}\",\n        scope=\"src/auth/\",\n        questions=[\n            \"What existing OAuth code can be reused?\",\n            \"What files need changes?\"\n        ]\n    )\n    explorer_prompts.append((feat.id, prompt))\n    # Execute each with Task tool in parallel\n\n# After exploration, spawn coders in parallel\ncoder_prompts = []\nfor feat_id, explorer_result in zip([f.id for f in features], explorer_results):\n    prompt = sdk.spawn_coder(\n        feature_id=feat_id,\n        context=explorer_result,\n        test_command=\"uv run pytest tests/auth/\"\n    )\n    coder_prompts.append(prompt)\n    # Execute each with Task tool in parallel\n</code></pre>"},{"location":"examples/agent-coordination/#agent-handoff-pattern","title":"Agent Handoff Pattern","text":"<p>Transfer work between different agents with full context preservation:</p> <pre><code># Agent 1 (Claude) starts work\nclaude_sdk = SDK(agent=\"claude\")\n\nfeature = claude_sdk.features.create(\"Implement OAuth flow\") \\\n    .add_steps([\n        \"Configure OAuth providers\",\n        \"Implement callback handler\",\n        \"Add token storage\"\n    ]) \\\n    .save()\n\n# Claude completes initial steps\nwith claude_sdk.features.edit(feature.id) as f:\n    f.status = \"in-progress\"\n    f.assigned_agent = \"claude\"\n    f.steps[0].completed = True\n\n# Claude hands off to Gemini\nwith claude_sdk.features.edit(feature.id) as f:\n    f.handoff_notes = \"\"\"\n    Completed OAuth provider configuration for Google and GitHub.\n\n    Next Steps:\n    - Implement callback handler at /auth/callback\n    - Files to modify: src/auth/oauth.py, src/routes/auth.py\n    - Use existing JWT middleware pattern from src/auth/middleware.py\n\n    Blockers: None\n    \"\"\"\n    f.assigned_agent = \"gemini\"\n\n# Agent 2 (Gemini) picks up work\ngemini_sdk = SDK(agent=\"gemini\")\n\nfeature = gemini_sdk.features.get(feature.id)\nprint(f\"Handoff notes: {feature.handoff_notes}\")\n\n# Gemini continues from step 2\nwith gemini_sdk.features.edit(feature.id) as f:\n    f.steps[1].completed = True\n    # Continue work...\n</code></pre>"},{"location":"examples/agent-coordination/#orchestrated-feature-implementation","title":"Orchestrated Feature Implementation","text":"<p>Use the high-level <code>orchestrate()</code> method for complete automation:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Create feature\nfeature = sdk.features.create(\"Add user profile endpoint\") \\\n    .add_steps([\n        \"Create route handler\",\n        \"Add database queries\",\n        \"Write tests\"\n    ]) \\\n    .save()\n\n# Orchestrate full implementation (spawns explorer + coder automatically)\nresult = sdk.orchestrate(\n    feature_id=feature.id,\n    exploration_scope=\"src/\",\n    test_command=\"uv run pytest tests/api/\"\n)\n\n# Returns prompts for both subagents\nexplorer_prompt = result[\"explorer\"]\ncoder_prompt = result[\"coder\"]\n\n# Execute in sequence:\n# 1. Task(prompt=explorer_prompt[\"prompt\"], ...)\n# 2. Task(prompt=coder_prompt[\"prompt\"], ...)\n</code></pre>"},{"location":"examples/agent-coordination/#custom-agent-integration","title":"Custom Agent Integration","text":"<p>Build your own agent wrapper with automatic tracking:</p> <pre><code>from htmlgraph import SDK\n\nclass CustomAgent:\n    def __init__(self, name: str):\n        self.sdk = SDK(agent=name)\n        self.name = name\n\n    def execute_task(self, task_description: str):\n        \"\"\"Execute task with automatic feature tracking\"\"\"\n        # Create feature\n        feature = self.sdk.features.create(task_description).save()\n\n        # Start work\n        with self.sdk.features.edit(feature.id) as f:\n            f.status = \"in-progress\"\n            f.assigned_agent = self.name\n\n        try:\n            # Your execution logic here\n            result = self._do_work(feature)\n\n            # Mark complete\n            with self.sdk.features.edit(feature.id) as f:\n                f.status = \"done\"\n\n            return result\n\n        except Exception as e:\n            # Handle failure\n            with self.sdk.features.edit(feature.id) as f:\n                f.status = \"blocked\"\n                f.handoff_notes = f\"Error: {str(e)}\\nNeeds investigation\"\n            raise\n\n    def _do_work(self, feature):\n        # Your implementation\n        for i, step in enumerate(feature.steps):\n            self._execute_step(step.description)\n            with self.sdk.features.edit(feature.id) as f:\n                f.steps[i].completed = True\n\n    def _execute_step(self, step_description: str):\n        # Your step execution logic\n        pass\n\n# Usage\nagent = CustomAgent(\"my-agent\")\nagent.execute_task(\"Implement payment processing\")\n</code></pre>"},{"location":"examples/agent-coordination/#session-tracking","title":"Session Tracking","text":"<p>All agent activity is tracked automatically:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Sessions start automatically\nstatus = sdk.status()\nprint(f\"Current session: {status.current_session}\")\nprint(f\"Active features: {status.active_features}\")\n\n# All SDK operations are logged to .htmlgraph/events/*.jsonl\nfeature = sdk.features.create(\"New feature\")\n\n# View session activity\n# open .htmlgraph/sessions/{session_id}/index.html\n</code></pre>"},{"location":"examples/agent-coordination/#best-practices","title":"Best Practices","text":""},{"location":"examples/agent-coordination/#1-use-explorers-for-discovery","title":"1. Use Explorers for Discovery","text":"<pre><code># Good: Use explorer to understand codebase first\nexplorer = sdk.spawn_explorer(\n    task=\"Find authentication patterns\",\n    scope=\"src/\",\n    patterns=[\"**/*.py\"]\n)\n# Then use results to inform implementation\n</code></pre>"},{"location":"examples/agent-coordination/#2-preserve-context-with-handoffs","title":"2. Preserve Context with Handoffs","text":"<pre><code># Good: Detailed handoff notes\nwith sdk.features.edit(feature.id) as f:\n    f.handoff_notes = \"\"\"\n    What I did: Configured OAuth providers\n    What's next: Implement callback at /auth/callback\n    Files: src/auth/oauth.py (see TODO comments)\n    \"\"\"\n    f.assigned_agent = \"next-agent\"\n</code></pre>"},{"location":"examples/agent-coordination/#3-parallel-when-possible","title":"3. Parallel When Possible","text":"<pre><code># Good: Independent features can run in parallel\nfeatures = [create_google_oauth(), create_github_oauth()]\nprompts = [sdk.spawn_coder(f.id) for f in features]\n# Execute all prompts with Task tool simultaneously\n</code></pre>"},{"location":"examples/agent-coordination/#4-always-specify-test-commands","title":"4. Always Specify Test Commands","text":"<pre><code># Good: Coders run tests automatically\ncoder = sdk.spawn_coder(\n    feature_id=feature.id,\n    test_command=\"uv run pytest tests/auth/ -v\"\n)\n</code></pre>"},{"location":"examples/agent-coordination/#next-steps","title":"Next Steps","text":"<ul> <li>Agents Guide - Full agent integration guide</li> <li>Track Examples - Complex multi-feature workflows</li> <li>API Reference - Complete SDK documentation</li> </ul>"},{"location":"examples/agents/","title":"Agent Workflows","text":"<p>Examples of integrating HtmlGraph with AI agents.</p>"},{"location":"examples/agents/#claude-code-integration","title":"Claude Code Integration","text":"<pre><code>from htmlgraph import SDK\n\n# SDK automatically detects agent from environment\nsdk = SDK(agent=\"claude\")\n\n# Create feature with TrackBuilder decision framework\nuser_request = \"Add user authentication\"\n\n# Decision: Complex feature, create a track\ntrack = sdk.tracks.builder() \\\n    .title(\"User Authentication System\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Implement secure authentication\",\n        requirements=[\n            (\"OAuth 2.0 support\", \"must-have\"),\n            (\"JWT token management\", \"must-have\")\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: Setup\", [\"Configure OAuth (2h)\", \"Setup DB (1h)\"]),\n        (\"Phase 2: Implementation\", [\"Implement login (4h)\", \"Add middleware (3h)\"])\n    ]) \\\n    .create()\n\n# Create features for each phase\nfor phase in track.plan.phases:\n    sdk.features.create(\n        title=phase.name,\n        track_id=track.track_id,\n        steps=[task.description for task in phase.tasks]\n    )\n</code></pre>"},{"location":"examples/agents/#multi-agent-collaboration","title":"Multi-Agent Collaboration","text":"<pre><code># Agent 1: Claude creates and starts work\nclaude_sdk = SDK(agent=\"claude\")\n\nfeature = claude_sdk.features.create(\n    title=\"Implement OAuth flow\",\n    priority=\"high\",\n    steps=[\n        \"Configure OAuth providers\",\n        \"Implement callback handler\",\n        \"Add token storage\"\n    ]\n)\n\n# Claude completes first step\nfeature.steps[0].completed = True\nfeature.assigned_agent = \"claude\"\nfeature.save()\n\n# Claude hands off to Gemini\nfeature.handoff_notes = \"\"\"\nCompleted OAuth provider configuration for Google and GitHub.\n\nNext: Implement callback handler at /auth/callback\nFiles: src/auth/oauth.py, src/routes/auth.py\n\"\"\"\nfeature.assigned_agent = \"gemini\"\nfeature.save()\n\n# Agent 2: Gemini picks up\ngemini_sdk = SDK(agent=\"gemini\")\n\nfeature = gemini_sdk.features.get(feature.id)\nprint(feature.handoff_notes)\n\n# Gemini continues work\nfeature.steps[1].completed = True\nfeature.save()\n</code></pre>"},{"location":"examples/agents/#custom-agent-integration","title":"Custom Agent Integration","text":"<pre><code>from htmlgraph import SDK\n\nclass MyCustomAgent:\n    def __init__(self, name):\n        self.sdk = SDK(agent=name)\n        self.name = name\n\n    def process_task(self, task_description):\n        \"\"\"Process a task with automatic tracking\"\"\"\n        # Create feature\n        feature = self.sdk.features.create(\n            title=task_description,\n            priority=self.assess_priority(task_description)\n        )\n\n        # Start working\n        self.sdk.features.start(feature.id)\n\n        try:\n            # Execute task\n            result = self.execute_task(feature)\n\n            # Mark complete\n            feature.status = \"done\"\n            feature.save()\n\n            return result\n\n        except Exception as e:\n            # Handle failure\n            feature.status = \"blocked\"\n            feature.handoff_notes = f\"Error: {str(e)}\"\n            feature.save()\n            raise\n\n    def assess_priority(self, description):\n        # Your priority logic\n        keywords = {\"urgent\", \"critical\", \"important\"}\n        if any(kw in description.lower() for kw in keywords):\n            return \"high\"\n        return \"medium\"\n\n    def execute_task(self, feature):\n        # Your execution logic\n        for i, step in enumerate(feature.steps):\n            self.execute_step(step.description)\n            feature.steps[i].completed = True\n            feature.save()\n\n    def execute_step(self, step_description):\n        # Your step execution logic\n        pass\n\n# Usage\nagent = MyCustomAgent(\"my-agent\")\nagent.process_task(\"Add user authentication\")\n</code></pre>"},{"location":"examples/agents/#session-management","title":"Session Management","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Sessions start automatically\nstatus = sdk.status()\nprint(f\"Current session: {status.current_session}\")\n\n# All activity is logged automatically via hooks\nfeature = sdk.features.create(\"Implement API\")\n\n# Document decisions\nsdk.track_activity(\n    feature_id=feature.id,\n    activity=\"Chose FastAPI over Flask (async support)\"\n)\n\n# Session ends automatically when work completes\nfeature.status = \"done\"\nfeature.save()\n</code></pre>"},{"location":"examples/agents/#next-steps","title":"Next Steps","text":"<ul> <li>Track Creation Examples - Complex track workflows</li> <li>Agents Guide - Full agent integration guide</li> <li>Sessions Guide - Session tracking details</li> </ul>"},{"location":"examples/basic/","title":"Basic Usage","text":"<p>Simple examples to get started with HtmlGraph.</p>"},{"location":"examples/basic/#creating-your-first-feature","title":"Creating Your First Feature","text":"<pre><code>from htmlgraph import SDK\n\n# Initialize SDK\nsdk = SDK(agent=\"me\")\n\n# Create a feature\nfeature = sdk.features.create(\n    title=\"Add user login\",\n    priority=\"high\",\n    steps=[\n        \"Create login form\",\n        \"Add authentication logic\",\n        \"Write tests\"\n    ]\n)\n\nprint(f\"Created: {feature.id}\")\n# Output: Created: feature-20241216-103045\n</code></pre>"},{"location":"examples/basic/#updating-a-feature","title":"Updating a Feature","text":"<pre><code># Get the feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n\n# Mark as in progress\nfeature.status = \"in-progress\"\nfeature.save()\n\n# Complete first step\nfeature.steps[0].completed = True\nfeature.save()\n\n# Check progress\ncompleted = sum(1 for s in feature.steps if s.completed)\ntotal = len(feature.steps)\nprint(f\"Progress: {completed}/{total} steps complete\")\n</code></pre>"},{"location":"examples/basic/#querying-features","title":"Querying Features","text":"<pre><code># Get all features\nall_features = sdk.features.all()\n\n# Filter by status\ntodo_features = sdk.features.where(status=\"todo\")\nin_progress = sdk.features.where(status=\"in-progress\")\n\n# Filter by priority\nhigh_priority = sdk.features.where(priority=\"high\")\n\n# Multiple filters\nurgent_tasks = sdk.features.where(\n    status=\"todo\",\n    priority=\"high\"\n)\n\n# Display results\nfor feature in urgent_tasks:\n    print(f\"- {feature.title} ({feature.priority})\")\n</code></pre>"},{"location":"examples/basic/#viewing-in-browser","title":"Viewing in Browser","text":"<pre><code># All features are HTML files\n# Open in any browser to view\nimport webbrowser\n\nfeature = sdk.features.get(\"feature-20241216-103045\")\nwebbrowser.open(f\".htmlgraph/features/{feature.id}.html\")\n</code></pre>"},{"location":"examples/basic/#using-the-cli","title":"Using the CLI","text":"<pre><code># Create a feature\nhtmlgraph feature create \"Add user login\" --priority high\n\n# List all features\nhtmlgraph feature list\n\n# Start working on a feature\nhtmlgraph feature start feature-20241216-103045\n\n# Mark complete\nhtmlgraph feature complete feature-20241216-103045\n</code></pre>"},{"location":"examples/basic/#launching-the-dashboard","title":"Launching the Dashboard","text":"<pre><code># Start the server\nhtmlgraph serve\n\n# Open http://localhost:8080 in your browser\n# See Kanban board, graph view, timeline, etc.\n</code></pre>"},{"location":"examples/basic/#complete-example-script","title":"Complete Example Script","text":"<pre><code>#!/usr/bin/env python3\nfrom htmlgraph import SDK\n\ndef main():\n    # Initialize\n    sdk = SDK(agent=\"example-script\")\n\n    # Create features for a small project\n    features = []\n\n    features.append(sdk.features.create(\n        title=\"Set up database\",\n        priority=\"high\",\n        steps=[\n            \"Install PostgreSQL\",\n            \"Create database schema\",\n            \"Add migrations\"\n        ]\n    ))\n\n    features.append(sdk.features.create(\n        title=\"Create API endpoints\",\n        priority=\"high\",\n        steps=[\n            \"Define routes\",\n            \"Implement handlers\",\n            \"Add validation\"\n        ]\n    ))\n\n    features.append(sdk.features.create(\n        title=\"Write tests\",\n        priority=\"medium\",\n        steps=[\n            \"Unit tests\",\n            \"Integration tests\",\n            \"E2E tests\"\n        ]\n    ))\n\n    # Add dependency: API depends on database\n    sdk.features.add_edge(\n        from_id=features[0].id,  # database\n        to_id=features[1].id,    # API\n        relationship=\"blocks\"\n    )\n\n    print(f\"Created {len(features)} features\")\n    print(\"\\nNext steps:\")\n    print(f\"  1. htmlgraph serve\")\n    print(f\"  2. Open http://localhost:8080\")\n    print(f\"  3. View your features in the dashboard\")\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Run it:</p> <pre><code>python example.py\nhtmlgraph serve\n</code></pre>"},{"location":"examples/basic/#next-steps","title":"Next Steps","text":"<ul> <li>Agent Workflows - Integrate with AI agents</li> <li>Track Creation - Create multi-feature tracks</li> <li>User Guide - In-depth documentation</li> </ul>"},{"location":"examples/tracks/","title":"Track Creation","text":"<p>Examples of creating tracks with specs and plans.</p>"},{"location":"examples/tracks/#simple-track","title":"Simple Track","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Minimal track\ntrack = sdk.tracks.builder() \\\n    .title(\"Website Redesign\") \\\n    .description(\"Redesign company website\") \\\n    .priority(\"high\") \\\n    .create()\n\nprint(f\"Created: {track.track_id}\")\n</code></pre>"},{"location":"examples/tracks/#track-with-specification","title":"Track with Specification","text":"<pre><code># Track with detailed spec\ntrack = sdk.tracks.builder() \\\n    .title(\"User Authentication System\") \\\n    .description(\"Implement secure authentication\") \\\n    .priority(\"critical\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 authentication with Google and GitHub providers\",\n        context=\"\"\"\nCurrent State:\n- No authentication system\n- Users cannot save preferences\n- No access control\n\nGoal:\n- Secure OAuth 2.0 login\n- JWT token management\n- User profile management\n        \"\"\",\n        requirements=[\n            (\"Google OAuth integration\", \"must-have\"),\n            (\"GitHub OAuth integration\", \"must-have\"),\n            (\"JWT token management\", \"must-have\"),\n            (\"Token refresh mechanism\", \"must-have\"),\n            (\"User profile endpoint\", \"should-have\"),\n            (\"Remember me functionality\", \"nice-to-have\")\n        ],\n        acceptance_criteria=[\n            (\"Users can log in with Google\", \"OAuth login test passes\"),\n            (\"Users can log in with GitHub\", \"OAuth login test passes\"),\n            (\"Tokens refresh automatically\", \"Token refresh test passes\"),\n            \"Session persists across browser restarts\",\n            \"Logout clears all tokens\"\n        ],\n        constraints=[\n            \"Must comply with GDPR\",\n            \"Must use OAuth 2.0 standard\",\n            \"Maximum 500ms latency for token validation\",\n            \"Support 10,000 concurrent users\"\n        ]\n    ) \\\n    .create()\n</code></pre>"},{"location":"examples/tracks/#track-with-implementation-plan","title":"Track with Implementation Plan","text":"<pre><code># Track with phased plan\ntrack = sdk.tracks.builder() \\\n    .title(\"Database Migration\") \\\n    .description(\"Migrate from SQLite to PostgreSQL\") \\\n    .priority(\"high\") \\\n    .with_plan_phases([\n        (\"Phase 1: Setup &amp; Planning\", [\n            \"Install PostgreSQL (0.5h)\",\n            \"Design new schema (2h)\",\n            \"Create migration scripts (4h)\",\n            \"Set up staging environment (1h)\"\n        ]),\n        (\"Phase 2: Data Migration\", [\n            \"Export data from SQLite (1h)\",\n            \"Transform data for PostgreSQL (3h)\",\n            \"Import to staging database (2h)\",\n            \"Validate data integrity (4h)\"\n        ]),\n        (\"Phase 3: Testing\", [\n            \"Update application config (1h)\",\n            \"Run integration tests (3h)\",\n            \"Performance testing (4h)\",\n            \"Load testing (2h)\"\n        ]),\n        (\"Phase 4: Production Deployment\", [\n            \"Schedule maintenance window\",\n            \"Backup production database (1h)\",\n            \"Run production migration (3h)\",\n            \"Validate and monitor (2h)\",\n            \"Update documentation (1h)\"\n        ])\n    ]) \\\n    .create()\n\nprint(f\"Total estimated time: {track.plan.total_estimate_hours}h\")\n</code></pre>"},{"location":"examples/tracks/#complete-track-spec-plan","title":"Complete Track (Spec + Plan)","text":"<pre><code># Full track with spec and plan\ntrack = sdk.tracks.builder() \\\n    .title(\"API Rate Limiting\") \\\n    .description(\"Implement rate limiting for all API endpoints\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Protect API from abuse with token bucket rate limiting\",\n        context=\"Current API has no rate limits, vulnerable to DoS attacks\",\n        requirements=[\n            (\"Token bucket algorithm\", \"must-have\"),\n            (\"Redis for distributed state\", \"must-have\"),\n            (\"Rate limit middleware\", \"must-have\"),\n            (\"Rate limit headers in responses\", \"should-have\"),\n            (\"Per-endpoint limits\", \"should-have\"),\n            (\"Admin bypass capability\", \"nice-to-have\")\n        ],\n        acceptance_criteria=[\n            (\"100 req/min per API key\", \"Load test confirms\"),\n            (\"429 status when exceeded\", \"Integration test passes\"),\n            \"Rate limits reset every 60 seconds\",\n            \"Distributed across multiple servers\",\n            \"Sub-5ms latency overhead\"\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: Core Implementation\", [\n            \"Implement token bucket (3h)\",\n            \"Add Redis client (1h)\",\n            \"Create rate limit middleware (2h)\",\n            \"Add configuration system (1h)\"\n        ]),\n        (\"Phase 2: Integration\", [\n            \"Add middleware to all routes (2h)\",\n            \"Implement rate limit headers (1h)\",\n            \"Add admin bypass logic (1h)\",\n            \"Error handling and logging (2h)\"\n        ]),\n        (\"Phase 3: Testing &amp; Docs\", [\n            \"Unit tests for algorithm (2h)\",\n            \"Integration tests (3h)\",\n            \"Load testing (4h)\",\n            \"API documentation (2h)\",\n            \"Deployment guide (1h)\"\n        ])\n    ]) \\\n    .create()\n\n# View the created files\nprint(f\"\\nCreated track: {track.track_id}\")\nprint(f\"  - Spec: .htmlgraph/tracks/{track.track_id}/spec.html\")\nprint(f\"  - Plan: .htmlgraph/tracks/{track.track_id}/plan.html\")\nprint(f\"  - Index: .htmlgraph/tracks/{track.track_id}/index.html\")\n</code></pre>"},{"location":"examples/tracks/#creating-features-from-track","title":"Creating Features from Track","text":"<pre><code># Create a track\ntrack = sdk.tracks.builder() \\\n    .title(\"E-commerce Platform\") \\\n    .with_plan_phases([\n        (\"Phase 1: Product Catalog\", [\n            \"Product listing page\",\n            \"Product detail page\",\n            \"Search functionality\"\n        ]),\n        (\"Phase 2: Shopping Cart\", [\n            \"Add to cart\",\n            \"Cart management\",\n            \"Checkout flow\"\n        ]),\n        (\"Phase 3: Payment\", [\n            \"Payment gateway integration\",\n            \"Order confirmation\",\n            \"Email notifications\"\n        ])\n    ]) \\\n    .create()\n\n# Create a feature for each task\nall_features = []\n\nfor phase in track.plan.phases:\n    for task in phase.tasks:\n        feature = sdk.features.create(\n            title=task.description,\n            track_id=track.track_id,\n            priority=track.priority,\n            properties={\n                \"phase\": phase.name,\n                \"estimate_hours\": task.estimate_hours or 0\n            }\n        )\n        all_features.append(feature)\n\nprint(f\"Created {len(all_features)} features for track {track.track_id}\")\n\n# Open in browser\nimport webbrowser\nwebbrowser.open(f\".htmlgraph/tracks/{track.track_id}/index.html\")\n</code></pre>"},{"location":"examples/tracks/#track-driven-development-workflow","title":"Track-Driven Development Workflow","text":"<pre><code>from htmlgraph import SDK\n\ndef create_project_track(title, phases):\n    \"\"\"Create a track with features for each phase\"\"\"\n    sdk = SDK(agent=\"claude\")\n\n    # Create track\n    track = sdk.tracks.builder() \\\n        .title(title) \\\n        .priority(\"high\") \\\n        .with_plan_phases(phases) \\\n        .create()\n\n    # Create features for each task\n    features_by_phase = {}\n\n    for phase in track.plan.phases:\n        phase_features = []\n\n        for task in phase.tasks:\n            feature = sdk.features.create(\n                title=task.description,\n                track_id=track.track_id,\n                priority=\"high\",\n                steps=[]  # Will be filled in during implementation\n            )\n            phase_features.append(feature)\n\n        features_by_phase[phase.name] = phase_features\n\n    return track, features_by_phase\n\n# Usage\ntrack, features = create_project_track(\n    title=\"Mobile App MVP\",\n    phases=[\n        (\"Phase 1: Core Features\", [\n            \"User authentication (8h)\",\n            \"Profile management (6h)\",\n            \"Settings screen (4h)\"\n        ]),\n        (\"Phase 2: Main Functionality\", [\n            \"Dashboard (10h)\",\n            \"Data sync (8h)\",\n            \"Offline mode (12h)\"\n        ]),\n        (\"Phase 3: Polish\", [\n            \"Onboarding flow (6h)\",\n            \"UI/UX refinements (8h)\",\n            \"Performance optimization (6h)\"\n        ])\n    ]\n)\n\n# Work through phases\nfor phase_name, phase_features in features.items():\n    print(f\"\\n{phase_name}:\")\n    for feature in phase_features:\n        print(f\"  - {feature.title}\")\n</code></pre>"},{"location":"examples/tracks/#next-steps","title":"Next Steps","text":"<ul> <li>Basic Examples - Simple feature workflows</li> <li>Agent Workflows - Agent integration patterns</li> <li>TrackBuilder Guide - Complete TrackBuilder documentation</li> </ul>"},{"location":"getting-started/concepts/","title":"Core Concepts","text":"<p>HtmlGraph is built on a simple philosophy: HTML is All You Need. This guide explains the core concepts and how they work together.</p>"},{"location":"getting-started/concepts/#the-web-is-a-graph","title":"The Web is a Graph","text":"<p>Every webpage is a node. Every hyperlink is an edge. HtmlGraph uses this fundamental web structure to create a lightweight graph database.</p> <pre><code>HTML File = Graph Node\n&lt;a href&gt; = Graph Edge\ndata-* attributes = Node Properties\nCSS selectors = Query Language\n</code></pre>"},{"location":"getting-started/concepts/#key-components","title":"Key Components","text":""},{"location":"getting-started/concepts/#features","title":"Features","text":"<p>Features are the atomic units of work in HtmlGraph. Each feature is an HTML file with:</p> <ul> <li>Status: <code>todo</code>, <code>in-progress</code>, <code>blocked</code>, <code>done</code></li> <li>Priority: <code>low</code>, <code>medium</code>, <code>high</code>, <code>critical</code></li> <li>Steps: Checklist of implementation tasks</li> <li>Properties: Custom metadata (<code>effort</code>, <code>completion</code>, etc.)</li> <li>Edges: Links to related features (blocks, blocked_by, related)</li> </ul> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\nfeature = sdk.features.create(\n    title=\"User Authentication\",\n    status=\"todo\",\n    priority=\"high\",\n    steps=[\"Create endpoint\", \"Add middleware\", \"Write tests\"]\n)\n</code></pre> <p>File location: <code>.htmlgraph/features/feature-{timestamp}.html</code></p>"},{"location":"getting-started/concepts/#tracks","title":"Tracks","text":"<p>Tracks are multi-feature projects that bundle related work with specs and plans. Each track is a directory containing:</p> <ul> <li>index.html: Track overview and dashboard</li> <li>spec.html: Requirements and success criteria</li> <li>plan.html: Phased implementation plan with time estimates</li> </ul> <pre><code>track = sdk.tracks.builder() \\\n    .title(\"OAuth Integration\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 support\",\n        requirements=[(\"Google OAuth\", \"must-have\")]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1\", [\"Configure OAuth (2h)\", \"Setup endpoints (1h)\"])\n    ]) \\\n    .create()\n</code></pre> <p>File location: <code>.htmlgraph/tracks/track-{timestamp}/</code></p>"},{"location":"getting-started/concepts/#sessions","title":"Sessions","text":"<p>Sessions track all activity during an agent's work session. Each session is an HTML file with:</p> <ul> <li>Events: Log of all tool calls and interactions</li> <li>Features worked on: Which features received attribution</li> <li>Timestamps: Start and end times</li> <li>Agent: Which agent did the work</li> </ul> <p>Sessions are automatically created and managed by HtmlGraph hooks.</p> <p>File location: <code>.htmlgraph/sessions/session-{id}.html</code></p>"},{"location":"getting-started/concepts/#events","title":"Events","text":"<p>Events are the append-only log of all activity. Each event is a JSON line with:</p> <ul> <li>Timestamp: When the event occurred</li> <li>Event type: <code>ToolUse</code>, <code>UserPrompt</code>, <code>SessionStart</code>, etc.</li> <li>Session ID: Which session generated the event</li> <li>Feature ID: Which feature receives attribution</li> <li>Data: Event-specific payload</li> </ul> <p>File location: <code>.htmlgraph/events/{session-id}.jsonl</code></p>"},{"location":"getting-started/concepts/#graph-structure","title":"Graph Structure","text":""},{"location":"getting-started/concepts/#nodes","title":"Nodes","text":"<p>Every HTML file in HtmlGraph is a graph node. Nodes have:</p> <ul> <li>ID: Unique, collision-resistant identifier (e.g., <code>feat-a1b2c3d4</code>)</li> <li>Type: <code>feature</code>, <code>track</code>, <code>session</code>, or custom</li> <li>Properties: Stored in <code>data-*</code> attributes</li> <li>Content: Human-readable description in HTML</li> </ul>"},{"location":"getting-started/concepts/#hash-based-ids","title":"Hash-Based IDs","text":"<p>HtmlGraph uses hash-based IDs for multi-agent collaboration:</p> Type Prefix Example Feature <code>feat-</code> <code>feat-a1b2c3d4</code> Bug <code>bug-</code> <code>bug-12345678</code> Track <code>trk-</code> <code>trk-abcdef12</code> Session <code>sess-</code> <code>sess-7890abcd</code> Spike <code>spk-</code> <code>spk-87654321</code> Event <code>evt-</code> <code>evt-11223344</code> <p>These IDs are collision-resistant, meaning multiple agents can create nodes simultaneously without conflicts. The 8-character hash is generated from SHA256 of (title + microsecond timestamp + random entropy), providing effectively zero collision probability even with thousands of concurrent agents.</p> <p>Hierarchical sub-tasks are supported: <code>feat-a1b2c3d4.1.2</code></p> <p>Learn more: - ID Generation API - Usage examples and API reference - Hash-Based IDs Design - Architecture and implementation details</p> <p>Example node structure:</p> <pre><code>&lt;article id=\"feature-001\"\n         data-type=\"feature\"\n         data-status=\"in-progress\"\n         data-priority=\"high\"&gt;\n    &lt;h1&gt;User Authentication&lt;/h1&gt;\n\n    &lt;nav data-graph-edges&gt;\n        &lt;section data-edge-type=\"blocks\"&gt;\n            &lt;h3&gt;\u26a0\ufe0f Blocked By:&lt;/h3&gt;\n            &lt;ul&gt;\n                &lt;li&gt;&lt;a href=\"feature-005.html\"&gt;Database Schema&lt;/a&gt;&lt;/li&gt;\n            &lt;/ul&gt;\n        &lt;/section&gt;\n    &lt;/nav&gt;\n&lt;/article&gt;\n</code></pre>"},{"location":"getting-started/concepts/#edges","title":"Edges","text":"<p>Edges are created using standard HTML hyperlinks. The relationship type is specified using <code>data-relationship</code> attributes:</p> <pre><code>&lt;a href=\"feature-005.html\"\n   data-relationship=\"blocks\"&gt;Database Schema&lt;/a&gt;\n</code></pre> <p>Common relationship types:</p> <ul> <li><code>blocks</code>: This feature blocks another</li> <li><code>blocked_by</code>: This feature is blocked by another</li> <li><code>related</code>: General relationship</li> <li><code>implements</code>: Session implements a feature</li> <li><code>part_of</code>: Feature is part of a track</li> </ul>"},{"location":"getting-started/concepts/#queries","title":"Queries","text":"<p>Query the graph using CSS selectors:</p> <pre><code># All high-priority features\nhigh = sdk.features.query('[data-priority=\"high\"]')\n\n# Blocked features\nblocked = sdk.features.query('[data-status=\"blocked\"]')\n\n# Features assigned to claude\nclaude_features = sdk.features.query('[data-agent-assigned=\"claude\"]')\n</code></pre>"},{"location":"getting-started/concepts/#data-flow","title":"Data Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Agent creates/updates nodes via SDK                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Pydantic models validate and convert to HTML        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. HTML files written to .htmlgraph/ directory         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. Hooks log events to JSONL file                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. SQLite index updated for fast queries               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 6. Browser/Dashboard displays graph visually           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"getting-started/concepts/#why-html","title":"Why HTML?","text":""},{"location":"getting-started/concepts/#human-readable","title":"Human Readable","text":"<p>Open any node in a browser and see it beautifully rendered with CSS styling. No special tools required.</p>"},{"location":"getting-started/concepts/#git-native","title":"Git Native","text":"<p>HTML is plain text. Git diffs show exactly what changed. Merge conflicts are readable.</p>"},{"location":"getting-started/concepts/#minimal-infrastructure","title":"Minimal Infrastructure","text":"<p>No Docker, no JVM, no external database servers. The SDK has minimal Python dependencies (pydantic, justhtml, watchdog) and uses SQLite for indexing and JSONL for event logs. HTML files work everywhere: browsers, Python, JavaScript, any language.</p>"},{"location":"getting-started/concepts/#standards-based","title":"Standards-Based","text":"<p>CSS selectors are a W3C standard. Everyone knows them. No proprietary query language to learn.</p>"},{"location":"getting-started/concepts/#offline-first","title":"Offline First","text":"<p>Everything works offline. No server required. Copy the <code>.htmlgraph/</code> directory anywhere.</p>"},{"location":"getting-started/concepts/#presentation-layer-included","title":"Presentation Layer Included","text":"<p>Styling, layout, and interactivity are built-in using CSS and JavaScript. No separate UI framework needed.</p>"},{"location":"getting-started/concepts/#sdk-vs-cli-vs-dashboard","title":"SDK vs CLI vs Dashboard","text":""},{"location":"getting-started/concepts/#sdk-python","title":"SDK (Python)","text":"<p>For programmatic access and agent integration:</p> <pre><code>from htmlgraph import SDK\nsdk = SDK(agent=\"claude\")\nfeature = sdk.features.create(\"Task\")\n</code></pre>"},{"location":"getting-started/concepts/#cli-bash","title":"CLI (Bash)","text":"<p>For command-line workflows:</p> <pre><code>htmlgraph feature create \"Task\"\nhtmlgraph feature start feature-001\nhtmlgraph serve\n</code></pre>"},{"location":"getting-started/concepts/#dashboard-browser","title":"Dashboard (Browser)","text":"<p>For visual exploration:</p> <ul> <li>Kanban board view</li> <li>Graph visualization</li> <li>Timeline view</li> <li>Session history</li> </ul> <p>Open <code>index.html</code> in any browser or run <code>htmlgraph serve</code>.</p>"},{"location":"getting-started/concepts/#next-steps","title":"Next Steps","text":"<ul> <li>Features &amp; Tracks Guide - Detailed feature and track workflows</li> <li>TrackBuilder Guide - Master the TrackBuilder API</li> <li>Sessions Guide - Understanding session tracking</li> <li>API Reference - Complete SDK documentation</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<p>HtmlGraph requires Python 3.10 or higher.</p>"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<p>The easiest way to install HtmlGraph is via pip:</p> <pre><code>pip install htmlgraph\n</code></pre> <p>Or using uv (recommended):</p> <pre><code>uv pip install htmlgraph\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from Source","text":"<p>Clone the repository and install in development mode:</p> <pre><code>git clone https://github.com/Shakes-tzd/htmlgraph.git\ncd htmlgraph\nuv pip install -e .\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Check that HtmlGraph is installed correctly:</p> <pre><code>python -c \"import htmlgraph; print(htmlgraph.__version__)\"\n</code></pre> <p>Or using the CLI:</p> <pre><code>htmlgraph --version\n</code></pre>"},{"location":"getting-started/installation/#optional-dependencies","title":"Optional Dependencies","text":"<p>For development and testing:</p> <pre><code># Install development dependencies\nuv pip install -e \".[dev]\"\n\n# Install testing dependencies\nuv pip install -e \".[test]\"\n\n# Install documentation dependencies\nuv pip install -e \".[docs]\"\n</code></pre>"},{"location":"getting-started/installation/#agent-integration","title":"Agent Integration","text":""},{"location":"getting-started/installation/#claude-code-plugin","title":"Claude Code Plugin","text":"<pre><code># Install the HtmlGraph plugin for Claude Code\nclaude plugin install htmlgraph\n\n# Or from local marketplace\nclaude plugin marketplace add local-marketplace\nclaude plugin install htmlgraph\n</code></pre>"},{"location":"getting-started/installation/#gemini-cli-extension","title":"Gemini CLI Extension","text":"<pre><code># Install the HtmlGraph extension for Gemini CLI\ngemini extension install htmlgraph\n</code></pre>"},{"location":"getting-started/installation/#codex-cli-skill","title":"Codex CLI Skill","text":"<pre><code># Install the HtmlGraph skill for Codex CLI\ncodex skill install htmlgraph\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Get started with your first graph</li> <li>Core Concepts - Understand HtmlGraph fundamentals</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get up and running with HtmlGraph in 5 minutes.</p>"},{"location":"getting-started/quick-start/#initialize-a-project","title":"Initialize a Project","text":"<pre><code># Create a new directory for your graph\nmkdir my-project\ncd my-project\n\n# Initialize HtmlGraph\nhtmlgraph init\n</code></pre> <p>This creates a <code>.htmlgraph/</code> directory with the following structure:</p> <pre><code>.htmlgraph/\n\u251c\u2500\u2500 features/       # Feature nodes\n\u251c\u2500\u2500 sessions/       # Session activity logs\n\u251c\u2500\u2500 tracks/         # Multi-feature tracks\n\u251c\u2500\u2500 events/         # Event log (JSONL)\n\u2514\u2500\u2500 index.db        # SQLite index (auto-generated)\n</code></pre>"},{"location":"getting-started/quick-start/#using-the-sdk","title":"Using the SDK","text":""},{"location":"getting-started/quick-start/#basic-feature-creation","title":"Basic Feature Creation","text":"<pre><code>from htmlgraph import SDK\n\n# Initialize SDK (auto-discovers .htmlgraph directory)\nsdk = SDK(agent=\"claude\")\n\n# Create a feature\nfeature = sdk.features.create(\n    title=\"User Authentication\",\n    priority=\"high\",\n    steps=[\n        \"Create login endpoint\",\n        \"Add JWT middleware\",\n        \"Write tests\"\n    ]\n)\n\nprint(f\"Created feature: {feature.id}\")\n# Output: Created feature: feature-20241216-103045\n</code></pre>"},{"location":"getting-started/quick-start/#query-features","title":"Query Features","text":"<pre><code># Get all high-priority features\nhigh_priority = sdk.features.where(priority=\"high\")\n\n# Get features by status\nin_progress = sdk.features.where(status=\"in-progress\")\n\n# Get a specific feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n</code></pre>"},{"location":"getting-started/quick-start/#update-feature-status","title":"Update Feature Status","text":"<pre><code># Start working on a feature\nfeature.status = \"in-progress\"\nfeature.save()\n\n# Complete a step\nfeature.steps[0].completed = True\nfeature.save()\n\n# Mark feature as complete\nfeature.status = \"done\"\nfeature.save()\n</code></pre>"},{"location":"getting-started/quick-start/#using-the-cli","title":"Using the CLI","text":""},{"location":"getting-started/quick-start/#feature-management","title":"Feature Management","text":"<pre><code># List all features\nhtmlgraph feature list\n\n# Create a new feature\nhtmlgraph feature create \"Add OAuth support\" --priority high\n\n# Start working on a feature\nhtmlgraph feature start feature-20241216-103045\n\n# Mark a feature as complete\nhtmlgraph feature complete feature-20241216-103045\n</code></pre>"},{"location":"getting-started/quick-start/#session-management","title":"Session Management","text":"<pre><code># View session status\nhtmlgraph status\n\n# List all sessions\nhtmlgraph session list\n\n# View session details\nhtmlgraph session show session-abc-123\n</code></pre>"},{"location":"getting-started/quick-start/#dashboard","title":"Dashboard","text":"<p>Launch the interactive dashboard:</p> <pre><code>htmlgraph serve\n</code></pre> <p>Then open http://localhost:8080 in your browser.</p>"},{"location":"getting-started/quick-start/#creating-a-track","title":"Creating a Track","text":"<p>For multi-feature projects, create a track with spec and plan:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Use TrackBuilder for complex tracks\ntrack = sdk.tracks.builder() \\\n    .title(\"OAuth Integration\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add OAuth 2.0 support for Google and GitHub\",\n        requirements=[\n            (\"Support Google OAuth\", \"must-have\"),\n            (\"Support GitHub OAuth\", \"must-have\"),\n            (\"JWT token management\", \"must-have\")\n        ],\n        success_criteria=[\n            \"Users can sign in with Google\",\n            \"Users can sign in with GitHub\",\n            \"Tokens refresh automatically\"\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: OAuth Setup\", [\n            \"Configure OAuth providers (2h)\",\n            \"Set up redirect endpoints (1h)\"\n        ]),\n        (\"Phase 2: Implementation\", [\n            \"Implement Google OAuth (4h)\",\n            \"Implement GitHub OAuth (4h)\",\n            \"Add JWT middleware (3h)\"\n        ]),\n        (\"Phase 3: Testing\", [\n            \"Write integration tests (3h)\",\n            \"Test with real providers (2h)\"\n        ])\n    ]) \\\n    .create()\n\nprint(f\"Created track: {track.track_id}\")\n# View at: .htmlgraph/tracks/{track.track_id}/index.html\n</code></pre>"},{"location":"getting-started/quick-start/#view-your-graph","title":"View Your Graph","text":"<p>All graph nodes are HTML files that you can open in any browser:</p> <pre><code># Open a feature in your browser\nopen .htmlgraph/features/feature-20241216-103045.html\n\n# Open a track\nopen .htmlgraph/tracks/track-20241216-120000/index.html\n\n# Open the dashboard\nopen index.html\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Core Concepts - Understand features, tracks, and sessions</li> <li>User Guide - In-depth guides for all features</li> <li>API Reference - Complete SDK documentation</li> <li>Examples - Real-world use cases</li> </ul>"},{"location":"guide/","title":"User Guide","text":"<p>Welcome to the HtmlGraph user guide. This section provides in-depth documentation for all HtmlGraph features.</p>"},{"location":"guide/#what-youll-learn","title":"What You'll Learn","text":"<p>This guide covers:</p> <ul> <li>Features &amp; Tracks - Creating and managing features and tracks</li> <li>TrackBuilder - Mastering the TrackBuilder fluent API</li> <li>Sessions - Understanding session tracking and attribution</li> <li>Agents - Integrating HtmlGraph with AI agents</li> <li>Dashboard - Using the interactive dashboard</li> </ul>"},{"location":"guide/#quick-navigation","title":"Quick Navigation","text":""},{"location":"guide/#for-beginners","title":"For Beginners","text":"<p>Start with these guides in order:</p> <ol> <li>Features &amp; Tracks - Learn the basics</li> <li>Dashboard - Visualize your work</li> <li>Sessions - Understand activity tracking</li> </ol>"},{"location":"guide/#for-agent-developers","title":"For Agent Developers","text":"<p>Jump to these sections:</p> <ol> <li>Agents - Agent integration patterns</li> <li>TrackBuilder - Deterministic track creation</li> <li>Sessions - Session management and attribution</li> </ol>"},{"location":"guide/#for-power-users","title":"For Power Users","text":"<p>Advanced topics:</p> <ol> <li>TrackBuilder - Complex track workflows</li> <li>Sessions - Custom session handling</li> <li>API Reference - Complete API documentation</li> </ol>"},{"location":"guide/#common-workflows","title":"Common Workflows","text":""},{"location":"guide/#creating-a-simple-feature","title":"Creating a Simple Feature","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\nfeature = sdk.features.create(\n    title=\"Add login page\",\n    priority=\"high\",\n    steps=[\"Create component\", \"Add routing\", \"Write tests\"]\n)\n</code></pre> <p>Learn more \u2192</p>"},{"location":"guide/#creating-a-complex-track","title":"Creating a Complex Track","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"User Authentication\") \\\n    .with_spec(overview=\"Full auth system\") \\\n    .with_plan_phases([\n        (\"Phase 1\", [\"OAuth setup (2h)\", \"JWT middleware (3h)\"])\n    ]) \\\n    .create()\n</code></pre> <p>Learn more \u2192</p>"},{"location":"guide/#linking-features-to-tracks","title":"Linking Features to Tracks","text":"<pre><code># Create features for the track\nauth_feature = sdk.features.create(\n    title=\"OAuth Setup\",\n    track_id=track.track_id\n)\n\njwt_feature = sdk.features.create(\n    title=\"JWT Middleware\",\n    track_id=track.track_id\n)\n</code></pre> <p>Learn more \u2192</p>"},{"location":"guide/#starting-a-session","title":"Starting a Session","text":"<p>Sessions are automatically managed by HtmlGraph hooks:</p> <pre><code># Session starts automatically when you begin working\nhtmlgraph feature start feature-001\n\n# View session status\nhtmlgraph status\n\n# Session ends automatically when you complete the feature\nhtmlgraph feature complete feature-001\n</code></pre> <p>Learn more \u2192</p>"},{"location":"guide/#need-help","title":"Need Help?","text":"<ul> <li>Check the API Reference for detailed SDK documentation</li> <li>Browse Examples for real-world use cases</li> <li>Read the Philosophy to understand design decisions</li> <li>Visit GitHub Discussions for community support</li> </ul>"},{"location":"guide/agents/","title":"Agents","text":"<p>HtmlGraph provides seamless integration with AI agents through SDKs, CLI tools, and browser extensions.</p>"},{"location":"guide/agents/#supported-agents","title":"Supported Agents","text":""},{"location":"guide/agents/#claude-code","title":"Claude Code","text":"<p>Official plugin for Claude Code CLI.</p> <p>Installation:</p> <pre><code>claude plugin install htmlgraph\n</code></pre> <p>Features:</p> <ul> <li>Automatic session management via hooks</li> <li>Activity tracking for all tool calls</li> <li>Drift detection and warnings</li> <li>Feature creation decision framework</li> <li>Session continuity across conversations</li> </ul> <p>Documentation: See the <code>htmlgraph-tracker</code> skill in Claude Code.</p>"},{"location":"guide/agents/#gemini-cli","title":"Gemini CLI","text":"<p>Extension for Gemini CLI.</p> <p>Installation:</p> <pre><code>gemini extension install htmlgraph\n</code></pre> <p>Features:</p> <ul> <li>Session tracking</li> <li>Feature management</li> <li>TrackBuilder integration</li> <li>Activity logging</li> </ul> <p>Documentation: Included in the extension's <code>GEMINI.md</code> file.</p>"},{"location":"guide/agents/#codex-cli","title":"Codex CLI","text":"<p>Skill for Codex CLI.</p> <p>Installation:</p> <pre><code>codex skill install htmlgraph\n</code></pre> <p>Features:</p> <ul> <li>Feature tracking</li> <li>Session management</li> <li>Spec and plan creation</li> <li>CLI integration</li> </ul> <p>Documentation: Included in the skill's <code>SKILL.md</code> file.</p>"},{"location":"guide/agents/#agent-workflow","title":"Agent Workflow","text":""},{"location":"guide/agents/#1-session-start","title":"1. Session Start","text":"<p>When an agent begins working:</p> <pre><code>from htmlgraph import SDK\n\n# Initialize with agent name\nsdk = SDK(agent=\"claude\")\n\n# Check status\nstatus = sdk.status()\nprint(f\"Session: {status.current_session}\")\nprint(f\"Active features: {len(status.active_features)}\")\n</code></pre>"},{"location":"guide/agents/#2-create-or-select-feature","title":"2. Create or Select Feature","text":"<pre><code># Create a new feature\nfeature = sdk.features.create(\n    title=\"Add user profile page\",\n    priority=\"high\",\n    steps=[\"Create component\", \"Add routing\", \"Write tests\"]\n)\n\n# Or select existing feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n\n# Start working on it\nsdk.features.start(feature.id)\n</code></pre>"},{"location":"guide/agents/#3-work-and-track-progress","title":"3. Work and Track Progress","text":"<pre><code># Complete a step\nfeature.steps[0].completed = True\nfeature.save()\n\n# Document decisions\nsdk.track_activity(\n    feature_id=feature.id,\n    activity=\"Chose React Router over Reach Router (better TypeScript support)\"\n)\n\n# Update status\nfeature.status = \"in-progress\"\nfeature.save()\n</code></pre>"},{"location":"guide/agents/#4-complete-feature","title":"4. Complete Feature","text":"<pre><code># Mark all steps complete\nfor step in feature.steps:\n    step.completed = True\nfeature.save()\n\n# Mark feature as done\nfeature.status = \"done\"\nfeature.save()\n\n# Or via CLI\n# htmlgraph feature complete feature-20241216-103045\n</code></pre>"},{"location":"guide/agents/#multi-agent-collaboration","title":"Multi-Agent Collaboration","text":"<p>Multiple agents can work together on the same graph:</p>"},{"location":"guide/agents/#agent-assignment","title":"Agent Assignment","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Claim a feature\nfeature = sdk.features.get(\"feature-001\")\nfeature.assigned_agent = \"claude\"\nfeature.save()\n\n# Later, another agent can take over\nsdk2 = SDK(agent=\"gemini\")\nfeature.assigned_agent = \"gemini\"\nfeature.handoff_notes = \"OAuth setup complete. Need JWT implementation next.\"\nfeature.save()\n</code></pre>"},{"location":"guide/agents/#handoff-notes","title":"Handoff Notes","text":"<p>When passing work between agents, add handoff notes:</p> <pre><code># Agent 1 completes phase 1\nfeature.status = \"blocked\"\nfeature.handoff_notes = \"\"\"\nCompleted:\n- OAuth provider configuration\n- Redirect endpoints created\n\nBlocked on:\n- Database schema (feature-005)\n\nNext steps:\n- Implement JWT signing once DB is ready\n- Add token refresh logic\n\"\"\"\nfeature.save()\n\n# Agent 2 picks up later\nfeature = sdk.features.get(\"feature-001\")\nprint(feature.handoff_notes)  # See what Agent 1 did\n</code></pre>"},{"location":"guide/agents/#sdk-integration-patterns","title":"SDK Integration Patterns","text":""},{"location":"guide/agents/#minimal-integration","title":"Minimal Integration","text":"<p>For simple scripts:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"my-script\")\nfeature = sdk.features.create(\"Quick task\")\n# Do work...\nfeature.status = \"done\"\nfeature.save()\n</code></pre>"},{"location":"guide/agents/#full-integration","title":"Full Integration","text":"<p>For complex agents:</p> <pre><code>from htmlgraph import SDK\n\nclass MyAgent:\n    def __init__(self, name):\n        self.sdk = SDK(agent=name)\n\n    def run_task(self, task_description):\n        # Create feature\n        feature = self.sdk.features.create(\n            title=task_description,\n            priority=self.assess_priority(task_description)\n        )\n\n        # Start working\n        self.sdk.features.start(feature.id)\n\n        try:\n            # Do the work\n            self.execute(feature)\n\n            # Mark complete\n            feature.status = \"done\"\n            feature.save()\n\n        except Exception as e:\n            # Record failure\n            self.sdk.track_activity(\n                feature_id=feature.id,\n                activity=f\"Failed: {str(e)}\"\n            )\n            feature.status = \"blocked\"\n            feature.save()\n            raise\n\n    def assess_priority(self, description):\n        # Your priority logic\n        return \"medium\"\n\n    def execute(self, feature):\n        # Your execution logic\n        for i, step in enumerate(feature.steps):\n            self.execute_step(step)\n            feature.steps[i].completed = True\n            feature.save()\n</code></pre>"},{"location":"guide/agents/#hooks","title":"Hooks","text":"<p>HtmlGraph uses hooks to automatically track agent activity.</p>"},{"location":"guide/agents/#available-hooks","title":"Available Hooks","text":"<ul> <li>SessionStart: Creates session, provides context</li> <li>PostToolUse: Logs every tool call</li> <li>UserPromptSubmit: Logs user queries</li> <li>SessionEnd: Finalizes session, generates summary</li> </ul>"},{"location":"guide/agents/#hook-configuration","title":"Hook Configuration","text":"<p>Claude Code:</p> <p>Add to <code>.claude/config.json</code>:</p> <pre><code>{\n  \"hooks\": {\n    \"sessionStart\": \"~/.claude/plugins/htmlgraph/hooks/session-start.py\",\n    \"sessionEnd\": \"~/.claude/plugins/htmlgraph/hooks/session-end.py\",\n    \"postToolUse\": \"~/.claude/plugins/htmlgraph/hooks/post-tool-use.py\"\n  }\n}\n</code></pre>"},{"location":"guide/agents/#custom-hooks","title":"Custom Hooks","text":"<p>Create your own hooks:</p> <pre><code># my-hook.py\nfrom htmlgraph import SDK\n\ndef on_tool_use(tool_name, tool_input, tool_output):\n    sdk = SDK(agent=\"my-agent\")\n\n    # Log activity\n    sdk.track_activity(\n        feature_id=sdk.current_feature_id,\n        activity=f\"Used {tool_name}: {tool_input}\"\n    )\n</code></pre>"},{"location":"guide/agents/#best-practices","title":"Best Practices","text":""},{"location":"guide/agents/#1-feature-creation-decision-framework","title":"1. Feature Creation Decision Framework","text":"<p>Use this framework to decide when to create a feature:</p> <p>Create a feature if:</p> <ul> <li>Estimated &gt;30 minutes of work</li> <li>Involves 3+ files</li> <li>Requires new tests</li> <li>Affects multiple components</li> <li>Hard to revert (schema changes, API changes)</li> <li>Needs documentation</li> </ul> <p>Implement directly if:</p> <ul> <li>Single file, obvious change</li> <li>&lt;30 minutes work</li> <li>No cross-system impact</li> <li>Easy to revert</li> <li>No tests needed</li> </ul>"},{"location":"guide/agents/#2-use-trackbuilder-for-complex-work","title":"2. Use TrackBuilder for Complex Work","text":"<p>For multi-feature projects:</p> <pre><code>track = sdk.tracks.builder() \\\n    .title(\"Multi-phase project\") \\\n    .with_spec(overview=\"...\", requirements=[...]) \\\n    .with_plan_phases([...]) \\\n    .create()\n\n# Create features for each phase\nfor phase in track.plan.phases:\n    feature = sdk.features.create(\n        title=phase.name,\n        track_id=track.track_id,\n        steps=[task.description for task in phase.tasks]\n    )\n</code></pre>"},{"location":"guide/agents/#3-document-decisions","title":"3. Document Decisions","text":"<p>Always record important decisions:</p> <pre><code>sdk.track_activity(\n    feature_id=feature.id,\n    activity=\"Chose PostgreSQL over MongoDB: better transactions, team familiarity\"\n)\n</code></pre>"},{"location":"guide/agents/#4-one-feature-at-a-time","title":"4. One Feature at a Time","text":"<p>Focus on single features for clear attribution:</p> <pre><code>htmlgraph feature start feature-001\n# Complete all work\nhtmlgraph feature complete feature-001\n</code></pre>"},{"location":"guide/agents/#next-steps","title":"Next Steps","text":"<ul> <li>Sessions Guide - Understanding session tracking</li> <li>Features &amp; Tracks Guide - Creating and managing work</li> <li>API Reference - Complete agent API documentation</li> <li>Examples - Real-world agent examples</li> </ul>"},{"location":"guide/dashboard/","title":"Dashboard","text":"<p>The HtmlGraph dashboard provides visual exploration of your graph with Kanban boards, timelines, and graph visualizations.</p>"},{"location":"guide/dashboard/#accessing-the-dashboard","title":"Accessing the Dashboard","text":""},{"location":"guide/dashboard/#local-files","title":"Local Files","text":"<p>Open <code>index.html</code> directly in any browser:</p> <pre><code>open index.html\n</code></pre>"},{"location":"guide/dashboard/#development-server","title":"Development Server","text":"<p>Run the built-in server for live updates:</p> <pre><code>htmlgraph serve\n</code></pre> <p>Then open http://localhost:8080 in your browser.</p>"},{"location":"guide/dashboard/#dashboard-views","title":"Dashboard Views","text":""},{"location":"guide/dashboard/#kanban-board","title":"Kanban Board","text":"<p>The default view shows features organized by status:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TODO   \u2502 IN PROGRESS  \u2502 BLOCKED \u2502 DONE \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Task 1  \u2502   Task 3     \u2502 Task 5  \u2502Task 8\u2502\n\u2502 Task 2  \u2502   Task 4     \u2502         \u2502Task 9\u2502\n\u2502         \u2502              \u2502         \u2502      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Features:</p> <ul> <li>Drag and drop to change status</li> <li>Color-coded by priority</li> <li>Progress bars show completion</li> <li>Click to view details</li> </ul>"},{"location":"guide/dashboard/#graph-view","title":"Graph View","text":"<p>Visualize relationships between features:</p> <pre><code>      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502Feature 1\u2502\n      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n           \u2502 blocks\n      \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510      related to\n      \u2502Feature 2\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n                           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n                           \u2502Feature 3\u2502\n                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Features:</p> <ul> <li>Force-directed layout</li> <li>Relationship types shown as edge labels</li> <li>Zoom and pan</li> <li>Click nodes to view details</li> </ul>"},{"location":"guide/dashboard/#timeline-view","title":"Timeline View","text":"<p>See activity over time:</p> <pre><code>Day 1:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591  50% (Feature 1)\nDay 2:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591  75% (Feature 1)\nDay 3:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (Feature 1)\n        \u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  15% (Feature 2)\n</code></pre> <p>Features:</p> <ul> <li>Daily/weekly/monthly views</li> <li>Progress tracking</li> <li>Session markers</li> <li>Agent attribution</li> </ul>"},{"location":"guide/dashboard/#session-history","title":"Session History","text":"<p>View all past sessions:</p> <pre><code>Session ABC-123 | claude | 2h 34m | 2024-12-16\n  - User Authentication (80% \u2192 100%)\n  - 12 activities logged\n\nSession XYZ-456 | gemini | 1h 15m | 2024-12-15\n  - Database Schema (0% \u2192 40%)\n  - 7 activities logged\n</code></pre> <p>Features:</p> <ul> <li>Filter by agent</li> <li>Filter by date range</li> <li>View session details</li> <li>Session summaries</li> </ul>"},{"location":"guide/dashboard/#navigation","title":"Navigation","text":""},{"location":"guide/dashboard/#search","title":"Search","text":"<p>Use the search bar to find features:</p> <pre><code>Search: \"auth\" \u2500\u2500\u2500\u2500\u2500\u2510\n                    \u25bc\nResults:\n  - User Authentication (in-progress)\n  - OAuth Setup (todo)\n  - Auth Middleware (done)\n</code></pre>"},{"location":"guide/dashboard/#filters","title":"Filters","text":"<p>Filter features by:</p> <ul> <li>Status: todo, in-progress, blocked, done</li> <li>Priority: low, medium, high, critical</li> <li>Agent: claude, gemini, codex, etc.</li> <li>Track: Features belonging to a specific track</li> </ul>"},{"location":"guide/dashboard/#sort","title":"Sort","text":"<p>Sort features by:</p> <ul> <li>Priority: High to low</li> <li>Created: Newest first</li> <li>Updated: Most recently updated</li> <li>Completion: Progress percentage</li> </ul>"},{"location":"guide/dashboard/#dashboard-customization","title":"Dashboard Customization","text":""},{"location":"guide/dashboard/#layout","title":"Layout","text":"<p>Choose your preferred layout:</p> <pre><code>htmlgraph serve --layout kanban    # Kanban board (default)\nhtmlgraph serve --layout graph     # Graph visualization\nhtmlgraph serve --layout timeline  # Timeline view\nhtmlgraph serve --layout list      # Simple list\n</code></pre>"},{"location":"guide/dashboard/#theme","title":"Theme","text":"<p>Switch between themes:</p> <ul> <li>Dark: High contrast, easy on eyes (default)</li> <li>Light: Clean, bright</li> <li>Terminal: Matrix-style green on black</li> <li>Custom: Define your own CSS</li> </ul>"},{"location":"guide/dashboard/#stats-panel","title":"Stats Panel","text":"<p>The stats panel shows:</p> <ul> <li>Total features</li> <li>Features by status</li> <li>Features by priority</li> <li>Average completion time</li> <li>Active agents</li> </ul>"},{"location":"guide/dashboard/#interactive-features","title":"Interactive Features","text":""},{"location":"guide/dashboard/#drag-and-drop","title":"Drag and Drop","text":"<p>Drag features between status columns:</p> <pre><code>TODO            IN PROGRESS\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Task 1  \u2502  \u2192   \u2502Task 1  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"guide/dashboard/#quick-actions","title":"Quick Actions","text":"<p>Right-click features for:</p> <ul> <li>Start working (changes status to in-progress)</li> <li>Mark complete (changes status to done)</li> <li>Block (changes status to blocked)</li> <li>Edit details</li> <li>Delete feature</li> </ul>"},{"location":"guide/dashboard/#inline-editing","title":"Inline Editing","text":"<p>Click any field to edit:</p> <ul> <li>Feature title</li> <li>Priority</li> <li>Steps (add/remove/check)</li> <li>Properties</li> </ul>"},{"location":"guide/dashboard/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"<ul> <li><code>n</code>: Create new feature</li> <li><code>s</code>: Focus search</li> <li><code>/</code>: Command palette</li> <li><code>1-4</code>: Switch views (Kanban, Graph, Timeline, List)</li> <li><code>h</code>: Show help</li> <li><code>Esc</code>: Close modals</li> </ul>"},{"location":"guide/dashboard/#mobile-view","title":"Mobile View","text":"<p>The dashboard is fully responsive:</p> <ul> <li>Swipe between status columns</li> <li>Tap to expand feature details</li> <li>Simplified graph view</li> <li>Touch-friendly controls</li> </ul>"},{"location":"guide/dashboard/#browser-compatibility","title":"Browser Compatibility","text":"<p>Works in all modern browsers:</p> <ul> <li>Chrome/Edge (recommended)</li> <li>Firefox</li> <li>Safari</li> <li>Mobile browsers (iOS/Android)</li> </ul> <p>No server required - runs entirely in the browser.</p>"},{"location":"guide/dashboard/#advanced-features","title":"Advanced Features","text":""},{"location":"guide/dashboard/#graph-algorithms","title":"Graph Algorithms","text":"<p>Run graph analysis:</p> <pre><code>// Find bottlenecks (features blocking many others)\nconst bottlenecks = graph.findBottlenecks();\n\n// Find critical path (longest dependency chain)\nconst criticalPath = graph.findCriticalPath();\n\n// Find orphaned features (no relationships)\nconst orphans = graph.findOrphans();\n</code></pre>"},{"location":"guide/dashboard/#export","title":"Export","text":"<p>Export your graph:</p> <ul> <li>JSON: Complete graph data</li> <li>CSV: Feature list</li> <li>SVG: Graph visualization</li> <li>Markdown: Feature list with links</li> </ul>"},{"location":"guide/dashboard/#embed","title":"Embed","text":"<p>Embed the dashboard in other sites:</p> <pre><code>&lt;iframe src=\"htmlgraph/index.html\" width=\"100%\" height=\"600\"&gt;&lt;/iframe&gt;\n</code></pre>"},{"location":"guide/dashboard/#next-steps","title":"Next Steps","text":"<ul> <li>Features &amp; Tracks Guide - Creating and managing work</li> <li>Sessions Guide - Understanding session tracking</li> <li>API Reference - Complete SDK documentation</li> </ul>"},{"location":"guide/features-tracks/","title":"Features &amp; Tracks","text":"<p>Learn how to create and manage features and tracks in HtmlGraph.</p>"},{"location":"guide/features-tracks/#features","title":"Features","text":"<p>Features are the atomic units of work. Each feature represents a single deliverable with clear steps and status.</p>"},{"location":"guide/features-tracks/#creating-features","title":"Creating Features","text":""},{"location":"guide/features-tracks/#basic-feature","title":"Basic Feature","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\nfeature = sdk.features.create(\n    title=\"Add user profile page\",\n    priority=\"high\"\n)\n</code></pre>"},{"location":"guide/features-tracks/#feature-with-steps","title":"Feature with Steps","text":"<pre><code>feature = sdk.features.create(\n    title=\"Add user profile page\",\n    priority=\"high\",\n    steps=[\n        \"Create profile component\",\n        \"Add routing\",\n        \"Fetch user data\",\n        \"Write tests\"\n    ]\n)\n</code></pre>"},{"location":"guide/features-tracks/#feature-with-custom-properties","title":"Feature with Custom Properties","text":"<pre><code>feature = sdk.features.create(\n    title=\"Add user profile page\",\n    priority=\"high\",\n    status=\"todo\",\n    steps=[\"Create component\", \"Add routing\", \"Write tests\"],\n    properties={\n        \"effort\": 4,  # hours\n        \"assignee\": \"claude\",\n        \"tags\": [\"ui\", \"frontend\"]\n    }\n)\n</code></pre>"},{"location":"guide/features-tracks/#querying-features","title":"Querying Features","text":"<pre><code># Get all features\nall_features = sdk.features.all()\n\n# Filter by status\nin_progress = sdk.features.where(status=\"in-progress\")\n\n# Filter by priority\nhigh_priority = sdk.features.where(priority=\"high\")\n\n# Multiple filters\nblocked_high = sdk.features.where(status=\"blocked\", priority=\"high\")\n\n# Get a specific feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n</code></pre>"},{"location":"guide/features-tracks/#updating-features","title":"Updating Features","text":"<pre><code># Get the feature\nfeature = sdk.features.get(\"feature-20241216-103045\")\n\n# Update status\nfeature.status = \"in-progress\"\nfeature.save()\n\n# Complete a step\nfeature.steps[0].completed = True\nfeature.save()\n\n# Update priority\nfeature.priority = \"critical\"\nfeature.save()\n\n# Add a note to activity log\nsdk.track_activity(\n    feature_id=feature.id,\n    activity=\"Discovered dependency on auth service\"\n)\n</code></pre>"},{"location":"guide/features-tracks/#deleting-features","title":"Deleting Features","text":"<pre><code># Delete a feature\nsdk.features.delete(\"feature-20241216-103045\")\n</code></pre>"},{"location":"guide/features-tracks/#tracks","title":"Tracks","text":"<p>Tracks are multi-feature projects that bundle related work with specifications and plans.</p>"},{"location":"guide/features-tracks/#when-to-use-tracks","title":"When to Use Tracks","text":"<p>Use tracks when:</p> <ul> <li>Work spans 3+ related features</li> <li>You need multi-phase planning</li> <li>Clear specs and requirements are needed</li> <li>Work has dependencies and sequencing</li> <li>You want time estimates and milestones</li> </ul>"},{"location":"guide/features-tracks/#creating-tracks","title":"Creating Tracks","text":""},{"location":"guide/features-tracks/#simple-track","title":"Simple Track","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack = sdk.tracks.create(\n    title=\"User Authentication System\",\n    priority=\"high\"\n)\n</code></pre>"},{"location":"guide/features-tracks/#track-with-spec-and-plan","title":"Track with Spec and Plan","text":"<p>Use the TrackBuilder API for complex tracks:</p> <pre><code>track = sdk.tracks.builder() \\\n    .title(\"User Authentication System\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Implement secure authentication with OAuth 2.0\",\n        requirements=[\n            (\"Google OAuth integration\", \"must-have\"),\n            (\"GitHub OAuth integration\", \"must-have\"),\n            (\"JWT token management\", \"must-have\"),\n            (\"Refresh token rotation\", \"should-have\")\n        ],\n        success_criteria=[\n            \"Users can sign in with Google\",\n            \"Users can sign in with GitHub\",\n            \"Tokens refresh automatically before expiry\",\n            \"99.9% uptime for auth service\"\n        ],\n        constraints=[\n            \"Must comply with GDPR\",\n            \"Must use OAuth 2.0 standard\",\n            \"Maximum 500ms latency for token validation\"\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: OAuth Setup\", [\n            \"Configure OAuth providers (2h)\",\n            \"Set up redirect endpoints (1h)\",\n            \"Create callback handlers (2h)\"\n        ]),\n        (\"Phase 2: JWT Implementation\", [\n            \"Implement JWT signing (3h)\",\n            \"Add token refresh logic (2h)\",\n            \"Create middleware (2h)\"\n        ]),\n        (\"Phase 3: Testing &amp; Deployment\", [\n            \"Write integration tests (4h)\",\n            \"Test with real OAuth providers (2h)\",\n            \"Deploy to staging (1h)\"\n        ])\n    ]) \\\n    .create()\n\nprint(f\"Created track: {track.track_id}\")\n# View at: .htmlgraph/tracks/{track.track_id}/index.html\n</code></pre> <p>See the TrackBuilder Guide for complete documentation.</p>"},{"location":"guide/features-tracks/#linking-features-to-tracks","title":"Linking Features to Tracks","text":"<p>Create features that belong to a track:</p> <pre><code># Create the track\ntrack = sdk.tracks.builder() \\\n    .title(\"User Authentication System\") \\\n    .priority(\"high\") \\\n    .create()\n\n# Create features linked to the track\noauth_feature = sdk.features.create(\n    title=\"OAuth Setup\",\n    priority=\"high\",\n    track_id=track.track_id,\n    steps=[\n        \"Configure Google OAuth\",\n        \"Configure GitHub OAuth\",\n        \"Set up redirect endpoints\"\n    ]\n)\n\njwt_feature = sdk.features.create(\n    title=\"JWT Implementation\",\n    priority=\"high\",\n    track_id=track.track_id,\n    steps=[\n        \"Implement JWT signing\",\n        \"Add token refresh logic\",\n        \"Create auth middleware\"\n    ]\n)\n\ntest_feature = sdk.features.create(\n    title=\"Testing &amp; Deployment\",\n    priority=\"medium\",\n    track_id=track.track_id,\n    steps=[\n        \"Write integration tests\",\n        \"Test with OAuth providers\",\n        \"Deploy to staging\"\n    ]\n)\n</code></pre>"},{"location":"guide/features-tracks/#querying-tracks","title":"Querying Tracks","text":"<pre><code># Get all tracks\nall_tracks = sdk.tracks.all()\n\n# Get a specific track\ntrack = sdk.tracks.get(\"track-20241216-120000\")\n\n# Get all features for a track\nfeatures = sdk.features.where(track_id=track.track_id)\n</code></pre>"},{"location":"guide/features-tracks/#track-structure","title":"Track Structure","text":"<p>Each track creates a directory with three HTML files:</p> <pre><code>.htmlgraph/tracks/track-20241216-120000/\n\u251c\u2500\u2500 index.html    # Track overview and status\n\u251c\u2500\u2500 spec.html     # Requirements and success criteria\n\u2514\u2500\u2500 plan.html     # Phased implementation plan\n</code></pre> <p>Open any file in a browser to view it with full styling and navigation.</p>"},{"location":"guide/features-tracks/#feature-relationships","title":"Feature Relationships","text":"<p>Features can have relationships with other features:</p>"},{"location":"guide/features-tracks/#blocking-relationships","title":"Blocking Relationships","text":"<pre><code># Create features\ndb_feature = sdk.features.create(title=\"Database Schema\")\nauth_feature = sdk.features.create(title=\"User Authentication\")\n\n# Add blocking relationship\nsdk.features.add_edge(\n    from_id=db_feature.id,\n    to_id=auth_feature.id,\n    relationship=\"blocks\"\n)\n\n# Now auth_feature shows it's blocked by db_feature\n</code></pre>"},{"location":"guide/features-tracks/#related-features","title":"Related Features","text":"<pre><code># Link related features\nsdk.features.add_edge(\n    from_id=auth_feature.id,\n    to_id=session_feature.id,\n    relationship=\"related\"\n)\n</code></pre>"},{"location":"guide/features-tracks/#feature-status-workflow","title":"Feature Status Workflow","text":"<p>The standard status progression:</p> <pre><code>todo \u2192 in-progress \u2192 blocked \u2192 in-progress \u2192 done\n  \u2193                                             \u2193\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt; cancelled &lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"guide/features-tracks/#status-meanings","title":"Status Meanings","text":"<ul> <li>todo: Not started</li> <li>in-progress: Currently being worked on</li> <li>blocked: Waiting on dependencies</li> <li>done: Completed successfully</li> <li>cancelled: Work abandoned</li> </ul>"},{"location":"guide/features-tracks/#cli-workflow","title":"CLI Workflow","text":"<pre><code># Create a feature\nhtmlgraph feature create \"Add profile page\" --priority high\n\n# Start working on it\nhtmlgraph feature start feature-20241216-103045\n\n# Mark as complete\nhtmlgraph feature complete feature-20241216-103045\n</code></pre>"},{"location":"guide/features-tracks/#best-practices","title":"Best Practices","text":""},{"location":"guide/features-tracks/#feature-naming","title":"Feature Naming","text":"<ul> <li>Good: \"Add user profile page\", \"Fix login redirect bug\"</li> <li>Bad: \"Work on stuff\", \"Update code\"</li> </ul> <p>Be specific and action-oriented.</p>"},{"location":"guide/features-tracks/#feature-sizing","title":"Feature Sizing","text":"<p>Keep features small and focused:</p> <ul> <li>Good: 1-8 hours of work, 3-7 steps</li> <li>Too small: &lt;1 hour, trivial changes</li> <li>Too large: &gt;16 hours, should be a track</li> </ul>"},{"location":"guide/features-tracks/#track-planning","title":"Track Planning","text":"<p>For tracks, invest time in the spec and plan:</p> <ul> <li>Clear success criteria</li> <li>Realistic time estimates</li> <li>Logical phase progression</li> <li>Dependencies identified upfront</li> </ul>"},{"location":"guide/features-tracks/#activity-logging","title":"Activity Logging","text":"<p>Document decisions and discoveries:</p> <pre><code>sdk.track_activity(\n    feature_id=feature.id,\n    activity=\"Decided to use Passport.js for OAuth (simpler than Auth0)\"\n)\n</code></pre>"},{"location":"guide/features-tracks/#next-steps","title":"Next Steps","text":"<ul> <li>TrackBuilder Guide - Master the TrackBuilder API</li> <li>Sessions Guide - Understand activity tracking</li> <li>Dashboard Guide - Visualize your work</li> <li>API Reference - Complete SDK documentation</li> </ul>"},{"location":"guide/migration/","title":"Migration Guide: CSS Selectors to Advanced Queries","text":"<p>This guide helps you migrate from CSS-only queries to HtmlGraph's advanced query APIs.</p>"},{"location":"guide/migration/#why-migrate","title":"Why Migrate?","text":"<p>CSS selectors are great for simple queries but have limitations:</p> Feature CSS Selectors QueryBuilder/Find AND conditions <code>[a=\"x\"][b=\"y\"]</code> <code>where(\"a\", \"x\").and_(\"b\", \"y\")</code> OR conditions Not possible <code>where(\"a\", \"x\").or_(\"a\", \"y\")</code> NOT conditions Not possible <code>not_(\"status\").eq(\"done\")</code> Numeric comparisons Not possible <code>where(\"effort\").gt(8)</code> Text search Not possible <code>where(\"title\").contains(\"auth\")</code> Regex matching Not possible <code>where(\"title\").matches(r\"v\\d+\")</code> Nested attributes Limited <code>where(\"properties.effort\").gt(8)</code>"},{"location":"guide/migration/#quick-migration-reference","title":"Quick Migration Reference","text":""},{"location":"guide/migration/#simple-equality","title":"Simple Equality","text":"<pre><code># Before (CSS)\ngraph.query('[data-status=\"blocked\"]')\n\n# After (QueryBuilder)\ngraph.query_builder().where(\"status\", \"blocked\").execute()\n\n# After (Find)\ngraph.find_all(status=\"blocked\")\n</code></pre>"},{"location":"guide/migration/#multiple-conditions-and","title":"Multiple Conditions (AND)","text":"<pre><code># Before (CSS)\ngraph.query('[data-status=\"blocked\"][data-priority=\"high\"]')\n\n# After (QueryBuilder)\ngraph.query_builder() \\\n    .where(\"status\", \"blocked\") \\\n    .and_(\"priority\", \"high\") \\\n    .execute()\n\n# After (Find)\ngraph.find_all(status=\"blocked\", priority=\"high\")\n</code></pre>"},{"location":"guide/migration/#type-status","title":"Type + Status","text":"<pre><code># Before (CSS)\ngraph.query('[data-type=\"feature\"][data-status=\"todo\"]')\n\n# After (QueryBuilder)\ngraph.query_builder() \\\n    .of_type(\"feature\") \\\n    .where(\"status\", \"todo\") \\\n    .execute()\n\n# After (Find)\ngraph.find_all(type=\"feature\", status=\"todo\")\n</code></pre>"},{"location":"guide/migration/#new-capabilities","title":"New Capabilities","text":""},{"location":"guide/migration/#or-conditions","title":"OR Conditions","text":"<pre><code># Not possible with CSS selectors\n\n# QueryBuilder\ngraph.query_builder() \\\n    .where(\"priority\", \"high\") \\\n    .or_(\"priority\", \"critical\") \\\n    .execute()\n\n# Find (use multiple calls or query builder)\nhigh = graph.find_all(priority=\"high\")\ncritical = graph.find_all(priority=\"critical\")\ncombined = high + critical\n</code></pre>"},{"location":"guide/migration/#not-conditions","title":"NOT Conditions","text":"<pre><code># Not possible with CSS selectors\n\n# QueryBuilder\ngraph.query_builder() \\\n    .where(\"type\", \"feature\") \\\n    .not_(\"status\").eq(\"done\") \\\n    .execute()\n\n# Find (filter after)\n[n for n in graph.find_all(type=\"feature\") if n.status != \"done\"]\n</code></pre>"},{"location":"guide/migration/#numeric-comparisons","title":"Numeric Comparisons","text":"<pre><code># Not possible with CSS selectors\n\n# QueryBuilder\ngraph.query_builder() \\\n    .where(\"properties.effort\").gt(8) \\\n    .execute()\n\n# Find with lookup suffix\ngraph.find_all(properties__effort__gt=8)\n</code></pre>"},{"location":"guide/migration/#text-search","title":"Text Search","text":"<pre><code># Not possible with CSS selectors\n\n# QueryBuilder\ngraph.query_builder() \\\n    .where(\"title\").contains(\"authentication\") \\\n    .execute()\n\n# Find with lookup suffix\ngraph.find_all(title__contains=\"authentication\")\n</code></pre>"},{"location":"guide/migration/#regex-matching","title":"Regex Matching","text":"<pre><code># Not possible with CSS selectors\n\n# QueryBuilder\ngraph.query_builder() \\\n    .where(\"title\").matches(r\"API|REST|GraphQL\") \\\n    .execute()\n\n# Find with lookup suffix\ngraph.find_all(title__regex=r\"API|REST|GraphQL\")\n</code></pre>"},{"location":"guide/migration/#common-migration-patterns","title":"Common Migration Patterns","text":""},{"location":"guide/migration/#pattern-1-status-based-filtering","title":"Pattern 1: Status-based Filtering","text":"<pre><code># Old approach\nblocked = graph.query('[data-status=\"blocked\"]')\ntodo = graph.query('[data-status=\"todo\"]')\n\n# New approach (more readable)\nblocked = graph.find_all(status=\"blocked\")\ntodo = graph.find_all(status=\"todo\")\n\n# New approach (with additional filtering)\nblocked_high = graph.find_all(status=\"blocked\", priority=\"high\")\n</code></pre>"},{"location":"guide/migration/#pattern-2-type-filtering","title":"Pattern 2: Type Filtering","text":"<pre><code># Old approach\nfeatures = graph.query('[data-type=\"feature\"]')\nsessions = graph.query('[data-type=\"session\"]')\n\n# New approach\nfeatures = graph.find_all(type=\"feature\")\nsessions = graph.find_all(type=\"session\")\n</code></pre>"},{"location":"guide/migration/#pattern-3-complex-business-logic","title":"Pattern 3: Complex Business Logic","text":"<pre><code># Old approach (required post-processing)\nall_features = graph.query('[data-type=\"feature\"]')\nurgent = [f for f in all_features\n          if f.status == \"blocked\" and f.priority in [\"high\", \"critical\"]]\n\n# New approach (single query)\nurgent = graph.query_builder() \\\n    .of_type(\"feature\") \\\n    .where(\"status\", \"blocked\") \\\n    .and_(\"priority\").in_([\"high\", \"critical\"]) \\\n    .execute()\n</code></pre>"},{"location":"guide/migration/#pattern-4-relationship-based-queries","title":"Pattern 4: Relationship-based Queries","text":"<pre><code># Old approach (manual traversal)\nnode = graph.get_node(\"feature-001\")\nblocked_by_ids = [e.target_id for e in node.edges.get(\"blocked_by\", [])]\nblockers = [graph.get_node(id) for id in blocked_by_ids]\n\n# New approach\nblockers = graph.find_blocked_by(\"feature-001\")\n\n# Or with find_related\nblockers = graph.find_related(\"feature-001\", relationship=\"blocked_by\")\n</code></pre>"},{"location":"guide/migration/#pattern-5-reverse-edge-lookups","title":"Pattern 5: Reverse Edge Lookups","text":"<pre><code># Old approach (O(V*E) scan)\ndef find_dependents(graph, node_id):\n    dependents = []\n    for node in graph.get_nodes():\n        for edge in node.edges.get(\"blocked_by\", []):\n            if edge.target_id == node_id:\n                dependents.append(node)\n    return dependents\n\n# New approach (O(1) with EdgeIndex)\ndependents = graph.descendants(\"feature-001\", relationship=\"blocked_by\")\n\n# Or using edge index directly\nincoming = graph.get_incoming_edges(\"feature-001\", relationship=\"blocked_by\")\n</code></pre>"},{"location":"guide/migration/#backward-compatibility","title":"Backward Compatibility","text":"<p>The <code>query()</code> method with CSS selectors still works and will continue to work:</p> <pre><code># This will always work\ngraph.query('[data-status=\"blocked\"]')\n</code></pre> <p>You can mix both approaches in your codebase:</p> <pre><code># Simple queries - use CSS selectors\nblocked = graph.query('[data-status=\"blocked\"]')\n\n# Complex queries - use QueryBuilder\ncomplex_result = graph.query_builder() \\\n    .where(\"status\", \"blocked\") \\\n    .and_(\"priority\").in_([\"high\", \"critical\"]) \\\n    .and_(\"properties.effort\").lt(8) \\\n    .execute()\n</code></pre>"},{"location":"guide/migration/#performance-considerations","title":"Performance Considerations","text":""},{"location":"guide/migration/#when-to-use-each-method","title":"When to Use Each Method","text":"Method Best For Performance <code>query()</code> Simple attribute matches Fast (native CSS) <code>query_builder()</code> Complex conditions, aggregations Fast (optimized filtering) <code>find()</code> Single result lookups Fast (early termination) <code>find_all()</code> Multiple results with filters Fast (direct filtering)"},{"location":"guide/migration/#edgeindex-benefits","title":"EdgeIndex Benefits","text":"<p>The new EdgeIndex provides O(1) reverse edge lookups:</p> <pre><code># Before: O(V*E) - scanning all nodes and edges\ndef old_get_dependents(graph, node_id):\n    result = []\n    for node in graph.get_nodes():\n        for edge in node.edges.get(\"blocked_by\", []):\n            if edge.target_id == node_id:\n                result.append(node)\n    return result\n\n# After: O(1) - direct index lookup\ndependents = graph.get_incoming_edges(node_id, \"blocked_by\")\n</code></pre>"},{"location":"guide/migration/#summary","title":"Summary","text":"<ol> <li>Keep using CSS selectors for simple attribute queries</li> <li>Use QueryBuilder when you need OR, NOT, numeric comparisons, or text search</li> <li>Use Find API for readable, Django-style queries</li> <li>Use EdgeIndex for efficient reverse edge lookups</li> <li>Use graph traversal methods for ancestors, descendants, and path finding</li> </ol> <p>All methods are interoperable - use whichever fits your use case best.</p>"},{"location":"guide/queries/","title":"Query Cookbook","text":"<p>HtmlGraph provides multiple ways to query your graph data. This cookbook covers all query methods with practical examples.</p>"},{"location":"guide/queries/#query-methods-overview","title":"Query Methods Overview","text":"Method Use Case Example <code>query()</code> CSS selector queries <code>graph.query('[data-status=\"blocked\"]')</code> <code>query_builder()</code> Complex conditions with AND/OR/NOT <code>graph.query_builder().where(\"status\", \"blocked\").execute()</code> <code>find()</code> Single node lookup <code>graph.find(type=\"feature\", status=\"done\")</code> <code>find_all()</code> Multiple nodes with filters <code>graph.find_all(priority=\"high\")</code>"},{"location":"guide/queries/#css-selector-queries","title":"CSS Selector Queries","text":"<p>The simplest way to query - uses familiar CSS selector syntax.</p> <pre><code>from htmlgraph import HtmlGraph\n\ngraph = HtmlGraph(\".htmlgraph\")\n\n# Status-based queries\nblocked = graph.query('[data-status=\"blocked\"]')\ndone = graph.query('[data-status=\"done\"]')\n\n# Priority queries\nhigh_priority = graph.query('[data-priority=\"high\"]')\ncritical = graph.query('[data-priority=\"critical\"]')\n\n# Type queries\nfeatures = graph.query('[data-type=\"feature\"]')\nsessions = graph.query('[data-type=\"session\"]')\n\n# Combined selectors\nurgent = graph.query('[data-status=\"blocked\"][data-priority=\"high\"]')\n</code></pre> <p>Limitations: CSS selectors cannot express OR logic, NOT conditions, numeric comparisons, or text search.</p>"},{"location":"guide/queries/#fluent-query-builder","title":"Fluent Query Builder","text":"<p>For complex queries that CSS selectors can't handle.</p>"},{"location":"guide/queries/#basic-conditions","title":"Basic Conditions","text":"<pre><code># Start a query\nqb = graph.query_builder()\n\n# Simple equality\nfeatures = qb.where(\"type\", \"feature\").execute()\n\n# With status\nblocked = qb.where(\"status\", \"blocked\").execute()\n</code></pre>"},{"location":"guide/queries/#chaining-conditions","title":"Chaining Conditions","text":"<pre><code># AND conditions (implicit)\nurgent = (graph.query_builder()\n    .where(\"status\", \"blocked\")\n    .and_(\"priority\", \"high\")\n    .execute())\n\n# OR conditions\nhigh_or_critical = (graph.query_builder()\n    .where(\"priority\", \"high\")\n    .or_(\"priority\", \"critical\")\n    .execute())\n\n# NOT conditions\nnot_done = (graph.query_builder()\n    .where(\"type\", \"feature\")\n    .not_(\"status\").eq(\"done\")\n    .execute())\n</code></pre>"},{"location":"guide/queries/#comparison-operators","title":"Comparison Operators","text":"<pre><code># Greater than\nlarge_effort = (graph.query_builder()\n    .where(\"properties.effort\").gt(8)\n    .execute())\n\n# Less than\nquick_tasks = (graph.query_builder()\n    .where(\"properties.effort\").lt(4)\n    .execute())\n\n# Greater than or equal\nmedium_plus = (graph.query_builder()\n    .where(\"properties.effort\").gte(5)\n    .execute())\n\n# Less than or equal\nsmall_tasks = (graph.query_builder()\n    .where(\"properties.effort\").lte(2)\n    .execute())\n\n# Between (inclusive)\nmedium_tasks = (graph.query_builder()\n    .where(\"properties.effort\").between(3, 6)\n    .execute())\n</code></pre>"},{"location":"guide/queries/#text-search","title":"Text Search","text":"<pre><code># Contains substring\nauth_features = (graph.query_builder()\n    .where(\"title\").contains(\"auth\")\n    .execute())\n\n# Case-insensitive contains\nauth_any_case = (graph.query_builder()\n    .where(\"title\").icontains(\"AUTH\")\n    .execute())\n\n# Regex matching\napi_features = (graph.query_builder()\n    .where(\"title\").matches(r\"API|REST|GraphQL\")\n    .execute())\n</code></pre>"},{"location":"guide/queries/#list-operations","title":"List Operations","text":"<pre><code># In list\nhigh_priorities = (graph.query_builder()\n    .where(\"priority\").in_([\"high\", \"critical\"])\n    .execute())\n\n# Not in list\nnot_done_or_blocked = (graph.query_builder()\n    .where(\"status\").not_in([\"done\", \"blocked\"])\n    .execute())\n</code></pre>"},{"location":"guide/queries/#nested-attributes","title":"Nested Attributes","text":"<pre><code># Access nested properties\nhigh_effort = (graph.query_builder()\n    .where(\"properties.effort\").gt(10)\n    .execute())\n\n# Multiple levels deep\nspecific_config = (graph.query_builder()\n    .where(\"properties.config.enabled\", True)\n    .execute())\n</code></pre>"},{"location":"guide/queries/#result-methods","title":"Result Methods","text":"<pre><code>qb = graph.query_builder().where(\"status\", \"blocked\")\n\n# Get all results\nall_blocked = qb.execute()\n\n# Get first match\nfirst_blocked = qb.first()\n\n# Get count only\nblocked_count = qb.count()\n</code></pre>"},{"location":"guide/queries/#find-api-beautifulsoup-style","title":"Find API (BeautifulSoup-style)","text":"<p>Simple, intuitive queries inspired by BeautifulSoup.</p>"},{"location":"guide/queries/#basic-find","title":"Basic Find","text":"<pre><code># Find first match\nfeature = graph.find(type=\"feature\")\nblocked = graph.find(status=\"blocked\")\n\n# Find with multiple criteria\nurgent = graph.find(type=\"feature\", status=\"blocked\", priority=\"high\")\n</code></pre>"},{"location":"guide/queries/#find-all","title":"Find All","text":"<pre><code># Find all matches\nall_features = graph.find_all(type=\"feature\")\nall_blocked = graph.find_all(status=\"blocked\")\n\n# With limit\ntop_5 = graph.find_all(type=\"feature\", limit=5)\n</code></pre>"},{"location":"guide/queries/#django-style-lookup-suffixes","title":"Django-style Lookup Suffixes","text":"<pre><code># Contains (case-sensitive)\nauth = graph.find_all(title__contains=\"auth\")\n\n# Case-insensitive contains\nauth_any = graph.find_all(title__icontains=\"AUTH\")\n\n# Starts with\napi_features = graph.find_all(title__startswith=\"API\")\n\n# Ends with\nservice_features = graph.find_all(title__endswith=\"Service\")\n\n# Regex\npattern_match = graph.find_all(title__regex=r\"v\\d+\")\n\n# Numeric comparisons\nhigh_effort = graph.find_all(properties__effort__gt=8)\nlow_effort = graph.find_all(properties__effort__lt=4)\nmedium = graph.find_all(properties__effort__gte=4, properties__effort__lte=8)\n\n# In list\npriority_filter = graph.find_all(priority__in=[\"high\", \"critical\"])\n\n# Not in list\nnot_completed = graph.find_all(status__not_in=[\"done\", \"cancelled\"])\n\n# Is null / Is not null\nno_assignee = graph.find_all(properties__assignee__isnull=True)\nhas_assignee = graph.find_all(properties__assignee__isnull=False)\n</code></pre>"},{"location":"guide/queries/#relationship-queries","title":"Relationship Queries","text":"<pre><code># Find nodes related to a specific node\nrelated = graph.find_related(\"feature-001\")\n\n# Find by specific relationship type\nblockers = graph.find_related(\"feature-001\", relationship=\"blocked_by\")\n\n# Convenience methods for common relationships\nblocking = graph.find_blocking(\"feature-001\")  # What this blocks\nblocked_by = graph.find_blocked_by(\"feature-001\")  # What blocks this\n</code></pre>"},{"location":"guide/queries/#graph-traversal","title":"Graph Traversal","text":"<p>Navigate the graph structure.</p>"},{"location":"guide/queries/#ancestors-and-descendants","title":"Ancestors and Descendants","text":"<pre><code># Get all ancestors (nodes this depends on)\nancestors = graph.ancestors(\"feature-001\")\n\n# With depth limit\nimmediate_deps = graph.ancestors(\"feature-001\", max_depth=1)\ntwo_levels = graph.ancestors(\"feature-001\", max_depth=2)\n\n# Get all descendants (nodes that depend on this)\ndescendants = graph.descendants(\"feature-001\")\n\n# With depth limit\nimmediate_dependents = graph.descendants(\"feature-001\", max_depth=1)\n</code></pre>"},{"location":"guide/queries/#path-finding","title":"Path Finding","text":"<pre><code># Find all paths between two nodes\npaths = graph.all_paths(\"feature-001\", \"feature-010\")\n\n# With max length constraint\nshort_paths = graph.all_paths(\"feature-001\", \"feature-010\", max_length=4)\n\n# Existing shortest path\nshortest = graph.shortest_path(\"feature-001\", \"feature-010\")\n</code></pre>"},{"location":"guide/queries/#subgraph-extraction","title":"Subgraph Extraction","text":"<pre><code># Extract a subgraph with specific nodes\nsubset = graph.subgraph([\"feature-001\", \"feature-002\", \"feature-003\"])\n\n# Without internal edges\nnodes_only = graph.subgraph([\"feature-001\", \"feature-002\"], include_edges=False)\n</code></pre>"},{"location":"guide/queries/#connected-components","title":"Connected Components","text":"<pre><code># Get all nodes in the same connected component\ncomponent = graph.connected_component(\"feature-001\")\n\n# Filter by relationship type\nblocking_component = graph.connected_component(\"feature-001\", relationship=\"blocked_by\")\n</code></pre>"},{"location":"guide/queries/#edge-index-o1-lookups","title":"Edge Index (O(1) Lookups)","text":"<p>Efficient reverse edge lookups.</p> <pre><code># Get edges pointing TO a node\nincoming = graph.get_incoming_edges(\"feature-001\")\n\n# Filter by relationship\nblockers = graph.get_incoming_edges(\"feature-001\", relationship=\"blocked_by\")\n\n# Get edges pointing FROM a node\noutgoing = graph.get_outgoing_edges(\"feature-001\")\n\n# Get all connected neighbors\nneighbors = graph.get_neighbors(\"feature-001\")\n</code></pre>"},{"location":"guide/queries/#common-patterns","title":"Common Patterns","text":""},{"location":"guide/queries/#finding-bottlenecks","title":"Finding Bottlenecks","text":"<pre><code># Nodes that block the most others\ndef find_top_blockers(graph, limit=5):\n    nodes = graph.find_all(type=\"feature\")\n    blockers = []\n    for node in nodes:\n        blocked_count = len(graph.descendants(node.id, relationship=\"blocked_by\"))\n        if blocked_count &gt; 0:\n            blockers.append((node, blocked_count))\n    return sorted(blockers, key=lambda x: x[1], reverse=True)[:limit]\n</code></pre>"},{"location":"guide/queries/#finding-leaf-nodes","title":"Finding Leaf Nodes","text":"<pre><code># Nodes with no dependencies\ndef find_leaf_nodes(graph):\n    return graph.query_builder() \\\n        .where(\"type\", \"feature\") \\\n        .execute()\n    # Then filter for nodes where ancestors() returns empty\n    return [n for n in graph.find_all(type=\"feature\")\n            if not graph.ancestors(n.id)]\n</code></pre>"},{"location":"guide/queries/#finding-ready-tasks","title":"Finding Ready Tasks","text":"<pre><code># Tasks where all dependencies are done\ndef find_ready_tasks(graph):\n    ready = []\n    for node in graph.find_all(type=\"feature\", status=\"todo\"):\n        blockers = graph.find_blocked_by(node.id)\n        if all(b.status == \"done\" for b in blockers):\n            ready.append(node)\n    return ready\n</code></pre>"},{"location":"guide/queries/#dependency-chain-analysis","title":"Dependency Chain Analysis","text":"<pre><code># Find the longest dependency chain\ndef find_critical_path(graph):\n    features = graph.find_all(type=\"feature\")\n    max_path = []\n    for f1 in features:\n        for f2 in features:\n            if f1.id != f2.id:\n                paths = graph.all_paths(f1.id, f2.id, relationship=\"blocked_by\")\n                for path in paths:\n                    if len(path) &gt; len(max_path):\n                        max_path = path\n    return max_path\n</code></pre>"},{"location":"guide/queries/#performance-tips","title":"Performance Tips","text":"<ol> <li>Use EdgeIndex for reverse lookups: <code>get_incoming_edges()</code> is O(1) vs O(V*E) for scanning</li> <li>Limit traversal depth: Use <code>max_depth</code> parameter when you don't need full transitive closure</li> <li>Use <code>first()</code> when you only need one result: Avoids iterating entire graph</li> <li>Prefer <code>find_all()</code> with filters: More efficient than filtering after <code>get_nodes()</code></li> <li>Cache frequently accessed subgraphs: Use <code>subgraph()</code> to create smaller working sets</li> </ol>"},{"location":"guide/sessions/","title":"Sessions","text":"<p>Sessions automatically track all activity during an agent's work, providing complete attribution and continuity across work periods.</p>"},{"location":"guide/sessions/#what-is-a-session","title":"What is a Session?","text":"<p>A session is a period of continuous work by an agent. HtmlGraph automatically:</p> <ul> <li>Creates a session when work begins</li> <li>Logs all tool calls and interactions</li> <li>Attributes activities to features</li> <li>Generates a session summary when work ends</li> <li>Preserves full context for future sessions</li> </ul> <p>Each session is stored as an HTML file in <code>.htmlgraph/sessions/</code>.</p>"},{"location":"guide/sessions/#session-lifecycle","title":"Session Lifecycle","text":""},{"location":"guide/sessions/#1-session-start","title":"1. Session Start","text":"<p>Sessions start automatically when:</p> <ul> <li>An agent begins working (via hooks)</li> <li>You run <code>htmlgraph feature start &lt;id&gt;</code></li> <li>You initialize the SDK with <code>SDK(agent=\"name\")</code></li> </ul> <pre><code>from htmlgraph import SDK\n\n# Session starts automatically\nsdk = SDK(agent=\"claude\")\n\n# View current session\nstatus = sdk.status()\nprint(status.current_session)  # session-abc-123\n</code></pre>"},{"location":"guide/sessions/#2-activity-logging","title":"2. Activity Logging","text":"<p>During the session, HtmlGraph logs:</p> <ul> <li>Tool calls: Every Read, Write, Edit, Bash command</li> <li>User prompts: Questions and requests</li> <li>Feature updates: Status changes, step completions</li> <li>Decisions: Notes and tracking via <code>sdk.track()</code></li> </ul> <p>All activities are attributed to the current feature.</p>"},{"location":"guide/sessions/#3-session-end","title":"3. Session End","text":"<p>Sessions end automatically when:</p> <ul> <li>Work is completed</li> <li>Feature is marked as done</li> <li>Agent exits</li> </ul> <p>The session end hook generates a summary of all work performed.</p>"},{"location":"guide/sessions/#viewing-sessions","title":"Viewing Sessions","text":""},{"location":"guide/sessions/#cli","title":"CLI","text":"<pre><code># List all sessions\nhtmlgraph session list\n\n# Show specific session\nhtmlgraph session show session-abc-123\n\n# View current session status\nhtmlgraph status\n</code></pre>"},{"location":"guide/sessions/#sdk","title":"SDK","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Get all sessions\nsessions = sdk.sessions.all()\n\n# Get specific session\nsession = sdk.sessions.get(\"session-abc-123\")\n\n# View session details\nprint(session.id)\nprint(session.agent)\nprint(session.features_worked_on)\nprint(session.event_count)\n</code></pre>"},{"location":"guide/sessions/#browser","title":"Browser","text":"<p>Open <code>.htmlgraph/sessions/session-abc-123.html</code> in any browser to view:</p> <ul> <li>Session timeline</li> <li>Activity log with timestamps</li> <li>Features worked on</li> <li>Agent attribution</li> <li>Full event history</li> </ul>"},{"location":"guide/sessions/#activity-attribution","title":"Activity Attribution","text":"<p>Activities are attributed to features based on:</p> <ol> <li>Current feature: Set via <code>htmlgraph feature start &lt;id&gt;</code></li> <li>Primary feature: If multiple features are active</li> <li>Drift detection: Alerts if activity doesn't match the current feature</li> </ol>"},{"location":"guide/sessions/#example","title":"Example","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Create and start a feature\nfeature = sdk.features.create(\"Add login page\")\nsdk.features.start(feature.id)\n\n# All subsequent activities attributed to this feature\nsdk.track_activity(feature.id, \"Implementing OAuth flow\")\n\n# Read files, write code, etc. - all tracked automatically\n</code></pre>"},{"location":"guide/sessions/#drift-detection","title":"Drift Detection","text":"<p>HtmlGraph monitors activity to detect \"drift\" - when work diverges from the assigned feature.</p>"},{"location":"guide/sessions/#how-it-works","title":"How It Works","text":"<p>The drift detector analyzes:</p> <ul> <li>Files modified</li> <li>Keywords in commands and prompts</li> <li>Feature descriptions and steps</li> </ul> <p>If drift is detected (score &gt; 0.7), you'll see a warning:</p> <pre><code>\u26a0\ufe0f  Drift detected (0.85): Activity may not align with feature-auth-001\n   Consider switching features or updating the feature scope\n</code></pre>"},{"location":"guide/sessions/#responding-to-drift","title":"Responding to Drift","text":"<p>When you see drift warnings:</p> <ol> <li>Expected drift: Work naturally spans features (ignore)</li> <li>Switch features: Use <code>htmlgraph feature primary &lt;id&gt;</code></li> <li>Wrong feature: Update the feature's scope or file patterns</li> </ol>"},{"location":"guide/sessions/#session-continuity","title":"Session Continuity","text":""},{"location":"guide/sessions/#across-sessions","title":"Across Sessions","text":"<p>HtmlGraph preserves context between sessions:</p> <pre><code># End of Session 1\nhtmlgraph feature start feature-001\n# Work on feature...\n# Session ends\n\n# Start of Session 2\nhtmlgraph status\n# Shows: Previous session worked on feature-001\n#        Feature is 60% complete\n#        Last activity: \"Implemented OAuth callback\"\n</code></pre>"},{"location":"guide/sessions/#session-summaries","title":"Session Summaries","text":"<p>At session end, HtmlGraph generates a summary:</p> <pre><code>Session: session-abc-123\nDuration: 2h 34m\nAgent: claude\nFeatures: feature-001 (80% complete)\n\nActivities:\n- Implemented OAuth callback\n- Added JWT middleware\n- Wrote integration tests\n- Fixed redirect bug\n\nNext Steps:\n- Complete user profile endpoint\n- Add error handling\n- Deploy to staging\n</code></pre>"},{"location":"guide/sessions/#manual-session-management","title":"Manual Session Management","text":""},{"location":"guide/sessions/#track-custom-activities","title":"Track Custom Activities","text":"<pre><code>sdk.track_activity(\n    feature_id=\"feature-001\",\n    activity=\"Decided to use Passport.js instead of Auth0 (simpler API)\"\n)\n</code></pre>"},{"location":"guide/sessions/#set-primary-feature","title":"Set Primary Feature","text":"<p>When multiple features are active:</p> <pre><code>sdk.features.set_primary(\"feature-001\")\n</code></pre> <p>Or via CLI:</p> <pre><code>htmlgraph feature primary feature-001\n</code></pre>"},{"location":"guide/sessions/#session-files","title":"Session Files","text":"<p>Each session creates an HTML file with:</p> <pre><code>&lt;article id=\"session-abc-123\"\n         data-type=\"session\"\n         data-agent=\"claude\"\n         data-start=\"2024-12-16T10:30:00Z\"\n         data-end=\"2024-12-16T13:04:00Z\"&gt;\n\n    &lt;h1&gt;Session ABC-123&lt;/h1&gt;\n\n    &lt;section data-features&gt;\n        &lt;h3&gt;Features Worked On:&lt;/h3&gt;\n        &lt;ul&gt;\n            &lt;li&gt;&lt;a href=\"../features/feature-001.html\"&gt;User Authentication (80%)&lt;/a&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n    &lt;/section&gt;\n\n    &lt;section data-activity-log&gt;\n        &lt;h3&gt;Activity Log:&lt;/h3&gt;\n        &lt;ol reversed&gt;\n            &lt;li data-timestamp=\"2024-12-16T13:04:00Z\"&gt;\n                Completed integration tests\n            &lt;/li&gt;\n            &lt;li data-timestamp=\"2024-12-16T12:30:00Z\"&gt;\n                Implemented OAuth callback\n            &lt;/li&gt;\n            &lt;!-- ... more activities ... --&gt;\n        &lt;/ol&gt;\n    &lt;/section&gt;\n&lt;/article&gt;\n</code></pre>"},{"location":"guide/sessions/#best-practices","title":"Best Practices","text":""},{"location":"guide/sessions/#1-one-feature-at-a-time","title":"1. One Feature at a Time","text":"<p>Focus on a single feature per session for clear attribution:</p> <pre><code>htmlgraph feature start feature-001\n# Work only on this feature\nhtmlgraph feature complete feature-001\n</code></pre>"},{"location":"guide/sessions/#2-document-decisions","title":"2. Document Decisions","text":"<p>Record important decisions as you make them:</p> <pre><code>sdk.track_activity(\n    feature_id=feature.id,\n    activity=\"Chose PostgreSQL over MongoDB for better transaction support\"\n)\n</code></pre>"},{"location":"guide/sessions/#3-complete-sessions","title":"3. Complete Sessions","text":"<p>Mark features as complete to trigger session summaries:</p> <pre><code>htmlgraph feature complete feature-001\n</code></pre>"},{"location":"guide/sessions/#4-review-previous-sessions","title":"4. Review Previous Sessions","text":"<p>Before starting new work, review what happened last:</p> <pre><code>htmlgraph status\nhtmlgraph session list --recent 5\n</code></pre>"},{"location":"guide/sessions/#integration-with-claude-code","title":"Integration with Claude Code","text":"<p>When using the Claude Code plugin, sessions are managed automatically:</p> <pre><code># In your Claude Code hook configuration\nSESSION_START_HOOK = \"~/.claude/plugins/htmlgraph/hooks/session-start.py\"\nSESSION_END_HOOK = \"~/.claude/plugins/htmlgraph/hooks/session-end.py\"\nPOST_TOOL_USE_HOOK = \"~/.claude/plugins/htmlgraph/hooks/post-tool-use.py\"\n</code></pre> <p>These hooks:</p> <ul> <li>Start sessions when Claude begins working</li> <li>Log all tool calls automatically</li> <li>Detect drift and warn you</li> <li>Generate summaries when sessions end</li> <li>Provide context at the start of new sessions</li> </ul>"},{"location":"guide/sessions/#next-steps","title":"Next Steps","text":"<ul> <li>Features &amp; Tracks Guide - Creating and managing work</li> <li>Agents Guide - Agent integration patterns</li> <li>Dashboard Guide - Visualizing session history</li> <li>API Reference - Complete SDK documentation</li> </ul>"},{"location":"guide/sqlite-index/","title":"SQLite Index (Optional)","text":"<p>The SQLite index is an optional performance feature that accelerates queries on large graphs.</p>"},{"location":"guide/sqlite-index/#overview","title":"Overview","text":"<p>HtmlGraph stores all data as HTML files (the source of truth). For performance, it optionally maintains a SQLite index that mirrors this data for fast queries.</p> <p>Key Points: - \u2705 Optional - HtmlGraph works without it - \u2705 Rebuildable - Can be regenerated from HTML files anytime - \u2705 Gitignored - Not committed to version control - \u2705 Automatic - Maintained automatically by the SDK</p>"},{"location":"guide/sqlite-index/#how-it-works","title":"How It Works","text":"<pre><code>HTML Files (source of truth)    SQLite Index (performance cache)\n.htmlgraph/features/*.html  \u2192   .htmlgraph/index.sqlite\n.htmlgraph/sessions/*.html  \u2192\n.htmlgraph/tracks/*/*.html  \u2192\n</code></pre> <p>The SDK automatically: 1. Reads HTML files when accessed 2. Updates SQLite index for faster subsequent queries 3. Rebuilds index when HTML files change</p>"},{"location":"guide/sqlite-index/#when-to-use","title":"When to Use","text":"<p>Use SQLite index when: - You have 100+ features/nodes - Query performance is slow - You're running analytics frequently - You're building dashboards</p> <p>Skip SQLite index when: - Small projects (&lt; 100 nodes) - Prefer simplicity over speed - Working in constrained environments - Debugging HTML structure</p>"},{"location":"guide/sqlite-index/#configuration","title":"Configuration","text":""},{"location":"guide/sqlite-index/#enable-default","title":"Enable (Default)","text":"<p>The SQLite index is enabled by default:</p> <pre><code>from htmlgraph import SDK\n\n# Index is used automatically\nsdk = SDK(agent=\"claude\")\nfeatures = sdk.features.all()  # Queries use index\n</code></pre>"},{"location":"guide/sqlite-index/#disable","title":"Disable","text":"<p>To disable the index:</p> <pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\", use_index=False)\n# All queries read HTML files directly\n</code></pre> <p>Or via environment variable:</p> <pre><code>export HTMLGRAPH_USE_INDEX=false\nhtmlgraph status  # Queries HTML files only\n</code></pre>"},{"location":"guide/sqlite-index/#index-maintenance","title":"Index Maintenance","text":""},{"location":"guide/sqlite-index/#rebuild-index","title":"Rebuild Index","text":"<p>If the index becomes out of sync:</p> <pre><code># Rebuild from HTML files\nhtmlgraph index rebuild\n\n# Or via SDK\nfrom htmlgraph import SDK\nsdk = SDK(agent=\"claude\")\nsdk.rebuild_index()\n</code></pre>"},{"location":"guide/sqlite-index/#clear-index","title":"Clear Index","text":"<p>To remove the index entirely:</p> <pre><code>rm .htmlgraph/index.sqlite\n\n# It will be recreated on next use\n</code></pre>"},{"location":"guide/sqlite-index/#check-index-status","title":"Check Index Status","text":"<pre><code># View index statistics\nhtmlgraph index stats\n</code></pre>"},{"location":"guide/sqlite-index/#performance-comparison","title":"Performance Comparison","text":"Operation Without Index With Index Speedup <code>features.all()</code> (100 nodes) 250ms 15ms 16x <code>features.where(status=\"todo\")</code> 200ms 8ms 25x <code>find_bottlenecks()</code> 800ms 45ms 18x <code>recommend_next_work()</code> 1.2s 65ms 18x <p>Benchmarks on M1 MacBook Pro with 100 features, 50 sessions</p>"},{"location":"guide/sqlite-index/#index-schema","title":"Index Schema","text":"<p>The SQLite index contains these tables:</p> <ul> <li><code>nodes</code> - All graph nodes (features, bugs, etc.)</li> <li><code>edges</code> - Relationships between nodes</li> <li><code>steps</code> - Feature/task steps</li> <li><code>sessions</code> - Session metadata</li> <li><code>events</code> - Event log entries</li> </ul> <p>Note: Schema is internal and may change between versions. Always use SDK methods to query.</p>"},{"location":"guide/sqlite-index/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guide/sqlite-index/#index-corruption","title":"Index Corruption","text":"<p>If queries return unexpected results:</p> <pre><code># Rebuild index from HTML source of truth\nhtmlgraph index rebuild --force\n</code></pre>"},{"location":"guide/sqlite-index/#disk-space","title":"Disk Space","text":"<p>The index typically uses 10-20% of HTML file size:</p> <pre><code># Check index size\ndu -sh .htmlgraph/index.sqlite\n\n# Compare to HTML size\ndu -sh .htmlgraph/features/\ndu -sh .htmlgraph/sessions/\n</code></pre> <p>To reduce size, archive old features/sessions:</p> <pre><code># Move completed features older than 90 days\nhtmlgraph archive --older-than 90d\n</code></pre>"},{"location":"guide/sqlite-index/#performance-still-slow","title":"Performance Still Slow","text":"<p>If queries are slow even with indexing:</p> <ol> <li>Rebuild index: <code>htmlgraph index rebuild</code></li> <li>Check disk I/O: Use SSD for <code>.htmlgraph/</code> if possible</li> <li>Analyze query: Use <code>EXPLAIN QUERY PLAN</code> in SQLite</li> <li>Reduce data: Archive old nodes</li> </ol>"},{"location":"guide/sqlite-index/#best-practices","title":"Best Practices","text":"<ol> <li>Gitignore index: Already in <code>.gitignore</code>, never commit</li> <li>Rebuild after git pull: If HTML changed, rebuild index</li> <li>Monitor index size: Keep under 100MB for best performance</li> <li>Use for analytics: Essential for <code>find_bottlenecks()</code>, <code>recommend_next_work()</code></li> </ol>"},{"location":"guide/sqlite-index/#faq","title":"FAQ","text":""},{"location":"guide/sqlite-index/#is-the-index-required","title":"Is the index required?","text":"<p>No. HtmlGraph works perfectly without it, just slower on large graphs.</p>"},{"location":"guide/sqlite-index/#can-i-commit-the-index-to-git","title":"Can I commit the index to git?","text":"<p>Not recommended. The index is gitignored by default. It's rebuildable from HTML files.</p>"},{"location":"guide/sqlite-index/#what-if-the-index-is-deleted","title":"What if the index is deleted?","text":"<p>No problem. It will be recreated automatically on next use.</p>"},{"location":"guide/sqlite-index/#how-often-is-the-index-updated","title":"How often is the index updated?","text":"<p>Automatically on every SDK write operation. No manual intervention needed.</p>"},{"location":"guide/sqlite-index/#does-the-index-support-transactions","title":"Does the index support transactions?","text":"<p>Yes. All SDK operations use SQLite transactions for consistency.</p>"},{"location":"guide/sqlite-index/#see-also","title":"See Also","text":"<ul> <li>Performance Optimization Guide</li> <li>Troubleshooting</li> <li>Architecture Overview</li> </ul>"},{"location":"guide/track-builder/","title":"TrackBuilder","text":"<p>The TrackBuilder provides a fluent API for creating tracks with specs and plans in a single command. No manual file creation, ID generation, or path management needed.</p>"},{"location":"guide/track-builder/#overview","title":"Overview","text":"<p>TrackBuilder is the recommended way to create tracks in HtmlGraph. It:</p> <ul> <li>Auto-generates track IDs and timestamps</li> <li>Creates HTML files in the correct directory structure</li> <li>Validates all input with Pydantic schemas</li> <li>Parses time estimates from task descriptions</li> <li>Provides a clean, readable API</li> </ul>"},{"location":"guide/track-builder/#basic-usage","title":"Basic Usage","text":""},{"location":"guide/track-builder/#minimal-track","title":"Minimal Track","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\ntrack = sdk.tracks.builder() \\\n    .title(\"Simple Feature\") \\\n    .description(\"A simple feature without detailed planning\") \\\n    .priority(\"medium\") \\\n    .create()\n\nprint(f\"Created: {track.track_id}\")\n# Creates: .htmlgraph/tracks/track-YYYYMMDD-HHMMSS/index.html\n</code></pre>"},{"location":"guide/track-builder/#track-with-specification","title":"Track with Specification","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"User Authentication\") \\\n    .description(\"Implement OAuth 2.0 authentication\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Add secure user authentication with OAuth support\",\n        context=\"Current system has no authentication. Need secure login for all users.\",\n        requirements=[\n            (\"Implement OAuth 2.0 flow\", \"must-have\"),\n            (\"Add JWT token management\", \"must-have\"),\n            (\"Create user profile endpoint\", \"should-have\"),\n            \"Add password reset flow\"  # Defaults to \"must-have\"\n        ],\n        acceptance_criteria=[\n            (\"Users can log in with Google/GitHub\", \"OAuth login works\"),\n            \"Tokens expire after 1 hour\",\n            \"Password reset emails sent within 5 minutes\"\n        ]\n    ) \\\n    .create()\n\n# Creates:\n#   - .htmlgraph/tracks/track-YYYYMMDD-HHMMSS/index.html\n#   - .htmlgraph/tracks/track-YYYYMMDD-HHMMSS/spec.html\n</code></pre>"},{"location":"guide/track-builder/#track-with-implementation-plan","title":"Track with Implementation Plan","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"Database Migration\") \\\n    .description(\"Migrate from SQLite to PostgreSQL\") \\\n    .priority(\"critical\") \\\n    .with_plan_phases([\n        (\"Phase 1: Setup\", [\n            \"Install PostgreSQL (0.5h)\",\n            \"Create migration scripts (2h)\",\n            \"Set up staging environment (1h)\"\n        ]),\n        (\"Phase 2: Migration\", [\n            \"Run migrations on staging (1h)\",\n            \"Validate data integrity (2h)\",\n            \"Performance testing (3h)\"\n        ]),\n        (\"Phase 3: Production\", [\n            \"Schedule maintenance window\",\n            \"Run production migration (2h)\",\n            \"Monitor for 24 hours\"\n        ])\n    ]) \\\n    .create()\n\n# Creates:\n#   - .htmlgraph/tracks/track-YYYYMMDD-HHMMSS/index.html\n#   - .htmlgraph/tracks/track-YYYYMMDD-HHMMSS/plan.html\n</code></pre>"},{"location":"guide/track-builder/#complete-track-spec-plan","title":"Complete Track (Spec + Plan)","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"API Rate Limiting\") \\\n    .description(\"Implement rate limiting for API endpoints\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Protect API from abuse with rate limiting\",\n        context=\"Current API has no rate limits, vulnerable to DoS attacks\",\n        requirements=[\n            (\"Implement token bucket algorithm\", \"must-have\"),\n            (\"Add Redis for distributed rate limiting\", \"must-have\"),\n            (\"Create rate limit middleware\", \"must-have\"),\n            (\"Add rate limit headers to responses\", \"should-have\")\n        ],\n        acceptance_criteria=[\n            (\"100 requests/minute per API key\", \"Load test confirms limit\"),\n            (\"429 status code when rate exceeded\", \"Integration test passes\"),\n            \"Rate limits reset every 60 seconds\"\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: Core Implementation\", [\n            \"Implement token bucket algorithm (3h)\",\n            \"Add Redis client (1h)\",\n            \"Create rate limiting middleware (2h)\"\n        ]),\n        (\"Phase 2: Integration\", [\n            \"Add middleware to API routes (1h)\",\n            \"Implement rate limit headers (1h)\",\n            \"Add error handling (1h)\"\n        ]),\n        (\"Phase 3: Testing\", [\n            \"Write unit tests (2h)\",\n            \"Load testing (3h)\",\n            \"Documentation (1h)\"\n        ])\n    ]) \\\n    .create()\n\n# Output:\n# \u2713 Created track: track-20251221-220000\n#   - Spec with 4 requirements\n#   - Plan with 3 phases, 9 tasks\n</code></pre>"},{"location":"guide/track-builder/#api-reference","title":"API Reference","text":""},{"location":"guide/track-builder/#trackbuilder-methods","title":"TrackBuilder Methods","text":""},{"location":"guide/track-builder/#titletitle-str-trackbuilder","title":"<code>.title(title: str) -&gt; TrackBuilder</code>","text":"<p>Set the track title. Required.</p> <pre><code>.title(\"User Authentication System\")\n</code></pre>"},{"location":"guide/track-builder/#descriptiondesc-str-trackbuilder","title":"<code>.description(desc: str) -&gt; TrackBuilder</code>","text":"<p>Set the track description. Optional.</p> <pre><code>.description(\"Implement OAuth 2.0 authentication with Google and GitHub\")\n</code></pre>"},{"location":"guide/track-builder/#prioritypriority-str-trackbuilder","title":"<code>.priority(priority: str) -&gt; TrackBuilder</code>","text":"<p>Set priority. Options: <code>\"low\"</code>, <code>\"medium\"</code>, <code>\"high\"</code>, <code>\"critical\"</code>. Defaults to <code>\"medium\"</code>.</p> <pre><code>.priority(\"high\")\n</code></pre>"},{"location":"guide/track-builder/#with_spec-trackbuilder","title":"<code>.with_spec(...) -&gt; TrackBuilder</code>","text":"<p>Add specification content. Optional.</p> <p>Parameters:</p> <ul> <li><code>overview: str</code> - High-level summary</li> <li><code>context: str</code> - Background and constraints</li> <li><code>requirements: list</code> - Requirements as:</li> <li><code>(description, priority)</code> tuples: <code>(\"Add auth\", \"must-have\")</code></li> <li>Or strings (defaults to \"must-have\"): <code>\"Add logging\"</code></li> <li><code>acceptance_criteria: list</code> - Success criteria as:</li> <li><code>(description, test_case)</code> tuples</li> <li>Or strings (test case optional)</li> </ul> <p>Requirement priorities: <code>\"must-have\"</code>, <code>\"should-have\"</code>, <code>\"nice-to-have\"</code></p> <pre><code>.with_spec(\n    overview=\"Add authentication\",\n    context=\"No auth currently exists\",\n    requirements=[\n        (\"OAuth 2.0\", \"must-have\"),\n        (\"JWT tokens\", \"must-have\"),\n        (\"Password reset\", \"should-have\")\n    ],\n    acceptance_criteria=[\n        (\"Users can log in\", \"Login test passes\"),\n        \"Tokens expire after 1 hour\"\n    ]\n)\n</code></pre>"},{"location":"guide/track-builder/#with_plan_phasesphases-listtuplestr-liststr-trackbuilder","title":"<code>.with_plan_phases(phases: list[tuple[str, list[str]]]) -&gt; TrackBuilder</code>","text":"<p>Add implementation plan with phases. Optional.</p> <p>Format: <code>[(phase_name, [task_descriptions]), ...]</code></p> <p>Time Estimates: Include <code>(Xh)</code> in task description: - <code>\"Implement auth (3h)\"</code> \u2192 3 hours - <code>\"Write tests (1.5h)\"</code> \u2192 1.5 hours - <code>\"Deploy\"</code> \u2192 No estimate</p> <pre><code>.with_plan_phases([\n    (\"Phase 1: Setup\", [\n        \"Configure OAuth providers (2h)\",\n        \"Set up database (1h)\"\n    ]),\n    (\"Phase 2: Implementation\", [\n        \"Implement login (4h)\",\n        \"Add middleware (3h)\"\n    ])\n])\n</code></pre>"},{"location":"guide/track-builder/#create-track","title":"<code>.create() -&gt; Track</code>","text":"<p>Execute the build and create all files. Returns <code>Track</code> object.</p> <pre><code>track = builder.create()\n\nprint(track.track_id)        # \"track-20251221-220000\"\nprint(track.title)           # \"Track: User Authentication\"\nprint(track.priority)        # \"high\"\nprint(track.has_spec)        # True\nprint(track.has_plan)        # True\n</code></pre>"},{"location":"guide/track-builder/#file-structure","title":"File Structure","text":"<p>TrackBuilder creates a directory with up to three HTML files:</p> <pre><code>.htmlgraph/tracks/track-YYYYMMDD-HHMMSS/\n\u251c\u2500\u2500 index.html    # Track metadata with links to spec/plan\n\u251c\u2500\u2500 spec.html     # Specification (if with_spec() used)\n\u2514\u2500\u2500 plan.html     # Implementation plan (if with_plan_phases() used)\n</code></pre> <p>All files are fully styled and can be opened in any browser.</p>"},{"location":"guide/track-builder/#when-to-use-trackbuilder","title":"When to Use TrackBuilder","text":"<p>Create a track when:</p> <ul> <li>Work involves 3+ features</li> <li>Multi-phase implementation needed</li> <li>Need coordination across sessions</li> <li>Requires detailed planning upfront</li> </ul> <p>Implement directly when:</p> <ul> <li>Single feature, straightforward work</li> <li>No need for planning</li> <li>Quick fix or enhancement</li> </ul>"},{"location":"guide/track-builder/#workflow-example","title":"Workflow Example","text":""},{"location":"guide/track-builder/#1-create-the-track","title":"1. Create the Track","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\n\n# Create track with spec and plan\ntrack = sdk.tracks.builder() \\\n    .title(\"Multi-Agent Collaboration\") \\\n    .description(\"Enable seamless agent collaboration\") \\\n    .priority(\"high\") \\\n    .with_spec(\n        overview=\"Multiple agents can work together on features\",\n        context=\"Current: isolated agents. Need: claiming, handoffs, notes\",\n        requirements=[\n            (\"Add assigned_agent field to features\", \"must-have\"),\n            (\"Implement claim CLI command\", \"must-have\"),\n            (\"Add handoff_notes field\", \"should-have\")\n        ],\n        acceptance_criteria=[\n            \"Multiple agents work without conflicts\",\n            \"Smooth handoffs with full context\"\n        ]\n    ) \\\n    .with_plan_phases([\n        (\"Phase 1: Claiming\", [\n            \"Add assigned_agent field (1h)\",\n            \"Implement claim CLI (2h)\",\n            \"Update feature HTML template (1h)\"\n        ]),\n        (\"Phase 2: Handoffs\", [\n            \"Add handoff_notes field (1h)\",\n            \"Update session hooks (2h)\",\n            \"Add handoff CLI command (1h)\"\n        ]),\n        (\"Phase 3: Testing\", [\n            \"Write multi-agent tests (3h)\",\n            \"Test handoff workflow (2h)\"\n        ])\n    ]) \\\n    .create()\n\nprint(f\"Created track: {track.track_id}\")\n</code></pre>"},{"location":"guide/track-builder/#2-create-features-from-phases","title":"2. Create Features from Phases","text":"<pre><code># Create a feature for each phase\nphase1 = sdk.features.create(\n    title=\"Phase 1: Agent Claiming\",\n    track_id=track.track_id,\n    priority=\"high\",\n    steps=[\n        \"Add assigned_agent field\",\n        \"Implement claim CLI\",\n        \"Update feature template\"\n    ]\n)\n\nphase2 = sdk.features.create(\n    title=\"Phase 2: Agent Handoffs\",\n    track_id=track.track_id,\n    priority=\"high\",\n    steps=[\n        \"Add handoff_notes field\",\n        \"Update session hooks\",\n        \"Add handoff CLI command\"\n    ]\n)\n\nphase3 = sdk.features.create(\n    title=\"Phase 3: Testing\",\n    track_id=track.track_id,\n    priority=\"medium\",\n    steps=[\n        \"Write multi-agent tests\",\n        \"Test handoff workflow\"\n    ]\n)\n</code></pre>"},{"location":"guide/track-builder/#3-work-on-features","title":"3. Work on Features","text":"<pre><code># Start working on Phase 1\nhtmlgraph feature start {phase1.id}\n\n# Complete steps as you go\n# Features are automatically attributed to the track\n</code></pre>"},{"location":"guide/track-builder/#error-handling","title":"Error Handling","text":""},{"location":"guide/track-builder/#missing-title","title":"Missing Title","text":"<pre><code>track = sdk.tracks.builder() \\\n    .priority(\"high\") \\\n    .create()\n# ValueError: Track title is required\n</code></pre> <p>Fix: Always call <code>.title()</code> before <code>.create()</code></p>"},{"location":"guide/track-builder/#invalid-priority","title":"Invalid Priority","text":"<pre><code>track = sdk.tracks.builder() \\\n    .title(\"My Track\") \\\n    .with_spec(\n        requirements=[(\"Add auth\", \"super-critical\")]  # Invalid!\n    ) \\\n    .create()\n# ValidationError: Input should be 'must-have', 'should-have' or 'nice-to-have'\n</code></pre> <p>Fix: Use valid priority values</p>"},{"location":"guide/track-builder/#tips","title":"Tips","text":"<ol> <li>Auto-generated IDs - Never manually create track IDs</li> <li>Timestamps - Created/updated timestamps are automatic</li> <li>File paths - Builder handles all path generation</li> <li>HTML generation - Spec and Plan models convert to HTML automatically</li> <li>Estimates - Include <code>(Xh)</code> in task descriptions</li> <li>Validation - Pydantic validates all fields before HTML generation</li> </ol>"},{"location":"guide/track-builder/#next-steps","title":"Next Steps","text":"<ul> <li>Features &amp; Tracks Guide - Linking features to tracks</li> <li>Sessions Guide - Session tracking and attribution</li> <li>API Reference - Complete API documentation</li> </ul>"},{"location":"guides/common-workflows/","title":"Common Workflows","text":"<p>Practical patterns for using HtmlGraph SDK in AI agent sessions.</p>"},{"location":"guides/common-workflows/#session-start","title":"Session Start","text":"<pre><code>from htmlgraph import SDK\n\nsdk = SDK(agent=\"claude\")\ninfo = sdk.get_session_start_info()\n\n# Check for active work\nif info.get(\"active_work\"):\n    print(f\"Continue: {info['active_work']['title']}\")\nelse:\n    # Get recommendations\n    recs = info.get(\"analytics\", {}).get(\"recommendations\", [])\n    if recs:\n        print(f\"Recommended: {recs[0]['title']}\")\n</code></pre> <p>What this does: - Loads session context automatically - Identifies in-progress work to continue - Provides strategic recommendations if starting fresh - Returns analytics about project health</p>"},{"location":"guides/common-workflows/#creating-work-items","title":"Creating Work Items","text":""},{"location":"guides/common-workflows/#features-implementation-work","title":"Features (Implementation Work)","text":"<pre><code># Simple feature creation\nfeature = sdk.features.create(\"Add user authentication\")\n\n# With full configuration\nfeature = sdk.features.create(\"Add user authentication\") \\\n    .set_priority(\"high\") \\\n    .set_status(\"in-progress\") \\\n    .add_steps([\n        \"Create auth routes\",\n        \"Add middleware\",\n        \"Write tests\"\n    ]) \\\n    .add_metadata({\n        \"estimated_hours\": 4,\n        \"requires_review\": True\n    }) \\\n    .save()\n\nprint(f\"Created feature: {feature.id}\")\n</code></pre> <p>When to use: - New features or enhancements - Multi-step implementation work - Work that adds new capabilities</p>"},{"location":"guides/common-workflows/#bugs-fixes","title":"Bugs (Fixes)","text":"<pre><code># Simple bug report\nbug = sdk.bugs.create(\"Login fails on timeout\")\n\n# With details\nbug = sdk.bugs.create(\"Login fails on timeout\") \\\n    .set_severity(\"high\") \\\n    .set_priority(\"urgent\") \\\n    .add_steps([\n        \"Reproduce timeout scenario\",\n        \"Add timeout handling\",\n        \"Test edge cases\"\n    ]) \\\n    .add_metadata({\n        \"error_message\": \"ConnectionTimeout in auth.py:45\",\n        \"affects_version\": \"0.9.3\"\n    }) \\\n    .save()\n</code></pre> <p>When to use: - Fixing broken functionality - Resolving errors or exceptions - Addressing production issues</p>"},{"location":"guides/common-workflows/#spikes-research","title":"Spikes (Research)","text":"<pre><code># Research spike with timebox\nspike = sdk.spikes.create(\"Evaluate caching options\") \\\n    .set_timebox_hours(2) \\\n    .set_priority(\"medium\") \\\n    .add_steps([\n        \"Review Redis vs Memcached\",\n        \"Test performance\",\n        \"Document findings\"\n    ]) \\\n    .save()\n</code></pre> <p>When to use: - Investigating unknowns - Proof-of-concept work - Evaluating alternatives - Time-boxed research</p>"},{"location":"guides/common-workflows/#orchestration-pattern","title":"Orchestration Pattern","text":""},{"location":"guides/common-workflows/#explore-then-implement","title":"Explore Then Implement","text":"<pre><code># 1. Spawn explorer for discovery\nexplorer = sdk.spawn_explorer(\n    task=\"Understand authentication system\",\n    scope=\"src/auth/\"\n)\n\n# Use with Task tool (pseudo-code for illustration)\n# Task(prompt=explorer[\"prompt\"], subagent_type=explorer[\"subagent_type\"])\n\n# 2. After exploration, spawn coder with context\ncoder = sdk.spawn_coder(\n    feature_id=feature.id,\n    context=explorer_results,  # Pass findings from explorer\n    test_command=\"uv run pytest tests/auth/\"\n)\n\n# Task(prompt=coder[\"prompt\"], subagent_type=coder[\"subagent_type\"])\n</code></pre> <p>Pattern benefits: - Separates discovery from implementation - Reduces context switching - Improves code quality through focused exploration</p>"},{"location":"guides/common-workflows/#full-orchestration","title":"Full Orchestration","text":"<pre><code># Automatic exploration \u2192 implementation flow\nprompts = sdk.orchestrate(\n    feature_id=\"feat-123\",\n    exploration_scope=\"src/\",\n    test_command=\"uv run pytest\"\n)\n\n# Returns both explorer and coder prompts\n# prompts = {\n#     \"explorer\": {\"prompt\": \"...\", \"subagent_type\": \"explorer\"},\n#     \"coder\": {\"prompt\": \"...\", \"subagent_type\": \"coder\"}\n# }\n\n# Execute in sequence:\n# 1. Task(prompt=prompts[\"explorer\"][\"prompt\"], ...)\n# 2. After explorer completes, use results in coder context\n# 3. Task(prompt=prompts[\"coder\"][\"prompt\"], ...)\n</code></pre> <p>When to use: - Complex features requiring research - Unfamiliar codebases - When exploration findings inform implementation</p>"},{"location":"guides/common-workflows/#parallel-execution","title":"Parallel Execution","text":"<pre><code># Check if work can be parallelized\nparallel = sdk.get_parallel_work(max_agents=3)\n\nif parallel[\"can_parallelize\"]:\n    print(f\"Found {len(parallel['prompts'])} parallelizable tasks\")\n\n    # Spawn multiple subagents in one message\n    for p in parallel[\"prompts\"]:\n        # Task(prompt=p[\"prompt\"], subagent_type=p[\"subagent_type\"])\n        print(f\"- {p['work_item']['title']}\")\nelse:\n    print(\"No parallelizable work found\")\n    print(f\"Reason: {parallel.get('reason', 'Unknown')}\")\n</code></pre> <p>Parallelization criteria: - Work items have no blocking dependencies - Different codebases/modules - Independent test suites - No shared state mutations</p> <p>Example parallel scenarios: - Bug fixes in different modules - Independent feature implementations - Documentation updates - Separate test suites</p>"},{"location":"guides/common-workflows/#progress-tracking","title":"Progress Tracking","text":""},{"location":"guides/common-workflows/#starting-work","title":"Starting Work","text":"<pre><code># Mark feature as in-progress\nsdk.features.start(feature.id)\n\n# Automatically logs:\n# - Start timestamp\n# - Agent assignment\n# - Session linkage\n</code></pre>"},{"location":"guides/common-workflows/#completing-steps","title":"Completing Steps","text":"<pre><code># Complete individual steps\nwith sdk.features.edit(feature.id) as f:\n    f.complete_step(0)  # \"Create auth routes\" \u2713\n    f.complete_step(1)  # \"Add middleware\" \u2713\n\n# Or complete with notes\nwith sdk.features.edit(feature.id) as f:\n    f.complete_step(2, notes=\"All tests passing\")\n</code></pre>"},{"location":"guides/common-workflows/#updating-status","title":"Updating Status","text":"<pre><code># Manual status update\nwith sdk.features.edit(feature.id) as f:\n    f.set_status(\"blocked\")\n    f.add_metadata({\"blocked_by\": \"Waiting for API key\"})\n\n# Or use helper methods\nsdk.features.block(feature.id, reason=\"Missing credentials\")\n</code></pre>"},{"location":"guides/common-workflows/#marking-complete","title":"Marking Complete","text":"<pre><code># Complete the feature\nsdk.features.complete(feature.id)\n\n# With completion notes\nsdk.features.complete(\n    feature.id,\n    notes=\"All tests passing, ready for review\"\n)\n\n# Automatically:\n# - Sets status to \"done\"\n# - Marks all steps complete\n# - Records completion timestamp\n# - Logs to session\n</code></pre>"},{"location":"guides/common-workflows/#session-end","title":"Session End","text":"<pre><code># End session with handoff notes\nsdk.end_session(\n    session_id=session.id,\n    handoff_notes=\"Completed auth feature, all tests passing\",\n    recommended_next=\"Implement rate limiting\"\n)\n\n# Or use auto-generated summary\nsummary = sdk.get_session_summary()\nsdk.end_session(\n    session_id=session.id,\n    handoff_notes=summary[\"summary\"],\n    recommended_next=summary[\"next_steps\"]\n)\n</code></pre> <p>Session end checklist: - \u2713 Commit all changes - \u2713 Run tests - \u2713 Document completion status - \u2713 Note any blockers - \u2713 Suggest next work</p>"},{"location":"guides/common-workflows/#strategic-analytics","title":"Strategic Analytics","text":""},{"location":"guides/common-workflows/#getting-recommendations","title":"Getting Recommendations","text":"<pre><code># Get work recommendations\nrecs = sdk.analytics.recommend_next_work(max_items=5)\n\nfor rec in recs:\n    print(f\"{rec['priority']}: {rec['title']}\")\n    print(f\"  Reason: {rec['reason']}\")\n    print(f\"  Ready: {rec['is_ready']}\")\n</code></pre> <p>Recommendation criteria: - Priority and severity - Unblocked dependencies - Time sensitivity - Resource availability</p>"},{"location":"guides/common-workflows/#finding-bottlenecks","title":"Finding Bottlenecks","text":"<pre><code># Identify blocking work items\nbottlenecks = sdk.analytics.find_bottlenecks()\n\nfor item in bottlenecks:\n    print(f\"{item['title']} blocks {len(item['blocks'])} items\")\n    for blocked in item['blocks']:\n        print(f\"  - {blocked['title']}\")\n</code></pre> <p>Use bottleneck analysis to: - Prioritize unblocking work - Identify dependency chains - Plan parallel work streams</p>"},{"location":"guides/common-workflows/#drift-detection","title":"Drift Detection","text":"<pre><code># Check for stale work\ndrift = sdk.analytics.detect_drift()\n\nif drift[\"stale_items\"]:\n    print(f\"Found {len(drift['stale_items'])} stale items:\")\n    for item in drift[\"stale_items\"]:\n        print(f\"- {item['title']} (idle {item['days_idle']} days)\")\n</code></pre>"},{"location":"guides/common-workflows/#complete-example-feature-implementation","title":"Complete Example: Feature Implementation","text":"<pre><code>from htmlgraph import SDK\n\n# Initialize\nsdk = SDK(agent=\"claude\")\n\n# 1. Check session context\ninfo = sdk.get_session_start_info()\nif info.get(\"active_work\"):\n    feature = sdk.features.get(info[\"active_work\"][\"id\"])\n    print(f\"Continuing: {feature.title}\")\nelse:\n    # 2. Create new feature\n    feature = sdk.features.create(\"Add rate limiting\") \\\n        .set_priority(\"high\") \\\n        .add_steps([\n            \"Design rate limit strategy\",\n            \"Implement middleware\",\n            \"Add Redis integration\",\n            \"Write tests\",\n            \"Update documentation\"\n        ]) \\\n        .save()\n\n    # 3. Start work\n    sdk.features.start(feature.id)\n\n# 4. Orchestrate exploration + implementation\nprompts = sdk.orchestrate(\n    feature_id=feature.id,\n    exploration_scope=\"src/middleware/\",\n    test_command=\"uv run pytest tests/middleware/\"\n)\n\n# Execute explorer first, then coder\n# (Implementation depends on your agent framework)\n\n# 5. Track progress\nwith sdk.features.edit(feature.id) as f:\n    f.complete_step(0)  # Design done\n    f.complete_step(1)  # Middleware done\n    # ... continue as work progresses\n\n# 6. Complete feature\nsdk.features.complete(\n    feature.id,\n    notes=\"Rate limiting implemented, all tests passing\"\n)\n\n# 7. End session\nsdk.end_session(\n    session_id=sdk.session.id,\n    handoff_notes=\"Rate limiting complete, ready for review\",\n    recommended_next=\"Add monitoring dashboards\"\n)\n</code></pre>"},{"location":"guides/common-workflows/#best-practices","title":"Best Practices","text":""},{"location":"guides/common-workflows/#dos","title":"Do's \u2713","text":"<ul> <li>Use <code>get_session_start_info()</code> at session start</li> <li>Create work items before starting implementation</li> <li>Track progress with step completion</li> <li>Use orchestration for complex features</li> <li>End sessions with handoff notes</li> <li>Check analytics for strategic guidance</li> </ul>"},{"location":"guides/common-workflows/#donts","title":"Don'ts \u2717","text":"<ul> <li>Don't create duplicate work items</li> <li>Don't skip session tracking</li> <li>Don't ignore bottleneck warnings</li> <li>Don't forget to mark work complete</li> <li>Don't bypass orchestration for complex work</li> </ul>"},{"location":"guides/common-workflows/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/common-workflows/#no-session-found","title":"\"No session found\"","text":"<pre><code># Ensure SDK is initialized\nsdk = SDK(agent=\"claude\")  # Creates session automatically\n</code></pre>"},{"location":"guides/common-workflows/#feature-not-found","title":"\"Feature not found\"","text":"<pre><code># List all features\nfeatures = sdk.features.list()\nprint([f.id for f in features])\n</code></pre>"},{"location":"guides/common-workflows/#cannot-parallelize-work","title":"\"Cannot parallelize work\"","text":"<pre><code># Check dependency graph\nbottlenecks = sdk.analytics.find_bottlenecks()\n# Resolve blocking items first\n</code></pre>"},{"location":"guides/common-workflows/#next-steps","title":"Next Steps","text":"<ul> <li>SDK Reference - Complete SDK documentation</li> <li>Orchestration Guide - Deep dive into agent coordination</li> <li>Analytics Guide - Strategic planning with analytics</li> <li>Examples - Real-world usage examples</li> </ul>"},{"location":"philosophy/comparisons/","title":"Comparisons","text":"<p>Detailed comparisons with alternative approaches.</p>"},{"location":"philosophy/comparisons/#vs-graph-databases","title":"vs Graph Databases","text":""},{"location":"philosophy/comparisons/#neo4j","title":"Neo4j","text":"<p>Neo4j Strengths: - Mature, battle-tested - Advanced graph algorithms - Cypher query language is expressive - Enterprise support</p> <p>Neo4j Weaknesses: - Requires Docker + JVM - Learning curve for Cypher - Binary data format - License costs for enterprise - Complex deployment</p> <p>HtmlGraph Approach: - Minimal dependencies (<code>pip install htmlgraph</code>) - No infrastructure (no Docker, JVM, or database servers) - CSS selectors (already know them) - Plain text HTML files - Free, MIT license - Just files on disk</p> <p>When to use Neo4j: Large-scale production systems with complex graph queries, enterprise support requirements.</p> <p>When to use HtmlGraph: Rapid prototyping, AI agent coordination, personal projects, Git-friendly workflows.</p>"},{"location":"philosophy/comparisons/#memgraph","title":"Memgraph","text":"<p>Similar trade-offs to Neo4j, with emphasis on real-time analytics.</p> <p>Use Memgraph when: You need streaming graph analytics, real-time pattern matching.</p> <p>Use HtmlGraph when: You need simplicity, portability, human readability.</p>"},{"location":"philosophy/comparisons/#vs-document-databases","title":"vs Document Databases","text":""},{"location":"philosophy/comparisons/#json-files","title":"JSON Files","text":"<p>JSON Strengths: - Simple format - Widely supported - Easy to parse</p> <p>JSON Weaknesses: - No native graph structure - Manual reference management - No built-in presentation - Needs custom UI</p> <p>HtmlGraph Advantages: - Native hyperlinks (graph edges) - Built-in rendering with CSS - CSS selector queries - Human-readable in browser</p>"},{"location":"philosophy/comparisons/#yaml","title":"YAML","text":"<p>Similar to JSON, with more readable syntax but same limitations for graph data.</p>"},{"location":"philosophy/comparisons/#vs-note-taking-tools","title":"vs Note-Taking Tools","text":""},{"location":"philosophy/comparisons/#notion","title":"Notion","text":"<p>Notion Strengths: - Beautiful UI - Collaboration features - Mobile apps</p> <p>Notion Weaknesses: - Cloud-only - Rate-limited API - No version control - Vendor lock-in - Limited AI agent access</p> <p>HtmlGraph Advantages: - Fully offline - Unlimited API access - Git native - Own your data - Direct SDK access for agents</p>"},{"location":"philosophy/comparisons/#obsidian","title":"Obsidian","text":"<p>Obsidian Strengths: - Local-first - Markdown files - Plugin ecosystem</p> <p>Obsidian Weaknesses: - Backlinks not typed (no relationship types) - Proprietary graph format - Markdown limitations for structured data</p> <p>HtmlGraph Advantages: - Typed relationships (<code>data-relationship=\"blocks\"</code>) - Native web format - Structured data with Pydantic - AI agent-first design</p>"},{"location":"philosophy/comparisons/#roam-research","title":"Roam Research","text":"<p>Similar to Notion but with better graph features. Still cloud-based with same limitations.</p>"},{"location":"philosophy/comparisons/#vs-ai-agent-memory-systems","title":"vs AI Agent Memory Systems","text":""},{"location":"philosophy/comparisons/#beads","title":"Beads","text":"<p>Beads by Steve Yegge is a similar project focused on AI agent task management.</p> <p>Beads Strengths:</p> <ul> <li>Hash-based IDs prevent conflicts</li> <li>Semantic memory decay</li> <li>Ready task detection</li> <li>Multiple frontends (TUI, web, VS Code)</li> </ul> <p>Beads Weaknesses:</p> <ul> <li>Requires CLI daemon</li> <li>JSONL storage format</li> <li>Needs viewer tools</li> </ul> <p>HtmlGraph Approach:</p> <ul> <li>Adopted hash-based IDs (inspired by Beads)</li> <li>Minimal Python dependencies (pydantic, justhtml, watchdog)</li> <li>Uses SQLite for indexing, JSONL for event logs</li> <li>No daemon process required</li> <li>HTML renders in any browser</li> <li>Web standards-based</li> </ul> <p>Shared Design Goals:</p> <p>Both projects aim to give AI agents persistent, structured memory beyond a single context window. HtmlGraph's hash-based ID system was directly inspired by Beads' approach to multi-agent collision resistance.</p> <p>When to use Beads: CLI-first workflow, multiple frontends needed, semantic memory decay.</p> <p>When to use HtmlGraph: Browser-first workflow, minimal infrastructure, web standards preference.</p>"},{"location":"philosophy/comparisons/#vs-ai-agent-frameworks","title":"vs AI Agent Frameworks","text":""},{"location":"philosophy/comparisons/#langchainlanggraph","title":"LangChain/LangGraph","text":"<p>LangChain Strengths: - Rich ecosystem - Many integrations - Active development</p> <p>LangChain Weaknesses: - Complex abstractions - Framework lock-in - Python/JS specific - No built-in observability</p> <p>HtmlGraph Advantages: - Simple, web-standards based - Language agnostic (any language can parse HTML) - Built-in observability (view in browser) - No framework lock-in</p>"},{"location":"philosophy/comparisons/#autogptbabyagi","title":"AutoGPT/BabyAGI","text":"<p>AutoGPT Strengths: - Autonomous operation - Task decomposition</p> <p>AutoGPT Weaknesses: - State management in JSON - Limited observability - No multi-agent coordination</p> <p>HtmlGraph Advantages: - Graph-based state (HTML) - Full observability (dashboard) - Multi-agent coordination built-in</p>"},{"location":"philosophy/comparisons/#feature-comparison-matrix","title":"Feature Comparison Matrix","text":"Feature Neo4j JSON Notion Obsidian HtmlGraph Setup complexity High Low None (cloud) Low Low Query language Cypher jq/custom UI only Search CSS selectors Version control \u274c \u2705 \u274c \u2705 \u2705 Offline-first \u2705 \u2705 \u274c \u2705 \u2705 AI agent API REST File I/O Rate-limited File I/O SDK + File I/O Human readable \u274c \ud83d\udfe1 \u2705 \u2705 \u2705 Graph native \u2705 \u274c \ud83d\udfe1 \ud83d\udfe1 \u2705 Typed relationships \u2705 \u274c \u274c \u274c \u2705 Self-hosting \u2705 \u2705 \u274c \u2705 \u2705 Cost $$$ Free $ $ Free"},{"location":"philosophy/comparisons/#when-to-use-each","title":"When to Use Each","text":""},{"location":"philosophy/comparisons/#use-neo4j-when","title":"Use Neo4j when:","text":"<ul> <li>Enterprise production system</li> <li>Complex graph algorithms needed</li> <li>Dedicated DBA available</li> <li>Budget for licensing</li> </ul>"},{"location":"philosophy/comparisons/#use-json-when","title":"Use JSON when:","text":"<ul> <li>Simple key-value data</li> <li>No graph structure needed</li> <li>Minimal querying</li> </ul>"},{"location":"philosophy/comparisons/#use-notion-when","title":"Use Notion when:","text":"<ul> <li>Team collaboration is primary</li> <li>Cloud-first is acceptable</li> <li>AI agents are secondary</li> </ul>"},{"location":"philosophy/comparisons/#use-obsidian-when","title":"Use Obsidian when:","text":"<ul> <li>Personal knowledge base</li> <li>Markdown preference</li> <li>Plugin ecosystem needed</li> </ul>"},{"location":"philosophy/comparisons/#use-htmlgraph-when","title":"Use HtmlGraph when:","text":"<ul> <li>AI agent coordination</li> <li>Git-based workflows</li> <li>Offline-first required</li> <li>Simplicity is priority</li> <li>Own your data</li> <li>Minimal infrastructure (no Docker, databases, or daemons)</li> </ul>"},{"location":"philosophy/comparisons/#next-steps","title":"Next Steps","text":"<ul> <li>Design Decisions - Why specific choices were made</li> <li>Why HTML? - Core philosophy</li> </ul>"},{"location":"philosophy/decisions/","title":"Design Decisions","text":"<p>Key design decisions and their rationale.</p>"},{"location":"philosophy/decisions/#html-as-primary-format","title":"HTML as Primary Format","text":"<p>Decision: Use HTML files as the primary data format, not JSON or a database.</p> <p>Rationale: - HTML provides structure (nodes), relationships (hyperlinks), and presentation (CSS) in one format - Browsers are universal graph viewers - no special tools needed - Human readable and machine parseable - Git-friendly text format</p> <p>Trade-offs: - Slightly more verbose than JSON - Requires HTML parsing (vs JSON.parse) - Not a \"standard\" database format</p> <p>Why it's worth it: The ability to view any node in a browser with full styling is invaluable for debugging and understanding. Version control works perfectly. No special tools required.</p>"},{"location":"philosophy/decisions/#css-selectors-for-queries","title":"CSS Selectors for Queries","text":"<p>Decision: Use CSS selectors instead of a custom query language (like Cypher or GraphQL).</p> <p>Rationale: - Everyone already knows CSS selectors - Powerful enough for most queries - Native browser support - Libraries available in every language</p> <p>Trade-offs: - Less expressive than Cypher for complex graph patterns - No built-in graph traversal syntax</p> <p>Why it's worth it: Zero learning curve. <code>'[data-status=\"blocked\"]'</code> is immediately understandable. For complex queries, use the Python/JS graph algorithms.</p>"},{"location":"philosophy/decisions/#pydantic-for-validation","title":"Pydantic for Validation","text":"<p>Decision: Use Pydantic models for all data structures.</p> <p>Rationale: - Type safety and validation - Automatic serialization - Excellent error messages - IDE autocomplete support</p> <p>Trade-offs: - Adds dependency (but only on Python side) - Schema changes require code updates</p> <p>Why it's worth it: Catch errors early with validation. Type hints make the SDK easier to use. Documentation comes from type annotations.</p>"},{"location":"philosophy/decisions/#justhtml-for-parsing","title":"justhtml for Parsing","text":"<p>Decision: Use justhtml library for HTML parsing in Python.</p> <p>Rationale: - Pure Python, no C dependencies - Simple API - Works in restrictive environments - Small footprint</p> <p>Trade-offs: - Slower than lxml for large files - Less features than BeautifulSoup</p> <p>Why it's worth it: Zero-dependency install works everywhere. Performance is fine for typical graph sizes (thousands of nodes).</p>"},{"location":"philosophy/decisions/#optional-sqlite-index","title":"Optional SQLite Index","text":"<p>Decision: Make SQLite index optional, not required.</p> <p>Rationale: - Most use cases work fine with file system queries - Adds complexity - Must be kept in sync</p> <p>Trade-offs: - Slower queries for large graphs without index - More features when index is enabled</p> <p>Why it's worth it: Start simple. Add complexity only when needed. The 80% case doesn't need a database.</p>"},{"location":"philosophy/decisions/#trackbuilder-fluent-api","title":"TrackBuilder Fluent API","text":"<p>Decision: Provide a fluent builder pattern for track creation.</p> <p>Rationale: - Reads like English - Self-documenting - Guides users through required fields - Chainable for conciseness</p> <p>Example: <pre><code>track = sdk.tracks.builder() \\\n    .title(\"Project\") \\\n    .with_spec(overview=\"...\") \\\n    .with_plan_phases([...]) \\\n    .create()\n</code></pre></p> <p>Trade-offs: - More code than dictionary-based API - Another pattern to learn</p> <p>Why it's worth it: Discoverability through method chaining. IDE autocomplete shows what's available. Errors caught at build time, not creation time.</p>"},{"location":"philosophy/decisions/#auto-generated-ids","title":"Auto-generated IDs","text":"<p>Decision: Auto-generate IDs (timestamp-based) instead of user-provided.</p> <p>Rationale: - No collision risk - Sortable by creation time - Deterministic (timestamp + type) - No user decision required</p> <p>Format: <code>{type}-YYYYMMDD-HHMMSS</code></p> <p>Trade-offs: - Less human-friendly than <code>\"user-auth\"</code> - Not portable across time zones (uses UTC)</p> <p>Why it's worth it: One less thing for users to think about. Collisions impossible. Easy to debug (timestamp shows when created).</p>"},{"location":"philosophy/decisions/#session-management-via-hooks","title":"Session Management via Hooks","text":"<p>Decision: Use hooks for automatic session management, not manual SDK calls.</p> <p>Rationale: - Zero user effort - Can't forget to start/end session - Consistent across all agents - Framework-agnostic</p> <p>Trade-offs: - Requires hook configuration - Less explicit than manual calls - Might capture unwanted activity</p> <p>Why it's worth it: Agent developers don't think about sessions. Attribution happens automatically. Context preserved across conversations.</p>"},{"location":"philosophy/decisions/#html-css-js-dashboard","title":"HTML + CSS + JS Dashboard","text":"<p>Decision: Build dashboard with vanilla HTML/CSS/JS, not React/Vue.</p> <p>Rationale: - No build step required - Works offline immediately - Easier to understand and modify - No framework lock-in</p> <p>Trade-offs: - More verbose code - Less sophisticated state management - Limited component reuse</p> <p>Why it's worth it: Open <code>index.html</code> in a browser and it works. No <code>npm install</code>, no build process. View source to understand how it works.</p>"},{"location":"philosophy/decisions/#git-as-version-control","title":"Git as Version Control","text":"<p>Decision: Design for Git from the start, not as an afterthought.</p> <p>Rationale: - Developers already use Git - Perfect for text files - Branching and merging work naturally - History and diffs are meaningful</p> <p>Trade-offs: - Large graphs might have slow diffs - Merge conflicts possible (though readable)</p> <p>Why it's worth it: Real version control, not change logs. Branches for experimentation. History shows evolution of work.</p>"},{"location":"philosophy/decisions/#python-sdk-first","title":"Python SDK First","text":"<p>Decision: Build Python SDK first, JavaScript second.</p> <p>Rationale: - AI agents primarily use Python - Rich ecosystem (Pydantic, etc.) - Type hints for documentation - Easier to validate designs</p> <p>Trade-offs: - JavaScript users wait longer - Some duplication of logic</p> <p>Why it's worth it: Focus on primary users (agents) first. Get it right in one language, then port. JavaScript can still use HTML directly.</p>"},{"location":"philosophy/decisions/#mit-license","title":"MIT License","text":"<p>Decision: Use MIT license, not GPL or proprietary.</p> <p>Rationale: - Maximum freedom for users - Commercial use allowed - Compatible with everything - Simple and clear</p> <p>Trade-offs: - Can't prevent proprietary forks - No patent protection</p> <p>Why it's worth it: Maximize adoption. No licensing worries. Good for community.</p>"},{"location":"philosophy/decisions/#immutable-by-default","title":"Immutable by Default","text":"<p>Decision: Pydantic models are immutable by default.</p> <p>Rationale: - Prevents accidental modifications - Thread-safe reads - Explicit about changes (must call <code>.save()</code>)</p> <p>Trade-offs: - Must create new instances for changes - More verbose update code</p> <p>Why it's worth it: Explicit is better than implicit. Prevents bugs from unexpected mutations. Clear when data is being persisted.</p>"},{"location":"philosophy/decisions/#decisions-we-didnt-make","title":"Decisions We Didn't Make","text":""},{"location":"philosophy/decisions/#why-not-mongodb","title":"Why not MongoDB?","text":"<ul> <li>Binary format (not human-readable)</li> <li>Requires server</li> <li>Complex deployment</li> <li>Not a graph database</li> </ul>"},{"location":"philosophy/decisions/#why-not-graphql","title":"Why not GraphQL?","text":"<ul> <li>Too complex for this use case</li> <li>Schema definition overhead</li> <li>Requires server</li> <li>CSS selectors are simpler</li> </ul>"},{"location":"philosophy/decisions/#why-not-markdown","title":"Why not Markdown?","text":"<ul> <li>Can't represent structured properties</li> <li>No native relationship types</li> <li>Needs front matter (not standard)</li> <li>HTML is more flexible</li> </ul>"},{"location":"philosophy/decisions/#why-not-rdfsemantic-web","title":"Why not RDF/Semantic Web?","text":"<ul> <li>Too complex</li> <li>Poor tooling</li> <li>Steep learning curve</li> <li>Overkill for most use cases</li> </ul>"},{"location":"philosophy/decisions/#next-steps","title":"Next Steps","text":"<ul> <li>Why HTML? - Core philosophy</li> <li>Comparisons - vs alternatives</li> <li>Contributing - Help improve HtmlGraph</li> </ul>"},{"location":"philosophy/why-html/","title":"Why HTML?","text":"<p>The philosophy behind \"HTML is All You Need\"</p>"},{"location":"philosophy/why-html/#the-problem","title":"The Problem","text":"<p>Modern AI agent systems are drowning in complexity:</p> <ul> <li>Neo4j/Memgraph: Requires Docker, JVM, learning Cypher query language</li> <li>Redis: Adds caching and state management overhead</li> <li>PostgreSQL: Heavy relational database setup and maintenance</li> <li>Custom Protocols: Proprietary agent coordination systems</li> <li>JSON/YAML: Manual reference management, no native graph structure</li> <li>Separate UIs: Additional observability tools and dashboards</li> </ul> <p>Each component adds:</p> <ul> <li>Installation friction</li> <li>Learning curve</li> <li>Runtime dependencies</li> <li>Maintenance burden</li> <li>Integration complexity</li> </ul>"},{"location":"philosophy/why-html/#the-insight","title":"The Insight","text":"<p>The web is already a giant graph database.</p> <p>Every HTML document has:</p> <ul> <li>Nodes: HTML files</li> <li>Edges: Hyperlinks (<code>&lt;a href&gt;</code>)</li> <li>Properties: <code>data-*</code> attributes</li> <li>Query language: CSS selectors</li> <li>Presentation: Built-in rendering with CSS</li> <li>Portability: Works everywhere</li> <li>Version control: Git-friendly text format</li> </ul>"},{"location":"philosophy/why-html/#core-principles","title":"Core Principles","text":""},{"location":"philosophy/why-html/#1-standards-over-invention","title":"1. Standards Over Invention","text":"<p>Use existing web standards instead of creating new ones:</p> <ul> <li>HTML for structure and content</li> <li>CSS for styling and presentation</li> <li>JavaScript for interactivity</li> <li>HTTP for serving</li> <li>CSS Selectors for querying</li> </ul> <p>These standards are:</p> <ul> <li>Well-documented</li> <li>Universally supported</li> <li>Battle-tested</li> <li>Familiar to everyone</li> </ul>"},{"location":"philosophy/why-html/#2-human-readable-first","title":"2. Human-Readable First","text":"<p>Optimizing for human readability has unexpected benefits:</p> <ul> <li>Debugging: View source in any browser</li> <li>Version control: Meaningful git diffs</li> <li>Onboarding: No special tools to learn</li> <li>Trust: See exactly what's stored</li> <li>Portability: Works in any environment</li> </ul>"},{"location":"philosophy/why-html/#3-minimal-infrastructure","title":"3. Minimal Infrastructure","text":"<p>The HTML files themselves work with just:</p> <ul> <li>A file system</li> <li>A web browser</li> </ul> <p>The SDK requires minimal Python dependencies:</p> <ul> <li><code>pydantic</code> - Data validation and models</li> <li><code>justhtml</code> - HTML parsing</li> <li><code>watchdog</code> - File watching for live updates</li> <li><code>sqlite3</code> - Indexing (Python standard library)</li> </ul> <p>What you don't need:</p> <ul> <li>Docker containers</li> <li>External database servers (Neo4j, Redis, PostgreSQL)</li> <li>Build tools or compilation</li> <li>Cloud services or API keys</li> <li>Daemon processes</li> </ul>"},{"location":"philosophy/why-html/#4-offline-first","title":"4. Offline First","text":"<p>HtmlGraph works completely offline:</p> <ul> <li>No network required</li> <li>No authentication</li> <li>No cloud sync</li> <li>No external services</li> </ul> <p>Copy the <code>.htmlgraph/</code> directory anywhere and it just works.</p>"},{"location":"philosophy/why-html/#5-git-native","title":"5. Git Native","text":"<p>HTML is plain text, which means:</p> <ul> <li>Diffs show real changes: See exactly what changed</li> <li>Merge conflicts are readable: Resolve conflicts easily</li> <li>History is meaningful: Understand evolution over time</li> <li>Branches work naturally: Experiment safely</li> </ul>"},{"location":"philosophy/why-html/#6-ai-agent-friendly","title":"6. AI Agent Friendly","text":"<p>HTML is ideal for AI agents:</p> <ul> <li>Structured but flexible: Easy to parse and generate</li> <li>Self-documenting: Content and metadata together</li> <li>Hyperlinks are native: Relationships are first-class</li> <li>CSS selectors: Powerful query language agents already know</li> </ul>"},{"location":"philosophy/why-html/#benefits","title":"Benefits","text":""},{"location":"philosophy/why-html/#for-developers","title":"For Developers","text":"<ul> <li>Fast setup: <code>pip install htmlgraph</code>, done</li> <li>No configuration: Works out of the box</li> <li>View in browser: Open any file to see it styled</li> <li>Standard tools: Git, text editors, browsers</li> </ul>"},{"location":"philosophy/why-html/#for-ai-agents","title":"For AI Agents","text":"<ul> <li>Simple API: SDK or direct HTML manipulation</li> <li>Context-efficient: Lightweight node representation</li> <li>Clear attribution: Session tracking built-in</li> <li>Deterministic: TrackBuilder for repeatable workflows</li> </ul>"},{"location":"philosophy/why-html/#for-teams","title":"For Teams","text":"<ul> <li>No infrastructure: No databases to maintain</li> <li>Easy sharing: Commit to git, done</li> <li>Transparent: Everyone can view the graph</li> <li>Accessible: No special permissions or access</li> </ul>"},{"location":"philosophy/why-html/#for-projects","title":"For Projects","text":"<ul> <li>Low overhead: Files on disk, that's it</li> <li>Scalable: Millions of nodes possible</li> <li>Portable: Move projects easily</li> <li>Archivable: HTML will outlive most databases</li> </ul>"},{"location":"philosophy/why-html/#trade-offs","title":"Trade-offs","text":""},{"location":"philosophy/why-html/#what-you-gain","title":"What You Gain","text":"<ul> <li>Simplicity</li> <li>Portability</li> <li>Human readability</li> <li>Minimal infrastructure (no Docker, databases, or daemons)</li> <li>Git integration</li> <li>Universal compatibility</li> </ul>"},{"location":"philosophy/why-html/#what-you-give-up","title":"What You Give Up","text":"<ul> <li>Sub-millisecond queries (add SQLite index if needed)</li> <li>Complex graph algorithms (implement in Python/JS)</li> <li>Concurrent writes (use file locking or optimistic concurrency)</li> <li>Database GUI tools (use the HTML dashboard instead)</li> </ul> <p>The trade-off is worth it for most use cases. When you need advanced graph features, add them incrementally.</p>"},{"location":"philosophy/why-html/#philosophy-in-practice","title":"Philosophy in Practice","text":""},{"location":"philosophy/why-html/#start-simple","title":"Start Simple","text":"<pre><code># Just create a feature\nfeature = sdk.features.create(\"Add login\")\n\n# It's an HTML file\n# Open it in a browser\n# That's it\n</code></pre>"},{"location":"philosophy/why-html/#add-complexity-only-when-needed","title":"Add Complexity Only When Needed","text":"<pre><code># Need better query performance?\n# Add SQLite index (optional)\nsdk.rebuild_index()\n\n# Need complex graph analysis?\n# Use the graph algorithms\npath = sdk.graph.shortest_path(start, end)\n</code></pre>"},{"location":"philosophy/why-html/#trust-web-standards","title":"Trust Web Standards","text":"<p>Don't reinvent what browsers already do:</p> <ul> <li>Styling: Use CSS, not custom renderers</li> <li>Queries: Use CSS selectors, not custom query language</li> <li>Storage: Use HTML files, not custom formats</li> <li>Serving: Use HTTP, not custom protocols</li> </ul>"},{"location":"philosophy/why-html/#comparisons","title":"Comparisons","text":""},{"location":"philosophy/why-html/#vs-neo4j","title":"vs Neo4j","text":"Feature Neo4j HtmlGraph Setup Docker + JVM + Cypher <code>pip install</code> Query Learn Cypher CSS selectors View data Neo4j Browser Any web browser Version control Binary exports Git diff Portability Requires runtime Just files"},{"location":"philosophy/why-html/#vs-jsonyaml","title":"vs JSON/YAML","text":"Feature JSON/YAML HtmlGraph Structure Manual references Native hyperlinks Presentation Needs separate UI Built-in rendering Querying jq or custom CSS selectors Validation JSON Schema HTML + Pydantic"},{"location":"philosophy/why-html/#vs-notionroam","title":"vs Notion/Roam","text":"Feature Notion/Roam HtmlGraph Ownership Cloud-hosted Your filesystem API Rate-limited Direct file access Offline Limited Full functionality Version control Not supported Git native Agent access API tokens Direct SDK"},{"location":"philosophy/why-html/#the-future","title":"The Future","text":"<p>HTML isn't going anywhere. By building on web standards, HtmlGraph will work:</p> <ul> <li>In 10 years</li> <li>On any platform</li> <li>With any tools</li> <li>For any use case</li> </ul> <p>HTML is all you need.</p>"},{"location":"philosophy/why-html/#next-steps","title":"Next Steps","text":"<ul> <li>Comparisons - Detailed comparisons with alternatives</li> <li>Design Decisions - Why specific choices were made</li> <li>Getting Started - Try it yourself</li> </ul>"}]}