<div class="view-container activity-feed-view">
    <div class="view-header">
        <h2>Agent Activity Feed</h2>
        <div class="view-info">
            <small>Hierarchical view showing Task delegations with nested subagent activity</small>
        </div>
        <div class="view-filters">
            <input type="text"
                   class="filter-input"
                   placeholder="Filter by agent..."
                   hx-get="/views/activity-feed"
                   hx-target="#content-area"
                   hx-trigger="input changed delay:500ms"
                   name="agent_id">
        </div>
    </div>

    <div class="activity-list hierarchical">
        {% if hierarchical_events %}
            {% for group in hierarchical_events %}
                <!-- Parent Event (Task Delegation or Root Activity) -->
                <div class="activity-group" data-parent-id="{{ group.parent.event_id }}">
                    <div class="activity-item parent-event event-{{ group.parent.status }}">
                        <div class="activity-item-header">
                            <span class="parent-indicator">ğŸ“Œ</span>
                            <span class="event-type-badge" title="Parent: {{ group.parent.event_type }}">
                                {% if group.parent.event_type == 'delegation' %}
                                    ğŸ”—
                                {% elif group.parent.event_type == 'tool_call' %}
                                    ğŸ”¨
                                {% elif group.parent.event_type == 'completion' %}
                                    ğŸ‰
                                {% else %}
                                    ğŸ“‹
                                {% endif %}
                            </span>
                            <span class="agent-name">{{ group.parent.agent_id }}</span>
                            <span class="parent-type-label">
                                {% if group.has_children %}
                                    <span class="badge badge-delegation">Task</span>
                                {% endif %}
                            </span>
                            <span class="event-timestamp">{{ group.parent.timestamp }}</span>
                        </div>

                        {% if group.parent.tool_name %}
                        <div class="activity-item-tool">
                            <code class="tool-name">{{ group.parent.tool_name }}</code>
                        </div>
                        {% endif %}

                        <div class="activity-item-content">
                            {% if group.parent.input_summary %}
                            <div class="event-input">
                                <span class="summary-label">Input:</span>
                                <span class="summary-text">{{ group.parent.input_summary[:150] }}{% if group.parent.input_summary|length > 150 %}...{% endif %}</span>
                            </div>
                            {% endif %}

                            {% if group.parent.output_summary %}
                            <div class="event-output">
                                <span class="summary-label">Output:</span>
                                <span class="summary-text">{{ group.parent.output_summary[:150] }}{% if group.parent.output_summary|length > 150 %}...{% endif %}</span>
                            </div>
                            {% endif %}
                        </div>

                        <div class="activity-item-footer">
                            <span class="event-id" title="{{ group.parent.event_id }}">{{ group.parent.event_id[:8] }}</span>
                            <span class="session-id" title="{{ group.parent.session_id }}">{{ group.parent.session_id[:8] }}</span>
                        </div>
                    </div>

                    <!-- Child Events (Subagent Work) -->
                    {% if group.has_children %}
                    <div class="activity-children">
                        {% for child in group.children %}
                        <div class="activity-item child-event event-{{ child.status }}">
                            <div class="child-indent-marker"></div>

                            <div class="activity-item-header">
                                <span class="child-indicator">â†³</span>
                                <span class="event-type-badge" title="Child: {{ child.event_type }}">
                                    {% if child.event_type == 'tool_call' %}
                                        ğŸ”¨
                                    {% elif child.event_type == 'tool_result' %}
                                        âœ…
                                    {% elif child.event_type == 'error' %}
                                        âŒ
                                    {% elif child.event_type == 'delegation' %}
                                        ğŸ”—
                                    {% elif child.event_type == 'completion' %}
                                        ğŸ‰
                                    {% else %}
                                        ğŸ“Œ
                                    {% endif %}
                                </span>
                                <span class="agent-name">{{ child.agent_id }}</span>
                                <span class="event-timestamp">{{ child.timestamp }}</span>
                            </div>

                            {% if child.tool_name %}
                            <div class="activity-item-tool">
                                <code class="tool-name">{{ child.tool_name }}</code>
                            </div>
                            {% endif %}

                            <div class="activity-item-content">
                                {% if child.input_summary %}
                                <div class="event-input">
                                    <span class="summary-label">Input:</span>
                                    <span class="summary-text">{{ child.input_summary[:150] }}{% if child.input_summary|length > 150 %}...{% endif %}</span>
                                </div>
                                {% endif %}

                                {% if child.output_summary %}
                                <div class="event-output">
                                    <span class="summary-label">Output:</span>
                                    <span class="summary-text">{{ child.output_summary[:150] }}{% if child.output_summary|length > 150 %}...{% endif %}</span>
                                </div>
                                {% endif %}
                            </div>

                            <div class="activity-item-footer">
                                <span class="event-id" title="{{ child.event_id }}">{{ child.event_id[:8] }}</span>
                                <span class="parent-ref" title="Parent: {{ child.parent_event_id }}">â† {{ child.parent_event_id[:8] }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>No events found</p>
                <small>Agent activity will appear here as tasks are executed</small>
            </div>
        {% endif %}
    </div>

    <!-- Auto-refresh indicator -->
    <div class="auto-refresh-indicator">
        <span class="refresh-dot"></span>
        Live updates enabled (via WebSocket)
    </div>
</div>
