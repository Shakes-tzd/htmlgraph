<div class="view-container activity-feed-view">
    <div class="view-header">
        <h2>Agent Activity Feed</h2>
        <div class="view-filters">
            <input type="text"
                   class="filter-input"
                   placeholder="Filter by agent..."
                   hx-get="/views/activity-feed"
                   hx-target="#content-area"
                   hx-trigger="input changed delay:500ms"
                   name="agent_id">
        </div>
    </div>

    <div class="activity-list">
        {% if events %}
            {% for event in events %}
            {% set is_child = event.parent_event_id is defined and event.parent_event_id %}
            <div class="activity-item event-{{ event.status }} {{ 'child-activity' if is_child else '' }}"
                 style="{{ 'margin-left: 2rem; border-left: 2px solid var(--border); padding-left: 1rem;' if is_child else '' }}">
                <div class="activity-item-header">
                    <span class="event-type-badge" title="{{ event.event_type }}">
                        {% if event.event_type == 'tool_call' %}
                            ğŸ”¨
                        {% elif event.event_type == 'tool_result' %}
                            âœ…
                        {% elif event.event_type == 'error' %}
                            âŒ
                        {% elif event.event_type == 'delegation' %}
                            ğŸ”—
                        {% elif event.event_type == 'completion' %}
                            ğŸ‰
                        {% else %}
                            ğŸ“‹
                        {% endif %}
                    </span>
                    <span class="agent-name agent-{{ event.agent_id|lower }}">{{ event.agent_id }}</span>
                    {% if is_child %}
                        <span class="child-indicator">â†³ sub-task</span>
                    {% endif %}
                    <span class="event-timestamp" data-utc-time="{{ event.timestamp }}">{{ event.timestamp }}</span>
                </div>

                {% if event.tool_name %}
                <div class="activity-item-tool">
                    <code class="tool-name">{{ event.tool_name }}</code>
                </div>
                {% endif %}

                <div class="activity-item-content">
                    {% if event.input_summary %}
                    <div class="event-input">
                        <span class="summary-label">Input:</span>
                        <span class="summary-text">{{ event.input_summary[:100] }}{% if event.input_summary|length > 100 %}...{% endif %}</span>
                    </div>
                    {% endif %}

                    {% if event.output_summary %}
                    <div class="event-output">
                        <span class="summary-label">Output:</span>
                        <span class="summary-text">{{ event.output_summary[:100] }}{% if event.output_summary|length > 100 %}...{% endif %}</span>
                    </div>
                    {% endif %}
                </div>

                <div class="activity-item-footer">
                    <span class="event-id" title="{{ event.event_id }}">{{ event.event_id[:8] }}</span>
                    <span class="session-id" title="{{ event.session_id }}">Session: {{ event.session_id[:8] }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>No events found</p>
                <small>Agent activity will appear here as tasks are executed</small>
            </div>
        {% endif %}
    </div>

    <!-- Auto-refresh indicator -->
    <div class="auto-refresh-indicator">
        <span class="refresh-dot"></span>
        Live updates enabled (via WebSocket)
    </div>
</div>
